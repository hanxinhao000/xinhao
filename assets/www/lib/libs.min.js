/*! zepto 2017-07-10 */
function formatAmSqlParams(){this.TABLENAME,this.ROWS=new Array}function formatAmSqlupdateRow(){this.STATUS,this.ID,this.COLUMNS=new Array}function formatAmSqlParamsToArr(obj){var jarr=new Array;return jarr.push(obj),JSON.stringify(jarr)}var mallMobileApp=angular.module("mallMobileApp",["ionic","mallMobileApp.controllers","mallMobileApp.services","am.sdk","angular-md5","ngFileUpload","ngCordova","am.banner","am.bar","ab-base64"]),mallMobileAppServices=angular.module("mallMobileApp.services",[]),mallMobileAppControllers=angular.module("mallMobileApp.controllers",[]);angular.module("mallMobileApp").run(["$cordovaDevice","$ionicPlatform","toolsService","Authen","$rootScope","$cordovaToast","$ionicHistory","appConfig","PlatformManagerService","$cordovaGeolocation","$cordovaSplashscreen","$cordovaAppVersion","$state","$cordovaDialogs","$cordovaNetwork","ReceiveMessageService","ajaxManager",function($cordovaDevice,$ionicPlatform,toolsService,Authen,$rootScope,$cordovaToast,$ionicHistory,appConfig,PlatformManagerService,$cordovaGeolocation,$cordovaSplashscreen,$cordovaAppVersion,$state,$cordovaDialogs,$cordovaNetwork,ReceiveMessageService,ajaxManager){document.addEventListener("offline",function(){$cordovaDialogs.alert("无法连接网络,请检查你的网络是否正常,重新进入APP!","提示","确定").then(function(){navigator.app.exitApp(),ionic.Platform.exitApp()})},!1),$ionicPlatform.ready(function(){$ionicPlatform.on("deviceready",function(){function initiateUI(){console.debug("极光推送注册");try{window.plugins.jPushPlugin.init(),window.plugins.jPushPlugin.getRegistrationID(function(data){try{toolsService.isEmpty(data)&&window.setTimeout(initiateUI,1e3),console.debug("极光推送注册id="+data),registrationid=data,PlatformManagerService.registXingeToken(Authen.getUserId(),data,platformStr)}catch(exception){console.log(exception)}}),"android"!=platformStr?(window.plugins.jPushPlugin.setDebugModeFromIos(),window.plugins.jPushPlugin.setApplicationIconBadgeNumber(0)):(window.plugins.jPushPlugin.setDebugMode(!0),window.plugins.jPushPlugin.setStatisticsOpen(!0))}catch(exception){console.log(exception)}}function onReceiveMessage(event){var message;if("android"==platformStr){var result_event=null,data=JSON.parse(event.message);result_event={message:data.DATA.content,extras:{"cn.jpush.android.CONTENT_TYPE":"text",title:data.DATA.title,memberid:data.DATA.memberid,friendid:data.DATA.friendId,phone:data.DATA.phone,groupid:data.DATA.groupid,groupno:data.DATA.groupno,imgcontent:data.DATA.imgcontent,type:data.DATA.type,"cn.jpush.android.EXTRA":{title:data.DATA.title,memberid:data.DATA.memberid,friendid:data.DATA.friendId,phone:data.DATA.phone,imgcontent:data.DATA.imgcontent,type:data.DATA.type},"cn.jpush.android.MSG_ID":event.extras["cn.jpush.android.MSG_ID"]}},message=data.DATA.content,ReceiveMessageService.addReceiveMessage(result_event,message,platformStr)}else{var result_event=null,data=JSON.parse(event.content);result_event={message:data.DATA.content,extras:{"cn.jpush.android.CONTENT_TYPE":"text",title:data.DATA.title,memberid:data.DATA.memberid,friendid:data.DATA.friendId,phone:data.DATA.phone,groupid:data.DATA.groupid,groupno:data.DATA.groupno,imgcontent:data.DATA.imgcontent,type:data.DATA.type,"cn.jpush.ios.EXTRA":{title:data.DATA.title,memberid:data.DATA.memberid,friendid:data.DATA.friendId,phone:data.DATA.phone,imgcontent:data.DATA.imgcontent,type:data.DATA.type},"cn.jpush.android.MSG_ID":(new Date).getTime()}},console.info("苹果通知:"+JSON.stringify(result_event)),message=data.DATA.content,ReceiveMessageService.addReceiveMessage(result_event,message,platformStr)}}function UserGPS(){baidu_location.getCurrentPosition(function(data){console.info("定位："+JSON.parse(data).latitude+" | "+JSON.parse(data).lontitude),lat=JSON.parse(data).latitude,long=JSON.parse(data).lontitude,Authen.setDriverLocation(long,lat),console.info("$cordovaGeolocation.watchPosition.position = "+lat+" | "+long)},function(data){})}ajaxManager.getTonken(),appConfig.isDerive=!0;var platformStr="";ionic.Platform.isAndroid()?platformStr="android":ionic.Platform.isIOS()&&(platformStr="ios"),PlatformManagerService.setMobileType(platformStr),ajaxManager.getTonken(),$ionicPlatform.registerBackButtonAction(function(e){return"#/mall/message"==location.hash||location.hash.indexOf("member/login")>0?$rootScope.backButtonPressedOnceToExit?ionic.Platform.exitApp():($rootScope.backButtonPressedOnceToExit=!0,$cordovaToast.showLongCenter("再按一次退出系统"),setTimeout(function(){$rootScope.backButtonPressedOnceToExit=!1},2e3)):$ionicHistory.backView()?$ionicHistory.goBack():($rootScope.backButtonPressedOnceToExit=!0,$cordovaToast.showLongCenter("再按一次退出系统"),setTimeout(function(){$rootScope.backButtonPressedOnceToExit=!1},2e3)),e.preventDefault(),!1},101),Authen.getLocationOfBMap(),cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),cordova.plugins.Keyboard.disableScroll(!0),StatusBar.backgroundColorByHexString("#2ad4d4"),initiateUI();var onReceiveNotification=function(event){try{"Android"==$cordovaDevice.getPlatform()?(console.info("安卓通知:"+JSON.stringify(event)),alertContent=event.alert):(console.info("苹果通知asd:"+JSON.stringify(event)),alertContent=event.aps.alert,alertObj=event)}catch(exception){console.log(exception)}};if(document.addEventListener("jpush.receiveNotification",onReceiveNotification,!1),window.setTimeout(document.addEventListener("jpush.receiveMessage",onReceiveMessage,!1),1e3),onOpenNotification=function(event){try{var alertContent,arr=null;"Android"==$cordovaDevice.getPlatform()?(alertContent=event.extras.jsonExtra,"1"==event.extras["cn.jpush.android.NOTIFICATION_TYPE"]?(arr=event.extras.url.split("/"),console.debug("toolsService.toStateOfServerUrl().$state.go("+arr[0]+",{params:"+arr[1]+"})"),$state.go(arr[0],{params:arr[1]})):toolsService.isEmpty(alertContent)||(alertContent=JSON.parse(alertContent),toolsService.toStateOfServerUrl($state,alertContent))):(alertContent=event.jsonExtra,window.plugins.jPushPlugin.setApplicationIconBadgeNumber(0),"1"==event["cn.jpush.android.NOTIFICATION_TYPE"]?(arr=event.url.split("/"),console.debug("toolsService.toStateOfServerUrl().$state.go("+arr[0]+",{params:"+arr[1]+"})"),$state.go(arr[0],{params:arr[1]})):toolsService.isEmpty(alertContent)||(console.debug(alertContent),alertContent=JSON.parse(alertContent),toolsService.toStateOfServerUrl($state,alertContent)))}catch(exception){console.log("JPushPlugin:onOpenNotification"+exception)}},document.addEventListener("jpush.openNotification",onOpenNotification,!1),toolsService.platform())UserGPS(),setInterval(function(){UserGPS()},1e4);else{var watchOptions={timeout:1e5,maximumAge:1e4,enableHighAccuracy:!1},watch=$cordovaGeolocation.watchPosition(watchOptions);watch.then(null,function(err){console.info("$cordovaGeolocation.watchPosition.err = "+err)},function(position){var lat=position.coords.latitude,long=position.coords.longitude;Authen.setDriverLocation(long,lat),console.info("$cordovaGeolocation.watchPosition.position = "+lat+" | "+long)})}$cordovaSplashscreen.hide(),ionic.Platform.isAndroid()&&$cordovaAppVersion.getVersionNumber().then(function(version){console.info(" --- This APP Version ["+version+"] --- "),appConfig.version=version,ionic.Platform.isIOS()||toolsService.checkAndroidAppVersion(version)})}),PlatformManagerService.otherInstall(),Authen.loginOfAuto(function(){console.info("Auto Login Authen.isAuthorized()="+Authen.isAuthorized())})})}]),angular.module("mallMobileApp").config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","$httpProvider","ACCESS_LEVELS","appConfig","$compileProvider",function($stateProvider,$urlRouterProvider,$ionicConfigProvider,$httpProvider,ACCESS_LEVELS,appConfig,$compileProvider){$compileProvider.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|sms|bdapp):/),$ionicConfigProvider.platform.ios.tabs.style("standard"),$ionicConfigProvider.platform.ios.tabs.position("bottom"),$ionicConfigProvider.platform.android.tabs.style("standard"),$ionicConfigProvider.platform.android.tabs.position("standard"),$ionicConfigProvider.platform.ios.navBar.alignTitle("center"),$ionicConfigProvider.platform.android.navBar.alignTitle("center"),$ionicConfigProvider.platform.ios.backButton.text("返回"),$ionicConfigProvider.platform.android.backButton.text("返回"),$ionicConfigProvider.platform.ios.backButton.previousTitleText("").icon("ion-ios-arrow-thin-left"),$ionicConfigProvider.platform.android.backButton.previousTitleText("").icon("ion-android-arrow-back"),$ionicConfigProvider.platform.ios.views.transition("none"),$ionicConfigProvider.platform.android.views.transition("none"),$ionicConfigProvider.views.transition("none"),$ionicConfigProvider.views.swipeBackEnabled(!1),$ionicConfigProvider.views.transition("none"),$ionicConfigProvider.scrolling.jsScrolling(!0),$stateProvider.state("guide",{url:"/guide","abstract":!0,templateUrl:"app_plugins/common/views/guidepage_main.html"}).state("guide.step1",{url:"/step1",views:{guidepage_view:{templateUrl:"app_plugins/common/views/guidepage.html",controller:"GuideCtrl"}}}).state("mall",{url:"/mall","abstract":!0,templateUrl:"app_plugins/mall/views/uoou_mall.html"}).state("mall.home",{url:"/home",cache:!1,views:{"mall-home":{templateUrl:"app_plugins/mall/home/views/home_page.html",controller:"homeIndexControllers"}}}).state("commodity",{url:"/commodity","abstract":!0,templateUrl:"app_plugins/mall/commodity/views/commodity_view_page.html"}).state("mall.weChartIn",{url:"/weChartIn/:params",cache:!1,views:{"mall-home":{templateUrl:"app_plugins/mall/home/views/home_page.html",controller:"homeIndexControllers"}}}).state("commodity.commodityList",{url:"/commodityList/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/mall/commodity/comd_list/views/comd_list_page.html",controller:"ComdListCtrl"}}}).state("commodity.searchList",{url:"/searchList/:cparams",views:{commodity_view:{templateUrl:"app_plugins/mall/commodity/comd_list/views/comd_list_page.html",controller:"ComdListCtrl"}}}).state("commodity.comdDetails",{url:"/comdDetails/:id",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/mall/commodity/comd_details/views/comd_details.html",controller:"ComdDetailsCtrl"}}}).state("commodity.comdFormat",{url:"/comdFormat/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/mall/commodity/comd_format/views/comd_format_page.html",controller:"ComdFormatCtrl"}}}).state("commodity.shop",{url:"/shop",views:{commodity_view:{templateUrl:"app_plugins/mall/shop/views/shop_page.html",controller:"ShopCtrl"}}}).state("commodity.mallclass",{url:"/mallclass",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/mall/mall_class/views/mall_class_page.html",controller:"mallClassControllers"}}}).state("commodity.mallclassDetail",{url:"/mallclassDetail/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/mall/mall_class/views/mall_class_detail_page.html",controller:"mallClassDetailControllers"}}}).state("commodity.inputProductMall",{url:"/inputProductMall/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/mall/mall_class/views/mall_class_detail_page.html",controller:"mallClassDetailControllers"}}}).state("mall.shopcard",{url:"/shopcard",cache:!1,intcude:"member.shopcard",intName:"我的购物车",access_level:ACCESS_LEVELS.user,views:{"mall-shop-card":{templateUrl:"app_plugins/mall/shop_card/views/shop_card_page.html",controller:"ShopCardCtrl"}}}).state("mall.mine",{url:"/mine",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/views/mine_view_page.html",controller:"MineCtrl"}}}).state("more",{url:"/more","abstract":!0,templateUrl:"frame/more/views/more_view_page.html"}).state("mall.more",{url:"/more",cache:!1,views:{"am-more":{templateUrl:"frame/more/views/more_page.html",controller:"MoreCtrl"}}}).state("more.about",{url:"/about",cache:!1,views:{more_view:{templateUrl:"frame/more/about/views/about_page.html",controller:"AboutCtrl"}}}).state("more.content",{url:"/content/:key",views:{more_view:{templateUrl:"frame/more/content/views/content_page.html",controller:"ContentCtrl"}}}).state("more.koppTrain",{url:"/koppTrain",intcude:"more.koppTrain",intName:"理性农业科普培训",views:{more_view:{templateUrl:"frame/more/kopp_train/views/kopp_train_page.html",controller:"koppTrainCtrl"}}}).state("more.koppTrainDetails",{url:"/koppTrainDetails/:id",cache:!1,views:{more_view:{templateUrl:"frame/more/kopp_train/views/kopp_train_details_page.html",controller:"koppTrainDetailsCtrl"}}}).state("more.myArticle",{url:"/myArticle/:params",cache:!1,intcude:"more.myArticle",intName:"理性农业科普培训我的文章",access_level:ACCESS_LEVELS.user,views:{more_view:{templateUrl:"frame/more/kopp_train/views/my_article_page.html",controller:"myArticleCtrl"}}}).state("more.signUp",{url:"/signUp",cache:!1,intcude:"more.signUp",intName:"科普培训我要报名",views:{more_view:{templateUrl:"frame/more/kopp_train/views/sign_up_page.html",controller:"signUpCtrl"}}}).state("more.signUpDetails",{url:"/signUpDetails/:id",cache:!1,views:{more_view:{templateUrl:"frame/more/kopp_train/views/sign_up_details_page.html",controller:"signUpDetailsCtrl"}}}).state("more.confirmSignUp",{url:"/confirmSignUp/:params",cache:!1,views:{more_view:{templateUrl:"frame/more/kopp_train/views/confirm_sign_up_page.html",controller:"confirmSignUpCtrl"}}}).state("more.mySignUp",{url:"/mySignUp/:params",cache:!1,intcude:"more.mySignUp",intName:"科普培训我的报名",views:{more_view:{templateUrl:"frame/more/kopp_train/views/my_sign_up_page.html",controller:"mySignUpCtrl"}}}).state("more.ecologyTourism",{url:"/ecologyTourism",cache:!1,intcude:"more.ecologyTourism",intName:"农业科普观光旅游",views:{more_view:{templateUrl:"frame/more/kopp_train/travel/views/ecology_tourism_page.html",controller:"ecologyTourismCtrl"}}}).state("more.ecologyTourismDetails",{url:"/ecologyTourismDetails/:id",cache:!1,views:{more_view:{templateUrl:"frame/more/kopp_train/travel/views/ecology_tourism_details_page.html",controller:"ecologyTourismDetailsCtrl"}}}).state("more.travelSignUp",{url:"/travelSignUp/:params",cache:!1,views:{more_view:{templateUrl:"frame/more/kopp_train/travel/views/travel_sign_up_page.html",controller:"TravelSignUpCtrl"}}}).state("more.myEcologyTourism",{url:"/myEcologyTourism/:params",cache:!1,intcude:"more.myEcologyTourism",intName:"我的生态旅游",views:{more_view:{templateUrl:"frame/more/kopp_train/travel/views/my_ecology_tourism_page.html",controller:"MyEcologyTourismCtrl"}}}).state("more.expertCompound",{url:"/expertCompound",intcude:"more.expertCompound",intName:"科普引智专家大院",views:{more_view:{templateUrl:"frame/more/expert_compound/views/expert_compound_page.html",controller:"expertCompoundCtrl"}}}).state("more.expertCompoundDetails",{url:"/expertCompoundDetails/:params",cache:!1,views:{more_view:{templateUrl:"frame/more/expert_compound/views/expert_compound_details_page.html",controller:"expertCompoundDetailsCtrl"}}}).state("more.publishArticles",{url:"/publishArticles/:id",cache:!1,intcude:"more.publishArticles",intName:"科普引智专家大院发布文章",views:{more_view:{templateUrl:"frame/more/expert_compound/views/publish_articles_page.html",controller:"publishArticlesCtrl"}}}).state("more.myPublishArticles",{url:"/myPublishArticles",cache:!1,views:{more_view:{templateUrl:"frame/more/expert_compound/views/my_articles_page.html",controller:"myPublishArticlesCtrl"}}}).state("more.memberPoll",{url:"/memberPoll",access_level:ACCESS_LEVELS.user,intcude:"more.memberPoll",intName:"社员代表大会",views:{more_view:{templateUrl:"frame/more/member_poll/views/member_poll_page.html",controller:"memberPollCtrl"}}}).state("more.memberPollDetails",{url:"/memberPollDetails/:id",cache:!1,views:{more_view:{templateUrl:"frame/more/member_poll/views/member_poll_details_page.html",controller:"memberPollDetailsCtrl"}}}).state("more.socialAssistance",{url:"/socialAssistance",intcude:"more.socialAssistance",intName:"社会救助",views:{more_view:{templateUrl:"frame/more/social_assistance/views/social_assistance_page.html",controller:"socialAssistanceCtrl"}}}).state("more.socialAssistanceDetails",{url:"/socialAssistanceDetails/:params",cache:!1,views:{more_view:{templateUrl:"frame/more/social_assistance/views/social_assistance_details.html",controller:"socialAssistanceDetailsCtrl"}}}).state("more.studenSupport",{url:"/studenSupport",access_level:ACCESS_LEVELS.user,intcude:"more.studenSupport",intName:"大学生资助",views:{more_view:{templateUrl:"frame/more/studen_support/views/studen_support_page.html",controller:"studenSupportCtrl"}}}).state("more.notice",{url:"/notice",cache:!1,views:{more_view:{templateUrl:"frame/more/notice/views/notice_page.html",controller:"NoticeCtrl"}}}).state("more.studentSupportDetails",{url:"/studentSupportDetails/:params",cache:!1,views:{more_view:{templateUrl:"frame/more/studen_support/views/student_support_details_page.html",controller:"studentSupportDetailsCtrl"}}}).state("more.applySupport",{url:"/applySupport",cache:!1,views:{more_view:{templateUrl:"frame/more/studen_support/views/apply_support_page.html",controller:"applySupportCtrl"}}}).state("more.myApply",{url:"/myApply",cache:!0,intcude:"more.myApply",intName:"大学生资助我的申请",views:{more_view:{templateUrl:"frame/more/studen_support/views/my_apply_page.html",controller:"myApplyCtrl"}}}).state("more.myApplyDetails",{url:"/myApplyDetails/:params",cache:!1,intcude:"more.myApplyDetails",intName:"大学生资助我的申请详情",views:{more_view:{templateUrl:"frame/more/studen_support/views/my_apply_details_page.html",controller:"myApplyDetailsCtrl"}}}).state("more.mySupport",{url:"/mySupport/:params",cache:!1,intcude:"more.mySupport",intName:"大学生资助我的资助",views:{more_view:{templateUrl:"frame/more/studen_support/views/my_support_page.html",controller:"mySupportCtrl"}}}).state("more.wishPlatform",{url:"/wishPlatform/:params",cache:!1,views:{more_view:{templateUrl:"frame/more/studen_support/views/wish_platform_page.html",controller:"wishPlatformCtrl"}}}).state("more.memberRules",{url:"/memberRules",cache:!1,views:{more_view:{templateUrl:"frame/more/member_rules/views/member_rules_page.html",controller:"memberRulesCtrl"}}}).state("commodity.ordercomment",{url:"/ordercomment/:cid",views:{commodity_view:{templateUrl:"app_plugins/mall/order/orderappraise/views/ordercomment.html",controller:"orderCommetCtrl"}}}).state("member",{url:"/member","abstract":!0,cache:!1,templateUrl:"frame/member/views/member_view_page.html"}).state("member.login",{url:"/login/:params",cache:!1,views:{member_view:{templateUrl:"frame/member/login/views/login.html",controller:"LoginCtrl"}}}).state("member.findpwd",{url:"/findpwd/:params",cache:!1,views:{member_view:{templateUrl:"frame/member/findpwsd/views/findpwsd.html",controller:"FindPwsdCtrl"}}}).state("member.dividends",{url:"/dividends",views:{member_view:{templateUrl:"frame/member/dividends/views/dividends_page.html",controller:"dividendsCtrl"}}}).state("member.virement",{url:"/virement/:accountId",cache:!1,views:{member_view:{templateUrl:"frame/member/virement/views/virement_page.html",controller:"virementCtrl"}}}).state("member.withdraw",{url:"/withdraw",cache:!1,intcude:"member.withdraw",intName:"我的提现",views:{member_view:{templateUrl:"frame/member/withdraw/views/withdraw_page.html",controller:"withdrawCtrl"}}}).state("member.withdrawDetail",{url:"/withdrawDetail/:accountId",cache:!1,views:{member_view:{templateUrl:"frame/member/withdraw/views/withdraw_detail_page.html",controller:"withdrawDetailCtrl"}}}).state("member.setnewpwd",{url:"/setnewpwd/:params/:reparams",cache:!1,views:{member_view:{templateUrl:"frame/member/findpwsd/views/setpassword.html",controller:"SetNewPwdCtrl"}}}).state("member.success",{url:"/success/:params/:reparams",cache:!1,views:{member_view:{templateUrl:"frame/member/successfuloperation/views/success.html",controller:"SuccessCtrl"}}}).state("member.register",{url:"/register/:params",cache:!1,intcude:"member.register",intName:"用户注册",views:{member_view:{templateUrl:"frame/member/register/views/register.html",controller:"RegisterCtrl"}}}).state("member.shopcard",{url:"/shopcard",cache:!1,intcude:"member.shopcard",intName:"我的购物车",access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"app_plugins/mall/shop_card/views/shop_card_page.html",controller:"ShopCardCtrl"}}}).state("member.myorder",{url:"/myorder",access_level:ACCESS_LEVELS.user,cache:!1,intcude:"member.myorder",intName:"我的订单",views:{member_view:{templateUrl:"app_plugins/mall/order/views/myorder_page.html",controller:"commodityorderCtrl"}}}).state("member.paymentOrder",{url:"/myorder:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{member_view:{templateUrl:"app_plugins/mall/order/views/myorder_page.html",controller:"commodityorderCtrl"}}}).state("member.returnrequest",{url:"/returnrequest/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"app_plugins/mall/order/return_request_from/views/return_request_from.html",controller:"returnRequestCtrl"}}}).state("member.evaluate",{url:"/evaluate/:params",cache:!1,views:{member_view:{templateUrl:"app_plugins/mall/order/evaluate/views/evaluate_from.html",controller:"evaluateCtrl"}}}).state("member.orderdetalils",{url:"/orderdetalils/:params",cache:!1,views:{member_view:{templateUrl:"app_plugins/mall/order/details/views/detalils.html",controller:"orderdetalils_Ctrl"}}}).state("member.orderSellOut",{url:"/orderSellOut/:params",cache:!1,views:{member_view:{templateUrl:"app_plugins/mall/order/details/views/order_sell_out.html",controller:"OrderSellOutCtrl"}}}).state("member.OrderComplaint",{url:"/OrderComplaint/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"app_plugins/mall/order/views/order_complaint.html",controller:"OrderComplaintCtrl"}}}).state("member.OrderDistList",{url:"/OrderDistList",cache:!1,intcude:"member.OrderDistList",intName:"配送人员接单",access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"app_plugins/mall/order/order_dist/views/order_dist_list_page.html",controller:"OrderDistCtrl"}}}).state("member.OrderDistDeatils",{url:"/OrderDistDeatils/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"app_plugins/mall/order/order_dist/views/order_rect_deatils_page.html",controller:"OrderDistDeatilsCtrl"}}}).state("member.distribution",{url:"/distribution",access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/task/distribution/views/distribution_page.html",controller:"DistributionCtrl"}}}).state("member.distributiondetails",{url:"/distributiondetails/:level",views:{member_view:{templateUrl:"frame/member/task/distribution/views/distribution_details_page.html",controller:"DistributionDetailsCtrl"}}}).state("member.myrecordlist",{url:"/myrecordlist",access_level:ACCESS_LEVELS.user,cache:!1,views:{member_view:{templateUrl:"frame/member/rechange/record_list/views/record_list_page.html",controller:"RecordListCtrl"}}}).state("member.record",{url:"/record",cache:!1,access_level:ACCESS_LEVELS.user,cache:!1,views:{member_view:{templateUrl:"frame/member/rechange/record/views/record.html",controller:"RecordCtrl"}}}).state("member.mytask",{url:"/mytask",access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/task/mytask/views/mytask_page.html",controller:"myTaskCtrl"}}}).state("member.bankcard",{url:"/bankcard",cache:!1,intcude:"member.bankcard",intName:"绑定银行卡",access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/bank_card/views/bank_card_page.html",controller:"BankCardCtrl"}}}).state("member.bankcardcontent",{url:"/bankcardcontent/:params",cache:!1,views:{member_view:{templateUrl:"frame/member/bank_card/views/bank_card_detail.html",controller:"BankCardDetailCtrl"}}}).state("member.myredparket",{url:"/myredparket",cache:!1,intcude:"member.myredparket",intName:"我的红包",views:{member_view:{templateUrl:"frame/member/red_parket/views/red_parket_page.html",controller:"BankParketCtrl"}}}).state("member.myredparketdetail",{url:"/myredparketdetail/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{member_view:{templateUrl:"frame/member/red_parket/views/red_parket_detail.html",controller:"BedParketDetailCtrl"}}}).state("member.invitation",{url:"/invitation",access_level:ACCESS_LEVELS.user,cache:!1,intcude:"member.invitation",intName:"邀请社员",views:{member_view:{templateUrl:"frame/member/invitation/views/invitation_page.html",controller:"InvitationMemberCtrl"}}}).state("member.Mycomplaint",{url:"/Mycomplaint",access_level:ACCESS_LEVELS.user,cache:!1,intcude:"member.Mycomplaint",intName:"我的投诉",views:{member_view:{templateUrl:"frame/member/my_complaint/views/my_complaint_page.html",controller:"MycomplaintCtrl"}}}).state("member.MycomplaintDetails",{url:"/MycomplaintDetails/:orderId",access_level:ACCESS_LEVELS.user,cache:!1,views:{member_view:{templateUrl:"frame/member/my_complaint/views/my_complaint_details_page.html",controller:"MycomplaintDetailsCtrl"}}}).state("payment",{url:"/payment","abstract":!0,templateUrl:"app_plugins/mall/payment/views/payment_page.html"}).state("payment.comdConfirmPayment",{url:"/comdConfirmPayment/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{payment_view:{templateUrl:"app_plugins/mall/payment/views/confirm_payment.html",controller:"MallPaymentCtrl"}}}).state("payment.selectRecvAddres",{url:"/selectRecvAddres",access_level:ACCESS_LEVELS.user,views:{payment_view:{templateUrl:"app_plugins/mall/payment/views/select_recv_addres.html",controller:"SelectRecvAddres"}}}).state("member.payment",{url:"/payment/:RECORDID",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/payment/payment_record/views/payment_page.html",controller:"PaymentCtrl"}}}).state("member.mallcouponlist",{url:"/mallcouponlist",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"app_plugins/mall/integral_mall/coupon_list/views/coupon_list_page.html",controller:"MallCouponListCtrl"}}}).state("member.bindingaccount",{url:"/bindingaccount/:accounttype",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/binding_account/views/binding_account_page.html",controller:"BindingAccountCtrl"}}}).state("member.updateaccount",{url:"/updateaccount/:type",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/binding_account/views/update_account_page.html",controller:"UpdateAccountCtrl"}}}).state("member.logisticsOrders",{url:"/logisticsOrders",cache:!1,intcude:"member.logisticsOrders",intName:"物流接单",access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/logistics_orders/views/logistics_orders_page.html",controller:"LogisticsOrdersCtrl"}}}).state("member.logisticsOrdersDetails",{url:"/logisticsOrdersDetails/:id",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/logistics_orders/views/logistics_orders_details.html",controller:"LogisticsOrdersDetailsCtrl"}}}).state("member.groupLending",{url:"/groupLendin",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"member.groupLending",intName:"联保贷款",views:{member_view:{templateUrl:"frame/member/group_lending/views/group_lending_page.html",controller:"GroupLendingCtrl"}}}).state("member.applyLoan",{url:"/applyLoan/:id",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"member.applyLoan",intName:"申请联保贷款",views:{member_view:{templateUrl:"frame/member/group_lending/views/apply_loan_page.html",controller:"ApplyLoanCtrl"}}}).state("member.MyApplyLoan",{url:"/MyApplyLoan/:id",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/group_lending/views/my_apply_loan_page.html",controller:"MyApplyLoanCtrl"}}}).state("member.myOrders",{url:"/myOrders",cache:!1,intcude:"member.myOrders",intName:"物流接单我的接单",access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/logistics_orders/views/my_orders_page.html",controller:"MyOrdersCtrl"}}}).state("mall.cooperative",{url:"/cooperative",cache:!1,access_level:ACCESS_LEVELS.user,views:{"am-cooperative":{templateUrl:"app_plugins/cooperative/main_page/views/main_page.html",controller:"CoopMainPageController"}}}).state("cooperative",{url:"/cooperative","abstract":!0,cache:!1,templateUrl:"app_plugins/cooperative/main_page/views/cooperative_view_page.html"}).state("cooperative.agroProjList",{url:"/agroProjList",intcude:"cooperative.agroProjList",intName:"投资三农",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/agriculture_project/views/agro_proj_page.html",controller:"AgroProjListCtrl"}}}).state("cooperative.agroProjDetails",{url:"/agroProjDetails/:id",access_level:ACCESS_LEVELS.user,views:{cooperative_view:{templateUrl:"app_plugins/cooperative/agriculture_project/views/agro_proj_details.html",controller:"AgroProjDetailsCtrl"}}}).state("cooperative.projectDetails",{url:"/projectDetails/:params",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/agriculture_project/views/project_details_page.html",controller:"ProjectDetailsCtrl"}}}).state("cooperative.serviceVolunteer",{url:"/serviceVolunteer",intcude:"cooperative.serviceVolunteer",intName:"服务志愿者",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/service_volunteer/views/service_volunteer_page.html",controller:"serviceVolunteerCtrl"}}}).state("cooperative.serviceVolunteerDetails",{url:"/serviceVolunteerDetails/:params",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/service_volunteer/views/service_volunteer_details_page.html",controller:"serviceVolunteerDetailsCtrl"}}}).state("cooperative.withdrawShare",{url:"/withdrawShare/:id",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/agriculture_project/views/withdraw_share_page.html",controller:"WithdrawShareCtrl"}}}).state("cooperative.startBusiness",{url:"/startBusiness",access_level:ACCESS_LEVELS.user,intcude:"cooperative.startBusiness",intName:"大众创业",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/start_business/views/start_business_page.html",controller:"StartBusinessCtrl"}}}).state("cooperative.startBusinessDetail",{url:"/startBusinessDetail/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{cooperative_view:{templateUrl:"app_plugins/cooperative/start_business/views/start_business_detail_page.html",controller:"StartBusinessDetailCtrl"}}}).state("cooperative.startBusinessMy",{url:"/startBusinessMy",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"cooperative.startBusinessMy",intName:"我的创业",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/start_business/views/start_business_my_page.html",controller:"StartBusinessMyCtrl"}}}).state("cooperative.loanStartBusiness",{url:"/loanStartBusiness/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{cooperative_view:{templateUrl:"app_plugins/cooperative/start_business/views/loan_start_business_page.html",controller:"LoanStartBusinessCtrl"}}}).state("cooperative.producerHelp",{url:"/producerHelp",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"cooperative.producerHelp",intName:"生产者帮扶",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/producer_help_page.html",controller:"producerHelpCtrl"}}}).state("cooperative.producerHelpOrder",{url:"/producerHelpOrder/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/producer_help_page.html",controller:"producerHelpCtrl"}}}).state("cooperative.consumerHelp",{url:"/consumerHelp",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"cooperative.consumerHelp",intName:"帮扶规则",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/consumer_help_page.html",controller:"consumerHelpCtrl"}}}).state("cooperative.consumerHelpFarmer",{url:"/consumerHelpFarmer/:roleid",access_level:ACCESS_LEVELS.user,intcude:"cooperative.consumerHelpFarmer",intName:"消费者帮扶",cache:!1,views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/consumer_help_farmer_page.html",controller:"consumerHelpFarmerCtrl"}}}).state("cooperative.consumerHelpDetails",{url:"/consumerHelpDetails/:id",cache:!1,access_level:ACCESS_LEVELS.user,views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/consumer_help_details_page.html",
controller:"consumerHelpDetailsCtrl"}}}).state("cooperative.consumerLaunchHelp",{url:"/consumerLaunchHelp/:params",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"cooperative.consumerLaunchHelp",intName:"消费者发起帮扶",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/consumer_launch_help_page.html",controller:"consumerLaunchHelpCtrl"}}}).state("cooperative.companyHelpGuide",{url:"/companyHelpGuide",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"cooperative.companyHelpGuide",intName:"单位帮扶规则",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/company_help_guide_page.html",controller:"companyHelpGuideCtrl"}}}).state("cooperative.companyHelp",{url:"/companyHelp/:roleid",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"cooperative.companyHelp",intName:"单位帮扶",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/company_help_page.html",controller:"companyHelpCtrl"}}}).state("cooperative.companyHelpDetails",{url:"/companyHelpDetails/:id",cache:!1,access_level:ACCESS_LEVELS.user,views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/company_help_details_page.html",controller:"companyHelpDetailsCtrl"}}}).state("cooperative.companyHelpBodies",{url:"/companyHelpBodies/:params",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"cooperative.companyHelpBodies",intName:"单位帮扶联合社规则",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/company_help_bodies_page.html",controller:"companyHelpBodiesCtrl"}}}).state("cooperative.agrlExpanded",{url:"/agrlExpanded",intcude:"cooperative.agrlExpanded",intName:"农技推广",views:{cooperative_view:{templateUrl:"app_plugins/cooperative/agrl_expanded/views/agrl_expanded_page.html",controller:"AgrlExpandedCtrl"}}}).state("cooperative.agrlExpandedDetails",{url:"/agrlExpandedDetails/:id",cache:!1,views:{cooperative_view:{templateUrl:"app_plugins/cooperative/agrl_expanded/views/agrl_expanded_details.html",controller:"AgrlExpandedDetailsCtrl"}}}).state("account",{url:"/account","abstract":!0,cache:!1,templateUrl:"frame/account/views/account_view_page.html"}).state("account.identityStock",{url:"/identityStock/:params",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"account.identityStock",intName:"身份股金帐号",views:{account_view:{templateUrl:"frame/account/identity_stock/views/identity_stock_page.html",controller:"IdentityStockCtrl"}}}).state("account.cashaccount",{url:"/cashaccount",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"account.cashaccount",intName:"现金账户",views:{account_view:{templateUrl:"frame/account/cash_account/views/cash_account_page.html",controller:"CashAccountCtrl"}}}).state("account.bounsaccount",{url:"/bounsaccount",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"account.bounsaccount",intName:"经营分红账户",views:{account_view:{templateUrl:"frame/account/bouns_account/views/bouns_account_page.html",controller:"BounsAccountCtrl"}}}).state("account.consumeraccount",{url:"/consumeraccount",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"account.consumeraccount",intName:"消费账户",views:{account_view:{templateUrl:"frame/account/consumer_account/views/consumer_account_page.html",controller:"ConsumerAccountCtrl"}}}).state("account.creditaccount",{url:"/creditaccount",cache:!1,intcude:"account.creditaccount",intName:"信用保证金账户",access_level:ACCESS_LEVELS.user,views:{account_view:{templateUrl:"frame/account/credit_margin_account/views/credit_margin_account_page.html",controller:"CreditMarginAccountCtrl"}}}).state("account.foodsafetyaccount",{url:"/foodsafetyaccount",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"account.foodsafetyaccount",intName:"食品安全追溯账户",views:{account_view:{templateUrl:"frame/account/food_safety_account/views/food_safety_account_page.html",controller:"FoodSafetyAccountCtrl"}}}).state("account.antiriskselfaccount",{url:"/antiriskselfaccount",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"account.antiriskselfaccount",intName:"抗风险自救金账户",views:{account_view:{templateUrl:"frame/account/anti_risk_self_account/views/anti_risk_self_account_page.html",controller:"AntiRiskSelfAccount"}}}).state("account.volunteerAccount",{url:"/volunteerAccount",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"account.volunteerAccount",intName:"志愿者服务账户",views:{account_view:{templateUrl:"frame/account/volunteer_account/views/volunteer_account_page.html",controller:"VolunteerAccountCtrl"}}}).state("account.creditcardaccount",{url:"/creditcardaccount",cache:!1,intcude:"account.creditcardaccount",intName:"信誉卡账户",views:{account_view:{templateUrl:"frame/account/credit_card_account/views/credit_card_account_page.html",controller:"CreditCardAccountCtrl"}}}).state("account.creditcardaccounts",{url:"/creditcardaccount/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{account_view:{templateUrl:"frame/account/credit_card_account/views/credit_card_account_page.html",controller:"CreditCardAccountCtrl"}}}).state("common.accessnavigention",{url:"/accessnavigention/:params",cache:!1,views:{common_view:{templateUrl:"app_plugins/common/access_navigetion/views/access_navigetion_page.html",controller:"AccessNavigetion"}}}).state("common.virementmanager",{url:"/virementmanager/:params",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"common.virementmanager",intName:"转账",views:{common_view:{templateUrl:"app_plugins/common/virement/views/virement_page.html",controller:"VirementManagerCtrl"}}}).state("common.virementothermanager",{url:"/virementothermanager/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/common/virement/views/virement_other_page.html",controller:"VirementOtherManagerCtrl"}}}).state("common.comment",{url:"/comment/:params",cache:!0,intcude:"common.comment",intName:"评论",access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/common/comment/views/comment_page.html",controller:"commentCtrl"}}}).state("common.payment",{url:"/payment/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/common/payment/views/payment_page.html",controller:"PaymentManagerCtrl"}}}).state("common.paymentinput",{url:"/paymentinput/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{common_view:{templateUrl:"app_plugins/common/payment/views/payment_input_page.html",controller:"PaymentInputManagerCtrl"}}}).state("common.withdraw",{url:"/withdraw/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/common/withdraw/views/withdraw_page.html",controller:"WithdrawManagerCtrl"}}}).state("common.recode",{url:"/recode/:params",cache:!1,intcude:"common.recode",intName:"交易记录",access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/common/record/views/transaction_record_page.html",controller:"TransactionRecordCtrl"}}}).state("common.resultpage",{url:"/resultpage/:params/:reparams",cache:!1,access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/common/result/views/result_page.html",controller:"ResultManagerCtrl"}}}).state("common.redpacket",{url:"/redpacket/:params",cache:!1,intcude:"common.redpacket",intName:"发红包",access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/common/red_packet/views/red_packet_ctrl.html",controller:"RedPacketManagerCtrl"}}}).state("common.imagePicker",{url:"/imagePicker/:params",cache:!1,views:{common_view:{templateUrl:"app_plugins/common/image_picker/views/image_picker_detail.html",controller:"ImagePickerCtrl"}}}).state("common.publiccomment",{url:"/publiccomment/:params",cache:!1,views:{common_view:{templateUrl:"app_plugins/common/comment/views/public_comment.html",controller:"PublicCommentCtrl"}}}).state("publicMarket",{url:"/publicMarket","abstract":!0,templateUrl:"app_plugins/public_market/views/public_market_page.html"}).state("publicMarket.selectMarketArea",{url:"/selectMarketArea",cache:!1,views:{public_market_view:{templateUrl:"app_plugins/public_market/views/select_area.html",controller:"SelectMarketArea"}}}).state("ruralMarket",{url:"/ruralMarket","abstract":!0,templateUrl:"app_plugins/rural_market/views/rural_market.html"}).state("ruralMarket.ruralMarket",{url:"/ruralMarket",intcude:"ruralMarket.ruralMarket",intName:"农村大市场",views:{rural_market_view:{templateUrl:"app_plugins/rural_market/views/rural_market_page.html",controller:"RuralMarketCtrl"}}}).state("ruralMarket.marketCustomized",{url:"/marketCustomized/:id",cache:!1,access_level:ACCESS_LEVELS.user,views:{rural_market_view:{templateUrl:"app_plugins/rural_market/views/market_customized_page.html",controller:"MarketCustomizedCtrl"}}}).state("ruralMarket.myBooth",{url:"/myBooth",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"ruralMarket.myBooth",intName:"我的摊位",views:{rural_market_view:{templateUrl:"app_plugins/rural_market/my_booth/views/my_booth_page.html",controller:"MyBoothCtrl"}}}).state("ruralMarket.publishMyBooth",{url:"/publishMyBooth",cache:!1,views:{rural_market_view:{templateUrl:"app_plugins/rural_market/my_booth/views/publish_my_booth_page.html",controller:"PublishMyBoothCtrl"}}}).state("ruralMarket.updateMyBooth",{url:"/updateMyBooth/:id",cache:!1,views:{rural_market_view:{templateUrl:"app_plugins/rural_market/my_booth/views/update_my_booth_page.html",controller:"UpdateMyBoothCtrl"}}}).state("ruralMarket.myCustomized",{url:"/myCustomized/:params",cache:!1,access_level:ACCESS_LEVELS.user,intcude:"ruralMarket.myCustomized",intName:"我的定制",views:{rural_market_view:{templateUrl:"app_plugins/rural_market/my_customized/views/my_customized_page.html",controller:"MyCustomizedCtrl"}}}).state("ruralMarket.confirmReceipt",{url:"/confirmReceipt/:mcid",cache:!1,views:{rural_market_view:{templateUrl:"app_plugins/rural_market/my_customized/views/confirm_receipt_page.html",controller:"ConfirmReceiptCtrl"}}}).state("foodSafety",{url:"/foodSafety","abstract":!0,templateUrl:"app_plugins/food_safety/views/food_safety.html"}).state("foodSafety.freezerOpen",{url:"/freezerOpen/:params",access_level:ACCESS_LEVELS.user,cache:!1,intcude:"foodSafety.freezerOpen",intName:"冷柜开通",views:{food_safety_view:{templateUrl:"app_plugins/food_safety/freezer_open/views/freezer_open_page.html",controller:"FreezerOpenCtrl"}}}).state("find",{url:"/find","abstract":!0,templateUrl:"app_plugins/find/views/find_view_page.html"}).state("commodity.ComdTransRecord",{url:"/ComdTransRecord/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/mall/commodity/views/comd_transaction_record.html",controller:"ComdTransCtrl"}}}).state("member.logout",{url:"/logout",cache:!1,intcude:"member.logout",intName:"社员注销",access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/logout/views/logout.html",controller:"MmeberLogoutCtrl"}}}).state("member.setting",{url:"/setting",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/setting/views/setting_index.html",controller:"SttingCtrl"}}}).state("member.boundphone",{url:"/boundphone",cache:!1,access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/setting/views/bound_phone_index.html",controller:"BoundPhoneCtrl"}}}).state("speciality",{url:"/speciality","abstract":!0,templateUrl:"app_plugins/speciality_product/views/speciality_view_page.html"}).state("common",{url:"/common","abstract":!0,templateUrl:"app_plugins/uoou/common/views/common_view_page.html"}).state("message",{url:"/message","abstract":!0,templateUrl:"app_plugins/uoou/message/views/message_page.html"}).state("contacts",{url:"/contacts","abstract":!0,templateUrl:"app_plugins/uoou/contacts/views/contacts_page.html"}).state("dynamic",{url:"/dynamic","abstract":!0,templateUrl:"app_plugins/uoou/dynamic/views/dynamic_page.html"}).state("mine",{url:"/mine","abstract":!0,templateUrl:"app_plugins/uoou/mine/views/mine_page.html"});var tKey="firstRun_"+appConfig.version,tValue=localStorage.getItem(tKey);console.info("判断是否是["+appConfig.version+"]版本首次运行["+tKey+"]="+tValue),null===tValue||void 0===tValue||""===tValue?$urlRouterProvider.otherwise("/guide/step1"):$urlRouterProvider.otherwise("/mall/message"),$httpProvider.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",$httpProvider.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8",$httpProvider.interceptors.push("loadingMarker"),$httpProvider.defaults.transformRequest=[function(data){var param=function(obj){var name,value,fullSubName,subName,subValue,innerObj,i,query="";for(name in obj)if(value=obj[name],value instanceof Array)for(i=0;i<value.length;++i)subValue=value[i],fullSubName=name+"["+i+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else if(value instanceof Object)for(subName in value)subValue=value[subName],fullSubName=name+"["+subName+"]",innerObj={},innerObj[fullSubName]=subValue,query+=param(innerObj)+"&";else void 0!==value&&null!==value&&(query+=encodeURIComponent(name)+"="+encodeURIComponent(value)+"&");return query.length?query.substr(0,query.length-1):query};return angular.isObject(data)&&"[object File]"!==String(data)?param(data):data}]}]),angular.module("mallMobileApp").constant("appConfig",{appName:"米鱼",version:"1.0.36",baseUrl:"http://elakm.com",actionUrl:"http://elakm.com/AmRes/",uploadurl:"http://elakm.com/am_upload",company:"AM",alipayEmail:"dadankeji@126.com",localUser:"USER_INFO",appOrg:"org",AmRes:"com.am.frame.webapi.ExecuteRes",AmUpdate:"com.am.frame.webapi.ExecuteSql",pageSize:20,defaultImg:"",alipayUrl:"/alipay/web/alipayapi.jsp",alipayNotifyUrl:"http://elakm.com/AmRes/com.am.frame.payment.impl.webApi.AlipayPaymenNotifyWebApi.do",debug:!0,tencentAppId:"1105838105",platformType:"",kdcustomer:"",kdkey:"",isDerive:!1,shareImg:"http://elakm.com/img/ylk_icon.png",shareUrl:"http://elakm.com/downloadapp.jsp",mpWeiChartTitle:"米鱼",mpWeiChartDesc:"米鱼",Tonken:null,shareContent:"下载米鱼、豪礼免费送！"}),mallMobileApp.constant("ACCESS_LEVELS",{pub:1,user:2,platform:1,role_01:1,role_02:2,role_03:3}),angular.module("mallMobileApp.services").service("actionManagerService",["appConfig",function(appConfig){return{requestTonken:function(check_code){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.dispatcher.TonkenAPI.do",data:{check_code:check_code}};return req},sendJpushApi:function(member_id,params,title,url,content){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins_common.push.SendJPushWebApi.do",data:{member_id:member_id,params:params,title:title,url:url,content:content}};return req},excuteUpdate:function(sql){var req={method:"POST",url:appConfig.actionUrl+"com.am.sdk.db.ShortDBManger.do",data:{type:"update",sql:sql}};return req},excuteQuery:function(sql){var req={method:"POST",url:appConfig.actionUrl+"com.am.sdk.db.ShortDBManger.do",data:{type:"select",sql:sql}};return req},excuteResource:function(rcode,params,pageNumber,pageSize){var par=params;""!=params&&(par=JSON.stringify(params));var req={method:"POST",url:appConfig.actionUrl+appConfig.AmRes+".do",data:{rcode:rcode,params:par,pageSize:pageSize||appConfig.pageSize,pageNumber:pageNumber||"1"}};return req},excuteAmUpdate:function(params){var req={method:"POST",url:appConfig.actionUrl+appConfig.AmUpdate+".do",data:{param:params}};return req},MemberLogin:function(logintype,login_account,login_password,userID,channelID,deviceType,street,lat,lng){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.MemberLogin.do",data:{logintype:logintype,login_account:login_account,login_password:login_password,UserID:userID,ChannelID:channelID,DeviceType:deviceType,street:street,lat:lat,lng:lng,version:appConfig.version}};return req},MemberRegister:function(login_account,login_password,invitation_code,orgcode,land,province,city,zone,member_identity,business_name,business_org,account_type,PwdSecurityGrade){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.MemberRegedit.do",data:{login_account:login_account,login_password:login_password,invitation_code:invitation_code,org_code:orgcode,land:land,province:province,city:city,zone:zone,member_identity:member_identity,business_name:business_name,business_org:business_org,account_type:account_type,PwdSecurityGrade:PwdSecurityGrade}};return req},MemberaccountIsExistence:function(Phone){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.FindMemberIsExistence.do",data:{Phone:Phone}};return req},ModifyMemberPassWord:function(oldPas,newPas,pwdsecuritygrade,memberID){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.ModifyMemberPassWord.do",data:{old_login_password:oldPas,new_login_password:newPas,pwd_security_grade:pwdsecuritygrade,member_id:memberID}};return req},MemberFindUpdatePwd:function(login_account,new_login_password){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.UpdateFindPwd.do",data:{login_account:login_account,new_login_password:new_login_password}};return req},UpdateMemberInfo:function(params){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.member.memberinfo.UpdateMemberInfo.do",data:{params:params}};return req},updateDefaultAddr:function(addrid,defaultaddr,memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.addres.UpdateDefaultAddr.do",data:{addrid:addrid,defaultaddr:defaultaddr,memberid:memberid}};return req},SmsVcode:function(phone,templatename){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.SmsVcode.do",data:{Phone:phone,TemplateName:templatename}};return req},SmsVcodebyType:function(phone,templatename,type){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.SmsVcode.do",data:{Phone:phone,TemplateName:templatename,Type:type}};return req},addRecordPayment:function(id,accountId,memberid,paymoney,paysource,paycontent,amorders){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.AddRecordPayment.do",data:{id:id,accountId:accountId,memberid:memberid,paymoney:paymoney,paysource:paysource,paycontent:paycontent,amorders:amorders}};return req},cashPayment:function(payid,memberid,paymoney,accountId){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.pay.CashPaymentWebAPI.do",data:{PID:payid,MEMBERID:memberid,PAYMONEY:paymoney,accountId:accountId}};return req},exchangeCoupon:function(memberid,eterpelectticketid,effectivedate,scorevalue){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.ExchangeCoupon.do",data:{memberid:memberid,eterpelectticketid:eterpelectticketid,effectivedate:effectivedate,scorevalue:scorevalue}};return req},getSystemParam:function(name){var req={method:"POST",url:appConfig.actionUrl+"com.as.common.GetSystemVariable.do",data:{key:name}};return req},isNewAppVersion:function(version){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.AppVersionManager.do",data:{AppName:appConfig.appOrg,AppThisVer:version}};return req},getListData:function(pageNumber,rcode,params,pageSize){var req={method:"POST",url:appConfig.actionUrl+appConfig.AmRes+".do",data:{rcode:rcode,params:params,pageSize:pageSize||appConfig.pageSize,pageNumber:pageNumber}};return req},getClassListDetail:function(id){var req={method:"POST",url:appConfig.actionUrl+"com.am.mall.commdityClass.CommdityClassDetailList.do",data:{id:id}};return req},submitOrder:function(orderInfo,orderAction,extendData){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.SubmitOrderWebApi.do",data:{ORDERINFO:orderInfo,ORDERACTION:orderAction,EXTENDDATA:extendData}};return req},MyOrderConfirreceipt:function(orderid,stateValue,actionCode){var req={method:"POST",url:appConfig.actionUrl+"com.am.mall.iwebAPI.SetNextOrderStateIWebAPI.do",data:{ORDERID:orderid,STATEVALUE:stateValue,ACTONCODE:actionCode}};return req},investment:function(number,projectid,memberid,stockprice){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.cooperative.agriculture_project.PurchaseSharesIWebApi.do",data:{number:number,projectid:projectid,memberid:memberid,stockprice:stockprice}};return req},updateBrowse:function(id){var req={method:"POST",url:appConfig.actionUrl+"com.am.more.content.UpdateBrowseIWebApi.do",data:{id:id}};return req},updateRecordsAccess:function(id,memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.more.kopp_train.UpdateRecordsAccessIWebApi.do",data:{id:id,memberid:memberid}};return req},confirmWithdrawals:function(buyNumber,buyId,projectId,sumPrice,penaltyRatio,difference,memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.cooperative.agriculture_project.withdrawShareIWebApi.do",data:{buyNumber:buyNumber,buyId:buyId,projectId:projectId,sumPrice:sumPrice,penaltyRatio:penaltyRatio,difference:difference,memberid:memberid}};return req},confirmSignUp:function(payId,pcid,memberid,count){var req={method:"POST",url:appConfig.actionUrl+"com.am.more.kopp_train.ConfirmSignUpIWebApi.do",data:{payId:payId,pcid:pcid,memberid:memberid,count:count}};return req},purchaseArticles:function(payid,id,count,cost,memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.more.kopp_train.PurchaseArticlesIWebApi.do",data:{payid:payid,id:id,count:count,cost:cost,memberid:memberid}};return req},saveArtcles:function(uuid,title,pay_type,content,status,memberid,start,imagepaths){var req={method:"POST",url:appConfig.actionUrl+"com.am.more.expert_compound.SaveArtclesIWebApi.do",data:{uuid:uuid,title:title,pay_type:pay_type,content:content,status:status,memberid:memberid,start:start,imagepaths:imagepaths}};return req},updateArtcles:function(title,pay_type,content,status,id,start,imagepaths){var req={method:"POST",url:appConfig.actionUrl+"com.am.more.expert_compound.UpdateArtclesIWebApi.do",data:{title:title,pay_type:pay_type,content:content,status:status,id:id,start:start,imagepaths:imagepaths}};return req},flowerLikes:function(id,field){var req={method:"POST",url:appConfig.actionUrl+"com.am.more.expert_compound.FlowerLikesIWebApi.do",data:{id:id,field:field}};return req},issueVote:function(paramsOptions,memberid,pollId){var req={method:"POST",url:appConfig.actionUrl+"com.am.more.member_poll.MemberPollIWebApi.do",data:{paramsOptions:paramsOptions,memberid:memberid,pollId:pollId}};return req},collegeHelper:function(payid,collegeId,paymoney,memberid,tomemberId){var req={method:"POST",url:appConfig.actionUrl+"com.am.more.student_support.SavaStudentSupportIWebApi.do",data:{payid:payid,collegeId:collegeId,paymoney:paymoney,memberid:memberid,tomemberId:tomemberId}};return req},consumerConfirmHelp:function(helpType,tomemberid,memberid,money,roleid){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.precision_help.ConsumerConfirmHelpIWebApi.do",data:{helpType:helpType,tomemberid:tomemberid,memberid:memberid,money:money,roleid:roleid}};return req},CompanyConfirmHelp:function(helpType,tomemberid,memberid,money,roleid,tabName,tabID){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.precision_help.CompanyConfirmHelpIWebApi.do",data:{helpType:helpType,tomemberid:tomemberid,memberid:memberid,money:money,roleid:roleid,tabName:tabName,tabID:tabID}};return req},SaveGroupLoan:function(applyBank,appyName,memberid,money,code,expiresDate,zipCode,address,telephone,phone,loanMemberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.member.group_loan.SaveGroupLoanWebApi.do",data:{applyBank:applyBank,appyName:appyName,memberid:memberid,money:money,code:code,expiresDate:expiresDate,zipCode:zipCode,address:address,telephone:telephone,phone:phone,loanMemberid:loanMemberid}};return req},UpdateGroupLoan:function(id,applyBank,appyName,memberid,money,code,expiresDate,zipCode,address,telephone,phone,loanMemberid,deletemember){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.member.group_loan.UpdateGroupLoanWebApi.do",data:{id:id,applyBank:applyBank,appyName:appyName,memberid:memberid,money:money,code:code,expiresDate:expiresDate,zipCode:zipCode,address:address,telephone:telephone,phone:phone,loanMemberid:loanMemberid,deletemember:deletemember}};return req},UpdateApplyGuarantor:function(lpid,memberid,lpgStatu){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.member.group_loan.UpdateApplyGuarantor.do",data:{lpid:lpid,memberid:memberid,lpgStatu:lpgStatu}};return req},saveMarket:function(uuid,title,class_id,content,status,memberid,start,imagepaths,price,recvProvince,recvCity,recvArea){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.rural_market.my_booth.SaveMarketIWebApi.do",data:{uuid:uuid,title:title,class_id:class_id,content:content,status:status,memberid:memberid,start:start,imagepaths:imagepaths,price:price,recvProvince:recvProvince,recvCity:recvCity,recvArea:recvArea}};return req},updateMarket:function(memberid,uuid,title,class_id,content,imagepaths,price,recvProvince,recvCity,recvArea){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.rural_market.my_booth.UpdateMarketIWebApi.do",data:{memberid:memberid,uuid:uuid,title:title,class_id:class_id,content:content,imagepaths:imagepaths,price:price,recvProvince:recvProvince,recvCity:recvCity,recvArea:recvArea}};return req},marketOrderGoods:function(meId,buyersId,price){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.rural_market.my_booth.MarketOrderGoodsIWebApi.do",data:{meId:meId,buyersId:buyersId,price:price}};return req},confirmReceipt:function(meId,memberId,price,mtrId){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.rural_market.my_customized.MarketConfirmReceiptIWebApi.do",data:{meId:meId,memberId:memberId,price:price,mtrId:mtrId}};return req},marketRefund:function(meId,buyersId,tradeAmount,mtrId){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.rural_market.my_booth.MarketRefundIWebApi.do",data:{meId:meId,buyersId:buyersId,tradeAmount:tradeAmount,mtrId:mtrId}};return req},freezerOpen:function(payId,memberid,paymoney){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.food_safety.FreezerOpenIWebApi.do",data:{payId:payId,memberid:memberid,paymoney:paymoney}};return req},SaveComment:function(mentid,contentid,memberid,upmemberid,surveycontent){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins_common.comment.SaveCommentWebApi.do",data:{mentid:mentid,contentid:contentid,memberid:memberid,upmemberid:upmemberid,surveycontent:surveycontent}};return req},virementManager:function(outMemberid,inMemberid,outAccountId,inAccountId,virementNumber,out_remarks,in_remarks){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins_common.virement.VirementWebApi.do",data:{outMemberid:outMemberid,inMemberid:inMemberid,outAccountId:outAccountId,inAccountId:inAccountId,virementNumber:virementNumber,out_remarks:out_remarks,in_remarks:in_remarks}};return req},withdrawManager:function(outMemberid,outAccountId,inAccountId,virementNumber,detail,withDrawType){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.transactions.withdraw.WithDrawApply.do",data:{outMemberid:outMemberid,outAccountId:outAccountId,inAccountId:inAccountId,virementNumber:virementNumber,detail:detail,withDrawType:withDrawType,orgCode:appConfig.appOrg}};return req},bindingAccount:function(memberid,account,type,name,cardholde,paypassword,phone){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.member.bindingaccount.BindingAccount.do",data:{memberid:memberid,account:account,type:type,name:name,cardholde:cardholde,paypassword:cardholde,phone:phone}};return req},executePayMent:function(memberId,inAccountCode,outAccountCode,pay_id,pay_money,pay_type,account_type,business,inremakes,outremakes,openid,COMMODITYNAME){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins_common.pay.PayMentWebApi.do",data:{memberId:memberId,inAccountCode:inAccountCode,outAccountCode:outAccountCode,pay_id:pay_id,pay_money:pay_money,pay_type:pay_type,account_type:account_type,business:JSON.stringify(business),inremakes:inremakes,outremakes:outremakes,platform:"1",openid:openid,commodityName:COMMODITYNAME}};return req},sendRedPacket:function(outMemberid,outAccountCode,inMemberAccount,inAccountId,red_money,out_remakers,red_type,remakers,name){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins_common.redpacket.SendRedPacketWebapi.do",data:{outMemberid:outMemberid,outAccountCode:outAccountCode,inMemberAccount:inMemberAccount,inAccountId:inAccountId,red_money:red_money,out_remakers:out_remakers,red_type:red_type,remakers:remakers,name:name}};return req},registUserToken:function(memberId,token,mobile){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins_common.push.setUserPushToken.do",data:{mobile:mobile,token:token,memberId:memberId}};return req},getServiceMallInfo:function(province,city,zone,memberid,org,id){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins.cooperative.start_business.GetServiceMallInfo.do",data:{province:province,city:city,zone:zone,memberid:memberid,org:appConfig.appOrg,id:id}};return req},submitShopCard:function(parmas){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.AddShoppingCartIWebApi.do",data:{DATA:JSON.stringify(parmas)}};return req},processOrderPay:function(parmas){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.ProcessOrderPaymentWebAPI.do",data:{PAY_ID:parmas.PAY_ID}};return req},getPostComplaint:function(parmas){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.ProcessOrderComplaintData.do",data:parmas};return req},openRedPacket:function(parmas){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins_common.redpacket.OpenRedPacketWebApi.do",data:{packet_id:parmas.packet_id,in_account:parmas.in_account}};return req},sellOutOrder:function(orderId){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.SellOutOrderWebApi.do",data:{orderId:orderId}};return req},recvOrRefuseOrder:function(orderId,state){var req={method:"POST",url:appConfig.actionUrl+"com.am.mall.order.webApi.OrderDistincationRecvOrRefuseWebAPI.do",data:{orderId:orderId,state:state}};return req},distOrderRelease:function(password,orderId){var req={method:"POST",url:appConfig.actionUrl+"com.am.mall.order.webApi.DistOrderReleaseWebAPI.do",data:{orderId:orderId,pwd:password}};return req},submitDelInveMember:function(invId){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.SubmitDelInveMember.do",data:{invId:invId}};return req},updateUserHeader:function(data){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.UpdateUserHeaderWebApi.do",data:data};return req},changeMemberTypeWebApi:function(memberId,invCode){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.ChangeMemberTypeWebApi.do",data:{memberid:memberId,invcode:invCode}};return req},submitBussinesIntducte:function(induct_code,name){var req={method:"POST",url:appConfig.actionUrl+"com.am.content.webapi.BussinessIntodectSebmintWebApi.do",data:{inductCode:induct_code,name:name,orgcode:appConfig.appOrg}};return req},submitLogoutInfo:function(memberid,reason){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.memberlogout.webapi.SubmitLogoutInfoWebApi.do",data:{memberid:memberid,reason:reason}};return req},getRecommendInfo:function(id,gps,type){var req={method:"POST",url:appConfig.actionUrl+"com.am.triph.recommend.GetRecommendInfo.do",data:{gps:gps,id:id,type:type}};return req},getMallActivitytemplate:function(type){var req={method:"POST",url:appConfig.actionUrl+"com.am.mall.Activities.GetMallShelvesInfo.do",data:{type:type}};return req},deleteOrder:function(orderId,memberId,mallClass,orderState){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.TriphDeleteOrderWebAPI.do",data:{orderId:orderId,memberId:memberId,mallClass:mallClass,orderState:orderState}};return req},getOrderInfo:function(orderId){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.GetOrderInfoByOrderId.do",data:{orderId:orderId}};return req},updateOrderStateByOrderId:function(orderInfo,memberId){
var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.GetOrderInfoByOrderId.do",data:{memberId:memberId,orderInfo:orderInfo}};return req},applyReturnPriceByOrderId:function(orderId,memberId){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.ApplyReturnOrderIdWebApi.do",data:{memberId:memberId,orderId:orderId}};return req},evalOrderProcess:function(evalId,memberId,images){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.order.ProcessOrderEvalValueWebApi.do",data:{evalId:evalId,memberId:memberId}};return req},getCommodityInfoData:function(memberId,id,fid,className){var req={method:"POST",url:appConfig.actionUrl+"com.am.mall.iwebAPI.GetCommoditySpectInfoWebApi.do",data:{id:id,memberId:memberId,fid:fid,className:className}};return req},getCarRentalInfo:function(id){var req={method:"POST",url:appConfig.actionUrl+"com.am.carRental.CarRentalInfo.do",data:{id:id}};return req},discountGroupDetails:function(id){var req={method:"POST",url:appConfig.actionUrl+"com.am.discount_group.DiscountGroupDetailsInfo.do",data:{id:id}};return req},getScenicSpotTemplate:function(id,mallclass){var req={method:"POST",url:appConfig.actionUrl+"com.am.mallstore.ScenicSpotDetails.do",data:{id:id,mallclass:mallclass}};return req},collectionManager:function(id,member_id,type){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins_common.collection.CollectionManager.do",data:{id:id,member_id:member_id,type:type}};return req},receiveCoupon:function(id,memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.triph.coupon.CouponReceive.do",data:{couponid:id,memberid:memberid}};return req},clickLike:function(id){var req={method:"POST",url:appConfig.actionUrl+"com.am.content.webapi.ContentClickLikeWebApi.do",data:{id:id}};return req},wxPaymentPlaceAnOrder:function(id,memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.triph.coupon.CouponReceive.do",data:{couponid:id,memberid:memberid}};return req},uploadFileAction:function(file,type,savepath){var req={method:"POST",url:appConfig.baseUrl+"/am_upload",transformRequest:angular.identity,headers:{"Content-Type":"multipart/form-data"},data:{file:file,type:type,savePath:savepath},header:{"Content-type":"multipart/form-data"}};return req},getWeiChartJSSDKWebAPI:function(JSSDKURL){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.weichart.webApi.GetWeiChartJSSDKWebApi.do",data:{jsSdkUrl:JSSDKURL}};return req},passWidthdrawAudit:function(id,audit_opinion,audit_person,main_audit_opinion,audit_result){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.widthdrawaudit.WidthdrawAuditPass.do",data:{id:id,audit_opinion:audit_opinion,audit_person:audit_person,main_audit_opinion:main_audit_opinion,audit_result:audit_result}};return req},rejectWidthdrawAudit:function(id,audit_opinion,audit_person,main_audit_opinion,audit_result){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.widthdrawaudit.WidthdrawAuditReject.do",data:{id:id,audit_opinion:audit_opinion,audit_person:audit_person,main_audit_opinion:main_audit_opinion,audit_result:audit_result}};return req},transferAuditPass:function(id,audit_opinion,audit_person,main_audit_opinion,audit_result){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.transfer.TransferAuditPass.do",data:{id:id,audit_opinion:audit_opinion,audit_person:audit_person,main_audit_opinion:main_audit_opinion,audit_result:audit_result}};return req},transferAuditReject:function(id,audit_opinion,audit_person,main_audit_opinion,audit_result){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.transfer.TransferAuditReject.do",data:{id:id,audit_opinion:audit_opinion,audit_person:audit_person,main_audit_opinion:main_audit_opinion,audit_result:audit_result}};return req},getTaskDetails:function(memberId,uTaskId){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.task.GetUserTaskDetails.do",data:{member_id:memberId,user_task_id:uTaskId}};return req},getTaskList:function(memberId,runState){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.task.GetUserTaskList.do",data:{member_id:memberId,run_state:runState}};return req},pushMessage:function(title,content,imgcontent,friendId,memberId,phone){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.push_message.webapi.PushMessage.do",data:{title:title,content:content,imgcontent:imgcontent,friendId:friendId,memberId:memberId,phone:phone}};return req},pushGroupMessage:function(title,content,imgcontent,groupId,memberId,groupNo){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.push_message.webapi.PushGroupMessage.do",data:{title:title,content:content,imgcontent:imgcontent,groupId:groupId,memberId:memberId,groupNo:groupNo}};return req},innerShareManager:function(id,type,sharetype,memberid,url,orgcode,title,pageParams){var req={method:"POST",url:appConfig.actionUrl+"com.am.app_plugins_common.share.ShareManager.do",data:{id:id,type:type,sharetype:sharetype,memberid:memberid,url:url,orgcode:orgcode,title:title,pageParams:pageParams}};return req},getMessageNoticeInfo:function(memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.message.notice.GetNoticeInfo.do",data:{memberid:memberid}};return req},pushLocationNotice:function(title,content,registrationid,platformStr){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.push_message.webapi.PushLocationNotice.do",data:{title:title,content:content,registrationid:registrationid,platformStr:platformStr}};return req},settingDemand:function(status,demandid,memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.demand.webapi.SettingDemand.do",data:{status:status,demandid:demandid,memberid:memberid}};return req},getMeteorRandomInfo:function(memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.dynamic.meteor.GetMeteorRandomInfo.do",data:{memberid:memberid}};return req},createGroup:function(groupname,memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.webapi.CreateGroup.do",data:{groupname:groupname,memberid:memberid}};return req},updateUserDynamicImg:function(memberid,dynamic_img){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.webapi.member.UpdateUserDynamicBackGround.do",data:{memberId:memberid,dynamic_img:dynamic_img}};return req},updateDynamicUpPoint:function(id,memberid){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.dynamic.detail.UpdateUpPoint.do",data:{memberid:memberid,id:id}};return req},updateEvaluateNum:function(store_id){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.myorder.UpdateEvaluateNum.do",data:{store_id:store_id}};return req},confirmDemand:function(demandId,remuneration){var req={method:"POST",url:appConfig.actionUrl+"com.am.uoou.webapi.ConfirmDemand.do",data:{demandId:demandId,remuneration:remuneration}};return req},getUserOpenIdByCode:function(memberId,code){var req={method:"POST",url:appConfig.actionUrl+"com.am.frame.weichart.webApi.GetWeiChartOpenPlatformUserBaseInfo.do",data:{member_id:memberId,code:code}};return req}}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.baidumap",{url:"/baidumap/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/baidumap/views/baidu_map_index.html",controller:"BaiDuMapCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("BaiDuMapCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$sce",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$sce){$scope.pageData={userLocation:Authen.getDriverLocation(),address:""};var lng=$scope.pageData.userLocation.currentPoint.lng,lat=$scope.pageData.userLocation.currentPoint.lat,address=JSON.parse($state.params.params).address;console.debug(address),$scope.pageData.address=$sce.trustAsResourceUrl(""+appConfig.baseUrl+"/baidumap.html?lng="+lng+"&lat="+lat+"&endaddress="+address),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.carRental",{url:"/carRental",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/car_rental/views/car_rental_page.html",controller:"CarRentalCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("CarRentalCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={title:"车行",List_Events:{},cxData:"",zwData:"",jgData:"",quercx:"",querzw:"",querjg:"",params:{wherSQL:"AND ms.mallclass_id='9' "}},$scope.toSearch=function(){$state.go("common.search",{})},$scope.init=function(){$scope.initCx(),$scope.initZw(),$scope.initJg()},$scope.initCx=function(){var params={lableClass:5},rData=actionManagerService.excuteResource("triph.label.labelEnum",params,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){var tData=toolsService.formJarryToObject(data.DATA);console.error(tData),$scope.pageData.cxData={name:"车型",data:tData}}})},$scope.initZw=function(){var params={lableClass:6},rData=actionManagerService.excuteResource("triph.label.labelEnum",params,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){var zwData=toolsService.formJarryToObject(data.DATA);$scope.pageData.zwData={name:"座位",data:zwData}}})},$scope.initJg=function(){var params={lableClass:7},rData=actionManagerService.excuteResource("triph.label.labelEnum",params,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){var jgData=toolsService.formJarryToObject(data.DATA);$scope.pageData.jgData={name:"价格",data:jgData},console.error($scope.pageData.jgData)}})},$scope.selectClick1=function(value){$scope.pageData.quercx=value,$scope.quer()},$scope.selectClick2=function(value){$scope.pageData.querzw=value,$scope.quer()},$scope.selectClick3=function(value){$scope.pageData.querjg=value,$scope.quer()},$scope.quer=function(){var wherSQL="AND ms.mallclass_id='9' ";$scope.pageData.quercx&&0!=$scope.pageData.quercx&&(wherSQL+=" AND ms.zccx_id = '"+$scope.pageData.quercx+"'"),$scope.pageData.querzw&&0!=$scope.pageData.querzw&&(wherSQL+=" AND ms.zczws_id='"+$scope.pageData.querzw+"' "),$scope.pageData.querjg&&0!=$scope.pageData.querjg&&(wherSQL+=" AND ms.zcjg_id ='"+$scope.pageData.querjg+"' "),$scope.pageData.params={wherSQL:wherSQL}},$scope.pageData.List_Events={carRental:function(id){console.info(id),$state.go("commodity.carRentalDetails",{params:JSON.stringify({id:id})})}},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.carRentalDetails",{url:"/carRentalDetails/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/car_rental/views/car_rental_details_page.html",controller:"CarRentalDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("CarRentalDetailsCtrl",["OtherHandleService","$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","AmCommonService","$ionicModal","$ionicPopup","commdityService","$timeout","$ionicBackdrop","$ionicHistory",function(OtherHandleService,$scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,AmCommonService,$ionicModal,$ionicPopup,commdityService,$timeout,$ionicBackdrop,$ionicHistory){$scope.pageData={baseUrl:appConfig.baseUrl,title:"",mainimage:"img/bg.png",dityid:0,fileJSo:[],storeImageNum:0,memberid:Authen.getUserId(),params:"",priceInfo:"",objArr:[],guige:"",mixData:"",choiceMoney:0};var rValue=[];$scope.goBack=function(){toolsService.goBackPage()},$scope.init=function(){var id=JSON.parse($state.params.params).id,rData=actionManagerService.getCarRentalInfo(id);ajaxManager.ajaxToJson(rData,function(data){console.error(data),$scope.pageData.title=data[0].STORE_NAME,$scope.pageData.mainimage=data[0].MAINIMGS,0!=data[0].MALL_STOREIMAGELIST.length&&(rValue=toolsService.formImagesToImgpicker(data[0].MALL_STOREIMAGELIST,function(count){$scope.pageData.storeImageNum=count})),$scope.pageData.comment=data[0].COMMENT,toolsService.isEmpty(data[0].MALL_COMMODITY)||($scope.pageData.dityid=data[0].MALL_COMMODITY[0].DITYID),$scope.pageData.commodityData=data[0].MALL_COMMODITY})},$scope.tuji=function(){if(0!=$scope.pageData.storeImageNum){var title=$scope.pageData.title,fileJSo=rValue,params={title:title,data:fileJSo};console.debug(params),$state.go("common.imagePicker",{params:JSON.stringify(params)})}},$scope.share=function(){var id=JSON.parse($state.params.params).id,title=$scope.pageData.title,img=$scope.pageData.baseUrl+$scope.pageData.mainimage[0].path,params={id:id,title:title,img:img,url:""};OtherHandleService.share(params)},$scope.comment=function(item){var id=item.ID,showImgs=item.SHOW_IMGS,badComments=item.BAD_COMMENTS,goodComments=item.GOOD_COMMENTS,qjzs=item.QJZS,pjpxdf=item.PJPXDF,title="商品评价",type=2,params={id:id,title:title,type:type,count:pjpxdf,allTotle:qjzs,greetTotle:goodComments,badTotle:badComments,photoTotle:showImgs};$state.go("common.publiccomment",{params:JSON.stringify(params)})},$scope.addCollection=function(){var id=JSON.parse($state.params.params).id,memberId=$scope.pageData.memberid;AmCommonService.addCollection({id:id,memberid:memberId,type:"store"})},$scope.init(),$scope.closeModal=function(){$rootScope.modal.hide(),$ionicBackdrop.release()},$scope.showModal=function(item){$scope.pageData.params=item,$scope.selectData(item),$rootScope.modal.show(),$ionicBackdrop.retain()},$ionicModal.fromTemplateUrl("carRentalDetails.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$rootScope.modal=modal}),$scope.$on("$destroy",function(){$scope.modal&&$scope.modal.hide()}),$scope.$on("modal.hidden",function(){$ionicBackdrop.release()}),$scope.$on("modal.removed",function(){$ionicBackdrop.release()}),$scope.selectData=function(item){var Id={id:item.ID},rData=actionManagerService.excuteResource("triph.public.selectCommodity",Id,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.guige=data.DATA,$scope.pageData.mixData=data.DATA[0].DATES;for(var i=0;$scope.pageData.guige.length>i;i++){var obj={date:$scope.pageData.guige[i].DATES,price:$scope.pageData.guige[i].JIAGE,id:$scope.pageData.guige[i].ID};$scope.pageData.objArr.push(obj)}$scope.pageData.dateData={priceData:$scope.pageData.objArr,selectType:"2",operation:"0",week:[0,1,2,3,4,5,6],startyear:$scope.pageData.mixData}}})},$scope.result=function(value){$scope.pageData.startData=value.start.date,$scope.pageData.endDate=value.end.date,$scope.pageData.choiceMoney=value.start.price,$scope.pageData.choiceId=value.start.id;for(var j=0;j<$scope.pageData.guige.length;j++)$scope.pageData.guige[j].ID==$scope.pageData.choiceId&&($scope.pageData.guigeInfo=$scope.pageData.guige[j])},$scope.buyNow=function(){$scope.pageData.choiceId?(commdityService.saveShopInfoToPayment($scope.pageData.memberid,$scope.pageData.params,$scope.pageData.guigeInfo,1,{startDate:$scope.pageData.startData,endDate:$scope.pageData.endDate}),$timeout(function(){$scope.closeModal();var params={source:"commodityDetails"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})},300)):toolsService.showMessage("请选择规格",2)}}]),angular.module("mallMobileApp.controllers").controller("AccessNavigetion",["$scope","$rootScope","$stateParams","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$stateParams,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={title:JSON.parse($state.params.params).title,banner_menu_code:JSON.parse($state.params.params).banner_menu_code,buttons:JSON.parse($state.params.params).buttons,content_menu_code:JSON.parse($state.params.params).content_id,show_type:JSON.parse($state.params.params).show_type,listEvents:null,detailed:null,content_title:null,button_width:0,button_padding:0},$scope.init=function(){var rData=actionManagerService.excuteResource("contentdetailsbycode",{codition:"and  am_mobliemenuid  = '"+$scope.pageData.content_menu_code+"'"},"","");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA.length>0&&($scope.pageData.detailed=data.DATA[0].DETAILED,$scope.pageData.content_title=data.DATA[0].TITLE)}),$scope.pageData.button_width=(window.screen.width-20)/$scope.pageData.buttons.length-20,$scope.pageData.button_padding=100*((window.screen.width-(.05*window.screen.width*($scope.pageData.buttons.length-1)+$scope.pageData.button_width*$scope.pageData.buttons.length+10))/2/window.screen.width).toFixed(2)+"%",toolsService.isEmpty($scope.pageData.title)&&($scope.pageData.title="二级页面")},$scope.redirect=function(item){var url=item.url,routeParam=item.routeParam;if(routeParam||(routeParam={}),url&&"http://"!=url.substr(0,7).toLowerCase())if(url.indexOf("/")>0){var arr=url.split("/");$state.go(arr[0],{params:JSON.stringify(arr[1])},{location:"replace"})}else console.error(url),$state.go(url,routeParam,{location:"replace"})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("commentCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={id:"",surveytitle:"",surveycontent:"",replyid:"",replyname:"请输入评论内容",replystate:"1",memberId:"",dataerr:!1,coverreplyid:"",upperreplyid:"",againreplyid:"",replyindex:"",againreplyindex:"",memberid:Authen.getUserId()},$scope.init=function(){var contentid={contentid:JSON.parse($state.params.params).contentid};$scope.pageData.commentcontent="";var rData=actionManagerService.excuteResource("currencyComment",contentid,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.commentdata=data;for(var i=0;i<data.DATA.length;i++)0!=data.DATA[i].PARTAKENUMBER?$scope.commentdata.DATA[i].openreply="展开回复":$scope.commentdata.DATA[i].openreply=""}})},$scope.init(),$scope.comment=function(){$scope.pageData.replyname="请输入评论内容",$scope.pageData.surveycontent=""},$scope.selreply=function(index){if($scope.pageData.replyindex=index,"展开回复"==$scope.commentdata.DATA[index].openreply){var id={id:$scope.commentdata.DATA[index].ID},rData=actionManagerService.excuteResource("toCurrencyComment",id,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.commentdata.DATA[index].replydata=data.DATA,$scope.commentdata.DATA[index].openreply="隐藏回复")})}else $scope.init()},$scope.upperreply=function(id,index){console.error(id),$scope.pageData.upperreplyid=id,$scope.pageData.replyindex=index;var id={id:id},rData=actionManagerService.excuteResource("upperreply",id,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.replyname="回复"+data.DATA[0].MEMBERNAME,$scope.pageData.coverreplyid=data.DATA[0].ID,$scope.pageData.memberId=data.DATA[0].MEMBERID)})},$scope.addComment=function(){var mentid=$scope.pageData.coverreplyid,contentid=JSON.parse($state.params.params).contentid,memberid=Authen.getUserId(),upmemberid=$scope.pageData.memberId,surveycontent=$scope.pageData.surveycontent;if(console.error(surveycontent),null==surveycontent||""==surveycontent||void 0==surveycontent)return void toolsService.showMessage("请输入评论内容！",1);var aData=actionManagerService.SaveComment(mentid,contentid,memberid,upmemberid,surveycontent);ajaxManager.ajaxToJson(aData,function(data){toolsService.isEmpty(data)||(toolsService.showMessage("评论成功！",1),$scope.pageData.surveycontent="",$scope.init())})},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("PublicCommentCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={id:"",type:"",title:"",allTotle:"0",greetTotle:"0",badTotle:"0",photoTotle:"0",allTab:"public_comment_select_div",greetTab:"",badTab:"",photoTab:"",barclass:"",classShow:!1,listParams:"",classfaction:[{name:"景区",value:"1"},{name:"酒店",value:"2"},{name:"餐饮",value:"3"},{name:"演艺",value:"4"},{name:"特产",value:"5"},{name:"车行",value:"6"},{name:"优惠组合",value:"7"},{name:"跟团游",value:"8"}],paramsCode:"com.am.mall.comment.GetCommentInfobyShop",listEvents:"",count:"0",clase:"",isSelect:!1,selectTab:""},$scope.init=function(){toolsService.isEmpty($state.params.params)||($scope.pageData.id=JSON.parse($state.params.params).id,$scope.pageData.title=JSON.parse($state.params.params).title,$scope.pageData.type=JSON.parse($state.params.params).type,$scope.pageData.count=JSON.parse($state.params.params).count,$scope.pageData.allTotle=JSON.parse($state.params.params).allTotle,$scope.pageData.greetTotle=JSON.parse($state.params.params).greetTotle,$scope.pageData.badTotle=JSON.parse($state.params.params).badTotle,$scope.pageData.photoTotle=JSON.parse($state.params.params).photoTotle,toolsService.isEmpty($scope.pageData.allTotle)&&($scope.pageData.allTotle="0"),toolsService.isEmpty($scope.pageData.greetTotle)&&($scope.pageData.greetTotle="0"),toolsService.isEmpty($scope.pageData.badTotle)&&($scope.pageData.badTotle="0"),toolsService.isEmpty($scope.pageData.photoTotle)&&($scope.pageData.photoTotle="0"),toolsService.isEmpty($scope.pageData.count)&&($scope.pageData.count="0")),toolsService.isEmpty($scope.pageData.title)?($scope.pageData.selectTab="allTab","1"==$scope.pageData.type&&($scope.pageData.listParams={condition:" and comd.store = '"+$scope.pageData.id+"'"})):($scope.pageData.selectTab="allTab","1"==$scope.pageData.type&&($scope.pageData.title="评价",$scope.pageData.listParams={condition:" and comd.store = '"+$scope.pageData.id+"'"}),"2"==$scope.pageData.type&&($scope.pageData.title="商品评价",$scope.pageData.listParams={condition:" and comd.id = '"+$scope.pageData.id+"'"}),"3"==$scope.pageData.type&&($scope.pageData.clase="1",$scope.pageData.title="用户评价",$scope.pageData.classShow=!0,$scope.pageData.listParams={condition:" and oe.memberid = '"+$scope.pageData.id+"'"})),"2"==$scope.pageData.type&&($scope.pageData.listParams={condition:" and comd.id = '"+$scope.pageData.id+"'"}),"3"==$scope.pageData.type&&($scope.pageData.clase="1",$scope.pageData.classShow=!0,$scope.pageData.listParams={condition:" and oe.memberid = '"+$scope.pageData.id+"'"})},$scope.selecttab=function(tabName,classes){if($scope.pageData.selectTab=tabName,"allTab"==tabName){if($scope.pageData.allTab="public_comment_select_div",$scope.pageData.greetTab="",$scope.pageData.badTab="",$scope.pageData.photoTab="","1"==$scope.pageData.type){var sql1="and comd.store = '"+$scope.pageData.id+"'";toolsService.isEmpty(classes)||(sql1+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sqls}}else if("3"==$scope.pageData.type){var sql2=" and oe.memberid = '"+$scope.pageData.id+"'";toolsService.isEmpty(classes)||(sql2+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql2}}else if("2"==$scope.pageData.type){var sql3=" and comd.id = '"+$scope.pageData.id+"'";toolsService.isEmpty(classes)||(sql3+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql3}}}else if("greetTab"==tabName){if($scope.pageData.allTab="",$scope.pageData.greetTab="public_comment_select_div",$scope.pageData.badTab="",$scope.pageData.photoTab="","1"==$scope.pageData.type){var sql1=" and comd.store = '"+$scope.pageData.id+"' and oe.starvalue >=4 ";toolsService.isEmpty(classes)||(sql1+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql1}}else if("3"==$scope.pageData.type){var sql2=" and oe.memberid = '"+$scope.pageData.id+"' and oe.starvalue >=4 ";toolsService.isEmpty(classes)||(sql2+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql2}}else if("2"==$scope.pageData.type){var sql3=" and comd.id = '"+$scope.pageData.id+"' and oe.starvalue >=4 ";toolsService.isEmpty(classes)||(sql3+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql3}}}else if("badTab"==tabName){if($scope.pageData.allTab="",$scope.pageData.greetTab="",$scope.pageData.badTab="public_comment_select_div",$scope.pageData.photoTab="","1"==$scope.pageData.type){var sql1=" and comd.store = '"+$scope.pageData.id+"' and oe.starvalue <3 ";toolsService.isEmpty(classes)||(sql1+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql1}}if("3"==$scope.pageData.type){var sql2=" and oe.memberid = '"+$scope.pageData.id+"' and oe.starvalue <3 ";toolsService.isEmpty(classes)||(sql2+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql2}}else if("2"==$scope.pageData.type){var sql3=" and comd.id = '"+$scope.pageData.id+"' and oe.starvalue <3 ";toolsService.isEmpty(classes)||(sql3+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql3}}}else if("photoTab"==tabName){if($scope.pageData.allTab="",$scope.pageData.greetTab="",$scope.pageData.badTab="",$scope.pageData.photoTab="public_comment_select_div","1"==$scope.pageData.type){var sql1=" and comd.store = '"+$scope.pageData.id+"' and oe.is_show_image = '1' ";toolsService.isEmpty(classes)||(sql1+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql1}}if("3"==$scope.pageData.type&&$scope.pageData.isSelect){var sql2=" and oe.memberid = '"+$scope.pageData.id+"' and oe.is_show_image = '1' ";toolsService.isEmpty(classes)||(sql2+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql2}}else if("2"==$scope.pageData.type){var sql3=" and comd.id = '"+$scope.pageData.id+"' and oe.is_show_image = '1' ";toolsService.isEmpty(classes)||(sql3+=" and comd.mall_class = '"+classes+"'"),$scope.pageData.listParams={condition:sql3}}}},$scope.changeAction=function(){$scope.pageData.isSelect=!0,toolsService.isEmpty($scope.pageData.selectTab)&&($scope.pageData.selectTab="allTab"),$scope.selecttab($scope.pageData.selectTab,$scope.pageData.clase)},$scope.jump=function(imgArr){if(!toolsService.isEmpty(imgArr)){var params=[{0:imgArr}];$state.go("common.imagePicker",{params:JSON.stringify(params)})}},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("GuideCtrl",["$rootScope","$scope","$timeout","$http","$location","toolsService","appConfig",function($rootScope,$scope,$timeout,$http,$location,toolsService,appConfig){new Swiper(".swiper-container",{paginationClickable:!0,pagination:".pagination",speed:300,onSlideChangeEnd:function(swiper){3==swiper.activeIndex?($(".clickDiv").css("zIndex","1200"),$(".startClick").css("zIndex","1201")):($(".clickDiv").css("zIndex","1"),$(".startClick").css("zIndex","1"))}});toolsService.isNewVersion(),$scope.startApp=function(){toolsService.setFirstRun("true"),$location.path("/mall/message").replace()}}]),angular.module("mallMobileApp.controllers").controller("ImagePickerCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state","$stateParams","appConfig","$ionicScrollDelegate","$cacheFactory",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state,$stateParams,appConfig,$ionicScrollDelegate,$cacheFactory){$scope.pageData={title:JSON.parse($state.params.params).title,data:JSON.parse($state.params.params).data,backurl:JSON.parse($state.params.params).backurl,classfactions:new Array,urlArr:new Array,pageUrlData:null,classSave:"",barclass:"",showClassFlag:!1,pageIndex:1,pageContent:0,conTainerHeight:"",documentEven:"",class_width:0};var galleryTop,galleryThumbs;$scope.init=function(){var okey="",ovalue="";toolsService.isEmpty($scope.pageData.title)&&($scope.pageData.title="图集");for(var i=0;i<$scope.pageData.data.length;i++){for(var key in $scope.pageData.data[i])okey=key,ovalue=$scope.pageData.data[i][key];$scope.pageData.classfactions.push(okey),$scope.pageData.urlArr.push(ovalue)}$scope.pageData.classfactions.length>1?($scope.pageData.showClassFlag=!0,$scope.pageData.pageUrlData=$scope.pageData.urlArr[0],$scope.pageData.class_width=90*$scope.pageData.classfactions.length):$scope.pageData.pageUrlData=$scope.pageData.urlArr[0],setTimeout(function(){$scope.initSwiper()},100)},$scope.initSwiper=function(){galleryTop=new Swiper(".gallery-top",{nextButton:".swiper-button-next",prevButton:".swiper-button-prev",spaceBetween:10,initialSlide:0,observer:!0,watchActiveIndex:!0,onSlideChangeStart:function(swiper){if(galleryTop.length>=2){var index=galleryTop[galleryTop.length-1].activeIndex+1;$scope.pageData.pageIndex=index,console.debug("ImagePickerCtrl_initSwiper"+index)}else $scope.pageData.pageIndex=galleryTop.activeIndex+1}}),galleryThumbs=new Swiper(".gallery-thumbs",{spaceBetween:10,centeredSlides:!0,initialSlide:0,slidesPerView:"auto",touchRatio:.2,slideToClickedSlide:!0,observer:!0}),galleryTop.length>=2?(galleryTop[galleryTop.length-1].params.control=galleryThumbs[galleryThumbs.length-1],galleryThumbs[galleryThumbs.length-1].params.control=galleryTop[galleryTop.length-1]):(galleryTop.params.control=galleryThumbs,galleryThumbs.params.control=galleryTop)},$scope.selectClick=function(classname,item,$event){for(var i=0;i<$scope.pageData.urlArr.length;i++)item==i&&($scope.pageData.pageUrlData=$scope.pageData.urlArr[i]);toolsService.isEmpty($scope.pageData.documentEven)?($scope.pageData.documentEven=$event.target,$scope.pageData.documentEven.setAttribute("class","destination_button month_button ng-binding button tab-item button-positive")):($scope.pageData.documentEven.setAttribute("class","destination_button month_button ng-binding button tab-item button-outline button-stable"),$scope.pageData.documentEven=$event.target,$scope.pageData.documentEven.setAttribute("class","destination_button month_button ng-binding button tab-item button-positive")),toolsService.isEmpty(galleryTop)||toolsService.isEmpty(galleryThumbs)||setTimeout(function(){galleryTop.update(),galleryThumbs.update()},500)},$scope.myswiper=function(){0!=$ionicScrollDelegate.$getByHandle("small").getScrollPosition().left?$scope.pageData.barclass="myorder_bar_display_none":0==$ionicScrollDelegate.$getByHandle("small").getScrollPosition().left&&($scope.pageData.barclass="myorder_bar_display_block"),$scope.$evalAsync()},$scope.back=function(){toolsService.goBackPage()},$scope.init()}]),mallMobileApp.config(["$stateProvider",function($stateProvider){$stateProvider.state("more.contentdetails_params",{url:"/contentdetails_params/:params",cache:!1,views:{more_view:{templateUrl:"app_plugins/common/message/views/message_detail.html",controller:"MessageDetailCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MessageDetailCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$window","$stateParams",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$window,$stateParams){$scope.pageData={title:"为您准备",paramsid:"",memberid:Authen.getUserId(),discription:"",img:"",infoData:"",button_height:"50"},ionic.Platform.isIOS()&&($scope.pageData.button_height="60"),$scope.init=function(){$scope.pageData.paramsid=angular.fromJson($state.params.params).id,$scope.getCouponInfo()},$scope.back=function(){toolsService.goBackPage()},$scope.getCouponInfo=function(id){var rData=actionManagerService.excuteResource("triph.app_plugins.common.message.GetCouponInfo",{id:$scope.pageData.paramsid},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.id=data.DATA[0].ID,$scope.pageData.infoData=data.DATA[0])})},$scope.receive=function(id){
if(Authen.isAuthorized()){var rData=actionManagerService.receiveCoupon($scope.pageData.paramsid,$scope.pageData.memberid);ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data)||(0==data.code?$state.go("member.mycoupon"):toolsService.tips(data.msg,""))})}else toolsService.showMessage("您还未登陆，请登录后在领取。",2)},$scope.init()}]),mallMobileApp.config(["$stateProvider",function($stateProvider){$stateProvider.state("common.message",{url:"/message",cache:!1,views:{common_view:{templateUrl:"app_plugins/common/message/views/message_list_page.html",controller:"MessageListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MessageListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$window",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$window){$scope.pageData={title:"消息",clickCssA:"common_message_label_on",classCssB:"common_message_label_off",params:"",memberid:Authen.getUserId(),list_events:""},$scope.init=function(){$scope.pageData.params={memberid:$scope.pageData.memberid,condition:" where menu_code = 'notice'"}},$scope.selectClick=function(type){"1"===type?($scope.pageData.clickCssA="common_message_label_on",$scope.pageData.classCssB="common_message_label_off",$scope.pageData.params={memberid:$scope.pageData.memberid,condition:" where menu_code = 'notice'"}):"2"===type&&($scope.pageData.clickCssA="common_message_label_off",$scope.pageData.classCssB="common_message_label_on",$scope.pageData.params={memberid:$scope.pageData.memberid,condition:" where menu_code <> 'notice'"})},$scope.back=function(){toolsService.goBackPage()},$scope.pageData.list_events={toPages:function(menu_code,url,id){toolsService.toStateOfServermessage($state,url)}},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("PaymentManagerCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state","$stateParams","appConfig","PlatformManagerService","$sce","$http","$ionicPopup","md5",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state,$stateParams,appConfig,PlatformManagerService,$sce,$http,$ionicPopup,md5){$scope.pageData={title:JSON.parse($state.params.params).title,pay_id:JSON.parse($state.params.params).pay_id,out_account_code:JSON.parse($state.params.params).out_account_code,in_account_code:JSON.parse($state.params.params).in_account_code,out_remakes:JSON.parse($state.params.params).out_remakes,in_remakes:JSON.parse($state.params.params).out_remakes,pay_money:JSON.parse($state.params.params).pay_money,business:JSON.parse($state.params.params).business,success_url:JSON.parse($state.params.params).success_url,lost_url:JSON.parse($state.params.params).lost_url,pay_type_name:JSON.parse($state.params.params).pay_type_name,pay_type:JSON.parse($state.params.params).pay_type,accountInfo:null,accountIdArr:new Array,account_type:null,memberId:Authen.getUserId(),orderInfo:{},msg_template:"",derive:"ALL",isWx:"",payPassword:"",payPasswordErrorMessage:"",payRemake:""},1==appConfig.isDerive?$scope.pageData.derive="APP":0==appConfig.isDerive&&($scope.pageData.derive="WEB");var msgTemplage=JSON.parse($state.params.params).msg_template;msgTemplage?$scope.pageData.msg_template=msgTemplage:$scope.pageData.msg_template="";var ua=navigator.userAgent.toLowerCase(),isWeixin=-1!=ua.indexOf("micromessenger");$scope.pageData.isWx=isWeixin,$scope.init=function(){var tPayTypeName="充值";if("1"==$scope.pageData.pay_type&&(tPayTypeName="支付"),$scope.getAccountInfo($scope.pageData.out_account_code,$scope.pageData.accountIdArr),toolsService.isEmpty($scope.pageData.pay_type_name)&&($scope.pageData.pay_type_name=tPayTypeName),$scope.pageData.business.orders){var orderId=$scope.pageData.business.orders.split(",")[0],rData=actionManagerService.excuteResource("orderdetails",{orderid:orderId},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)?($scope.pageData.orderInfo.ORDERCODE=orderId,$scope.pageData.orderInfo.COMMODITYNAME="充值"):($scope.pageData.orderInfo=data.DATA[0],data.DATA[0]&&($scope.pageData.msg_template=$sce.trustAsHtml(data.DATA[0].PAYMENT_SHOW_MSG)))})}},$scope.getAccountInfo=function(paramAccount,accountInfoArr){var rData=actionManagerService.excuteResource("account_class_info",{accountType:" and mai.member_orgid_id ='"+$scope.pageData.memberId+"'"},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){if($scope.pageData.accountInfo=data.DATA,!toolsService.isEmpty(paramAccount)){var arr=null;paramAccount.indexOf(",")>0?arr=paramAccount.split(","):(arr=new Array,arr.push(paramAccount)),console.debug($scope.pageData.accountInfo);for(var i=0;i<$scope.pageData.accountInfo.length;i++)for(var j=0;j<arr.length;j++)arr[j]==$scope.pageData.accountInfo[i].SA_CODE&&($scope.pageData.accountInfo[i].CSS="ion-ios-circle-outline",accountInfoArr.push($scope.pageData.accountInfo[i]))}console.debug($scope.pageData.accountIdArr)}})},$scope.back=function(){toolsService.goBackPage()};var item,currentPaymethIndex;$scope.selectPayMonth=function(index){$scope.pageData.accountIdArr[index].CSS="ion-ios-checkmark",(currentPaymethIndex||0==currentPaymethIndex)&&($scope.pageData.accountIdArr[currentPaymethIndex].CSS="ion-ios-circle-outline"),item=$scope.pageData.accountIdArr[index],currentPaymethIndex=index};var errorFue;$scope.toPayment=function(){if($scope.pageData.orderInfo&&"true"==$scope.pageData.orderInfo.IS_CLOSE)return void toolsService.showMessage("交易超时，请重新下单！",1500);if(item)if("SYS_ACCOUNT"==item.PAY_CLASS_CODE){$ionicPopup.confirm({title:'<div class="fs-14"><strong>确认支付</strong></div>',template:'<input type="password" style="border: 1px solid #ddd;" placeholder="请输入登录密码后完成支付-必填" ng-model="pageData.payPassword"><div  style="color:red;height: 20px;" >{{pageData.payPasswordErrorMessage}}</div>',scope:$scope,buttons:[{text:"取消",type:"btnc",onTap:function(){$scope.pageData.payPasswordErrorMessage="",$scope.pageData.payPassword=""}},{text:"确定",type:"btn1",onTap:function(e){if(errorFue=e,toolsService.isEmpty($scope.pageData.payPassword))$scope.pageData.payPasswordErrorMessage="请正确填写登录密码完成支付操作!",e.preventDefault();else{var passw=md5.createHash($scope.pageData.payPassword),payDatas=actionManagerService.excuteResource("lxny.app_plugins.common.payment.getUserInfoByPasswordAndMemberid",{id:Authen.getUserInfo().ID,loginpassword:passw},"none","none");ajaxManager.ajaxToJson(payDatas,function(date){toolsService.isEmpty(date)?($scope.pageData.payPasswordErrorMessage="",$scope.pageData.payPassword="",toolsService.tips("登录密码错误,请正确填写登录密码完成支付操作!",1500)):date.DATA.length<1?($scope.pageData.payPasswordErrorMessage="",$scope.pageData.payPassword="",toolsService.tips("登录密码错误,请正确填写登录密码完成支付操作!",1500)):($scope.pageData.payPasswordErrorMessage="",$scope.pay(item.SA_CODE,"2",!0))})}}}]});$(".popup-buttons").css("padding","0px"),$(".popup-body").css("border-bottom","1px solid #ddd")}else $scope.pay(item.SA_CODE,"2",!0);else toolsService.showMessage("请选择支付方式",800)},$scope.pay=function(pay_code,account_type,blanace_type){if(console.debug("$scope.pay() pay_code="+pay_code),!toolsService.isEmpty(pay_code)&&blanace_type){$scope.pageData.account_type=account_type;try{var openId=Authen.getUserMPOpenId();if(console.info("openID:"+openId),console.info($scope.pageData.in_remakes),openId&&"ALIPAY_ACCOUNT_MODE_WEB"==pay_code)return void toolsService.showMessage("请点击右上角在浏览器中打开进行支付",1800);if(!openId&&"MP_WECHAT_ACCOUNT_MODE"==pay_code)return void toolsService.showMessage("无法使用微信支付",1800)}catch(e){}$scope.pageData.orderInfo.COMMODITYNAME||($scope.pageData.orderInfo.COMMODITYNAME=$scope.pageData.out_remakes||$scope.pageData.in_remakes);var rData=actionManagerService.executePayMent($scope.pageData.memberId,$scope.pageData.in_account_code,pay_code,$scope.pageData.pay_id,$scope.pageData.pay_money,$scope.pageData.pay_type,account_type,$scope.pageData.business,$scope.pageData.in_remakes,$scope.pageData.out_remakes,Authen.getUserMPOpenId(),$scope.pageData.orderInfo.COMMODITYNAME);ajaxManager.ajaxToJson(rData,function(data){var param=null,tResultType=2;if(!toolsService.isEmpty(data))if("0"==data.code){tResultType=1,param={title:$scope.pageData.pay_type_name,success_url:$scope.pageData.success_url,lost_url:$scope.pageData.lost_url,business:$scope.pageData.business,result_type:tResultType,pay_id:$scope.pageData.pay_id,pay_money:$scope.pageData.pay_money,lost_msg:"支付成功"};var payPrice=$scope.pageData.pay_money,commodityName=$scope.pageData.orderInfo.COMMODITYNAME||$scope.pageData.in_remakes;"2"==$scope.pageData.pay_type&&(commodityName="充值");var aliPayparams={seller:appConfig.alipayEmail,subject:commodityName,body:commodityName,price:payPrice,tradeNo:$scope.pageData.pay_id,timeout:"30m",notifyUrl:appConfig.alipayNotifyUrl};if(!appConfig.isDerive&&"ALIPAY_ACCOUNT_MODE_WEB"==pay_code){var aliPayWebParas="seller="+appConfig.alipayEmail;aliPayWebParas+="&WIDout_trade_no="+$scope.pageData.pay_id,aliPayWebParas+="&WIDsubject="+encodeURIComponent($scope.pageData.orderInfo.COMMODITYNAME||$scope.pageData.in_remakes),aliPayWebParas+="&WIDtotal_fee="+payPrice,aliPayWebParas+="&WIDshow_url="+location.href,aliPayWebParas+="&WIDbody= "+encodeURIComponent($scope.pageData.orderInfo.COMMODITYNAME||$scope.pageData.in_remakes),window.open(appConfig.baseUrl+"/alipay/wap/alipayapi.jsp?"+aliPayWebParas),$state.go("member.myorder",{},{location:"replace"})}if(appConfig.isDerive&&data.account_type_code&&"aliPay"==data.account_type_code){var aliPay=new sdk_services_common_service_payment_IPayment_impl_AlipayPayment;console.debug("支付宝支付,支付参数:"+angular.toJson(aliPayparams)),aliPay.execute(aliPayparams,function(data){console.debug("支付宝支付，支付成功！"+data),"9000"==data&&$state.go("common.resultpage",{params:JSON.stringify(param)},{location:"replace"})},function(errorData){console.debug("支付宝支付，支付失败！"+errorData)})}if(data.account_type_code&&"WECHAT_ACCOUNT_MODE"==data.account_type_code){var wechart=new sdk_services_common_service_payment_IPayment_impl_WxpayPayment;wechart.execute(data.prepay_id,function(data){console.error("微信支付成功返回："+data),"0"==data&&$state.go("common.resultpage",{params:JSON.stringify(param)},{location:"replace"})},function(errorData){console.debug("微信支付，支付失败！"+errorData)})}if(data.account_type_code&&"MP_WECHAT_ACCOUNT_MODE"==data.account_type_code){var mpWechart=new sdk_services_common_service_payment_IPayment_impl_MpWeiChartPaymentImpl;mpWechart.execute(data.UNIFORM,function(res){"get_brand_wcpay_request:ok"==res.err_msg&&$state.go("common.resultpage",{params:JSON.stringify(param)},{location:"replace"})})}data.account_type_code&&"SYSTEM_ACCOUNT"==data.account_type_code&&$state.go("common.resultpage",{params:JSON.stringify(param)},{location:"replace"})}else toolsService.tips(data.msg,"")})}},$scope.back=function(){toolsService.goBackPage()},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("PaymentInputManagerCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={blance:0,id:"",memberid:Authen.getUserId(),success_url:JSON.parse($state.params.params).success_url,lost_url:JSON.parse($state.params.params).lost_url,out_account_code:JSON.parse($state.params.params).out_account_code,paymoney:JSON.parse($state.params.params).paymoney,paysource:0,paycontent:"充值支付",amorders:"",balance:0,accountId:JSON.parse($state.params.params).accountCode},$scope.recordBlance=function(){JSON.parse($state.params.params).paymoney?$scope.pageData.paymoney=$scope.pageData.paymoney:$scope.pageData.paymoney=0;var params={member_id:$scope.pageData.memberid,sa_code:$scope.pageData.accountId},rData=actionManagerService.excuteResource("GetAccountInfo",params,"","");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE)})},console.error($state.params.params),$scope.recordBlance(),$scope.recordPayment=function(){if(!toolsService.isNumber($scope.pageData.paymoney))return toolsService.tips("请正确输入金额!",""),!1;if(0==$scope.pageData.paymoney)return toolsService.tips("请输入金额!",""),!1;var uuid=toolsService.uuid().toUpperCase();uuid=uuid.replace(/-/g,"");var params={title:"充值",out_account_code:$scope.pageData.out_account_code,in_account_code:$scope.pageData.accountId,out_remakes:"",in_remakes:"充值",pay_money:new Number($scope.pageData.paymoney),business:{payment_id:uuid,in_account_code:$scope.pageData.accountId,memberid:$scope.pageData.memberid,orders:uuid,paymoney:new Number($scope.pageData.paymoney),success_call_back:"com.am.frame.payment.business.PayBusinessCallBack"},success_url:$scope.pageData.success_url,lost_url:$scope.pageData.lost_url,pay_id:uuid,pay_type:"2",pay_type_name:"充值"};$state.go("common.payment",{params:JSON.stringify(params)},{location:"replace"})},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("TransactionRecordCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={recordInfo:null,memberId:Authen.getUserId(),accountCode:"",stateDate:null,endDate:null,type:null,title:"交易列表",params:null,list_events:"",pay_type:"",select_date:"",start_date:"",end_date:"",condition:"",pay_type_arr:[{value:"1",name:"支出"},{value:"2",name:"收入"}],select_date_arr:[{value:"1",name:"当天"},{value:"2",name:"最近一个月"},{value:"3",name:"最近三个月"}]},$scope.init=function(){$scope.pageData.select_date="1";var memberid="",params=JSON.parse($state.params.params).memberid;memberid=void 0==params||""==params?$scope.pageData.memberId:JSON.parse($state.params.params).memberid,$scope.pageData.start_date=new Date,$scope.pageData.end_date=new Date,$scope.pageData.accountCode=JSON.parse($state.params.params).accountCode,$scope.pageData.params={memberid:memberid,sa_code:$scope.pageData.accountCode,condition:" and to_char(mtd.trade_time,'yyyy-MM-dd')::date >=  to_date(to_char(cast('"+new Date($scope.pageData.start_date).Format("yyyy-MM-dd")+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') and to_char(mtd.trade_time,'yyyy-MM-dd')::date <= to_date(to_char(cast('"+new Date($scope.pageData.end_date).Format("yyyy-MM-dd")+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') "}},$scope.dateSeletChange=function(){var dataManager=new DataManager;"1"==$scope.pageData.select_date&&($scope.pageData.start_date=new Date,$scope.pageData.end_date=new Date),"2"==$scope.pageData.select_date&&($scope.pageData.start_date=dataManager.getDateToMonth(-1),$scope.pageData.end_date=new Date),"3"==$scope.pageData.select_date&&($scope.pageData.start_date=$scope.pageData.end_date=dataManager.getDateToMonth(-3),$scope.pageData.end_date=new Date)},$scope.query=function(){var str="";toolsService.isEmpty($scope.pageData.start_date)||(str+=" and to_char(mtd.trade_time,'yyyy-MM-dd')::date >=  to_date(to_char(cast('"+new Date($scope.pageData.start_date).Format("yyyy-MM-dd")+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') "),toolsService.isEmpty($scope.pageData.end_date)||(str+=" and to_char(mtd.trade_time,'yyyy-MM-dd')::date  <= to_date(to_char(cast('"+new Date($scope.pageData.end_date).Format("yyyy-MM-dd")+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') "),toolsService.isEmpty($scope.pageData.pay_type)||(str+=" and mtd.trade_type='"+$scope.pageData.pay_type+"'"),$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:$scope.pageData.accountCode,condition:str}},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("RedPacketManagerCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={title:JSON.parse($state.params.params).title,blance:0,outMemberid:Authen.getUserId(),inMemberid:JSON.parse($state.params.params).inMemberid,outAccountId:JSON.parse($state.params.params).out_account_code,inAccountId:JSON.parse($state.params.params).in_account_code,accountInfo:"",paymoney:0,inAccountIdArr:new Array,outAccountIdArr:new Array,virementDate:toolsService.getCurentDate(),in_remakes:"",out_remakers:JSON.parse($state.params.params).out_remakers,success_url:JSON.parse($state.params.params).success_url,lost_url:JSON.parse($state.params.params).lost_url,red_packet_class:"",red_packet_info:"",select_type:"",remakers:"",outSelectStatus:!1,accountIdArr:new Array,isSelfSend:!1,selectItemId:0,selectItemMoney:"",pageName:"",selftShow:!1},$scope.getAccountInfo=function(){if(!$scope.pageData.showFlag){var rData=actionManagerService.excuteResource("account_class_info",{accountType:" and mpc.pay_class_code = 'SYS_ACCOUNT'"},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)&&($scope.pageData.accountInfo=data.DATA,!toolsService.isEmpty($scope.pageData.outAccountId))){var arr=null;if($scope.pageData.outAccountId.indexOf(",")>0){arr=$scope.pageData.outAccountId.split(","),$scope.pageData.outSelectStatus=!0;for(var j=0;j<arr.length;j++)for(var i=0;i<$scope.pageData.accountInfo.length;i++)if(arr[j]==$scope.pageData.accountInfo[i].SA_CODE){$scope.pageData.inAccountIdArr.push($scope.pageData.accountInfo[i]);break}}}})}},$scope.init=function(){$scope.getAccountInfo(),$scope.getRedClass(),$scope.getRedInfo(),toolsService.isEmpty($scope.pageData.title)&&($scope.pageData.title="发果蔬红包")},$scope.getRedClass=function(){var rData=actionManagerService.excuteResource("mall_base_setting_info",{condition:"and bs_type = 'red_packet_type'"},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.red_packet_class=data.DATA)})},$scope.getRedInfo=function(){var rData=actionManagerService.excuteResource("mall_red_packet_info","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.red_packet_info=data.DATA)})},$scope.selectSend=function(type_id,money,name){if(toolsService.isEmpty($scope.pageData.inMemberid))return void toolsService.tips("收红包人账户不能为空","");if($scope.pageData.pageName=name,toolsService.isEmpty(name))for(var i=0;i<$scope.pageData.red_packet_class.length;i++)$scope.pageData.select_type==$scope.pageData.red_packet_class[i].ID&&($scope.pageData.pageName=money/100+"元"+$scope.pageData.red_packet_class[i].BNAME);toolsService.isEmpty($scope.pageData.remakers)&&($scope.pageData.remakers="恭喜发财,大吉大利");var rData=actionManagerService.sendRedPacket($scope.pageData.outMemberid,$scope.pageData.outAccountId,$scope.pageData.inMemberid,$scope.pageData.inAccountId,money/100,$scope.pageData.out_remakers,type_id,$scope.pageData.remakers,$scope.pageData.pageName);ajaxManager.ajaxToJson(rData,function(data){"0"==data.code?toolsService.tips(data.msg,""):toolsService.tips(data.msg,"")})},$scope.selectClick=function(money,type_id,name){toolsService.isEmpty(type_id)?$scope.pageData.selftShow=!0:($scope.pageData.isSelfSend=!0,$scope.pageData.selectItemId=type_id,$scope.pageData.selectItemMoney=money,$scope.pageData.pageName=name,$scope.pageData.selftShow=!1)},$scope.send=function(){$scope.pageData.isSelfSend?$scope.selectSend($scope.pageData.selectItemId,$scope.pageData.selectItemMoney,$scope.pageData.pageName):$scope.sendSelftRedPage()},$scope.sendSelftRedPage=function(){if(toolsService.isEmpty($scope.pageData.inMemberid))return void toolsService.tips("收红包人账户不能为空","");if(toolsService.isEmpty($scope.pageData.select_type))return void toolsService.tips("请选择红包类型","");if(toolsService.isEmpty($scope.pageData.paymoney))return void toolsService.tips("请输入红包金额","");toolsService.isEmpty($scope.pageData.remakers)&&($scope.pageData.remakers="恭喜发财,大吉大利"),toolsService.isEmpty($scope.pageData.out_remakers)&&($scope.pageData.out_remakers="发送红包");for(var i=0;i<$scope.pageData.red_packet_class.length;i++)$scope.pageData.select_type==$scope.pageData.red_packet_class[i].ID&&($scope.pageData.pageName=$scope.pageData.paymoney+"元"+$scope.pageData.red_packet_class[i].BNAME);var rData=actionManagerService.sendRedPacket($scope.pageData.outMemberid,$scope.pageData.outAccountId,$scope.pageData.inMemberid,$scope.pageData.inAccountId,$scope.pageData.paymoney,$scope.pageData.out_remakers,$scope.pageData.select_type,$scope.pageData.remakers,$scope.pageData.pageName);ajaxManager.ajaxToJson(rData,function(data){"0"==data.code?toolsService.tips(data.msg,""):toolsService.tips(data.msg,"")})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("ResultManagerCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state","$stateParams","appConfig",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state,$stateParams,appConfig){$scope.pageData={title:JSON.parse($state.params.params).title,pay_id:JSON.parse($state.params.params).pay_id,business:JSON.parse($state.params.params).business,success_url:JSON.parse($state.params.params).success_url,lost_url:JSON.parse($state.params.params).lost_url,result_type:JSON.parse($state.params.params).result_type,success_msg:JSON.parse($state.params.params).success_msg,lost_msg:JSON.parse($state.params.params).lost_msg,paymoney:JSON.parse($state.params.params).pay_money,msg:"",imgSrc:""},console.error(JSON.parse($state.params.params)),console.error($scope.pageData.result_type),$scope.init=function(){"1"==$scope.pageData.result_type?($scope.pageData.imgSrc=appConfig.baseUrl+"",$scope.pageData.button_title=$scope.pageData.title+"成功",$scope.pageData.msg=$scope.pageData.success_msg):($scope.pageData.imgSrc=appConfig.baseUrl+"",$scope.pageData.button_title=$scope.pageData.title+"失败",$scope.pageData.msg=$scope.pageData.lost_msg)},$scope.toPage=function(){var paramsValue={pay_id:$scope.pageData.pay_id,business:$scope.pageData.business,paymoney:$scope.pageData.paymoney};console.error(paramsValue),"1"==$scope.pageData.result_type?$state.go($scope.pageData.success_url,{params:JSON.stringify(paramsValue)},{location:"replace"}):$state.go($scope.pageData.lost_url,{params:JSON.stringify(paramsValue)},{location:"replace"})},$scope.init()}]),mallMobileApp.config(["$stateProvider",function($stateProvider){$stateProvider.state("common.search",{url:"/search",cache:!1,views:{common_view:{templateUrl:"app_plugins/common/search/views/search.html",controller:"SearchControllers"}}})}]),angular.module("mallMobileApp.controllers").controller("SearchControllers",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$window","PlatformManagerService","$ionicPlatform","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$window,PlatformManagerService,$ionicPlatform,$ionicHistory){$scope.pageData={labelData:"",localData:null,searchName:"",url:"common.searchshark"},$scope.init=function(){var params={lable_class:"12"},rData=actionManagerService.excuteResource("triph.com.mall.search.GetLableInfo",params,"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.labelData=data.DATA)}),$scope.pageData.localData=$scope.getLocalInfo()},$scope.getLocalInfo=function(){var result=null;return toolsService.isEmpty($window.localStorage.getItem("local_search"))||(result=$window.localStorage.getItem("local_search"),result=JSON.parse(result)),result},$scope.inLocal=function(value){var localData=null,flag=!0;if(toolsService.isEmpty($window.localStorage.getItem("local_search"))){var arr={data:[]};arr.data.push({name:value}),$window.localStorage.setItem("local_search",JSON.stringify(arr))}else{localData=$window.localStorage.getItem("local_search"),localData=JSON.parse(localData);for(var i=0;i<localData.data.length;i++)localData.data[i].name==value&&(flag=!1);flag&&(localData.data.push({name:value}),$window.localStorage.setItem("local_search",JSON.stringify(localData)))}},$scope.search=function(value){if(toolsService.isEmpty(value)){if(!toolsService.isEmpty($scope.pageData.searchName)){$scope.inLocal($scope.pageData.searchName);var mparams={name:$scope.pageData.searchName};$state.go("common.searchItem",{params:JSON.stringify(mparams)})}}else{$scope.inLocal(value);var vparams={name:value};$state.go("common.searchItem",{params:JSON.stringify(vparams)})}},$scope.clear=function(type){if("1"==type)$scope.pageData.searchName="";else{var arr={data:[]};$window.localStorage.setItem("local_search",JSON.stringify(arr)),$scope.pageData.localData=$scope.getLocalInfo()}},$scope.back=function(){toolsService.goBackPage()},$ionicPlatform.on("deviceready",function(){var options={frequency:500},watchID=navigator.accelerometer.watchAcceleration(function(acceleration){(new Number(acceleration.x)>=14||new Number(acceleration.x)>=14||new Number(acceleration.x)>=14)&&"#/common/search"===location.hash&&(navigator.accelerometer.clearWatch(watchID),PlatformManagerService.shock(1e3),$state.go($scope.pageData.url,{}))},function(){},options);$scope.$on("$destroy",function(){navigator.accelerometer.clearWatch(watchID)})}),$scope.init()}]),mallMobileApp.config(["$stateProvider",function($stateProvider){$stateProvider.state("common.searchItem",{url:"/searchItem/:params",cache:!1,views:{common_view:{templateUrl:"app_plugins/common/search/views/search_list_page.html",controller:"SearchItemControllers"}}})}]),angular.module("mallMobileApp.controllers").controller("SearchItemControllers",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$window",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$window){$scope.pageData={title:"搜索",listData:null,params:"",list_events:""},$scope.init=function(){$scope.pageData.params={name:JSON.parse($state.params.params).name}},$scope.pageData.list_events={toPage:function(id,type,mallclass){var urlObj=new Array;urlObj["1-1"]="commodity.scenicspotdetails",urlObj["1-2"]="commodity.comdDetails",urlObj["2-1"]="commodity.hoteldetails",urlObj["2-2"]="commodity.comdDetails",urlObj["3-1"]="commodity.restaurantdetails",urlObj["3-2"]="commodity.comdDetails",urlObj["4-1"]="commodity.performingdetails",urlObj["4-2"]="commodity.comdDetails",urlObj["5-1"]="speciality.specialityList",urlObj["5-2"]="commodity.comdDetails",urlObj["6-1"]="commodity.carRentalDetails",urlObj["6-2"]="commodity.comdDetails",urlObj["7-1"]="commodity.discountGroupDetails",urlObj["7-2"]="commodity.comdDetails",urlObj["8-1"]="commodity.grouptourdetails",urlObj["8-2"]="commodity.comdDetails",urlObj["9-1"]="commodity.carRentalDetails",urlObj["9-2"]="commodity.comdDetails",urlObj[-2]="commodity.comdDetails";var tUrl=urlObj[mallclass+"-"+type],params={id:id};toolsService.isEmpty(tUrl)||$state.go(tUrl,{params:JSON.stringify(params)})}},$scope.init()}]),mallMobileApp.config(["$stateProvider",function($stateProvider){$stateProvider.state("common.searchshark",{url:"/searchshark",cache:!1,views:{common_view:{templateUrl:"app_plugins/common/search/views/search_shark.html",controller:"SearchSharkControllers"}}})}]),angular.module("mallMobileApp.controllers").controller("SearchSharkControllers",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$window","PlatformManagerService","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$window,PlatformManagerService,$ionicHistory){$scope.pageData={labelData:"",localData:null,searchName:""},$scope.init=function(){$scope.pageData.localData=[{name:"附近全部酒店",img:"app_plugins/common/search/img/shark_11.png",url:"commodity.hotel"},{name:"附近全部景区",img:"app_plugins/common/search/img/shark_18.png",url:"commodity.scenicspot"},{name:"附近全部美食",img:"app_plugins/common/search/img/shark_20.png",url:"commodity.restaurant"}]},$scope.search=function(value){var mparams={name:$scope.pageData.searchName};$state.go("common.searchItem",{params:JSON.stringify(mparams)})},$scope.clear=function(type){if("1"==type)$scope.pageData.searchName="";else{var arr={data:[]};$window.localStorage.setItem("local_search",JSON.stringify(arr)),$scope.pageData.localData=$scope.getLocalInfo()}},$scope.back=function(){toolsService.goBackPage()},$scope.toPage=function(url){$state.go(url,{})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("VirementManagerCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={title:JSON.parse($state.params.params).title,blance:0,outMemberid:Authen.getUserId(),outAccountId:JSON.parse($state.params.params).out_account_code,inAccountId:JSON.parse($state.params.params).in_account_code,accountInfo:"",paymoney:JSON.parse($state.params.params).paymoney,blanceFlag:!1,inAccountIdArr:new Array,virementDate:toolsService.getCurentDate(),in_remakes:JSON.parse($state.params.params).in_remakes,out_remakes:JSON.parse($state.params.params).out_remakes,success_url:JSON.parse($state.params.params).success_url,lost_url:JSON.parse($state.params.params).lost_url,success_default_url:"",lost_default_url:""},$scope.getAccountInfo=function(){if(!$scope.pageData.showFlag){var rData=actionManagerService.excuteResource("account_class_info",{accountType:" and mpc.pay_class_code = 'SYS_ACCOUNT' and mai.member_orgid_id = '"+$scope.pageData.outMemberid+"'"},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)&&($scope.pageData.accountInfo=data.DATA,!toolsService.isEmpty($scope.pageData.inAccountId))){var arr=null;$scope.pageData.inAccountId.indexOf(",")>0?arr=$scope.pageData.inAccountId.split(","):(arr=new Array,arr.push($scope.pageData.inAccountId));for(var i=0;i<$scope.pageData.accountInfo.length;i++)for(var j=0;j<arr.length;j++)$scope.pageData.accountInfo[i].SA_CODE==arr[j]&&$scope.pageData.inAccountIdArr.push($scope.pageData.accountInfo[i])}})}},$scope.init=function(){toolsService.isEmpty($scope.pageData.paymoney)?($scope.pageData.blanceFlag=!1,$scope.pageData.paymoney=0):$scope.pageData.blanceFlag=!0,$scope.getAccountInfo(),toolsService.isEmpty($scope.pageData.title)&&($scope.pageData.title="转账")},$scope.payClick=function(){if(!toolsService.isNumber($scope.pageData.paymoney))return toolsService.tips("请正确输入金额",""),!1;if(0==$scope.pageData.paymoney)return toolsService.tips("请输入金额",""),!1;if(toolsService.isEmpty($scope.pageData.inAccountId))return toolsService.tips("请选择目标账户",""),!1;var rData=actionManagerService.virementManager($scope.pageData.outMemberid,"",$scope.pageData.outAccountId,$scope.pageData.inAccountId,$scope.pageData.paymoney,$scope.pageData.out_remakes,$scope.pageData.in_remakes);ajaxManager.ajaxToJson(rData,function(data){var param="";"0"==data.code?(param={title:$scope.pageData.title,success_url:$scope.pageData.success_url,lost_url:$scope.pageData.lost_url,result_type:"1",pay_id:data.out_pay_id,business:$scope.pageData.business,pay_money:new Number($scope.pageData.paymoney),success_msg:data.msg},$state.go("common.resultpage",{params:JSON.stringify(param)},{location:"replace"})):(param={title:$scope.pageData.title,success_url:$scope.pageData.success_url,
lost_url:$scope.pageData.lost_url,business:$scope.pageData.business,result_type:"2",pay_id:data.out_pay_id,pay_money:new Number($scope.pageData.paymoney),lost_msg:data.msg},$state.go("common.resultpage",{params:JSON.stringify(param)},{location:"replace"}))})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("VirementOtherManagerCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={title:JSON.parse($state.params.params).title,blance:0,outMemberid:Authen.getUserId(),inMemberid:JSON.parse($state.params.params).inMemberid,outAccountId:JSON.parse($state.params.params).out_account_code,inAccountId:JSON.parse($state.params.params).in_account_code,accountInfo:"",paymoney:JSON.parse($state.params.params).paymoney,inAccountIdArr:new Array,virementDate:toolsService.getCurentDate(),in_remakes:JSON.parse($state.params.params).in_remakes,out_remakes:JSON.parse($state.params.params).out_remakes,success_url:JSON.parse($state.params.params).success_url,lost_url:JSON.parse($state.params.params).lost_url,business:JSON.parse($state.params.params).business,success_default_url:"",lost_default_url:"",blanceFlag:!1,inMemberFlag:!1},$scope.getAccountInfo=function(){if(!$scope.pageData.showFlag){var rData=actionManagerService.excuteResource("account_class_info",{accountType:" and mpc.pay_class_code = 'SYS_ACCOUNT' and mai.member_orgid_id = '"+$scope.pageData.outMemberid+"'"},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)&&($scope.pageData.accountInfo=data.DATA,!toolsService.isEmpty($scope.pageData.inAccountId))){var arr=null;$scope.pageData.inAccountId.indexOf(",")>0?arr=$scope.pageData.inAccountId.split(","):(arr=new Array,arr.push($scope.pageData.inAccountId));for(var i=0;i<$scope.pageData.accountInfo.length;i++)for(var j=0;j<arr.length;j++)arr[j]==$scope.pageData.accountInfo[i].SA_CODE&&$scope.pageData.inAccountIdArr.push($scope.pageData.accountInfo[i])}})}},$scope.init=function(){toolsService.isEmpty($scope.pageData.inMemberid)||($scope.pageData.inMemberFlag=!0),toolsService.isEmpty($scope.pageData.paymoney)?($scope.pageData.blanceFlag=!1,$scope.pageData.paymoney=0):$scope.pageData.blanceFlag=!0,$scope.getAccountInfo(),toolsService.isEmpty($scope.pageData.title)&&($scope.pageData.title="转账")},$scope.payClick=function(){if(!toolsService.isNumber($scope.pageData.paymoney))return toolsService.tips("请正确输入金额",""),!1;if(0==$scope.pageData.paymoney)return toolsService.tips("请输入金额",""),!1;if(toolsService.isEmpty($scope.pageData.inAccountId))return toolsService.tips("请选择目标账户",""),!1;if(toolsService.isEmpty($scope.pageData.inMemberid))return toolsService.tips("请输入目标人账号",""),!1;var rData=actionManagerService.virementManager($scope.pageData.outMemberid,$scope.pageData.inMemberid,$scope.pageData.outAccountId,$scope.pageData.inAccountId,$scope.pageData.paymoney,$scope.pageData.out_remakes,$scope.pageData.in_remakes);ajaxManager.ajaxToJson(rData,function(data){var param="";console.error(param),"0"==data.code?(param={title:$scope.pageData.title,success_url:$scope.pageData.success_url,lost_url:$scope.pageData.lost_url,result_type:"1",pay_id:data.out_pay_id,business:$scope.pageData.business,pay_money:$scope.pageData.paymoney,success_msg:data.msg},$state.go("common.resultpage",{params:JSON.stringify(param)},{location:"replace"})):(param={title:$scope.pageData.title,success_url:$scope.pageData.success_url,lost_url:$scope.pageData.lost_url,result_type:"2",pay_id:data.out_pay_id,business:$scope.pageData.business,pay_money:$scope.pageData.paymoney,lost_msg:data.msg},$state.go("common.resultpage",{params:JSON.stringify(param)},{location:"replace"}))})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("WithdrawManagerCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={balance:0,outMemberid:Authen.getUserId(),inAccountId:"",outAccountId:JSON.parse($state.params.params).outAccountId,success_url:JSON.parse($state.params.params).success_url,lost_url:JSON.parse($state.params.params).lost_url,accountInfo:"",paymoney:"",virtementType:"0",bankInfo:"",bindbingBankInfo:new Array,max_money:JSON.parse($state.params.params).max_money,title:"提现",free:""},$scope.init=function(){$scope.getAccountInfo(),$scope.bindingInfo()},$scope.getAccountInfo=function(){var param={member_id:$scope.pageData.outMemberid,sa_code:$scope.pageData.outAccountId},rData=actionManagerService.excuteResource("GetAccountInfo",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.accountInfo=data.DATA;for(var i=0;i<data.DATA.length;i++)data.DATA[i].SA_CODE==$scope.pageData.outAccountId&&($scope.pageData.paymoney="",$scope.pageData.balance=data.DATA[i].BALANCE,$scope.pageData.free=data.DATA[i].CASH_FEE_RATIO)}})},$scope.bindingInfo=function(){var param={memberid:$scope.pageData.outMemberid},rData=actionManagerService.excuteResource("mall_back_info",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.bankInfo=data.DATA)})},$scope.withdrawClick=function(){if(!toolsService.isNumber($scope.pageData.paymoney))return toolsService.tips("请正确输入金额",""),!1;if(""==$scope.pageData.paymoney||0==$scope.pageData.paymoney)return toolsService.tips("请输入金额",""),!1;if(toolsService.isEmpty($scope.pageData.inAccountId))return toolsService.tips("请选择提现账号",""),!1;if(toolsService.isEmpty($scope.pageData.detail))return toolsService.tips("请填写提现原因",""),!1;if(toolsService.isEmpty($scope.pageData.max_money)){var rData=actionManagerService.withdrawManager($scope.pageData.outMemberid,$scope.pageData.outAccountId,$scope.pageData.inAccountId,$scope.pageData.paymoney,"","0");ajaxManager.ajaxToJson(rData,function(data){"0"==data.code?(toolsService.tips("提现申请成功",""),toolsService.isEmpty($scope.pageData.success_url)||$state.go($scope.pageData.success_url,{},{location:"replace"})):(toolsService.tips(data.msg,""),toolsService.isEmpty($scope.pageData.lost_url)||$state.go($scope.pageData.lost_url,{},{location:"replace"}))})}else if(new Number($scope.pageData.max_money)/100>$scope.pageData.paymoney)return toolsService.tips("提现金额超出可提现额度",""),!1},$scope.init(),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("AgroProjListCtrl",["$scope","$state",function($scope,$state){$scope.pageData={listEvents:"",projectName:"",params:{wherSQL:""}},$scope.pageData.list_events={agroProjDetails:function(id){$state.go("cooperative.agroProjDetails",{id:id})}},$scope.query=function(){var wherSQL="";if($scope.pageData.projectName){var Name=$scope.pageData.projectName;wherSQL=" AND p_name LIKE '%"+Name+"%'"}$scope.pageData.params={wherSQL:wherSQL}}}]),angular.module("mallMobileApp.controllers").controller("AgroProjDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={prospectus:"",detailid:"",numberShares:"",shengYu:"",minBuyNumber:"",stockPrice:"",totalStocks:"",memberid:Authen.getUserId()},$scope.init=function(){var Id={id:$state.params.id},detailsData=actionManagerService.excuteResource("agriculture_project_details",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.prospectus=data.DATA[0].PROSPECTUS,$scope.pageData.detailid=data.DATA[0].ID,$scope.pageData.shengYu=data.DATA[0].SHENGYU,$scope.pageData.stockPrice=data.DATA[0].STOCK_PRICE,$scope.pageData.minBuyNumber=data.DATA[0].MIN_BUY_NUMBER,$scope.pageData.totalStocks=data.DATA[0].TOTAL_STOCKS,$scope.pageData.publishtime=data.DATA[0].PUBLISHTIME,$scope.pageData.penaltyRatio=data.DATA[0].PENALTY_RATIO)})},$scope.investment=function(){if(null==$scope.pageData.numberShares||""==$scope.pageData.numberShares||void 0==$scope.pageData.numberShares)return void toolsService.showMessage("请输入购买股数！",1);if(parseInt($scope.pageData.numberShares)>parseInt($scope.pageData.shengYu))return void toolsService.showMessage("购买份数大于剩余股数！",1);if(parseInt($scope.pageData.minBuyNumber)>parseInt($scope.pageData.numberShares))return void toolsService.showMessage("购买份数不能小于最小购买股数!",1);var number=$scope.pageData.numberShares,projectid=$scope.pageData.detailid,stockprice=$scope.pageData.stockPrice,memberid=Authen.getUserId(),moneys=$scope.pageData.numberShares*$scope.pageData.stockPrice/100,uuid=toolsService.uuid(),params={title:"投资农业项目",out_account_code:"CASH_ACCOUNT",in_account_code:"",out_remakes:"投资农业项目",in_remakes:"投资农业项目",pay_money:moneys,business:{payment_id:uuid,projectid:projectid,memberid:memberid,number:number,stockprice:stockprice,orders:uuid},success_url:"account.identityStock",lost_url:"cooperative.agroProjDetails",pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};$state.go("common.payment",{params:JSON.stringify(params)})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("ProjectDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={showView:"prospectus",memberid:Authen.getUserId(),params:JSON.parse($state.params.params),pageTitle:JSON.parse($state.params.params).P_NAME,id:JSON.parse($state.params.params).ID,projectId:JSON.parse($state.params.params).PROJECT_ID};var currentIndex=0;$scope.pageData.type=currentIndex,$scope.pageData.comdSelectCards=[{title:"招股说明",CSS:"login_cm_select_item_active",show:!0,style:"color:#24B35E;"},{title:"分红明细",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"}],$scope.selectCards=function(index){$scope.pageData.comdSelectCards[index].CSS="login_cm_select_item_active",$scope.pageData.comdSelectCards[index].style="color:#24B35E;",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="login_cm_select_item",$scope.pageData.comdSelectCards[currentIndex].style="color: #585858;",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex},$scope.withdrawShare=function(id){$state.go("cooperative.withdrawShare",{id:$scope.pageData.id})}}]),angular.module("mallMobileApp.controllers").controller("WithdrawShareCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={memberid:Authen.getUserId(),buyId:"",projectId:"",pName:"",sumPrice:"",expireTime:"",difference:"",penaltyRatio:"",buyNumber:""},$scope.init=function(){var id={id:$state.params.id},detailsData=actionManagerService.excuteResource("withdraw_share",id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.buyId=data.DATA[0].ID,$scope.pageData.projectId=data.DATA[0].PROJECT_ID,$scope.pageData.pName=data.DATA[0].P_NAME,$scope.pageData.sumPrice=data.DATA[0].SUMPRICE,$scope.pageData.penaltyRatio=data.DATA[0].PENALTY_RATIO,$scope.pageData.buyNumber=data.DATA[0].BUY_NUMBER,$scope.pageData.expireTime=data.DATA[0].EXPIRETIME,$scope.pageData.difference=data.DATA[0].DIFFERENCE)})},$scope.confirmWithdrawals=function(){var buyId=$scope.pageData.buyId,projectId=$scope.pageData.projectId,sumPrice=$scope.pageData.sumPrice,buyNumber=$scope.pageData.buyNumber,penaltyRatio=$scope.pageData.penaltyRatio,difference=$scope.pageData.difference,memberid=Authen.getUserId(),aData=actionManagerService.confirmWithdrawals(buyNumber,buyId,projectId,sumPrice,penaltyRatio,difference,memberid);ajaxManager.ajaxToJson(aData,function(data){toolsService.showMessage("退股成功！",1),$state.go("account.identityStock",{},{location:"replace"})})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("AgrlExpandedCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={params:{wherSQL:""}},$scope.pageData.listEvents={AgrlExpandedDetails:function(id){$state.go("cooperative.agrlExpandedDetails",{id:id})}},$scope.init=function(){var rData=actionManagerService.excuteResource("lxny.cooperative.agrlExpanded.agrlExpandedClass","","none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.typedata=data.DATA})},$scope.init(),$scope.query=function(){var wherSQL="";if($scope.pageData.classId){var classId=$scope.pageData.classId;wherSQL+=" AND at.class_id='"+classId+"' "}$scope.pageData.params={wherSQL:wherSQL}}}]),angular.module("mallMobileApp.controllers").controller("AgrlExpandedDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={agrlData:""},$scope.init=function(){var Id={id:$state.params.id},detailsData=actionManagerService.excuteResource("lxny.cooperative.agrlExpanded.agrlExpandedDetails",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.agrlData=data.DATA[0])})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("CoopMainPageController",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){var type="";Authen.getUserInfo()&&(type=Authen.getUserInfo().MEMBER_TYPE);var url="";url=1==type?"cooperative.consumerHelp":2==type?"cooperative.companyHelpGuide":3==type?"cooperative.producerHelp":"member.login",$scope.pageData={pageTitle:"理性农业食品安全GAP信用体系",linkData:[{address:"member.invitation",title:"邀请社员",icon:"img/cooperative_3.png",params:{ads:"sdfasdf"}},{address:"account.volunteerAccount",title:"志愿者服务费账户",icon:"img/cooperative_4.png"},{address:url,title:"产业扶贫社会精准帮扶",icon:"img/cooperative_5.png"},{address:"cooperative.serviceVolunteer",title:"城乡服务志愿者",icon:"img/cooperative_6.png"}],linkDatas:[{role:!0,address:"account.cashaccount",title:"现金账户",icon:"img/cooperative_7.png"},{role:!0,address:"account.creditaccount",title:"信用保证金账户",icon:"img/cooperative_8.png"},{role:!0,address:"account.consumeraccount",title:"消费账户",icon:"img/cooperative_9.png"},{role:3==type?!0:!1,address:"common.accessnavigention",title:"土壤改良周转信誉卡",icon:"img/cooperative_10.png",params:{banner_menu_code:"creditCardAccount",title:"土壤改良周转信誉卡",buttons:[{button_title:"进入",url:"account.creditcardaccount"}],content_id:"creditCardAccount"}},{role:!0,address:"account.identityStock",title:"社员股金账户",icon:"img/cooperative_11.png"},{role:!0,address:"account.foodsafetyaccount",title:"食品安全账户",icon:"img/cooperative_12.png"},{role:!0,address:"account.bounsaccount",title:"经营分红账户",icon:"img/cooperative_13.png"},{role:!0,address:"common.accessnavigention",title:"抗风险自救金账户",icon:"img/cooperative_14.png",params:{banner_menu_code:"antiriskselfaccount",title:"抗风险自救金账户",buttons:[{button_title:"进入",url:"account.antiriskselfaccount"}],content_id:"antiriskselfaccount"}}]},$scope.Jump=function(url,params){$state.go(url,{params:params})},$scope.agroProj=function(){var params={banner_menu_code:"agroProjList",title:"理性扶持投资农业",buttons:[{button_title:"我要投资",url:"cooperative.agroProjList"}],content_id:"agroProjList"};$state.go("cooperative.agroProjList",{params:JSON.stringify(params)})},$scope.toStartBusiness=function(){var params={banner_menu_code:"startBusiness",title:"大众创业",buttons:[{button_title:"进入",url:"cooperative.startBusiness"}],content_id:"startBusiness"};$state.go("cooperative.startBusiness",{params:JSON.stringify(params)})}}]),angular.module("mallMobileApp.controllers").controller("companyHelpBodiesCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={tabName:"",tabID:"",u_name:"",phone:"",name:"",memberaddress:"",type:"",repaystatus:"",tableName:"",balance:0,tableId:"",memberid:Authen.getUserId(),tableEnum:[{value:"united_press",name:"联合社"},{value:"home_farm",name:"农厂自然村"},{value:"mall_cooperative",name:"合作社"}],helpTypeEnum:[{value:"1",name:"帮赠"},{value:"2",name:"帮借"}],params:{wherSQL:"AND info.tablename IN ('home_farm','united_press','mall_cooperative') "}},$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.init=function(){var rData=actionManagerService.excuteResource("companyHelpBodiesSql",$scope.pageData.params,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.id=data.DATA[0].ID,$scope.pageData.u_name=data.DATA[0].U_NAME,$scope.pageData.tabID=data.DATA[0].TABLE_ID,$scope.pageData.tabName=data.DATA[0].TABLENAME,$scope.pageData.phone=data.DATA[0].PHONE,$scope.pageData.memberaddress=data.DATA[0].MEMBERADDRESS,$scope.province(),$scope.balance(),$scope.mixMoney())})},$scope.init(),$scope.againMate=function(){$scope.init()},$scope.query=function(){var wherSQL="";if($scope.pageData.recvProvince){var pId=$scope.pageData.recvProvince.PROID;wherSQL=" AND info.province_id = '"+pId+"'"}if($scope.pageData.recvCity){var cId=$scope.pageData.recvCity.CITYID;wherSQL+=" AND info.city_id='"+cId+"' "}if($scope.pageData.recvArea){var zoneid=$scope.pageData.recvArea.ZONEID;wherSQL+=" AND info.zone_id='"+zoneid+"' "}if($scope.pageData.tableName){var table=$scope.pageData.tableName;wherSQL+=" AND info.tablename='"+table+"' "}if($scope.pageData.name){var name=$scope.pageData.name;wherSQL+=" AND info.u_name LIKE '%"+name+"%' "}$scope.pageData.params={wherSQL:wherSQL},$scope.init()},$scope.province=function(){var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)})},$scope.$watch("pageData.recvProvince",function(){if($scope.pageData.recvProvince){var pId={pid:$scope.pageData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pageData.recvCity",function(){if($scope.pageData.recvCity){var cId={cid:$scope.pageData.recvCity.CITYID},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),$scope.balance=function(){var params={memberid:$scope.pageData.memberid,code:"CASH_ACCOUNT"},proData=actionManagerService.excuteResource("QueryBalance",params,"none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE)})},$scope.mixMoney=function(){var vid={vid:"group_help_min_amount"},qData=actionManagerService.excuteResource("variableSql",vid,"none","none");ajaxManager.ajaxToJson(qData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.vvalue=data.DATA[0].VVALUE)})},$scope.confirmHelp=function(){if(null==$scope.pageData.helpType||""==$scope.pageData.helpType||void 0==$scope.pageData.helpType)return void toolsService.showMessage("请选择帮扶类型！",1);if(null==$scope.pageData.money||""==$scope.pageData.money||void 0==$scope.pageData.money)return void toolsService.showMessage("请输入帮扶金额！",1);if(parseInt(100*$scope.pageData.money)>parseInt($scope.pageData.balance))return void toolsService.showMessage("余额不足！",1);if(parseInt($scope.pageData.money)<parseInt($scope.pageData.vvalue))return void toolsService.showMessage("帮扶金额不能低于最低帮扶金额！",1);var helpType=$scope.pageData.helpType,tomemberid=$scope.pageData.id,tabName=$scope.pageData.tabName,tabID=$scope.pageData.tabID,memberid=Authen.getUserId(),money=$scope.pageData.money,roleid=JSON.parse($state.params.params).id;console.error(roleid);var aData=actionManagerService.CompanyConfirmHelp(helpType,tomemberid,memberid,money,roleid,tabName,tabID);ajaxManager.ajaxToJson(aData,function(data){console.error(data),0!=data.code?toolsService.tips(data.msg,""):(toolsService.tips(data.msg,""),$state.go("cooperative.companyHelp",{roleid:roleid}))})}}]),angular.module("mallMobileApp.controllers").controller("companyHelpCtrl",["$scope","$state","Authen",function($scope,$state,Authen){$scope.pageData={listEvents:"",memberid:Authen.getUserId(),roleid:$state.params.roleid},$scope.pageData.list_events={consumerHelpDetails:function(id){$state.go("cooperative.companyHelpDetails",{id:id})}},$scope.helpFarm=function(){var params={id:$scope.pageData.roleid};$state.go("cooperative.companyHelpBodies",{params:JSON.stringify(params)})},$scope.studenSupport=function(){$state.go("more.studenSupport")}}]),angular.module("mallMobileApp.controllers").controller("companyHelpDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={membername:"",identitycardnumber:"",phone:"",memberaddress:"",type:"",repaystatus:"",createtime:"",helpAmount:"",memberid:Authen.getUserId()},$scope.init=function(){var Id={id:$state.params.id},rData=actionManagerService.excuteResource("companyHelpDetails",Id,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.membername=data.DATA[0].MEMBERNAME,$scope.pageData.orgid=data.DATA[0].ORGID,$scope.pageData.infoid=data.DATA[0].INFOID,$scope.pageData.identitycardnumber=data.DATA[0].IDENTITYCARDNUMBER,$scope.pageData.phone=data.DATA[0].PHONE,$scope.pageData.memberaddress=data.DATA[0].MEMBERADDRESS,$scope.pageData.type=data.DATA[0].TYPE,$scope.pageData.repaystatus=data.DATA[0].REPAYSTATUS,$scope.pageData.createtime=data.DATA[0].CREATETIME,$scope.pageData.helpAmount=data.DATA[0].HELP_AMOUNT,$scope.pledge()})},$scope.init(),$scope.pledge=function(){var menucode={memberid:$scope.pageData.orgid,sa_code:"AND msac.sa_code IN ('GROUP_CASH_ACCOUNT','GROUP_CREDIT_MARGIN_ACCOUNT','GROUP_IDENTITY_STOCK_ACCOUNT','GROUP_LOAN_ACCOUNT','GROUP_FOOD_SAFETY_TRACING_ACCOUNT')"},rData=actionManagerService.excuteResource("mall_system_account_class",menucode,"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pageData.saCode=data.DATA)})},$scope.recode=function(sa_code){var params={accountCode:sa_code,memberid:$scope.pageData.infoid};$state.go("common.recode",{params:JSON.stringify(params)})}}]),angular.module("mallMobileApp.controllers").controller("companyHelpGuideCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={id:"",roleDesc:"",loginaccount:"",role:""},$scope.init=function(){var roletype={roletype:2},rData=actionManagerService.excuteResource("roleChoice",roletype,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.role=data.DATA)})},$scope.init(),$scope.Jump=function(id){$state.go("cooperative.companyHelp",{roleid:id})}}]),angular.module("mallMobileApp.controllers").controller("consumerHelpCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={id:"",roleDesc:"",loginaccount:"",role:""},$scope.init=function(){var roletype={roletype:1},rData=actionManagerService.excuteResource("roleChoice",roletype,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.role=data.DATA)})},$scope.init(),$scope.Jump=function(id){console.error(id),$state.go("cooperative.consumerHelpFarmer",{roleid:id})}}]),angular.module("mallMobileApp.controllers").controller("consumerHelpDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={membername:"",identitycardnumber:"",phone:"",memberaddress:"",type:"",repaystatus:"",createtime:"",helpAmount:"",memberid:Authen.getUserId()},$scope.init=function(){var Id={id:$state.params.id},rData=actionManagerService.excuteResource("consumerHelpDetails",Id,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.membername=data.DATA[0].MEMBERNAME,$scope.pageData.identitycardnumber=data.DATA[0].IDENTITYCARDNUMBER,$scope.pageData.phone=data.DATA[0].PHONE,$scope.pageData.memberaddress=data.DATA[0].MEMBERADDRESS,$scope.pageData.type=data.DATA[0].TYPE,$scope.pageData.repaystatus=data.DATA[0].REPAYSTATUS,$scope.pageData.createtime=data.DATA[0].CREATETIME,$scope.pageData.helpAmount=data.DATA[0].HELP_AMOUNT,$scope.pledge()})},$scope.init(),$scope.pledge=function(){var menucode={menucode:"commitmentBook"},rData=actionManagerService.excuteResource("collegeStudentBook",menucode,"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pageData.title=data.DATA[0].TITLE,$scope.pageData.detailed=data.DATA[0].DETAILED)})}}]),angular.module("mallMobileApp.controllers").controller("consumerHelpFarmerCtrl",["$scope","$state","Authen",function($scope,$state,Authen){$scope.pageData={listEvents:"",memberid:Authen.getUserId(),roleid:$state.params.roleid},$scope.pageData.list_events={consumerHelpDetails:function(id){$state.go("cooperative.consumerHelpDetails",{id:id})}},$scope.consumerLaunchHelp=function(){var params={id:$scope.pageData.roleid};console.error(params),$state.go("cooperative.consumerLaunchHelp",{params:JSON.stringify(params)})}}]),angular.module("mallMobileApp.controllers").controller("consumerLaunchHelpCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={membername:"",identitycardnumber:"",phone:"",memberaddress:"",type:"",repaystatus:"",createtime:"",helpAmount:"",memberid:Authen.getUserId(),introduction:"",helpTypeEnum:[{value:"1",name:"帮赠"},{value:"2",name:"帮借"}]},$scope.init=function(){var rData=actionManagerService.excuteResource("consumerLaunchHelp","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.id=data.DATA[0].ID,$scope.pageData.membername=data.DATA[0].MEMBERNAME,$scope.pageData.identitycardnumber=data.DATA[0].IDENTITYCARDNUMBER,$scope.pageData.phone=data.DATA[0].PHONE,$scope.pageData.memberaddress=data.DATA[0].MEMBERADDRESS,$scope.pageData.introduction=data.DATA[0].INTRODUCTION,$scope.queryAmount())})},$scope.init(),$scope.queryAmount=function(){var vid={vid:"help_amount"},qData=actionManagerService.excuteResource("variableSql",vid,"none","none");ajaxManager.ajaxToJson(qData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.vvalue=data.DATA[0].VVALUE)})},$scope.againMate=function(){$scope.init()},$scope.confirmHelp=function(){if(null==$scope.pageData.helpType||""==$scope.pageData.helpType||void 0==$scope.pageData.helpType)return void toolsService.showMessage("请选择帮扶类型！",1);var helpType=$scope.pageData.helpType,tomemberid=$scope.pageData.id,memberid=Authen.getUserId(),money=$scope.pageData.vvalue,roleid=JSON.parse($state.params.params).id;console.error(roleid);var aData=actionManagerService.consumerConfirmHelp(helpType,tomemberid,memberid,money,roleid);ajaxManager.ajaxToJson(aData,function(data){console.error(data.code),0!=data.code?toolsService.tips(data.msg,""):(toolsService.tips(data.msg,""),$state.go("cooperative.consumerHelpFarmer",{roleid:roleid},{location:"replace"}))})}}]),angular.module("mallMobileApp").config(["ACCESS_LEVELS","$stateProvider",function(ACCESS_LEVELS,$stateProvider){$stateProvider.state("cooperative.helpGuide",{url:"/helpGuide",cache:!0,access_level:ACCESS_LEVELS.user,views:{cooperative_view:{templateUrl:"app_plugins/cooperative/precision_help/views/producer_help_page.html",controller:"HelpGuideCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("HelpGuideCtrl",["$state","Authen",function($state,Authen){var hrlpUrl="",type="";Authen.getUserInfo()&&(type=Authen.getUserInfo().MEMBER_TYPE),1==type?hrlpUrl="cooperative.consumerHelp":2==type?hrlpUrl="cooperative.companyHelpGuide":3==type&&(hrlpUrl="cooperative.producerHelp"),$state.go(hrlpUrl)}]),angular.module("mallMobileApp.controllers").controller("producerHelpCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={membername:"",loginaccount:"",phone:"",memberaddress:"",type:"",createtime:"",helpAmount:"",repaymentStatus:"",repayStatus:"",viewdata:!0,memberid:Authen.getUserId(),params:{categoryid:""}};var params=$state.params,orderParams={};if(params&&params.params){orderParams=JSON.parse(params.params);var payId=orderParams.pay_id,helpId=JSON.parse(params.params).business.helpId,rData=actionManagerService.producerHelpOrder(payId,helpId);ajaxManager.ajaxToJson(rData,function(data){0==data.ERROR&&$state.reload()})}$scope.init=function(){var memberid={memberid:Authen.getUserId()},rData=actionManagerService.excuteResource("producerHelp",memberid,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)?$scope.pageData.viewdata=!0:($scope.pageData.id=data.DATA[0].ID,$scope.pageData.loginaccount=data.DATA[0].LOGINACCOUNT,$scope.pageData.money=data.DATA[0].MONEY,$scope.pageData.membername=data.DATA[0].MEMBERNAME,$scope.pageData.phone=data.DATA[0].PHONE,$scope.pageData.memberaddress=data.DATA[0].MEMBERADDRESS,$scope.pageData.type=data.DATA[0].TYPE,$scope.pageData.createtime=data.DATA[0].CREATETIME,$scope.pageData.helpAmount=data.DATA[0].HELP_AMOUNT,$scope.pageData.repaymentStatus=data.DATA[0].REPAYMENT_STATUS,$scope.pageData.repayStatus=data.DATA[0].REPAYSTATUS,$scope.pageData.viewdata=!1,$scope.pledge())})},$scope.pledge=function(){var menucode={menucode:"commitmentBook"},rData=actionManagerService.excuteResource("collegeStudentBook",menucode,"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pageData.title=data.DATA[0].TITLE,$scope.pageData.detailed=data.DATA[0].DETAILED)})},$scope.init(),$scope.repayment=function(){var params={title:"农产品还款",out_account_code:"CASH_ACCOUNT",in_account_code:"CONSUMER_ACCOUNT",out_remakes:"农产品还款",in_remakes:"农产品还款",business:{helpId:$scope.pageData.id},success_url:"cooperative.producerHelpOrder",lost_url:"cooperative.producerHelpOrder",paymoney:$scope.pageData.money,inMemberid:$scope.pageData.loginaccount};$state.go("common.virementothermanager",{params:JSON.stringify(params)},{location:"replace"})},$scope.thankYou=function(){var params={title:"果蔬红包",out_account_code:"CASH_ACCOUNT",in_account_code:"CASH_ACCOUNT",out_remakes:"感恩答谢",business:{helpId:$scope.pageData.id},success_url:"cooperative.producerHelpOrder",lost_url:"cooperative.producerHelpOrder",inMemberid:$scope.pageData.loginaccount};$state.go("common.redpacket",{params:JSON.stringify(params)})}}]),angular.module("mallMobileApp.controllers").controller("serviceVolunteerCtrl",["$scope","$rootScope","$state","Authen",function($scope,$rootScope,$state,Authen){$scope.pageData={listEvents:"",invitationcode:"",params:{memberid:Authen.getUserId()}},$scope.pageData.list_events={serviceVolunteerDetails:function(level,level_name,count){var params={level:level,level_name:level_name,
count:count};$state.go("cooperative.serviceVolunteerDetails",{params:JSON.stringify(params)})}}}]),angular.module("mallMobileApp.controllers").controller("serviceVolunteerDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen){$scope.pageData={level:JSON.parse($state.params.params).level,levelName:JSON.parse($state.params.params).level_name,count:JSON.parse($state.params.params).count,params:{memberid:Authen.getUserId(),level:JSON.parse($state.params.params).level}}}]),angular.module("mallMobileApp.controllers").controller("LoanStartBusinessCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen","toolsService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen,toolsService){$scope.pageData={title:"借款创业",recvProvince:JSON.parse($state.params.params).business.province,recvCity:JSON.parse($state.params.params).business.city,recvArea:JSON.parse($state.params.params).business.zone,businessid:JSON.parse($state.params.params).business.businessid,memberid:Authen.getUserId(),businessParam:JSON.parse($state.params.params).business,uuid:JSON.parse($state.params.params).business.uuid,pay_ids:toolsService.uuid(),degree_of_education_info:"",pay_money:JSON.parse($state.params.params).pay_money,multiple:"",credit_money:"",degree_of_education:"",loan_business_term_info:"",loan_business_term:"",agree_type:!1,idnumber:"",name:"",address:"",age:""},$scope.init=function(){$scope.getVarInfoInfo()},$scope.verificationisnull=function(){var flag=!0;return toolsService.isEmpty($scope.pageData.name)?(toolsService.tips("对不起，您还未填写姓名!",""),flag=!1):toolsService.isEmpty($scope.pageData.idnumber)?(toolsService.tips("对不起，您的身份证输入有误,请仔细检查!",""),flag=!1):toolsService.isEmpty($scope.pageData.age)?(toolsService.tips("对不起，您的年龄输入有误,请仔细检查!",""),flag=!1):toolsService.isEmpty($scope.pageData.degree_of_education)?(toolsService.tips("对不起，您还未选择文化程度!",""),flag=!1):toolsService.isEmpty($scope.pageData.address)?(toolsService.tips("对不起，您还未填写家庭地址!",""),flag=!1):toolsService.isEmpty($scope.pageData.loan_business_term)?(toolsService.tips("对不起，您还未选择还款约定!",""),flag=!1):$scope.pageData.agree_type?flag:(toolsService.tips("对不起，您还未勾选我同意大众创业借款协议",""),flag=!1)},$scope.getVarInfoInfo=function(){var rData=actionManagerService.excuteResource("get_avar_info",{vid:"degree_of_education"},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(data&&data.DATA&&!toolsService.isEmail(data.DATA[0].VVALUE)){var arr=data.DATA[0].VVALUE.split(",");$scope.pageData.degree_of_education_info=arr;var pData=actionManagerService.excuteResource("get_avar_info",{vid:"credit_margin_ratio"},"none","none");ajaxManager.ajaxToJson(pData,function(data){if(data&&data.DATA){$scope.pageData.multiple=data.DATA[0].VVALUE,"0"==$scope.pageData.multiple&&toolsService.isEmpty($scope.pageData.multiple)||($scope.pageData.credit_money=$scope.pageData.pay_money/$scope.pageData.multiple);var pData=actionManagerService.excuteResource("get_avar_info",{vid:"loan_business_term"},"none","none");ajaxManager.ajaxToJson(pData,function(data){data&&data.DATA&&($scope.pageData.loan_business_term_info=data.DATA[0].VVALUE.split(","))})}})}})},$scope.init(),$scope.subClick=function(){var uuid=toolsService.uuid().toUpperCase();if(uuid=uuid.replace(/-/g,""),$scope.verificationisnull()){var params={title:"支付",out_account_code:"CASH_ACCOUNT",in_account_code:"",out_remakes:"缴纳授信保证金",in_remakes:"",pay_money:$scope.pageData.credit_money/100,business:{uuid:$scope.pageData.uuid,files:JSON.parse($state.params.params).business.files,pay_id:uuid,province:$scope.pageData.recvProvince,city:$scope.pageData.recvCity,zone:$scope.pageData.recvArea,businessid:JSON.parse($state.params.params).business.businessid,memberid:JSON.parse($state.params.params).business.memberid,pay_money:$scope.pageData.credit_money,orgid:appConfig.appOrg,success_call_back:"com.am.app_plugins.cooperative.start_business.UpdateStartBusiness",lost_call_back:"",business_type:"2",orders:uuid,name:$scope.pageData.name,idnumber:$scope.pageData.idnumber,DataName:JSON.parse($state.params.params).business.DataName,address:$scope.pageData.address,age:$scope.pageData.age,degree_of_education:$scope.pageData.degree_of_education,loan_business_term:$scope.pageData.loan_business_term,credit_money:$scope.pageData.credit_money},pay_type:"1",pay_type_name:"支付",pay_id:uuid,success_url:"cooperative.startBusinessMy",lost_url:"cooperative.startBusiness"};$state.go("common.payment",{params:JSON.stringify(params)})}}}]),angular.module("mallMobileApp.controllers").controller("StartBusinessCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen","toolsService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen,toolsService){$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pageData={title:"科学帮扶大众创业",params:"",recvProvince:"",recvCity:"",recvArea:"",memberid:Authen.getUserId(),serviceData:""},$scope.init=function(){var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){if(data&&data.DATA){$scope.cascadePCZ.provinces=data.DATA;var pData=actionManagerService.excuteResource("member_info",{member_id:$scope.pageData.memberid},"","");ajaxManager.ajaxToJson(pData,function(data){data&&data.DATA&&($scope.pageData.recvProvince=data.DATA[0].PROVINCE,$scope.pageData.recvCity=data.DATA[0].CITY,$scope.pageData.recvArea=data.DATA[0].ZZONE,$scope.getServiceMallInfo($scope.pageData.recvProvince,$scope.pageData.recvCity,$scope.pageData.recvArea,"",""))})}})},$scope.getServiceMallInfo=function(province,city,zone,memberid,org){var pData=actionManagerService.getServiceMallInfo(province,city,zone,memberid,"","");ajaxManager.ajaxToJson(pData,function(data){$scope.pageData.serviceData=data})},$scope.$watch("pageData.recvProvince",function(){if($scope.pageData.recvProvince){var pId={pid:$scope.pageData.recvProvince},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pageData.recvCity",function(){if($scope.pageData.recvCity){var cId={cid:$scope.pageData.recvCity},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),$scope.init(),$scope.query=function(){return toolsService.isEmpty($scope.pageData.recvProvince)?void toolsService.tips("未选择购买省区域",""):toolsService.isEmpty($scope.pageData.recvCity)?void toolsService.tips("未选择购买市区域",""):toolsService.isEmpty($scope.pageData.recvArea)?void toolsService.tips("未选择购买县区域",""):void $scope.getServiceMallInfo($scope.pageData.recvProvince,$scope.pageData.recvCity,$scope.pageData.recvArea,"","")},$scope.myStart=function(){$state.go("cooperative.startBusinessMy",{})},$scope.toPage=function(id,typeId,pay_type,tableName){if(toolsService.isEmpty($scope.pageData.recvProvince))return void toolsService.tips("未选择购买省区域","");if(toolsService.isEmpty($scope.pageData.recvCity))return void toolsService.tips("未选择购买市区域","");if(toolsService.isEmpty($scope.pageData.recvArea))return void toolsService.tips("未选择购买县区域","");if("2"==pay_type){var params={id:id,province:$scope.pageData.recvProvince,city:$scope.pageData.recvCity,zone:$scope.pageData.recvArea,table_name:tableName};$state.go("cooperative.startBusinessDetail",{params:JSON.stringify(params)})}}}]),angular.module("mallMobileApp.controllers").controller("StartBusinessDetailCtrl",["$scope","$ionicPopup","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen","toolsService","FileAccess",function($scope,$ionicPopup,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen,toolsService,FileAccess){$scope.pageData={title:"科学帮扶大众创业",recvProvince:JSON.parse($state.params.params).province,recvCity:JSON.parse($state.params.params).city,recvArea:JSON.parse($state.params.params).zone,businessid:JSON.parse($state.params.params).id,tableName:JSON.parse($state.params.params).table_name,memberid:Authen.getUserId(),button_width:0,button_padding:0,DataName:"",balance:0,files:"",inputData:[],imagepath:"",pay_ids:toolsService.uuid(),uuid:toolsService.uuid(),bTableName:""},$scope.init=function(){$scope.getServiceMallInfo("","","","","",$scope.pageData.businessid)},$scope.getServiceMallInfo=function(province,city,zone,memberid,org,id){var pData=actionManagerService.getServiceMallInfo(province,city,zone,memberid,"",id);ajaxManager.ajaxToJson(pData,function(data){data&&($scope.pageData.serviceData=data[0]);var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberid,sa_code:"CASH_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE)})})},$scope.init(),$scope.redirect=function(type){if(toolsService.isEmpty($scope.pageData.DataName))return void toolsService.tips("请输入名称","");var uploadData=[];console.error($scope.pageData.inputData),$scope.pageData.bTableName=$scope.pageData.tableName.toUpperCase(),console.error($scope.pageData.bTableName);for(var i=0;i<$scope.pageData.inputData.length;i++){var item=$scope.pageData.inputData[i];"image"==item.type&&uploadData.push({type:"file",data:{fileName:item.fileName,mimeType:item.mimeType,type:item.type,file:item.file,savePath:"files//"+$scope.pageData.bTableName+"//"+$scope.pageData.uuid+"//bdp_enclosures"}})}0==uploadData.length?($scope.pageData.imagepath="",$scope.processSave(type)):(console.error("文件上传"),FileAccess.asUpload(uploadData,function(files){var imagepath=toolsService.fileJsonreturnstr(files,"image");$scope.pageData.imagepath=imagepath,$scope.processSave(type)},null,null,"n_space"))},$scope.processSave=function(type){var uuid=toolsService.uuid().toUpperCase();if(uuid=uuid.replace(/-/g,""),"1"==type){if(new Number($scope.pageData.serviceData[0].PRICE)>new Number($scope.pageData.balance))return void toolsService.tips("现金账户余额不足,请充值后购买","");var params={title:"支付创建",out_account_code:"CASH_ACCOUNT",in_account_code:"",out_remakes:"创办联合社",in_remakes:"",pay_money:new Number($scope.pageData.serviceData[0].PRICE)/100,business:{uuid:$scope.pageData.uuid,files:$scope.pageData.imagepath,pay_id:$scope.pageData.pay_ids,province:$scope.pageData.recvProvince,city:$scope.pageData.recvCity,zone:$scope.pageData.recvArea,businessid:$scope.pageData.businessid,memberid:$scope.pageData.memberid,pay_money:$scope.pageData.serviceData[0].PRICE,orgid:appConfig.appOrg,DataName:$scope.pageData.DataName,business_type:"1",orders:uuid,success_call_back:"com.am.app_plugins.cooperative.start_business.UpdateStartBusiness",lost_call_back:""},pay_type:"1",pay_type_name:"支付创建",pay_id:$scope.pageData.pay_ids,success_url:"cooperative.startBusinessMy",lost_url:"cooperative.startBusiness"};console.error(params),$state.go("common.payment",{params:JSON.stringify(params)})}else if("2"==type){var params={out_account_code:"CASH_ACCOUNT",in_account_code:"",out_remakes:"借款创业",in_remakes:"",pay_money:$scope.pageData.serviceData[0].PRICE,business:{uuid:$scope.pageData.uuid,files:$scope.pageData.imagepath,pay_id:$scope.pageData.pay_ids,province:$scope.pageData.recvProvince,city:$scope.pageData.recvCity,zone:$scope.pageData.recvArea,businessid:$scope.pageData.businessid,memberid:$scope.pageData.memberid,pay_money:$scope.pageData.serviceData[0].PRICE,DataName:$scope.pageData.DataName,orgid:appConfig.appOrg,success_call_back:"com.am.app_plugins.cooperative.start_business.UpdateStartBusiness",lost_call_back:""},pay_id:$scope.pageData.pay_ids,success_url:"cooperative.startBusinessMy",lost_url:"cooperative.startBusiness"};$state.go("cooperative.loanStartBusiness",{params:JSON.stringify(params)})}},$scope["delete"]=function(value){$ionicPopup.show({title:"确认删除",template:"确认删除选中的图片?",scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>确认</b>",type:"btn1",onTap:function(){for(var i=(JSON.stringify(value),0);i<$scope.pageData.inputData.length;i++)$scope.pageData.imagepath=$scope.pageData.imagepath.replace(value+",",""),$scope.pageData.imagepath=$scope.pageData.imagepath.replace(value,""),$scope.pageData.inputData[i]==value&&$scope.pageData.inputData.splice(i,1)}}]})}}]),angular.module("mallMobileApp.controllers").controller("StartBusinessMyCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen","toolsService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen,toolsService){$scope.pageData={title:"科学帮扶大众创业",params:"",recvProvince:"",recvCity:"",recvArea:"",memberid:Authen.getUserId(),serviceData:"",myServiceInfo:""},$scope.init=function(){$scope.getServiceMallInfo("","","",$scope.pageData.memberid,"")},$scope.getServiceMallInfo=function(province,city,zone,memberid,org){var pData=actionManagerService.getServiceMallInfo(province,city,zone,memberid,"","");ajaxManager.ajaxToJson(pData,function(data){$scope.pageData.serviceData=data,console.error($scope.pageData.serviceData);for(var arr=new Array,i=0;i<$scope.pageData.serviceData.length;i++)if(!toolsService.isEmpty($scope.pageData.serviceData[i].my_pay)&&$scope.pageData.serviceData[i].my_pay.length>0)for(var j=0;j<$scope.pageData.serviceData[i].my_pay.length;j++)arr.push($scope.pageData.serviceData[i].my_pay[j]);$scope.pageData.myServiceInfo=arr,console.error($scope.pageData.myServiceInfo)})},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("mall.test01",{url:"/test01",cache:!1,views:{"mall-home":{templateUrl:"app_plugins/demo/test_01/Test01View.html",controller:"test01Controllers"}}})}]),angular.module("mallMobileApp.controllers").controller("test01Controllers",["$scope","$ionicModal","$ionicBackdrop","$anchorScroll","$location","$ionicScrollDelegate","$http",function($scope,$ionicModal,$ionicBackdrop,$anchorScroll,$location,$ionicScrollDelegate,$http){console.debug("test01Controllers start run ..."),$ionicModal.fromTemplateUrl("my-modal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal}),$scope.chat={name:"姓名",face:"img/test/select_01.png",lastText:"车市内容"},$scope.isShow=!1,$scope.ListData={name:"选择地区",data:{"地区1":"1","地区2":"2","地区3":"3"}},$scope.selectClick1=function(value){console.debug("test01Controllers selectClick().mValue1:="+value),console.dir(value)},$scope.selectClick2=function(value){console.debug("test01Controllers selectClick().mValue2:="+value)},$scope.selectClick3=function(value){console.debug("test01Controllers selectClick().mValue3:="+value)},$scope.buttonClick=function(){$scope.modal.show(),$ionicBackdrop.retain(),$scope.chat.face="img/test/select_02.png",console.debug("test01Controllers buttonClick()="+$scope.isShow)},$scope.ItemClick=function(lable,value){console.debug("test01Controllers ItemClick()="+lable),$scope.chat.face="img/test/select_01.png",$scope.modal.hide(),$ionicBackdrop.release()},$scope.gotoAnchor=function(x){$location.hash("anchor"+x),$anchorScroll(),$location.replace(),$ionicScrollDelegate.$getByHandle("mainScroll").freezeScroll(!1)};var params={title:"xxx","content ":"xxxxxxxxx",accept_time:[],custom_content:{key1:"value1",key2:"value2"},device_token:"",message_type:2,message:"",expire_time:0,send_time:"",multi_pkg:0,environment:1};url="http://openapi.xg.qq.com/v2/push/single_device?params",$scope.push=function(){return $http({method:"POST",url:url,data:params,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(data){console.debug(data)}).error(function(){})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("mall.weichart",{url:"/weichart",cache:!1,views:{"mall-home":{templateUrl:"app_plugins/demo/weichart/views/weichartdemo.html",controller:"WeiChartDemoCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("WeiChartDemoCtrl",["$scope","$ionicModal","$ionicBackdrop","$location","$ionicScrollDelegate","$http","appConfig","toolsService","$state","Authen",function($scope,$ionicModal,$ionicBackdrop,$location,$ionicScrollDelegate,$http,appConfig,toolsService,$state,Authen){$scope.onWeiChartPay=function(params){var cardInfo={ordernumber:(new Date).getTime(),orderbyname:"微信公众号支付测试产品"},params="ordernumber="+cardInfo.ordernumber+"&openid="+Authen.getUserMPOpenId()+"&body="+encodeURIComponent(cardInfo.orderbyname)+"&total_fee=1&attchStr=payId";console.error("url="+params);var url=appConfig.baseUrl+"/AmRes/com.am.frame.weichart.webApi.MpUnifiedOrderApiAction.do?"+params;$http.get(url).success(function(data){function onBridgeReady(){alert(data),WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:data.appId,timeStamp:data.timeStamp,nonceStr:data.nonceStr,"package":data["package"],signType:"MD5",paySign:data.paySign},function(res){console.info("微信公众账号支付返回res参数:"+JSON.stringify(res)),"get_brand_wcpay_request:ok"==res.err_msg&&alert("支付成功")})}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",onBridgeReady,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",onBridgeReady)):(console.error(onBridgeReady),onBridgeReady())})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.discountGroup",{url:"/discountGroup",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/discount_group/views/discount_group_page.html",controller:"DiscountGroupCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("DiscountGroupCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={pxData:{name:"智能排序",data:{"综合排序":"0","评价最高":"1","人气最高":"2","价格最低":"3","价格最高":"4"}},ztData:"",zhData:"",znpx:"",zt:"",zh:"",params:{wherSQL:"AND mc.mall_class='7' ORDER BY COALESCE(mc.recommendvalue,-1) DESC"}},$scope.toSearch=function(){$state.go("common.search",{})},$scope.init=function(){$scope.initZt(),$scope.initZh()},$scope.initZt=function(){var params={lableClass:8},rData=actionManagerService.excuteResource("triph.label.labelEnum",params,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){var tData=toolsService.formJarryToObject(data.DATA);$scope.pageData.ztData={name:"主题",data:tData}}})},$scope.initZh=function(){var params={lableClass:9},rData=actionManagerService.excuteResource("triph.label.labelEnum",params,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){var zhData=toolsService.formJarryToObject(data.DATA);$scope.pageData.zhData={name:"组合",data:zhData}}})},$scope.selectClick1=function(value){$scope.pageData.znpx=value,$scope.quer()},$scope.selectClick2=function(value){$scope.pageData.zt=value,$scope.quer()},$scope.selectClick3=function(value){$scope.pageData.zh=value,$scope.quer()},$scope.quer=function(){var wherSQL="AND mc.mall_class='7'";$scope.pageData.zt&&0!=$scope.pageData.zt&&(wherSQL+=" AND mc.them = '"+$scope.pageData.zt+"'  ORDER BY COALESCE(mc.recommendvalue,-1) DESC"),$scope.pageData.zh&&0!=$scope.pageData.zh&&(wherSQL+=" AND mc.group_label='"+$scope.pageData.zh+"' ORDER BY COALESCE(mc.recommendvalue,-1) DESC "),$scope.pageData.znpx&&(0==$scope.pageData.znpx&&(wherSQL+=" ORDER BY  COALESCE(mc.recommendvalue,-1) DESC "),1==$scope.pageData.znpx&&(wherSQL+=" ORDER BY pjpxdf DESC "),2==$scope.pageData.znpx&&(wherSQL+=" ORDER BY salenumber DESC "),3==$scope.pageData.znpx&&(wherSQL+=" ORDER BY price "),4==$scope.pageData.znpx&&(wherSQL+=" ORDER BY price DESC ")),$scope.pageData.params={wherSQL:wherSQL}},$scope.pageData.list_events={discountGroup:function(id){$state.go("commodity.discountGroupDetails",{params:JSON.stringify({id:id})})}},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.discountGroupDetails",{url:"/discountGroupDetails/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/discount_group/views/discount_group_details.html",controller:"DiscountGroupDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("DiscountGroupDetailsCtrl",["OtherHandleService","$location","$ionicScrollDelegate","$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","AmCommonService","$ionicModal","$ionicPopup","commdityService","$timeout","$ionicHistory",function(OtherHandleService,$location,$ionicScrollDelegate,$scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,AmCommonService,$ionicModal,$ionicPopup,commdityService,$timeout,$ionicHistory){$scope.pageData={baseUrl:appConfig.baseUrl,title:"",mainimage:"img/bg.png",dityid:0,comImageNum:0,memberid:Authen.getUserId(),params:"",priceInfo:"",yuanjia:"",fileJSo:"",objArr:[],choiceMoney:0,mixData:"",packageClass:"package",reserveNotice:"reserve_notice",dateData:""};var rValue=[];$scope.taocan=function(){$scope.pageData.packageClass="package",$scope.pageData.reserveNotice="reserve_notice",$location.hash("taocanmiao"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.yuding=function(){$scope.pageData.packageClass="reserve_notice",$scope.pageData.reserveNotice="package",$location.hash("yudingmiao"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.goBack=function(){toolsService.goBackPage()},$scope.init=function(){var id=JSON.parse($state.params.params).id,rData=actionManagerService.discountGroupDetails(id);ajaxManager.ajaxToJson(rData,function(data){if($scope.pageData.mallInfo=data[0],$scope.pageData.name=data[0].NAME,$scope.pageData.mainimage=data[0].MAINIMAGES,0!=data[0].MALL_STOREIMAGELIST.length&&(rValue=toolsService.formImagesToImgpicker(data[0].MALL_STOREIMAGELIST,function(count){$scope.pageData.comImageNum=count})),!toolsService.isEmpty(data[0].MALL_COMMODITYSPECIFICATIONS)){$scope.pageData.priceInfo=data[0].MALL_COMMODITYSPECIFICATIONS,$scope.pageData.mixData=$scope.pageData.priceInfo[0].DATES;for(var i=0;$scope.pageData.priceInfo.length>i;i++){var obj={date:$scope.pageData.priceInfo[i].DATES,price:$scope.pageData.priceInfo[i].JIAGE,id:$scope.pageData.priceInfo[i].ID};$scope.pageData.objArr.push(obj)}$scope.pageData.dateData={priceData:$scope.pageData.objArr,selectType:"1",operation:"0",week:[0,1,2,3,4,5,6],startyear:$scope.pageData.mixData}}$scope.pageData.yuanjia=data[0].YUANJIA[0].YUANJIA})},$scope.tuji=function(){if(0!=$scope.pageData.comImageNum){var title=$scope.pageData.name,fileJSo=rValue,params={title:title,data:fileJSo};$state.go("common.imagePicker",{params:JSON.stringify(params)})}},$scope.share=function(){var id=JSON.parse($state.params.params).id,title=$scope.pageData.name,img=$scope.pageData.baseUrl+$scope.pageData.mallInfo.MAINIMAGES[0].path,params={id:id,title:title,img:img,url:""};OtherHandleService.share(params)},$scope.comment=function(item){var id=item.ID,showImgs=item.SHOW_IMGS,badComments=item.BAD_COMMENTS,goodComments=item.GOOD_COMMENTS,qjzs=item.QJZS,pjpxdf=item.PJPXDF,title="商品评价",type=2,params={id:id,title:title,type:type,count:pjpxdf,allTotle:qjzs,greetTotle:goodComments,badTotle:badComments,photoTotle:showImgs};$state.go("common.publiccomment",{params:JSON.stringify(params)})},$scope.addCollection=function(){var id=JSON.parse($state.params.params).id,memberId=$scope.pageData.memberid;AmCommonService.addCollection({id:id,memberid:memberId,type:"store"})},$scope.init(),$scope.result=function(value){$scope.pageData.startData=value.start.date,$scope.pageData.choiceMoney=value.start.price,$scope.pageData.choiceId=value.start.id;for(var j=0;j<$scope.pageData.priceInfo.length;j++)$scope.pageData.priceInfo[j].ID==$scope.pageData.choiceId&&($scope.pageData.guigeInfo=$scope.pageData.priceInfo[j])},$scope.buyNow=function(){$scope.pageData.choiceId?(commdityService.saveShopInfoToPayment($scope.pageData.memberid,$scope.pageData.mallInfo.COMMODITY_INFO[0],$scope.pageData.guigeInfo,1,$scope.pageData.startData),$timeout(function(){var params={source:"commodityDetails"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})},300)):toolsService.showMessage("请选择规格",2)}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("common.emoji",{url:"/emoji",cache:!1,views:{common_view:{templateUrl:"app_plugins/emoji_demo/views/emoji_page.html",controller:"emojiCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("emojiCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$window",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$window){$scope.init=function(){$("#send_content").emoji({button:"#emoji_btn_1",showTab:!0,animation:"none",icons:[{name:"贴吧表情",path:"dist/img/tieba/",maxNum:50,file:".jpg"},{name:"QQ表情",path:"dist/img/qq/",maxNum:91,file:".gif"}]})},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("mall.find",{url:"/find",cache:!1,views:{"am-find":{templateUrl:"app_plugins/find/views/find_page.html",controller:"FindCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("FindCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","appConfig",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,appConfig){function initVoid(){var vPath=$scope.pageData.video;console.error(vPath),window.open(vPath,"_blank")}$scope.pageData={findData:"",topLineData:"",videoData:"",video:""},$scope.init=function(){$scope.getBannerInfo(),$scope.getTopLine(),$scope.getVideo()},$scope.getBannerInfo=function(){var bannerParam={condition:" and am_mobliemenuid='menu_find' and orgcode='"+appConfig.appOrg+"'"},rData=actionManagerService.excuteResource("banner_active_info",bannerParam,"","");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.findData=data.DATA,toolsService.createSwiper(".find_swiper",".swiper-pagination"))})},$scope.getTopLine=function(){var menucode={menucode:"triphTopLine",limit:3},rData=actionManagerService.excuteResource("triph.appPlugins.find.contentSql",menucode,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.topLineData=data.DATA)})},$scope.getVideo=function(){var menucode={menucode:"triphVideo",limit:1},rData=actionManagerService.excuteResource("triph.appPlugins.find.contentSql",menucode,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.videoData=data.DATA,$scope.pageData.video=data.DATA[0].VIDEO)})},$scope.toPage=function(url){toolsService.toStateOfServerUrl($state,url)},$scope.toDetails=function(id){$state.go("more.contentdetails",{id:id})},$scope.toVideo=function(id){initVoid(),$scope.browse(id)},$scope.message=function(){$state.go("common.message",{})},$scope.topLine=function(){$state.go("find.triphTopLine")},$scope.destination=function(){$state.go("find.destination")},$scope.browse=function(id){var aData=actionManagerService.updateBrowse(id);ajaxManager.ajaxToJson(aData,function(data){})},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("find.fandVideo",{url:"/fandVideo/:video",cache:!1,views:{find_view:{templateUrl:"app_plugins/find/views/find_video_page.html",controller:"FandVideoCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("FandVideoCtrl",["$scope","$rootScope","$state","toolsService",function($scope,$rootScope,$state,toolsService){$scope.init=function(){var video=$state.params.video;if(toolsService.isEmpty(video))toolsService.tips("视频文件不存在","");else{var vPath=JSON.parse(video);console.error(vPath);var player=new CloudVodPlayer;player.init(vPath,"find_player_video_page")}},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("find.destination",{url:"/destination",views:{find_view:{templateUrl:"app_plugins/find/destination/views/destination_page.html",controller:"DestinationCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("DestinationCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","appConfig","$ionicScrollDelegate",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,appConfig,$ionicScrollDelegate){$scope.pageData={list_events:"",destinationData:"",topLineData:"",urlArr:new Array,params:{},querName:""};var myDate=new Date,year=myDate.getFullYear(),month=myDate.getMonth(),offsetX=70*month;$scope.init=function(){$scope.getBannerInfo(),setTimeout(function(){$ionicScrollDelegate.$getByHandle("small").scrollBy(offsetX,0,!1),$scope.selectCards(month)},800)};var currentIndex=0;$scope.pageData.type=currentIndex,$scope.pageData.comdSelectCards=[{title:"1月",CSS:"button button-positive",show:!0},{title:"2月",CSS:"button button-outline button-stable",show:!1},{title:"3月",CSS:"button button-outline button-stable",show:!1},{title:"4月",CSS:"button button-outline button-stable",show:!1},{title:"5月",CSS:"button button-outline button-stable",show:!1},{title:"6月",CSS:"button button-outline button-stable",show:!1},{title:"7月",CSS:"button button-outline button-stable",show:!1},{title:"8月",CSS:"button button-outline button-stable",show:!1},{title:"9月",CSS:"button button-outline button-stable",show:!1},{title:"10月",CSS:"button button-outline button-stable",show:!1},{title:"11月",CSS:"button button-outline button-stable",show:!1},{title:"12月",CSS:"button button-outline button-stable",show:!1}],$scope.selectCards=function(index){$scope.pageData.comdSelectCards[index].CSS="button button-positive",$scope.pageData.comdSelectCards[index].style="",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="button button-outline button-stable",$scope.pageData.comdSelectCards[currentIndex].style="",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex,$scope.querList(index)},$scope.querList=function(index){var month="",monthIndex=1;month=parseInt(index,10)+monthIndex,month=parseInt(month)<10?"0"+month:month,$scope.pageData.params={menucode:"Destination",wherSQL:"AND ac.month='"+month+"' AND ac.year='"+year+"' "}},$scope.getBannerInfo=function(){var bannerParam={condition:" and am_mobliemenuid='menu_Destination' and orgcode='"+appConfig.appOrg+"'"},rData=actionManagerService.excuteResource("banner_active_info",bannerParam,"","");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.destinationData=data.DATA,toolsService.createSwiper(".destination_swiper",".swiper-pagination"))})},$scope.toPage=function(url){toolsService.toStateOfServerUrl($state,url)},$scope.pageData.list_events={toDetails:function(id){$state.go("more.contentdetails",{id:id})}},$scope.toSearch=function(){$state.go("common.search",{})},$scope.querName=function(){$scope.pageData.querName&&($scope.pageData.params={menucode:"Destination",wherSQL:"AND title like '%"+$scope.pageData.querName+"%' "})},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("find.triphTopLine",{url:"/triphTopLine",views:{find_view:{templateUrl:"app_plugins/find/topline/views/triph_topline_page.html",controller:"TriphTopLineCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("TriphTopLineCtrl",["$scope","$rootScope","$state","$ionicPopup","actionManagerService","ajaxManager","appConfig","Authen",function($scope,$rootScope,$state,$ionicPopup,actionManagerService,ajaxManager,appConfig,Authen){
function initVoid(video){window.open(video,"_blank")}$scope.pageData={listEvents:"",triphTopLine:{menucode:"triphTopLine"},triphVideo:{menucode:"triphVideo"}};var currentIndex=0;$scope.pageData.type=currentIndex,$scope.pageData.comdSelectCards=[{title:"文章",CSS:"button button-positive",show:!0},{title:"视频",CSS:"button button-outline button-positive",show:!1}],$scope.selectCards=function(index){$scope.pageData.comdSelectCards[index].CSS="button button-positive",$scope.pageData.comdSelectCards[index].style="",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="button button-outline button-positive",$scope.pageData.comdSelectCards[currentIndex].style="",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex},$scope.pageData.list_events={toDetails:function(id){$state.go("more.contentdetails",{id:id})},toVideo:function(value){initVoid(value.VIDEO),$scope.browse(value.ID),console.info(value.ID)}},$scope.toSearch=function(){$state.go("common.search",{})},$scope.browse=function(id){var aData=actionManagerService.updateBrowse(id);ajaxManager.ajaxToJson(aData,function(data){})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("?",{url:"/freezerApply",cache:!1,intcude:"foodSafety.freezerApply",intName:"冷柜申请",views:{food_safety_view:{templateUrl:"app_plugins/food_safety/views/freezer_apply_page.html",controller:"FreezerApplyCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("FreezerApplyCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){var AddIndex=-1;$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pageData={statusEnum:{1:"待审核",2:"审核通过",3:"审核拒绝"},status:""},$scope.init=function(){var memberid={memberid:Authen.getUserId()},rData=actionManagerService.excuteResource("lxny.foodSafety.freezerApply",memberid,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)&&($scope.pageData.province=data.DATA[0].PROVINCE,$scope.pageData.city=data.DATA[0].CITY,$scope.pageData.zone=data.DATA[0].ZONE,$scope.pageData.community=data.DATA[0].COMMUNITY,$scope.pageData.address=data.DATA[0].ADDRESS,$scope.pageData.contacts=data.DATA[0].CONTACTS,$scope.pageData.contactPhone=parseInt(data.DATA[0].CONTACT_PHONE),$scope.pageData.status=data.DATA[0].STATUS,$scope.pageData.remarks=data.DATA[0].REMARKS,AddIndex=1,AddIndex>=0))for(var i=0;i<$scope.cascadePCZ.provinces.length;i++)if($scope.cascadePCZ.provinces[i].PROID==$scope.pageData.province){$scope.pageData.recvProvince=$scope.cascadePCZ.provinces[i];break}})};var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)}),$scope.$watch("pageData.recvProvince",function(){if($scope.pageData.recvProvince){var pId={pid:$scope.pageData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){if(data.DATA&&($scope.cascadePCZ.cities=data.DATA),AddIndex>=0)for(var i=0;i<$scope.cascadePCZ.cities.length;i++)if($scope.cascadePCZ.cities[i].CITYID==$scope.pageData.city){$scope.pageData.recvCity=$scope.cascadePCZ.cities[i];break}})}}),$scope.$watch("pageData.recvCity",function(){if($scope.pageData.recvCity){var cId={cid:$scope.pageData.recvCity.CITYID},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){if(data.DATA&&($scope.cascadePCZ.zones=data.DATA),AddIndex>=0)for(var i=0;i<$scope.cascadePCZ.zones.length;i++)if($scope.cascadePCZ.zones[i].ZONEID==$scope.pageData.zone){$scope.pageData.recvArea=$scope.cascadePCZ.zones[i];break}})}}),$scope.init(),$scope.submitApply=function(){if(toolsService.isEmpty($scope.pageData.recvProvince))return void toolsService.showMessage("请选择省份！",1);if(toolsService.isEmpty($scope.pageData.recvCity))return void toolsService.showMessage("请选择市！",1);if(toolsService.isEmpty($scope.pageData.recvArea))return void toolsService.showMessage("请选择区/县！",1);if(toolsService.isEmpty($scope.pageData.address))return void toolsService.tips("地址不能为空!","");if(toolsService.isEmpty($scope.pageData.community))return void toolsService.tips("社区名称不能为空!","");if(toolsService.isEmpty($scope.pageData.contacts))return void toolsService.tips("联系人不能为空!","");if(toolsService.isEmpty($scope.pageData.contactPhone))return void toolsService.tips("联系电话不能为空!","");if(!toolsService.isMobile($scope.pageData.contactPhone))return void toolsService.tips("联系电话不合法!","");var recvProvince=$scope.pageData.recvProvince.PROID,recvCity=$scope.pageData.recvCity.CITYID,recvArea=$scope.pageData.recvArea.ZONEID,uuid=toolsService.uuid(),memberid=Authen.getUserId(),address=$scope.pageData.address,community=$scope.pageData.community,contacts=$scope.pageData.contacts,contactPhone=$scope.pageData.contactPhone,params=new formatAmSqlParams;params.TABLENAME="mall_freezer_apply";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("province",recvProvince),row.addColumn("city",recvCity),row.addColumn("zone",recvArea),row.addColumn("community",community),row.addColumn("address",address),row.addColumn("contacts",contacts),row.addColumn("contact_phone",contactPhone),row.addColumn("member_id",memberid),row.addColumn("status",1),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params);console.error(param);var rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("申请失败！",1):(toolsService.showMessage("申请成功，请等待客服人员联系。",1),$state.go("foodSafety.freezerApply",{},{reload:!0}))})}}]),angular.module("mallMobileApp.controllers").controller("FreezerOpenCtrl",["$scope","$state","Authen","toolsService","actionManagerService","ajaxManager",function($scope,$state,Authen,toolsService,actionManagerService,ajaxManager){$scope.pageData={listEvents:"",vvalue:0,repeatdata:[],params:{memberid:Authen.getUserId()}};var memberId=Authen.getUserId();$state.params.params;$scope.init=function(){var vid={vid:"COMUNT_FREEZER_DEPOSIT"},qData=actionManagerService.excuteResource("variableSql",vid,"none","none");ajaxManager.ajaxToJson(qData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.vvalue=data.DATA[0].VVALUE)})},$scope.init(),$scope.freezerOpen=function(){var uuid=toolsService.uuid().toUpperCase();uuid=uuid.replace(/-/g,"");var params={title:"冷柜开通",out_account_code:"CASH_ACCOUNT",in_account_code:"CREDIT_MARGIN_ACCOUNT",out_remakes:"冷柜开通",in_remakes:"",pay_money:$scope.pageData.vvalue,business:{payment_id:uuid,memberid:memberId,orders:uuid,paymoney:$scope.pageData.vvalue,success_call_back:"com.am.app_plugins.food_safety.FreezerOpenPaymenyProcessBusinessCallBack"},success_url:"foodSafety.freezerOpen",lost_url:"foodSafety.freezerOpen",pay_id:uuid,pay_type:"1",pay_type_name:"支付"};$state.go("common.payment",{params:JSON.stringify(params)},{location:"replace"})}}]),angular.module("mallMobileApp.controllers").controller("ComdDetailsCtrl",["$rootScope","$timeout","$scope","$state","$ionicNavBarDelegate","$rootScope","Authen","commdityService","actionManagerService","ajaxManager","$ionicModal","$ionicBackdrop","toolsService","appConfig",function($rootScope,$timeout,$scope,$state,$ionicNavBarDelegate,$rootScope,Authen,commdityService,actionManagerService,ajaxManager,$ionicModal,$ionicBackdrop,toolsService,appConfig){$scope.pData={cid:"",title:"",comdData:{},mainImages:[],comdSelectCards:[],comdSpace:[],comdRecomd:[],formatData:[],cmodPags:[],currentFormat:{},currentFormatIndex:0,selectFormatIndex:new Array,Discount:1,buyNumber:1,operation:{selectFormat:{SELECTED:!1},addShopCard:{SELECTED:!1},buyNow:{SELECTED:!1},currentOperation:""}};var memberId=Authen.getUserId(),initOperation=function(operation){$scope.pData.operation.selectFormat.SELECTED=!1,$scope.pData.operation.addShopCard.SELECTED=!1,$scope.pData.operation.buyNow.SELECTED=!1,$scope.pData.operation[operation].SELECTED=!0,$scope.pData.operation.currentOperation=operation};$scope.pData.cid=$state.params.id;var params={cid:$scope.pData.cid},queryParams=actionManagerService.excuteResource("comdDetailById",params,"none","none");ajaxManager.ajaxToJson(queryParams,function(data,header,config,status){data.DATA&&($scope.pData.comdData=data.DATA[0],$scope.pData.title=$scope.pData.comdData.NAME,$scope.pData.Discount=data.DATA[0].DISCOUNT,$scope.pData.currentFormat.SPECIMAGES=data.DATA[0].LISTIMAGE,$scope.pData.currentFormat.PRICE=data.DATA[0].PRICE,$scope.pData.comdData.MAINIMAGES&&($scope.pData.mainImages=JSON.parse($scope.pData.comdData.MAINIMAGES),$timeout(function(){new Swiper("#comdd_swiper",{pagination:".swiper-pagination",loop:!0,autoplay:3e3})},800)))},function(data,header,config,status){});var currentIndex=0;$scope.pData.comdSelectCards=[{title:"图文详情",CSS:"cm_select_item_active",show:!0,style:"color:#33cd5f;"},{title:"产品参数",CSS:"cm_select_item",show:!1,style:""},{title:"配套推荐",CSS:"cm_select_item",show:!1,style:""}],$scope.selectCards=function(index){$scope.pData.comdSelectCards[index].CSS="cm_select_item_active",$scope.pData.comdSelectCards[index].style="color:#33cd5f;",$scope.pData.comdSelectCards[index].show=!0,$scope.pData.comdSelectCards[currentIndex].CSS="cm_select_item",$scope.pData.comdSelectCards[currentIndex].style="",$scope.pData.comdSelectCards[currentIndex].show=!1,currentIndex=index},ajaxManager.ajaxToJson(actionManagerService.excuteResource("getComdSpaceByCid",params,"none","none"),function(data,header,config,status){data&&data.DATA&&($scope.pData.comdSpace=data.DATA)}),ajaxManager.ajaxToJson(actionManagerService.excuteResource("getComdRecomdByCid",params,"none","none"),function(data,header,config,status){data&&data.DATA&&($scope.pData.comdRecomd=data.DATA)}),ajaxManager.ajaxToJson(actionManagerService.excuteResource("getComdityPageNames",params,"none","none"),function(data,header,config,status){data&&data.DATA&&($scope.pData.cmodPags=data.DATA)});var currentPagIndex,currentPageItem=null;$scope.selectPackage=function(index){if($scope.pData.cmodPags[index].CSS="cm_pg_active",$scope.pData.cmodPags[currentPagIndex]&&($scope.pData.cmodPags[currentPagIndex].CSS="cm_pg_default"),index===currentPagIndex&&currentPageItem?(currentPageItem=null,currentPagIndex=-10):(currentPageItem=$scope.pData.cmodPags[index],currentPagIndex=index),currentPageItem){var postParams={MEMBERID:memberId,ORGCODE:appConfig.appOrg,GROUPSALEID:currentPageItem.ID,ISGROUPSALE:!0};commdityService.addShopCardByPackageID(postParams,function(data){if(data.ORDERID){var orders=data.ORDERID.replace(/'/g,"").split(",");$timeout(function(){$scope.closeFormatModel(),commdityService.saveShopCardPayments(orders);var params={source:"shopCard"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})},300)}})}},$ionicModal.fromTemplateUrl("my-modal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$rootScope.modal=modal}),$scope.openModal=function(){$rootScope.modal.show()},$scope.closeModal=function(){$rootScope.modal.hide()},$scope.closeFormatModel=function(){$scope.closeModal(),$ionicBackdrop.release()};var queryParams=actionManagerService.excuteResource("getComdFormatByCid",{cid:$scope.pData.cid},"none","none");ajaxManager.ajaxToJson(queryParams,function(data){if(data&&data.DATA){$scope.pData.formatData=data.DATA;for(var i=0;i<$scope.pData.formatData.length;i++)$scope.pData.formatData[i].CSS="cm_pg_default"}}),$scope.pData.currentFormatIndex=null,$scope.selectCurrentFormat=function(index){$scope.pData.currentFormatIndex!==index&&($scope.pData.formatData[index].CSS="cm_pg_active",$scope.pData.formatData[$scope.pData.currentFormatIndex]&&($scope.pData.formatData[$scope.pData.currentFormatIndex].CSS="cm_pg_default"),index===$scope.pData.currentFormatIndex&&$scope.pData.currentFormat?($scope.pData.currentFormat=null,$scope.pData.currentFormatIndex=-10):($scope.pData.currentFormat=$scope.pData.formatData[index],$scope.pData.currentFormatIndex=index))},$scope.toCmdTransRecord=function(){$state.go("commodity.ComdTransRecord",{params:$scope.pData.comdData.ID})},$scope.toComdFormat=function(){initOperation("selectFormat"),$scope.openModal()},$scope.addShopCard=function(){initOperation("addShopCard"),$scope.openModal()},$scope.buyNow=function(){initOperation("buyNow"),$scope.openModal()},$scope.addCollection=function(){var id=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="am_membercollection";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("i"),row.addColumn("member_id",memberId),row.addColumn("type","commodity"),row.addColumn("collectionid",$scope.pData.comdData.ID),row.addColumn("createdate","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("收藏成功！",2)})};var checkComdFormatInfo=function(){var result=!1;return $scope.pData.currentFormat&&$scope.pData.currentFormat.COMMODITYID&&$scope.pData.currentFormat.COMMODITYID.length>1?result=!0:toolsService.showMessage("请选择规格",2),result};$scope.formatAddShopCard=function(){checkComdFormatInfo()&&(commdityService.addShopCard(memberId,$scope.pData.comdData,$scope.pData.currentFormat,$scope.pData.buyNumber),$timeout(function(){$scope.closeFormatModel()},300))},$scope.formatBuyNow=function(){checkComdFormatInfo()&&(commdityService.saveShopInfoToPayment(memberId,$scope.pData.comdData,$scope.pData.currentFormat,$scope.pData.buyNumber),$timeout(function(){$scope.closeFormatModel();var params={source:"commodityDetails"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})},300))},$scope.confirmOperation=function(){"addShopCard"==$scope.pData.operation.currentOperation?$scope.formatAddShopCard():"buyNow"==$scope.pData.operation.currentOperation&&$scope.formatBuyNow()},$scope.goComdDeatils=function(cid){$state.go("commodity.comdDetails",{id:cid})}}]),angular.module("mallMobileApp.controllers").controller("ComdFormatCtrl",["$scope","$state","actionManagerService","ajaxManager","$ionicBackdrop","$timeout",function($scope,$state,actionManagerService,ajaxManager,$ionicBackdrop,$timeout){var params=$state.params.params;$scope.pData={formatData:{},title:""},$scope.pData.cid=params;var queryParams=actionManagerService.excuteResource("getComdFormatByCid",{cid:$scope.pData.cid},"none","none");ajaxManager.ajaxToJson(queryParams,function(data){console.error(data),$scope.action(),data&&data.DATA&&($scope.pData.formatData=data.DATA,console.error($scope.pData.formatData),$scope.pData.title=$scope.pData.formatData[0].CNAME)}),$scope.action=function(){$ionicBackdrop.retain(),$timeout(function(){$ionicBackdrop.release()},5e3)},$scope.$on("backdrop.hidden",function(){}),$scope.$on("backdrop.shown",function(){})}]),angular.module("mallMobileApp.controllers").controller("ComdListCtrl",["$rootScope","$scope","$state","$ionicNavBarDelegate","$rootScope","$ionicHistory","appConfig","$ionicModal","actionManagerService","ajaxManager",function($rootScope,$scope,$state,$ionicNavBarDelegate,$rootScope,$ionicHistory,appConfig,$ionicModal,actionManagerService,ajaxManager){$scope.pData={listEvents:"",params:{orgid:appConfig.appOrg,orderBy:"ORDER BY mc.SaleNumber DESC,mc.price "},rcode:"comdListByGoodId",sortParams:"ORDER BY mc.SaleNumber DESC,mc.price",searchWord:"",sortParamsList:[{value:" ORDER BY mc.SaleNumber DESC,mc.price ",name:"综合"},{value:" ORDER BY mc.SaleNumber DESC ",name:"销售数量(从高到底)"},{value:" ORDER BY mc.SaleNumber ",name:"销售数量(从底到高)"},{value:" ORDER BY mc.Price ",name:"价格(从低到高)"},{value:" ORDER BY mc.Price DESC ",name:"价格(从高到底)"}]},$scope.pData.sortParams=$scope.pData.sortParamsList[0].value;var routeParams=null;$state.params&&$state.params.params&&(routeParams=JSON.parse($state.params.params)),routeParams&&routeParams.searchInput&&($scope.pData.rcode="searchCommodity",$scope.pData.params.searchKey=routeParams.searchInput),$scope.$watch("pData.sortParams",function(){$scope.pData.params.orderBy=$scope.pData.sortParams}),routeParams&&routeParams.classid?($scope.pData.rcode="comdListByGoodId",$scope.pData.params.classid=" AND commodityclassid='"+routeParams.classid+"'"):$scope.pData.params.classid="",routeParams&&routeParams.attch&&"location"==routeParams.attch&&$ionicNavBarDelegate.showBackButton(!1),$rootScope.goBack=function(){routeParams&&routeParams.goBack?$state.go(routeParams.goBack):$ionicHistory.goBack()},$scope.rightOne=function(){$state.go("commodity.mallclass",{},{location:"replace"})},$scope.pData.listEvents={goComdDeatils:function(cid){$state.go("commodity.comdDetails",{id:cid})}},$scope.openModal=function(){$ionicModal.fromTemplateUrl("commodity_filter.html",{scope:$scope,animation:"slide-in-left"}).then(function(modal){$rootScope.modal=modal,$rootScope.modal.show(),$(".modal-backdrop").css("width","68%"),$(".modal-backdrop").css("height","100%"),$(".modal-backdrop").css("position","fixed"),$(".modal-backdrop").css("top","45px"),$(".modal-backdrop").css("left","0px")})},$scope.closeModal=function(){$rootScope.modal&&($rootScope.modal.hide(),$rootScope.modal.remove())},$scope.closeModal(),$scope.pData.params.filter="",$scope.confirmFilter=function(){var queryParmas="";$scope.filterData.comdPrice&&(queryParmas=$scope.filterData.comdPrice),$scope.filterData.minPrice&&$scope.filterData.maxPrice&&$scope.filterData.minPrice<$scope.filterData.maxPrice&&(queryParmas=" AND ( mc.price>"+$scope.filterData.minPrice+" AND mc.price<="+$scope.filterData.maxPrice+" ) "),$scope.pData.recvProvince&&(queryParmas+=" AND mc.province='"+$scope.pData.recvProvince.PROID+"' "),$scope.pData.recvCity&&(queryParmas+=" AND mc.city='"+$scope.pData.recvCity.CITYID+"' "),$scope.pData.recvArea&&(queryParmas+=" AND mc.zone='"+$scope.pData.recvArea.ZONEID+"' "),$scope.pData.searchWord&&(queryParmas+=" AND mc.name LIKE '%"+$scope.pData.searchWord+"%' "),$scope.pData.params.filter=queryParmas,$scope.closeModal()},$scope.filterData={comdPrice:"",minPrice:"",maxPrice:"",comdPriceRange:[{value:" AND ( mc.price>0 AND mc.price<=100 ) ",name:"0-100"},{value:" AND ( mc.price>100 AND mc.price<=200 ) ",name:"100-200"},{value:" AND ( mc.price>200 AND mc.price<=500 ) ",name:"200-500"},{value:" AND ( mc.price>500 AND mc.price<=1000 ) ",name:"500-1000"},{value:" AND mc.price>1000 ",name:"1000以上"}]},$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pData.recvProvince="",$scope.pData.recvCity="",$scope.pData.recvArea="";var currentSelectAddIndex,proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)}),$scope.$watch("pData.recvProvince",function(){if($scope.pData.recvProvince){$scope.cascadePCZ.zones=[],$scope.pData.recvCity="",$scope.pData.recvArea="";var pId={pid:$scope.pData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){if(data.DATA&&($scope.cascadePCZ.cities=data.DATA,currentSelectAddIndex>=0))for(var i=0;i<$scope.cascadePCZ.cities.length;i++)if($scope.cascadePCZ.cities[i].CITYID==$scope.pData.recvcity){$scope.pData.recvCity=$scope.cascadePCZ.cities[i];break}})}}),$scope.$watch("pData.recvCity",function(){if($scope.pData.recvArea="",$scope.pData.recvCity){var cId={cid:$scope.pData.recvCity.CITYID},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){if(data.DATA&&($scope.cascadePCZ.zones=data.DATA),currentSelectAddIndex>=0)for(var i=0;i<$scope.cascadePCZ.zones.length;i++)if($scope.cascadePCZ.zones[i].ZONEID==$scope.pData.recvarea){$scope.pData.recvArea=$scope.cascadePCZ.zones[i];break}})}}),$state.params&&$state.params.params&&"province"==JSON.parse($state.params&&$state.params.params).type&&($scope.pData.params.filter=" AND mc.province='"+JSON.parse($state.params&&$state.params.params).value+"' ")}]),angular.module("mallMobileApp.controllers").controller("ComdTransCtrl",["$rootScope","$scope","$state","$ionicNavBarDelegate","$rootScope","$ionicHistory","appConfig","$ionicModal","actionManagerService","ajaxManager",function($rootScope,$scope,$state,$ionicNavBarDelegate,$rootScope,$ionicHistory,appConfig,$ionicModal,actionManagerService,ajaxManager){$scope.pData={cmid:"",resource:"getComdityTrsfRecord",listEvents:{},params:""};var routeParams={};$state.params&&(routeParams=$state.params.params,$scope.pData.cmid=routeParams,$scope.pData.params={commodityId:$scope.pData.cmid})}]),angular.module("mallMobileApp.controllers").controller("amAppMain",["$scope","$rootScope","$state","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","$ionicModal","$ionicBackdrop","appConfig","actionManagerService","ajaxManager","toolsService",function($scope,$rootScope,$state,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,$ionicModal,$ionicBackdrop,appConfig,actionManagerService,ajaxManager,toolsService){if($rootScope.navBar={rightOne:!1,rightTwo:!1,rightOneShow:!1,rightTwoShow:!1,rightOnwTitle:"",rightTwoTitle:""},$scope.pData={isDerive:appConfig.isDerive},$rootScope.plaformMargTop="0px",$rootScope.plaformPaddTop="0px",$rootScope.plaformmargBut="0px",$rootScope.plashopmargBut="47px",$rootScope.iosPaddBott="0px",$rootScope.iosPaddTop="0px",$rootScope.iosTop="44px",$scope.$watch("pData.isDerive",function(){ionic.Platform.isWebView()&&ionic.Platform.isIOS()?($rootScope.plaformMargTop="20px",$rootScope.plaformPaddTop="16px 0px 0px 0px",$rootScope.plaformmargBut="20px",$rootScope.plashopmargBut="72px",$rootScope.iosPaddBott="15px",$rootScope.iosPaddTop="10px",$rootScope.iosTop="68px"):($rootScope.platform_top="0px",$rootScope.header_height="44px")}),$rootScope.baseUrl=appConfig.baseUrl,$rootScope.init=function(){try{$rootScope.modal&&($rootScope.modal.hide(),$rootScope.modal.remove(),$ionicBackdrop.release())}catch(e){console.error(e)}$rootScope.navBar={rightOne:!1,rightTwo:!1,rightOneShow:!1,rightTwoShow:!1,rightOnwTitle:"",rightTwoTitle:""},$ionicNavBarDelegate.showBackButton(!0)},$rootScope.init(),$rootScope.goBack=function(){toolsService.goBackPage()},$rootScope.rightOne=function(){},$rootScope.rightTwo=function(){},$rootScope.$on("$stateChangeStart",function(evt,toState,toParams,fromState,fromParams){var isGoLoginPage=!1;if($rootScope.init(),toState&&toState.access_level===ACCESS_LEVELS.user?Authen.isAuthorized()||(isGoLoginPage=!0,evt.preventDefault()):toState&&toState.access_level===ACCESS_LEVELS.role_03&&(Authen.isRoleUser(toState.access_level)?toolsService.showMessage("你无权访问此功能，请联系系统管理员。",1600):(isGoLoginPage=!0,evt.preventDefault())),isGoLoginPage){var params='{ "ToState" : '+angular.toJson(toState)+',"ToParams" : '+angular.toJson(toParams)+"}";console.debug("pringt amAppMain $stateChangeStart.params="+params),$state.go("member.login",{params:params},{location:"replace"})}}),0==appConfig.isDerive)try{}catch(e){}}]);try{}catch(e){}angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("member.mycoupon",{url:"/mycoupon",cache:!1,views:{member_view:{templateUrl:"app_plugins/mall/coupon/views/coupon_list_page.html",controller:"CouponListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("CouponListCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate){$scope.pageData={memberid:Authen.getUserId(),coupondata:{},usestatus:"1",comdSelectCards:[],params:{memberid:Authen.getUserId(),userstatus:1}};var currentIndex=0;$scope.pageData.type=currentIndex,$scope.pageData.comdSelectCards=[{title:"未使用",CSS:"button button-positive",show:!0,style:"background-color:#2ad4d4;color:#FFFFFF;border:0px;height: 30px;width: 70px;"},{title:"已使用",CSS:"button button-outline button-positive",show:!1,style:"border:0px;color:#2ad4d4;background-color:#FFFFFF;height: 30px;width: 70px;"}],$scope.selectCards=function(index){$scope.pageData.comdSelectCards[index].CSS="button button-positive",$scope.pageData.comdSelectCards[index].style="background-color:#2ad4d4;color:#FFFFFF;border:0px;height: 30px;width: 70px;",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="button button-outline button-positive",$scope.pageData.comdSelectCards[currentIndex].style="border:0px;color:#2ad4d4;background-color:#FFFFFF;height: 30px;width: 70px;",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex,$scope.quecoupon($scope.pageData.type)},$scope.quecoupon=function(type){0==type?$scope.pageData.params={memberid:Authen.getUserId(),userstatus:1}:$scope.pageData.params={memberid:Authen.getUserId(),userstatus:2}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("homeIndexControllers",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){function getActivitys(){var params={orgid:appConfig.appOrg},rData=actionManagerService.excuteResource("com.am.mall.getMallActivity",params,"","");ajaxManager.ajaxToJson(rData,function(data){if(data&&data.DATA)for(var i=0;i<data.DATA.length;i++)2==data.DATA[i].ACTIVITIESTYPE&&$scope.pageData.mallActives.listMall.push({activitiesType:2,orgcode:appConfig.appOrg,mid:data.DATA[i].ID,MALL_TITLE:data.DATA[i].TITLE,ITEM_DATA:{}})})}$scope.$on("$ionicView.afterEnter",function(){navigator.splashscreen&&navigator.splashscreen.hide()},!1);var type="",volunteerUrl="";Authen.getUserInfo()&&(type=Authen.getUserInfo().MEMBER_TYPE),volunteerUrl=Authen.isAuthorized()?"member.invitation":"member.register",$scope.pageData={bannerData:"",searchInput:"",mallActive:"",activeParam:{activitiesType:2,orgcode:appConfig.appOrg},title:"农业立体联动社会化综合服务平台",normalMallActive:{activitiesType:0,orgcode:appConfig.appOrg},limitMallActive:{activitiesType:1,orgcode:appConfig.appOrg},commodityMallActive:"",icon:"",normalData:[],limitData:[],madData:[],mallActives:{normalMall:[],limitMall:[],listMall:[]}},$scope.pData={listEvents:""},$scope.init=function(){$scope.getBannerInfo(),$rootScope.navBar={rightOne:!0,rightOneShow:!0,rightOnwTitle:"分类"}},$scope.rightOne=function(){$state.go("commodity.mallclass",{},{})},$scope.pageData.icon=[{title:"大众创业",img:"img/home1_15.png",url:"common.accessnavigention",param:{banner_menu_code:"startBusiness",title:"科学帮扶大众创业",buttons:[{button_title:"我要创业",url:"cooperative.startBusiness"}],content_id:"startBusiness"}},{title:"投资三农",img:"img/home1_17.png",url:"common.accessnavigention",param:{banner_menu_code:"agroProjList",title:"理性扶持投资农业",buttons:[{button_title:"我要投资",url:"cooperative.agroProjList"}],content_id:"agroProjList"}},{title:"生态旅游",img:"img/home1_19.png",url:"common.accessnavigention",param:{banner_menu_code:"ecologyTourism",title:"生态田园游",buttons:[{button_title:"进入",url:"more.ecologyTourism"}],content_id:"ecologyTourism"}},{title:"农村大市场",img:"img/home1_21.png",url:"common.accessnavigention",param:{banner_menu_code:"ruralMarket",title:"农村大市场",buttons:[{button_title:"我去赶集",url:"ruralMarket.ruralMarket"}],content_id:"ruralMarket"}},{title:"冷链物流",img:"img/home2_15.png",url:"common.accessnavigention",param:{banner_menu_code:"cooldLink",title:"冷链物流",buttons:[{button_title:"进入",url:"cooperative.startBusiness"}],content_id:"cooldLink"}},{title:"社区配送",img:"img/home2_16.png",url:"common.accessnavigention",param:{banner_menu_code:"communityDist",title:"社区配送",buttons:[{button_title:"进入",url:"cooperative.startBusiness"}],content_id:"communityDist"}},{title:"食品安全",img:"img/home2_17.png",url:"common.accessnavigention",param:{banner_menu_code:"foodsafety",title:"食品安全",show_type:"linkRow",buttons:[{button_title:"村头/社区冷柜安装申请",url:"foodSafety.freezerApply"},{button_title:"社区交易冷柜使用开通",url:"foodSafety.freezerOpen"},{button_title:"投资参与共建共享食安体系",url:"cooperative.agroProjList"}],content_id:"foodsafety"}},{title:"品质生活",img:"img/home2_09.png",url:"common.accessnavigention",param:{banner_menu_code:"qualityLife",title:"高品质生活",buttons:[{button_title:"敬请期待",url:""}],content_id:"qualityLife"}},{title:"精准扶贫",img:"img/home1_33.png",url:"common.accessnavigention",param:{banner_menu_code:"LaunchHelp",title:"产业扶贫社会精准帮扶",buttons:[{button_title:"进入",url:"cooperative.helpGuide"}],content_id:"LaunchHelp"}},{title:"合作保险",img:"img/home2_18.png",url:"common.accessnavigention",param:{banner_menu_code:"CoopInsurance",title:"合作保险",buttons:[{button_title:"敬请期待",url:""}],content_id:"CoopInsurance"}},{title:"金融服务",img:"img/home2_03.png",url:"common.accessnavigention",param:{banner_menu_code:"groupLending",title:"金融服务",buttons:[{button_title:"进入",url:"member.groupLending"}],content_id:"groupLending"}},{title:"政府监管",img:"img/home2_05.png",url:"common.accessnavigention",param:{banner_menu_code:"govRegulation",title:"政府监管",buttons:[{button_title:"敬请期待",url:""}],content_id:"govRegulation"}},{title:"慈善救助",img:"img/home1_31.png",url:"common.accessnavigention",param:{banner_menu_code:"charityAid",title:"社会救助扶贫帮困",buttons:[{button_title:"我去救助",url:"more.socialAssistance"}],content_id:"charityAid"}},{title:"大学生资助",img:"img/home1_40.png",url:"common.accessnavigention",param:{banner_menu_code:"studenSupport",title:"大学生资助",buttons:[{button_title:"进入",url:"more.studenSupport"}],content_id:"studenSupport"}},{title:"法律援助",img:"img/home2_07.png",url:"common.accessnavigention",param:{banner_menu_code:"legalAid",title:"法律援助",buttons:[{button_title:"敬请期待",url:""}],content_id:"legalAid"}},{title:"信用查询",img:"img/home2_23.png",url:"common.accessnavigention",param:{banner_menu_code:"CreditInquiry",title:"信用查询",buttons:[{button_title:"敬请期待",url:""}],content_id:"CreditInquiry"}},{title:"农技推广",img:"img/home1_30.png",url:"common.accessnavigention",param:{banner_menu_code:"koppTrainContent",title:"科协农技下乡科普专栏",buttons:[{button_title:"进入",url:"cooperative.agrlExpanded"}],content_id:"koppTrainContent"}},{title:"专家大院",img:"img/home1_28.png",url:"common.accessnavigention",param:{banner_menu_code:"expertCompound",title:"科普引智专家大院",buttons:[{button_title:"进入",url:"more.expertCompound"}],content_id:"expertCompound"}},{title:"科普培训",img:"img/home1_43.png",url:"common.accessnavigention",param:{banner_menu_code:"koppTrainEdu",title:"现代理性农业科普培训",buttons:[{button_title:"进入",url:"more.koppTrain"}],content_id:"koppTrainEdu"}},{title:"科普志愿者",img:"img/home2_24.png",url:"common.accessnavigention",param:{banner_menu_code:"distribution",title:"科普志愿者",buttons:[{button_title:"成为志愿者",url:volunteerUrl}],content_id:"distribution"}},{title:"社员大会",img:"img/home1_42.png",url:"common.accessnavigention",param:{banner_menu_code:"memberPoll",title:"社员代表大会",buttons:[{button_title:"我去参会",url:"more.memberPoll"}],content_id:"memberPoll"}},{title:"生态养老",img:"img/home1_44.png",url:"common.accessnavigention",param:{banner_menu_code:"ecologicalPension",title:"生态养老",buttons:[{button_title:"敬请期待",url:""}],content_id:"ecologicalPension"}},{title:"医疗服务",img:"img/home1_45.png",url:"common.accessnavigention",param:{banner_menu_code:"medicalService",title:"医疗服务",buttons:[{button_title:"敬请期待",url:""}],content_id:"medicalService"}}],getActivitys(),$scope.getBannerInfo=function(){var bannerParam={condition:" and am_mobliemenuid='menu_home' and orgcode='"+appConfig.appOrg+"'"},rData=actionManagerService.excuteResource("banner_active_info",bannerParam,"","");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.bannerData=data.DATA,toolsService.createSwiper(".home_swipersss",".home_swiper_pagination"));
})},$scope.toPage=function(url){toolsService.toStateOfServerUrl($state,url)},$scope.Jump=function(url,param){$state.go(url,{params:param})},$scope.homeSearch=function(){toolsService.isEmpty($scope.pageData.searchInput)||$state.go("commodity.commodityList",{searchInput:$scope.pageData.searchInput})},$scope.pData.listEvents={toClassDeatils:function(index,classId,stateData,endData,state,title){if(console.error(title),"1"==state){if(console.error((new Date).getTime()-new Date(stateData).getTime()),(new Date).getTime()-new Date(stateData).getTime()<0)return void toolsService.tips("活动还未开始","");if((new Date).getTime()-new Date(endData).getTime()>0)return void toolsService.tips("活动已结束","");var p={id:classId,title:title};$state.go("commodity.mallclassDetail",{params:JSON.stringify(p)})}else{var p={id:classId,title:title};console.error(p),$state.go("commodity.mallclassDetail",{params:JSON.stringify(p)})}},goComdDeatils:function(cid){$state.go("commodity.comdDetails",{id:cid})}},$scope.init();$scope.toPublicWelfare=function(){var url="common.accessnavigention",param={banner_menu_code:"PublicWelfare",title:"公益市场",buttons:[{button_title:"进入市场",url:"publicMarket.selectMarketArea"}],content_id:"PublicWelfare"};$state.go(url,{params:JSON.stringify(param)})},$scope.inputProductUrl=function(){var rData=actionManagerService.excuteResource("variableSql",{vid:"InputMallClassId"},"","");ajaxManager.ajaxToJson(rData,function(data){if(data&&data.DATA){$scope.pageData.bannerData=data.DATA;var classId=data.DATA[0].VVALUE,params={id:classId,title:"农业部948项目食品安全GAP体系"},url="common.accessnavigention",param={banner_menu_code:"InputProduct",title:"农业部948项目食品安全GAP体系",buttons:[{button_title:"进入",url:"commodity.mallclassDetail",routeParam:{params:JSON.stringify(params)}}],content_id:"InputProduct"};$state.go(url,{params:JSON.stringify(param)})}})},$scope.openBDMap=function(){var url="http://api.map.baidu.com/direction?origin=latlng:34.264642646862,108.95108518068|name:我家&destination=大雁塔&mode=driving&region=西安&output=html&src=yourCompanyName|yourAppName";window.open(url)}}]),angular.module("mallMobileApp.controllers").controller("MallCouponListCtrl",["$scope","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state","$stateParams","appConfig",function($scope,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state,$stateParams,appConfig){$scope.pageData={memberid:Authen.getUserId(),scoreParams:{},serverHost:appConfig.baseUrl+"/",mallCouponListParams:{orgcode:appConfig.appOrg},score:0,listEvents:""},$scope.MemberScore=function(){$scope.pageData.scoreParams={memberid:$scope.pageData.memberid};var rData=actionManagerService.excuteResource("score",$scope.pageData.scoreParams,"","","");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.score=data.DATA[0].SCORE})},$scope.MemberScore(),$scope.pageData.listEvents={ExchangeCoupon:function(eterpelectticketid,effectivedate,scorevalue){if(parseInt($scope.pageData.score)<parseInt(scorevalue))return toolsService.showMessage("积分不足!",1),!1;var rData=actionManagerService.exchangeCoupon($scope.pageData.memberid,eterpelectticketid,effectivedate,scorevalue);ajaxManager.ajaxToJson(rData,function(data){return 0==data.CODE?($scope.MemberScore(),toolsService.showMessage("兑换成功!",1),!0):void 0})}}}]),angular.module("mallMobileApp.controllers").controller("mallClassControllers",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService){$scope.pageData={leftMenuData:"",searchInput:"",classListId:"",secondMenuData:"",thirdMenuData:"",title:"商品分类"};var currentFristIndex=0;$scope.clickMenu=function(classItem,index){var classListId=classItem.ID;$scope.pageData.leftMenuData[currentFristIndex].CSS="",classItem.CSS="frist_item_active",currentFristIndex=index,classListId&&($scope.pageData.thirdMenuData=new Array,$scope.secondMenuCreate(classListId))},$scope.secondMenuCreate=function(fristID){var param={upid:fristID},rData=actionManagerService.excuteResource("mallClassList",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.secondMenuData=data.DATA;for(var i=0;i<data.DATA.length;i++)$scope.thirdMenuCreate(data.DATA[i].ID)}})},$scope.thirdMenuCreate=function(secondID){var param={upid:secondID},rData=actionManagerService.excuteResource("mallClassList",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||$scope.pageData.thirdMenuData.push(data.DATA)})},$scope.oneMenuCreate=function(){var param={orgcode:appConfig.appOrg},rData=actionManagerService.excuteResource("mallLeftClass",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.leftMenuData=data.DATA,$scope.pageData.thirdMenuData=new Array,currentFristIndex=0,$scope.clickMenu(data.DATA[0],0))})},$scope.toGoodsPage=function(id){var routeParams={classid:id};$state.go("commodity.commodityList",{params:JSON.stringify(routeParams)})},$scope.init=function(){$scope.oneMenuCreate(),$rootScope.navBar={rightOne:!1,rightTwo:!1,rightOneShow:!1,rightTwoShow:!1,rightOnwTitle:"",rightTwoTitle:""}},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("mallClassDetailControllers",["$scope","$stateParams","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$stateParams,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){console.info("mallClassDetailControllers:"+angular.toJson($stateParams.params)),$scope.pageData={parentClassId:JSON.parse($stateParams.params).id,classData:"",goodsData:"",classOrGoods:"class",activeParam:"",title:"货柜",listEvents:"",listEventss:"",madData:[],params:""};var routeParams=JSON.parse($stateParams.params),classId=routeParams.id;$scope.pageData.activeParam={classid:classId},$scope.pageData.params={classid:classId,orgcode:appConfig.appOrg},$scope.pageData.title=routeParams.title;$scope.pageData.listEvents={toGoodDeatils:function(classId,title){if(!toolsService.isEmpty(classId)){var p={id:classId,title:title};console.error(p),$state.go("commodity.mallclassDetail",{params:JSON.stringify(p)})}}},$scope.pageData.listEventss={goComdDeatils:function(cid){$state.go("commodity.comdDetails",{id:cid})}},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("commodityorderCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen","OrderService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen,OrderService){$scope.pData={alltab:"myorder_select_div",distributiontab:"",goodsreceipttab:"",servicetab:"",commenttab:"",chaseratingstab:"",barclass:"",myorderSQL:"myorderquery",myorderSQLcondition:{member_id:Authen.getUserId(),condition:" order by mm.createdate desc",tabnumber:0},listEvents:""};var orderStateEnum;OrderService.getOrderStateEnum(function(data){orderStateEnum=data,console.info("OrderStateEnum:"+angular.toJson(orderStateEnum))});var params=$state.params,orderParams={};if(params&&params.params){orderParams=JSON.parse(params.params);var pPars={PAY_ID:orderParams.pay_id},rData=actionManagerService.processOrderPay(pPars);ajaxManager.ajaxToJson(rData,function(data){0==data.ERROR&&$state.reload()})}$ionicScrollDelegate.$getByHandle("mainScroll").scrollTop([shouldAnimate=!0]),$ionicScrollDelegate.$getByHandle("mainScroll").scrollBottom([shouldAnimate=!0]),$scope.myswiper=function(){0!=$ionicScrollDelegate.$getByHandle("small").getScrollPosition().left?$scope.pData.barclass="myorder_bar_display_none":0==$ionicScrollDelegate.$getByHandle("small").getScrollPosition().left&&($scope.pData.barclass="myorder_bar_display_block"),$scope.$evalAsync()},$scope.selecttab=function(tabName){"alltab"==tabName?""==$scope.pData.alltab&&($scope.pData.alltab="myorder_select_div",$scope.pData.distributiontab="",$scope.pData.goodsreceipttab="",$scope.pData.servicetab="",$scope.pData.chaseratingstab="",$scope.pData.commenttab="",$scope.pData.tabName="alltab",$scope.pData.myorderSQLcondition.tabnumber=0,$scope.pData.myorderSQLcondition.condition=" order by mm.createdate desc"):"distributiontab"==tabName?""==$scope.pData.distributiontab&&($scope.pData.alltab="",$scope.pData.distributiontab="myorder_select_div",$scope.pData.goodsreceipttab="",$scope.pData.servicetab="",$scope.pData.chaseratingstab="",$scope.pData.commenttab="",$scope.pData.tabName="distributiontab",$scope.pData.myorderSQLcondition.tabnumber=1,$scope.pData.myorderSQLcondition.condition=" AND mm.OrderState IN('3','30','31','401','32') ORDER BY mm.createdate DESC"):"goodsreceipttab"==tabName?""==$scope.pData.goodsreceipttab&&($scope.pData.alltab="",$scope.pData.distributiontab="",$scope.pData.goodsreceipttab="myorder_select_div",$scope.pData.servicetab="",$scope.pData.chaseratingstab="",$scope.pData.commenttab="",$scope.pData.tabName="goodsreceipttab",$scope.pData.myorderSQLcondition.tabnumber=2,$scope.pData.myorderSQLcondition.condition=" AND mm.OrderState IN ('4','5','402','403','404') order by mm.createdate desc"):"servicetab"==tabName?""==$scope.pData.servicetab&&($scope.pData.alltab="",$scope.pData.distributiontab="",$scope.pData.goodsreceipttab="",$scope.pData.servicetab="myorder_select_div",$scope.pData.chaseratingstab="",$scope.pData.commenttab="",$scope.pData.tabName="servicetab",$scope.pData.myorderSQLcondition.tabnumber=3,$scope.pData.myorderSQLcondition.condition=" and mm.OrderState='6' order by mm.createdate desc"):"commenttab"==tabName?""==$scope.pData.commenttab&&($scope.pData.alltab="",$scope.pData.distributiontab="",$scope.pData.goodsreceipttab="",$scope.pData.servicetab="",$scope.pData.chaseratingstab="",$scope.pData.commenttab="myorder_select_div",$scope.pData.tabName="commenttab",$scope.pData.myorderSQLcondition.tabnumber=4,$scope.pData.myorderSQLcondition.condition=" AND mm.OrderState IN ('8') order by mm.createdate desc"):"chaseratingstab"==tabName&&""==$scope.pData.chaseratingstab&&($scope.pData.alltab="",$scope.pData.distributiontab="",$scope.pData.goodsreceipttab="",$scope.pData.servicetab="",$scope.pData.commenttab="",$scope.pData.chaseratingstab="myorder_select_div",$scope.pData.tabName="commenttab",$scope.pData.myorderSQLcondition.tabnumber=5,$scope.pData.myorderSQLcondition.condition=" and mm.OrderState='81' order by mm.createdate desc")},$scope.pData.listEvents={myorderCancel:function(orderid){OrderService.orderCancel(orderid)},myorderConfirreceiptclick:function(orderid){OrderService.orderConfirmRecv(orderid)},myorderReturnGoods:function(orderid){var params=JSON.stringify({orderid:orderid});$state.go("member.returnrequest",{params:params},{})},orderComplain:function(orderid){OrderService.goToComplain(orderid)},myorderConfirmationService:function(orderid){OrderService.orderConfirmation(orderid)},myorderEvaluate:function(orderid){var params=JSON.stringify({orderid:orderid,orderState:"8"});$state.go("member.evaluate",{params:params})},myorderChaseratings:function(orderid){var params=JSON.stringify({orderid:orderid,orderState:2});$state.go("member.evaluate",{params:params})},orderDetails:function(orderid){var params=JSON.stringify({orderid:orderid});$state.go("member.orderdetalils",{params:params})},OrderStateEnum:orderStateEnum,OrderShippingMethodEnum:{1:"即时送货",2:"预约送货"}}}]),angular.module("mallMobileApp.controllers").controller("OrderComplaintCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen","Upload","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen,Upload,$ionicPopup){$scope.pData={viewStae:"e",complaintInfo:{},complResCode:"getOrderCompByOrdrId",orderId:"",isEdit:!0,inputData:[],imagepath:""},$state.params&&$state.params.params&&($scope.pData.orderId=JSON.parse($state.params.params).orderid,ajaxManager.ajaxToJson(actionManagerService.excuteResource($scope.pData.complResCode,{orderId:$scope.pData.orderId},"none","none"),function(data){data&&data.DATA&&($scope.pData.complaintInfo=data.DATA[0],$scope.pData.complaintInfo&&$scope.pData.complaintInfo.COMPLAINT_CONTENT&&($scope.pData.isEdit=!1,$scope.pData.inputData=$scope.pData.complaintInfo.COMPLAINT_ATTACH.split(",")))})),$scope.upload=function(file){var rData=actionManagerService.uploadFileAction(file,"image","files/MALL_COMMODITYORDEREVALUATION/"+$scope.pData.orderId+"/bdp_eval_images");Upload.upload(rData).then(function(resp){$scope.CommentImgUrl="/"+resp.data.NET_FILE_PATH,"/undefined"!=$scope.CommentImgUrl&&($scope.pData.inputData.push({type:"file",data:$scope.CommentImgUrl}),$scope.pData.imagepath&&$scope.pData.imagepath.length>1?$scope.pData.imagepath+=","+$scope.CommentImgUrl:$scope.pData.imagepath=$scope.CommentImgUrl)},function(resp){},function(evt){})},$scope["delete"]=function(value){$ionicPopup.show({title:"确认删除",template:"确认删除选中的图片?",scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>确认</b>",type:"btn1",onTap:function(){for(var i=0;i<$scope.pData.inputData.length;i++)$scope.pData.imagepath=$scope.pData.imagepath.replace(","+value,""),$scope.pData.imagepath=$scope.pData.imagepath.replace(value,""),$scope.pData.inputData[i].data==value&&$scope.pData.inputData.splice(i,1)}}]})},$scope.submintComplaint=function(){if(toolsService.isEmpty($scope.pData.complaintInfo.COMPLAINT_CONTENT))return void toolsService.showMessage("请输入投诉内容","2");$scope.pData.complaintInfo.COMPLAINT_ATTACH=$scope.pData.imagepath;var postData=actionManagerService.getPostComplaint($scope.pData.complaintInfo);ajaxManager.ajaxToJson(postData,function(data){data&&(toolsService.showMessage(data.MSG,1),$state.go("member.myorder"))})}}]),angular.module("mallMobileApp.controllers").controller("orderdetalils_Ctrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen","OrderService","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen,OrderService,$ionicPopup){$scope.pData={orderid:JSON.parse($state.params.params).orderid,orderstate:"",ordertotalprice:0,POSTAGE:0,CONTACT:"",ADDRESS:"",CONTACTPHONE:"",imgurl:"",NAME:"",SALEPRICE:"",SALENUMBER:"",ORDERCODE:"",COMPLETEDATE:"",buttontext:"",buttonclass:"",returngoods:"",orderInfo:{},tabnumber:0,orderSellOutFree:.3,OrderShippingMethodEnum:{1:"即时送货",2:"预约送货"},OrderStateEnum:{}},OrderService.getOrderStateEnum(function(data){$scope.pData.OrderStateEnum=data,console.info("OrderStateEnum:"+angular.toJson($scope.pData.OrderStateEnum))}),$scope.toComditDeatil=function(){$state.go("commodity.comdDetails",{id:$scope.pData.orderInfo.COMMODITYID})},$scope.returngoods=function(){var params=JSON.stringify({orderid:$scope.pData.orderid});$state.go("member.returnrequest",{params:params},{location:"replace"})},$scope.goaddress=function(state){switch(Number($scope.pData.buttonclass)){case 2:var rData=actionManagerService.excuteResource("orderpayquery",{orderid:$scope.pData.orderid,memberid:Authen.getUserId()},"","");ajaxManager.ajaxToJson(rData,function(data){$state.go("member.payment",{},{RECORDID:data.DATA[0].ID})});break;case 3:var rData=actionManagerService.MyOrderConfirreceipt($scope.pData.orderid,$scope.pData.buttonclass,39);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("订单取消成功!"),$state.go("member.myorder",{},{location:"replace"})});break;case 4:var rData=actionManagerService.MyOrderConfirreceipt($scope.pData.orderid,$scope.pData.buttonclass,49);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("订单取消成功!"),$state.go("member.myorder",{},{location:"replace"})});break;case 5:var rData=actionManagerService.MyOrderConfirreceipt($scope.pData.orderid,$scope.pData.buttonclass,"");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("确认收货成功!"),$state.go("member.myorder",{},{location:"replace"})});break;case 6:var rData=actionManagerService.MyOrderConfirreceipt($scope.pData.orderid,$scope.pData.buttonclass,"");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("确认服务成功!"),$state.go("member.myorder",{},{location:"replace"})});break;case 8:var params=JSON.stringify({orderid:$scope.pData.orderid,orderState:1});$state.go("member.evaluate",{params:params},{location:"replace"});break;case 81:var params=JSON.stringify({orderid:$scope.pData.orderid,orderState:2});$state.go("member.evaluate",{params:params},{location:"replace"});break;case 82:console.error("订单完成");break;case 31:var rData=actionManagerService.MyOrderConfirreceipt($scope.pData.orderid,$scope.pData.buttonclass,"319");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("订单取消成功!"),$state.go("member.myorder",{},{location:"replace"})})}},$scope.init=function(){var rData=actionManagerService.excuteResource("orderdetails",{orderid:$scope.pData.orderid},"","");ajaxManager.ajaxToJson(rData,function(data){if(data.DATA.length>0){var rs=data.DATA[0];$scope.pData.orderInfo=rs,OrderService.saveOrderDetails($scope.pData.orderInfo),$scope.pData.ordertotalprice=""==rs.TOTALPRICE?0:rs.TOTALPRICE,$scope.pData.POSTAGE=""==rs.POSTAGE?0:rs.POSTAGE,$scope.pData.CONTACT=rs.CONTACT,$scope.pData.ADDRESS=rs.ADDRESS,$scope.pData.CONTACTPHONE=rs.CONTACTPHONE,$scope.pData.imgurl=appConfig.baseUrl+"/"+rs.LISTIMAGE,$scope.pData.NAME=rs.NAME,$scope.pData.SALEPRICE=rs.SALEPRICE,$scope.pData.SALENUMBER=rs.SALENUMBER,$scope.pData.ORDERCODE=rs.ORDERCODE,$scope.pData.COMPLETEDATE=""==rs.COMPLETEDATE?"(交易未完成)":rs.COMPLETEDATE,$scope.pData.ID=rs.ID;var ordState=$scope.pData.orderInfo.ORDERSTATE;"3"==ordState||"30"==ordState||"31"==ordState||"401"==ordState||"32"==ordState?$scope.pData.tabnumber=1:"4"==ordState||"402"==ordState||"403"==ordState||"404"==ordState?$scope.pData.tabnumber=2:("5"==ordState||"8"==ordState||"81"==ordState)&&($scope.pData.tabnumber=4);var state=Number(rs.BUTTONNAME);switch(console.error(rs.BUTTONNAME),state){case 2:$scope.pData.orderstate="待付款",$scope.pData.buttontext="支付",$scope.pData.buttonclass="2";break;case 3:$scope.pData.orderstate="待配送",$scope.pData.buttontext="取消订单",$scope.pData.buttonclass="3";break;case 4:$scope.pData.orderstate="待配送",$scope.pData.buttontext="取消订单",$scope.pData.buttonclass="4";break;case 5:$scope.pData.orderstate="待收货",$scope.pData.buttontext="确认收货",$scope.pData.buttonclass="5",$scope.pData.returngoods="退货申请";break;case 6:$scope.pData.orderstate="待服务",$scope.pData.buttontext="确认服务",$scope.pData.buttonclass="6",$scope.pData.returngoods="退货申请";break;case 8:$scope.pData.orderstate="待评价",$scope.pData.buttontext="评价",$scope.pData.buttonclass="8";break;case 81:$scope.pData.orderstate="待追评",$scope.pData.buttontext="追评",$scope.pData.buttonclass="81";break;case 82:$scope.pData.orderstate="订单完成",$scope.pData.buttontext="删除订单",$scope.pData.buttonclass="82";break;case 31:$scope.pData.orderstate="待派单",$scope.pData.buttontext="取消订单",$scope.pData.buttonclass="31";break;case 91:$scope.pData.orderstate="退货成功",$scope.pData.buttontext="退货成功",$scope.pData.buttonclass="91"}}})},$scope.goToComplain=function(){OrderService.goToComplain($scope.pData.orderid)},$scope.evaluate=function(){var params=JSON.stringify({orderid:$scope.pData.orderid,orderState:1});$state.go("member.evaluate",{params:params})},$scope.orderCancel=function(){OrderService.orderCancel($scope.pData.orderid)},$scope.orderConfirmRecv=function(){OrderService.orderConfirmRecv($scope.pData.orderid)},$scope.sellOut=function(){var paramsObj={orderId:$scope.pData.orderid};$state.go("member.orderSellOut",{params:JSON.stringify(paramsObj)})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("OrderSellOutCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen","OrderService","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen,OrderService,$ionicPopup){$scope.pData={orderSellOutFree:.3,orderInfo:{},orderId:""};var init=function(){var rData=actionManagerService.excuteResource("get_avar_info",{vid:"order_sell_out_free_ratio"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pData.orderSellOutFree=data.DATA[0].VVALUE)}),$state.params&&($scope.pData.orderId=JSON.parse($state.params.params).orderId),OrderService.getOrderDetails($scope.pData.orderId,function(data){$scope.pData.orderInfo=data})};init();var confirmPopup={};$scope.sellOut=function(){confirmPopup=$ionicPopup.confirm({title:"<h3>卖出确认</h3>",template:"卖出当前订单可以获取元"+new Number($scope.pData.orderInfo.NOWOUTTOTALPRICE).toFixed(2)+"，其中需收取手续费为"+new Number($scope.pData.orderSellOutFree*$scope.pData.orderInfo.NOWOUTTOTALPRICE)+"元。<br>您确认好卖出当前订单吗?",buttons:[{text:"取消",type:"btnc",onTap:function(){}},{text:"确定",type:"btn1",onTap:function(){OrderService.sellOut($scope.pData.orderInfo.ID,function(data){0==data.CODE?(toolsService.showMessage(data.MSG,1800),$state.go("member.myorder",{},{location:"replace"})):toolsService.showMessage(data.MSG,1800)})}}]})}}]),angular.module("mallMobileApp.controllers").controller("evaluateCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen","OrderService","FileAccess","$ionicPopup","Upload",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen,OrderService,FileAccess,$ionicPopup,Upload){function processSave(isEdit){$scope.pData.rememberstate&&($scope.pData.evaObj.ISANONYMOUS="1"),$scope.pData.evaObj.CONTENT1=$scope.pData.content;var params=new formatAmSqlParams;params.TABLENAME="mall_CommodityOrderEvaluation",$scope.pData.evaObj.EVALDATETIME1||($scope.pData.evaObj.EVALDATETIME1=new Date(new Date).Format("yyyy-MM-dd hh:mm:ss")),console.error($scope.pData.imagepath);var row=new formatAmSqlupdateRow;if(row.addColumn("ORDERID",$scope.pData.evaObj.ORDERID),row.addColumn("MEMBERID",$scope.pData.evaObj.MEMBERID),row.addColumn("STARVALUE",$scope.pData.evaObj.STARVALUE),row.addColumn("CONTENT1",$scope.pData.evaObj.CONTENT1),row.addColumn("EVALDATETIME1",$scope.pData.evaObj.EVALDATETIME1),row.addColumn("ISANONYMOUS",$scope.pData.evaObj.ISANONYMOUS),row.addColumn("IS_SHOW_IMAGE",$scope.pData.is_show_image),row.addColumn("EVAL_IMAGES",$scope.pData.imagepath),row.setID($scope.pData.evaObj.ID),row.setStatus("i"),params.addRow(row),(""==$scope.pData.evaObj.CONTENT1||$scope.pData.evaObj.CONTENT1.length<1)&&"8"==$scope.pData.orderState)toolsService.showMessage("评论内容不能为空",1200);else{var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"===data.CODE&&(toolsService.showMessage("评论成功!"),$scope.changeOrderState($scope.pData.evaObj.ORDERID,"8"),OrderService.evalOrderProcess($scope.pData.evaObj.ID,memberId,"",function(data){}))})}}$scope.pData={orderid:JSON.parse($state.params.params).orderid,star_level:0,icon:"ion-ios-circle-outline",showdiv:!1,content:"",time:"",rememberstate:!1,content1:"",time1:"",evaObj:{ID:toolsService.uuid(),ORDERID:JSON.parse($state.params.params).orderid,MEMBERID:Authen.getUserId(),STARVALUE:1,CONTENT1:"",EVALDATETIME1:"",ISANONYMOUS:"",CONTENT2:"",EVALDATETIME2:""},orderState:JSON.parse($state.params.params).orderState,inputstatus:!1,star_state:"e",inputData:[],imagepath:"",is_show_image:"0",isDerive:appConfig.isDerive,imgArray:[]};var memberId=Authen.getUserId();$scope.changeOrderState=function(orderid,state){ajaxManager.ajaxToJson(actionManagerService.MyOrderConfirreceipt(orderid,state,""),function(data){0==data.ERRCODE?$state.go("member.myorder",{},{location:"replace"}):toolsService.showMessage(data.MSG)})},$scope["delete"]=function(value){$ionicPopup.show({title:"确认删除",template:"确认删除选中的图片?",scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>确认</b>",type:"btn1",onTap:function(){for(var i=(JSON.stringify(value),0);i<$scope.pData.inputData.length;i++)$scope.pData.imagepath=$scope.pData.imagepath.replace(","+value,""),$scope.pData.imagepath=$scope.pData.imagepath.replace(value,""),console.debug($scope.pData.imagepath),$scope.pData.inputData[i]==value&&$scope.pData.inputData.splice(i,1)}}]})},$scope.save=function(isEdit){if("8"==$scope.pData.orderState){for(var uploadData=[],dataId=$scope.pData.evaObj.ID,i=0;i<$scope.pData.inputData.length;i++){var item=$scope.pData.inputData[i];"image"==item.type&&uploadData.push({type:"file",data:{fileName:item.fileName,mimeType:item.mimeType,type:item.type,file:item.file,savePath:"files//MALL_COMMODITYORDEREVALUATION//"+dataId+"//bdp_eval_images"}})}uploadData.length>0?($scope.pData.is_show_image="1",FileAccess.asUpload(uploadData,function(files){var imagepath=toolsService.fileJsonreturnstr(files,"image");$scope.pData.imagepath&&$scope.pData.imagepath.length>1?$scope.pData.imagepath+=","+imagepath:$scope.pData.imagepath=imagepath,processSave(isEdit)},null,null,"n_space")):($scope.pData.is_show_image="0",processSave(isEdit))}},$scope.isHistoryShow=function(isAddEval){isAddEval&&($scope.pData.showdiv=!0,$scope.save(!0));var rData=actionManagerService.excuteResource("queryorderevaluation",{orderid:$scope.pData.orderid},"","");ajaxManager.ajaxToJson(rData,function(data){if(data&&data.DATA&&data.DATA.length>0){var rs=data.DATA[0];$scope.pData.content=rs.CONTENT1,$scope.pData.time=rs.EVALDATETIME1,$scope.pData.star_level=rs.STARVALUE,$scope.pData.evaObj.ID=rs.ID,$scope.pData.evaObj.EVALDATETIME1=rs.EVALDATETIME1,$scope.pData.evaObj.STARVALUE=rs.STARVALUE,rs.EVAL_IMAGES&&($scope.pData.inputData=rs.EVAL_IMAGES.split(",")),"1"===rs.ISANONYMOUS&&($scope.pData.icon="ion-ios-checkmark-outline",$scope.pData.rememberstate=!0)}})},$scope.isNewShow=function(){$scope.pData.evaObj.EVALDATETIME1=$scope.pData.time,$scope.pData.evaObj.STARVALUE=$scope.pData.star_level,$scope.save(!1)},$scope.formatDateTime=function(date){var y=date.getFullYear(),m=date.getMonth()+1;m=10>m?"0"+m:m;var d=date.getDate();d=10>d?"0"+d:d;var h=date.getHours(),minute=date.getMinutes();return minute=10>minute?"0"+minute:minute,y+"-"+m+"-"+d+" "+h+":"+minute},$scope.checkisanonymous=function(){"1"==$scope.pData.orderState&&($scope.pData.rememberstate?($scope.pData.rememberstate=!1,$scope.pData.icon="ion-ios-circle-outline"):($scope.pData.rememberstate=!0,$scope.pData.icon="ion-ios-checkmark-outline"))},$scope.pData.time=$scope.formatDateTime(new Date),$scope.pData.time1=$scope.formatDateTime(new Date),$scope.saveevaluate=function(){var rData=actionManagerService.excuteResource("whethercomment",{orderid:$scope.pData.orderid},"","");ajaxManager.ajaxToJson(rData,function(data){1==data.DATA[0].COUNT?$scope.isHistoryShow(!0):$scope.isNewShow()})},$scope.init=function(){console.error($scope.pData.orderState),"8"!=$scope.pData.orderState&&($scope.pData.showdiv=!0,$scope.pData.star_state="s",$scope.pData.inputstatus=!0,$scope.isHistoryShow(!0))},$scope.init(),$scope.upload=function(file){var rData=actionManagerService.uploadFileAction(file,"image","files/MALL_COMMODITYORDEREVALUATION/"+$scope.pData.evaObj.ID+"/bdp_eval_images");Upload.upload(rData).then(function(resp){$scope.CommentImgUrl="/"+resp.data.NET_FILE_PATH,console.debug($scope.CommentImgUrl),"/undefined"!=$scope.CommentImgUrl&&($scope.pData.inputData.push({type:"file",data:$scope.CommentImgUrl}),console.debug("inputData="+$scope.pData.inputData[0].data),$scope.pData.imagepath&&$scope.pData.imagepath.length>1?$scope.pData.imagepath+=","+$scope.CommentImgUrl:$scope.pData.imagepath=$scope.CommentImgUrl)},function(resp){},function(evt){})}}]),angular.module("mallMobileApp.controllers").controller("OrderDistCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen","OrderService","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen,OrderService,$ionicPopup){$scope.pData={resourceCode:"getWaitRecvOrders",resPrams:{memberId:""},listEvents:{},OrderShippingMethodEnum:{1:"即时送货",2:"预约送货"}};var memberId=Authen.getUserId();$scope.pData.resPrams={memberId:memberId};var orderStateEnum={};OrderService.getOrderStateEnum(function(data){orderStateEnum=data}),$scope.rightOne=function(){$state.go("member.MyOrderRecvList")},$scope.pData.listEvents={OrderShippingMethodEnum:$scope.pData.OrderShippingMethodEnum,recvOrder:function(orderId){var urlParams={orderId:orderId};$state.go("member.OrderDistDeatils",{params:JSON.stringify(urlParams)})},refuseOrder:function(orderId){$scope.refuseOrderPop(orderId)},OrderStateEnum:orderStateEnum};var confirmPopup={};$scope.refuseOrderPop=function(orderId){confirmPopup=$ionicPopup.confirm({title:"<h3>拒绝接单确认</h3>",template:"您确认拒绝接单吗？",buttons:[{text:"取消",type:"btnc",onTap:function(){}},{text:"确定",type:"btn1",onTap:function(){OrderService.refuseOrder(orderId,function(data){0==data.CODE?(toolsService.showMessage(data.MSG,1800),$state.reload()):toolsService.showMessage(data.MSG,1800)})}}]})}}]),angular.module("mallMobileApp.controllers").controller("OrderDistDeatilsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen","OrderService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen,OrderService){$scope.pData={orderId:JSON.parse($state.params.params).orderId,orderInfo:{},tabnumber:0,OrderShippingMethodEnum:{1:"即时送货",2:"预约送货"},orderStateEnum:{},showOperation:!0,title:"配送接单详情"},OrderService.getOrderStateEnum(function(data){$scope.pData.orderStateEnum=data}),$scope.init=function(){JSON.parse($state.params.params).showOperation&&($scope.pData.showOperation=!1),console.error($scope.pData.showOperation),OrderService.getOrderDetailsByNet($scope.pData.orderId,function(data){$scope.pData.orderInfo=data})},$scope.confirmRecvOrder=function(){OrderService.recvOrder($scope.pData.orderInfo.ID),$state.go("member.OrderDistList",{},{location:"replace",reload:!0})},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("member.MyOrderRecvList",{url:"/MyOrderRecvList",cache:!1,intcude:"member.MyOrderRecvList",intName:"配送人员我的接单",views:{member_view:{templateUrl:"app_plugins/mall/order/order_dist/views/order_dist_my_recv_page.html",controller:"MyOrderRecvListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MyOrderRecvListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen","OrderService","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen,OrderService,$ionicPopup){$scope.pData={myRecvOrders:"getRecvOrderByMemberId",resParams:"",comdSelectCards:[],listEvents:{},releasePasswd:"",orderStateEnum:[],currentPoint:{},OrderShippingMethodEnum:{1:"即时送货",2:"预约送货"}},OrderService.getOrderStateEnum(function(data){$scope.pData.orderStateEnum=data,console.debug($scope.pData.orderStateEnum)});var memberId=Authen.getUserId();$scope.pData.resParams={memberId:memberId,extWhereSQL:""};var currentIndex=0;$scope.pData.comdSelectCards=[{title:"全部",WHERESQL:"",CSS:"cm_select_item_active",show:!0,style:"color:#33cd5f;"},{title:"未配送",WHERESQL:" AND  od.orderState IN ('403') ",CSS:"cm_select_item",show:!1,style:""},{title:"已放货",WHERESQL:" AND  od.orderState IN ('404') ",CSS:"cm_select_item",show:!1,style:""},{title:"已收货",WHERESQL:" AND  od.orderState IN ('5','8','81') ",CSS:"cm_select_item",show:!1,style:""}],$scope.selectCards=function(index){$scope.pData.comdSelectCards[index].CSS="cm_select_item_active",$scope.pData.comdSelectCards[index].style="color:#33cd5f;",
$scope.pData.comdSelectCards[index].show=!0,$scope.pData.comdSelectCards[currentIndex].CSS="cm_select_item",$scope.pData.comdSelectCards[currentIndex].style="",$scope.pData.comdSelectCards[currentIndex].show=!1,$scope.pData.resParams.extWhereSQL=$scope.pData.comdSelectCards[index].WHERESQL,currentIndex=index};var confirmReleasePop=function(orderId){$ionicPopup.confirm({template:'<input type="password" ng-model="pData.releasePasswd">',title:"请输入放货密码",scope:$scope,buttons:[{text:"<b>取消</b>",type:"btnc"},{text:"<b>确定</b>",type:"btn1",onTap:function(e){$scope.pData.releasePasswd?OrderService.distOrderRelease($scope.pData.releasePasswd,orderId,function(data){$state.reload()}):e.preventDefault()}}]})};$scope.pData.listEvents={OrderShippingMethodEnum:$scope.pData.OrderShippingMethodEnum,release:function(orderId){confirmReleasePop(orderId)},navigate:function(orderId){console.error("导航")},itemOnClick:function(orderId){var routeParam={orderId:orderId,showOperation:"false"};$state.go("member.OrderDistDeatils",{params:JSON.stringify(routeParam)})},OrderStateEnum:$scope.pData.orderStateEnum,currentPoint:{lng:Authen.getBMUserLocation().currentPoint.lng,lat:Authen.getBMUserLocation().currentPoint.lat}}}]),angular.module("mallMobileApp.controllers").controller("orderCommetCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService){$scope.pData={cid:$state.params.cid,commentall:"title_select",commentpraise:"",commentmediumreview:"",commentbad:"",allnumber:0,praisenumber:0,mediumreview:0,badnumber:0,conditionparameter:"",showviewSQL:"commoditycomment",SQLparams:{orderid:$state.params.cid,conditionparameter:"1=1"}},$scope.init=function(){var rData=actionManagerService.excuteResource("reviewstatistics",{commid:$scope.pData.cid},"","");ajaxManager.ajaxToJson(rData,function(data){$scope.pData.allnumber=data.DATA[0].ALLNUMBER,$scope.pData.praisenumber=data.DATA[0].PRAISENUMBER,$scope.pData.mediumreview=data.DATA[0].MEDIUMREVIEW,$scope.pData.badnumber=data.DATA[0].BADNUMBER})},$scope.parameterassembly=function(){$scope.pData.SQLparams={orderid:$scope.pData.cid,conditionparameter:$scope.pData.conditionparameter}},$scope.select=function(choice){"all"==choice?""==$scope.pData.commentall&&($scope.pData.commentall="title_select",$scope.pData.commentpraise="",$scope.pData.commentmediumreview="",$scope.pData.commentbad="",$scope.pData.conditionparameter="1=1",$scope.parameterassembly()):"praise"==choice?""==$scope.pData.commentpraise&&($scope.pData.commentall="",$scope.pData.commentpraise="title_select",$scope.pData.commentmediumreview="",$scope.pData.commentbad="",$scope.pData.conditionparameter="mcoe.StarValue >= 5",$scope.parameterassembly()):"mediumreview"==choice?""==$scope.pData.commentmediumreview&&($scope.pData.commentall="",$scope.pData.commentpraise="",$scope.pData.commentmediumreview="title_select",$scope.pData.commentbad="",$scope.pData.conditionparameter="mcoe.StarValue between 3 and 4",$scope.parameterassembly()):""==$scope.pData.commentbad&&($scope.pData.commentall="",$scope.pData.commentpraise="",$scope.pData.commentmediumreview="",$scope.pData.commentbad="title_select",$scope.pData.conditionparameter="mcoe.StarValue <= 2",$scope.parameterassembly())},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("returnRequestCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen){$scope.pData={orderid:JSON.parse($state.params.params).orderid,returngoodsstuts:"",refundamount:0,actualrefundamount:0,refundreason:"",refundnumber:"",refundapplicationtime:new Date,refundtime:new Date,refund:{ID:toolsService.uuid(),ORDERID:"",STATE:"1",REFUNDCODE:"",APPLYTIME:"",APPLYREASON:"",APPLYREFUNDMENOY:"0"},showdiv:!1,textreadonly:!1,textinforeadonly:!1},$scope.saveRefund=function(){var params=new formatAmSqlParams;params.TABLENAME="mall_refund";var row=new formatAmSqlupdateRow;row.setID($scope.pData.refund.ID),row.addColumn("orderid",$scope.pData.refund.ORDERID),row.addColumn("state",$scope.pData.refund.STATE),row.addColumn("refundcode",$scope.pData.refund.REFUNDCODE),row.addColumn("applytime",$scope.pData.refund.APPLYTIME),row.addColumn("applyreason",$scope.pData.refund.APPLYREASON),row.addColumn("applyrefundmenoy",$scope.pData.refund.APPLYREFUNDMENOY),row.setStatus("i"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);console.error(JSON.stringify(rData)),ajaxManager.ajaxToJson(rData,function(data){if(toolsService.showMessage("退货申请提交成功!","1"),console.info(JSON.stringify(data)),"0"===data.CODE){console.error("退货");var rData1=actionManagerService.MyOrderConfirreceipt($scope.pData.refund.ORDERID,"5","502");ajaxManager.ajaxToJson(rData1,function(data){$state.go("member.myorder",{},{location:"replace"})})}})},$scope.addRefundShow=function(refund){$scope.pData.returngoodsstuts="申请退款",$scope.pData.refundnumber=refund.REFUNDCODE,$scope.pData.refundreason="",$scope.pData.refundapplicationtime=refund.APPLYTIME},$scope.formatDateTime=function(date){var y=date.getFullYear(),m=date.getMonth()+1;m=10>m?"0"+m:m;var d=date.getDate();d=10>d?"0"+d:d;var h=date.getHours(),minute=date.getMinutes();return minute=10>minute?"0"+minute:minute,y+"-"+m+"-"+d+" "+h+":"+minute},$scope.getRefundStatus=function(index){var statusList=new Array("","申请退款","退款审核通过","退款申请失败","退款完成");return statusList[index]},$scope.init=function(){var rData=actionManagerService.excuteResource("mall_refund_query",{orderid:$scope.pData.orderid},"",""),date=new Date;ajaxManager.ajaxToJson(rData,function(data){var refundCode=(data.DATA[0],date.getTime()),time=$scope.formatDateTime(date);if(0==data.DATA[0].COUNT){$scope.pData.refund.ORDERID=$scope.pData.orderid,$scope.pData.refund.REFUNDCODE=refundCode,$scope.pData.refund.APPLYTIME=time,$scope.addRefundShow($scope.pData.refund);var rData=actionManagerService.excuteResource("checkpaymentamount",{orderid:$scope.pData.orderid},"","");ajaxManager.ajaxToJson(rData,function(data){data.DATA.length>0&&($scope.pData.refundamount=data.DATA[0].TOTALPRICE)})}else{$scope.pData.showdiv=!0,$scope.pData.textinforeadonly=!0;var rData=actionManagerService.excuteResource("backorderselect",{orderid:$scope.pData.orderid},"","");ajaxManager.ajaxToJson(rData,function(data){var rs=data.DATA[0],deductcost=void 0===rs.DEDUCTCOST||""===rs.DEDUCTCOST||null==rs.DEDUCTCOST?0:rs.DEDUCTCOST;$scope.pData.returngoodsstuts=$scope.getRefundStatus(parseInt(rs.STATE)),$scope.pData.refundamount=rs.APPLYREFUNDMENOY,$scope.pData.actualrefundamount=rs.REALREFUNDMENOY,$scope.pData.deductcost="扣除运费"+deductcost+"元",$scope.pData.refundtime=rs.REFUNDTIME,$scope.pData.refundreason=rs.APPLYREASON,$scope.pData.refundnumber=rs.REFUNDCODE,$scope.pData.refundapplicationtime=rs.APPLYTIME})}})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("MallPaymentCtrl",["$scope","commdityService","Authen","actionManagerService","ajaxManager","$state","$ionicModal","$ionicBackdrop","$timeout","toolsService","$ionicPopup",function($scope,commdityService,Authen,actionManagerService,ajaxManager,$state,$ionicModal,$ionicBackdrop,$timeout,toolsService,$ionicPopup){function toPayment(data){var uuid=toolsService.uuid().toUpperCase();uuid=uuid.replace(/-/g,"");var params={title:"商品支付",out_account_code:accountStr,in_account_code:"",out_remakes:data.COMDITYNAME,in_remakes:"",pay_money:data.PAYMONEY,business:{payment_id:uuid,memberid:memberId,orders:data.ORDERS,paymoney:data.PAYMONEY,success_call_back:"com.am.frame.order.process.OrderBusinessCallBack"},success_url:"member.paymentOrder",lost_url:"member.paymentOrder",pay_id:uuid,pay_type:"1",pay_type_name:"支付"};$state.go("common.payment",{params:JSON.stringify(params)},{location:"replace"})}$scope.pData={title:"确认支付",recvAddres:{},shopInfo:[],paymentTotal:0,actualBuyNumber:1,memberAddresList:[],coupList:[],currentCoup:"none",coupNone:{CSS:"ion-ios-checkmark-outline"},coupMeny:0,shippingMethodDataSet:[{name:"即时送货",value:"1"},{name:"预约送货",value:"2"}],shippingMethod:1,bespeakTime:"",orderBespeakMinLimitDate:7,showOrderMsg:!1},$scope.featureData=[],$scope.expectArrivalTime="",$scope.expectArrivalTimeList=[{name:"1点前",value:"01:00:00"},{name:"2点前",value:"02:00:00"},{name:"3点前",value:"03:00:00"},{name:"4点前",value:"04:00:00"},{name:"5点前",value:"05:00:00"},{name:"6点前",value:"06:00:00"},{name:"7点前",value:"07:00:00"},{name:"8点前",value:"08:00:00"},{name:"9点前",value:"09:00:00"},{name:"10点前",value:"10:00:00"},{name:"11点前",value:"11:00:00"},{name:"12点前",value:"12:00:00"},{name:"13点前",value:"13:00:00"},{name:"14点前",value:"14:00:00"},{name:"15点前",value:"15:00:00"},{name:"16点前",value:"16:00:00"},{name:"17点前",value:"17:00:00"},{name:"18点前",value:"18:00:00"},{name:"19点前",value:"19:00:00"},{name:"20点前",value:"20:00:00"},{name:"21点前",value:"21:00:00"},{name:"22点前",value:"22:00:00"},{name:"23点前",value:"23:00:00"},{name:"24点前",value:"24:00:00"}],$scope.orderData={contact:"",contactPhone:"",expectArrivalTime:"",groupOrderInfo:[{vname:"",identity_code:"",contactPhone:""}],vesterNumber:1,childeDataShow:!0},$scope.switchChildeData=function(){$scope.orderData.childeDataShow=!$scope.orderData.childeDataShow};var memberId=Authen.getUserId(),params=JSON.parse($state.params.params),source=params.source;$scope.pData.recvAddres=commdityService.getMemberAddresBymId(memberId,function(data){$scope.pData.memberAddresList=data,$scope.pData.recvAddres=$scope.pData.memberAddresList[0]}),$scope.switchShowOrderMsg=function(){$scope.pData.showOrderMsg=!$scope.pData.showOrderMsg},$scope.pData.shopInfo=commdityService.getPaymentCommdityInfo(memberId,source,function(data){$scope.featureData=data,$scope.pData.orderMsg=data["预订须知"].CONTENT,$scope.pData.shopInfo[0].MALL_CLASS=data.COMD_INFO.MALL_CLASS,$scope.pData.shopInfo[0].VALIDITY_DATE_START=data.COMD_INFO.VALIDITY_DATE_START,$scope.pData.shopInfo[0].VALIDITY_DATE_START=data.COMD_INFO.VALIDITY_DATE_END});var accountStr="";if(console.error($scope.pData.shopInfo),$scope.pData.shopInfo&&$scope.pData.shopInfo.length>0){var rData=actionManagerService.excuteResource("com.am.commodity.ComdPayAccountInfo",{psid:$scope.pData.shopInfo[0].payMeoth},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(data.DATA)for(var i=0;i<data.DATA.length;i++)accountStr+=data.DATA[i].SA_CODE+","})}var rData=actionManagerService.excuteResource("get_avar_info",{vid:"order_bespeak_min_limit_date"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pData.orderBespeakMinLimitDate=data.DATA[0].VVALUE)});var sumPaymentTotal=function(){$scope.pData.paymentTotal=0;for(var i=0;i<$scope.pData.shopInfo.length;i++)$scope.pData.shopInfo[i].calcPaymentMoney(),$scope.pData.paymentTotal+=$scope.pData.shopInfo[i].totalPaymentMoney;$scope.pData.paymentTotal>$scope.pData.coupMeny&&($scope.pData.paymentTotal=$scope.pData.paymentTotal-$scope.pData.coupMeny),console.debug("$scope.pData.paymentTotal:"+$scope.pData.paymentTotal),console.debug("$scope.pData.paymentTotal:"+$scope.pData.coupMeny)};$scope.calcPayment=function(step){$timeout(function(){sumPaymentTotal()},600),step>0&&($scope.orderData.groupOrderInfo.push({vname:"",identity_code:"",contactPhone:""}),$scope.orderData.vesterNumber++),0>step&&($scope.orderData.groupOrderInfo.pop(),$scope.orderData.vesterNumber--)},$scope.$watchCollection("pData.shopInfo",function(){console.debug("$scope.$watchCollection(pData.shopInfo)"),console.error($scope.pData.shopInfo),sumPaymentTotal()}),$scope.$watch("pData.coupMeny",function(){sumPaymentTotal()}),$ionicModal.fromTemplateUrl("select-address-modal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal}),$scope.openModal=function(){$scope.modal.show(),$ionicBackdrop.retain()},$scope.closeModal=function(){$ionicBackdrop.release(),$scope.modal.hide()},$scope.selectRecvAddres=function(){$scope.openModal()},$scope.toAddres=function(){$scope.closeSelectAddClick(),console.error($state.params);var params={routeType:"ORDER",stateName:"payment.comdConfirmPayment",state:JSON.stringify($state.params)};$state.go("member.addaddr",{params:JSON.stringify(params)})},$scope.closeSelectAddClick=function(){$scope.closeModal()},$scope.selectAddres=function(index){$scope.pData.recvAddres=$scope.pData.memberAddresList[index],$scope.closeSelectAddClick()},commdityService.getMemberCoupByMemberId(memberId,function(data){for(var i=0;i<data.length;i++)data[i].SELECTED=!1,data[i].CSS="ion-ios-circle-outline";$scope.pData.coupList=data}),$scope.changeCurrentCoup=function(index){if(-1!=index){if($scope.pData.paymentTotal<=$scope.pData.coupList[index].CASH)return toolsService.showMessage("无法使用此优惠券!",1200),void($scope.pData.coupMeny=new Number(0));$scope.pData.coupNone.CSS="ion-ios-circle-outline";for(var i=0;i<$scope.pData.coupList.length;i++)0==$scope.pData.coupList[i].SELECTED,$scope.pData.coupList[i].CSS="ion-ios-circle-outline";$scope.pData.currentCoup=$scope.pData.coupList[index],$scope.pData.coupList[index].CSS="ion-ios-checkmark-outline"}else{for(var i=0;i<$scope.pData.coupList.length;i++)0==$scope.pData.coupList[i].SELECTED,$scope.pData.coupList[i].CSS="ion-ios-circle-outline";$scope.pData.currentCoup="none",$scope.pData.coupNone.CSS="ion-ios-checkmark-outline"}"none"!=$scope.pData.currentCoup?$scope.pData.coupMeny=new Number($scope.pData.currentCoup.CASH):$scope.pData.coupMeny=new Number(0)};var builderPaymentShowMsg=function(data){var buyNumber=1;$scope.pData.shopInfo[0].buyNumber&&(buyNumber=$scope.pData.shopInfo[0].buyNumber);var tempTemplate=' <div class="row" style="color:#999999;">                    <div class="col">                      <span>'+$scope.pData.shopInfo[0].name+"</span>                    </div>                  </div>";if("5"==$scope.pData.shopInfo[0].MALL_CLASS){for(var itmeName="",i=0;i<$scope.pData.shopInfo.length;i++)itmeName+="<span>"+$scope.pData.shopInfo[i].name+"</span>&nbsp;*&nbsp;<span>"+$scope.pData.shopInfo[i].buyNumber+"</span>&nbsp;&nbsp;&nbsp;&nbsp;<span>￥<span>"+new Number($scope.pData.shopInfo[i].fPrice).toFixed(2)+"</span><br>";tempTemplate='<div class="row" style="color:#000000;"><div class="col">'+itmeName+"</div></div>"}return"6"==$scope.pData.shopInfo[0].MALL_CLASS&&(tempTemplate='<div class="row"><div class="col" style="color:#000000;">车型:<i>'+$scope.featureData.COMD_INFO.CARTYPENAME+'</i></div><div class="col" style="color:#666666;">由<i>'+$scope.featureData.COMD_INFO.STORE_NAME+"</i> 提供</div></div>"),"8"==$scope.pData.shopInfo[0].MALL_CLASS&&(tempTemplate+=' <div class="row">		        <div class="col">		          <span>成人×		          <i >'+$scope.pData.shopInfo[0].buyNumber+"</i></span>		          &nbsp;&nbsp;&nbsp;&nbsp;		          <span >儿童×<i >"+$scope.pData.shopInfo[0].childBuyNumber+"</i></span>		        </div>		      </div>"),tempTemplate};$scope.confirmToPayment=function(){for(var i=0;i<$scope.pData.shopInfo.length;i++)if(0==$scope.pData.shopInfo[i].buyNumber)return void $scope.buyNumberTips("plugError");var paymentShowMsg=({totalPaymentMoney:$scope.pData.paymentTotal},builderPaymentShowMsg()),curentCoupId="";$scope.pData.currentCoup&&$scope.pData.currentCoup.ID&&(curentCoupId=$scope.pData.currentCoup.ID);var vadResult=commdityService.orderValidate($scope.pData.shopInfo,$scope.orderData,memberId);if(vadResult)return void toolsService.tips(vadResult,1500);if("5"!=$scope.pData.shopInfo[0].MALL_CLASS||$scope.pData.recvAddres){if(2==$scope.pData.shippingMethod){if(console.error($scope.pData.bespeakTime),!$scope.pData.bespeakTime||""==$scope.pData.bespeakTime)return void toolsService.showMessage("预约日期不能为空！",1800);var bespeakTime=new Date($scope.pData.bespeakTime).getTime(),now=(new Date).getTime();if(bespeakTime<now+1e3*new Number($scope.pData.orderBespeakMinLimitDate)*60*60*24){var msg="预约送货日期不正确。";return 0==$scope.pData.orderBespeakMinLimitDate||(msg+="预约日期最快应该是当前日期"+$scope.pData.orderBespeakMinLimitDate+"天之后。"),void toolsService.showMessage(msg,1800)}}var dateStr=new Date($scope.pData.bespeakTime).toLocaleString(),submitBespeakTime=dateStr.substring(0,dateStr.indexOf(" ")).replace(/\//g,"-"),addressId="";$scope.pData.recvAddres&&$scope.pData.recvAddres.ID&&(addressId=$scope.pData.recvAddres.ID),$scope.pData.shippingMethod||($scope.pData.shippingMethod="1"),commdityService.submitComdOrder(memberId,addressId,curentCoupId,$scope.pData.paymentTotal,$scope.pData.shopInfo,$scope.pData.shippingMethod,submitBespeakTime,function(data){0==data.ERRCODE&&toPayment(data)},$scope.orderData,paymentShowMsg)}else{$ionicPopup.confirm({title:'<span style="font-size:13px;color:#333333;">提示</span>',template:'<p class="CM" style="font-size:12px;color:#333333;">			 您还没有设置收获地址，请点击这里设置</p>',buttons:[{text:'<span style="font-size:14px;color:#0093fe;">取&nbsp;消</span>',type:"btnc"},{text:'<span style="font-size:14px;color:#0093fe;">确&nbsp;定</span>',type:"btn1",onTap:function(){$scope.toAddres()}}]})}},$scope.buyNumberTips=function(code){var tipsMsg="车辆不足";"plugError"==code&&("2"==$scope.pData.shopInfo[0].MALL_CLASS&&(tipsMsg="房间不足！"),toolsService.showMessage(tipsMsg,1200))}}]),angular.module("mallMobileApp.controllers").controller("SelectRecvAddres",["$scope","commdityService","Authen","actionManagerService","ajaxManager","$state","$rootScope",function($scope,commdityService,Authen,actionManagerService,ajaxManager,$state,$rootScope){$scope.pData={recvAddress:{}};var memberId=Authen.getUserId(),params={memberid:memberId},queryParams=actionManagerService.excuteResource("address",params,"none","none");ajaxManager.ajaxToJson(queryParams,function(data,header,config,status){if(data&&data.DATA){for(var i=0;i<data.DATA.length;i++)data.DATA[i].SELECTED=!1;$scope.pData.recvAddress=data.DATA}}),$scope.selectAddres=function(addres){var recvAddr=JSON.parse(addres);commdityService.saveRecvAddres(recvAddr),$rootScope.$broadcast("selectRecvAddres",{}),$state.go("payment.comdConfirmPayment",{},{location:"replace"})}}]),angular.module("mallMobileApp.services").service("commdityService",["toolsService","Authen","actionManagerService","ajaxManager","appConfig",function(toolsService,Authen,actionManagerService,ajaxManager,appConfig){var getOrderCode=function(){return str=toolsService.uuid().toUpperCase().replace(/-/g,""),str},PaymentCommodity=function(orderCode){this.memberId="",this.id="",this.name="",this.discount=1,this.orderstateid="",this.price=0,this.listimage=0,this.fid="",this.fname="",this.specImages="",this.fPrice=0,this.explain="",this.buyNumber=1,this.childBuyNumber=0,this.totalPaymentMoney=0,this.orderId="",this.postage=0,this.recvAddres={},this.supportPaymentMode="",this.orderCode=orderCode,this.createTime=(new Date).getTime(),this.shippingMethod="",this.BUYERS_MESSAGE="",this.expectArrivalTime="",this.startDate="",this.endDate=""};PaymentCommodity.prototype.calcPaymentMoney=function(){if(this.stock<1&&(this.buyNumber=0),this.totalPaymentMoney=this.fPrice*this.buyNumber,this.childBuyNumber>0&&(this.totalPaymentMoney+=this.childPrice*this.childBuyNumber),this.endDate&&this.startDate){var days=new Number((new CalendarManager).DateDiff(new Date(this.endDate).toString(),new Date(this.startDate).toString()));this.totalPaymentMoney=this.totalPaymentMoney*days}},PaymentCommodity.prototype.setRecvAddres=function(recvAddres){this.recvAddres=recvAddres};var OrderItem=function(){this.COMMODITYID="",this.SPECIFICATIONSID="",this.ORDERCODE="",this.SALEPRICE="",this.SCALENUMBER="",this.POSTAGE="",this.SALENUMBER="",this.TOTALPRICE="",this.PAYMENTTYPE="",this.COMMODNAME=""};OrderItem.prototype.payComdItemToOrderItem=function(payItem){this.COMMODITYID=payItem.id,this.SPECIFICATIONSID=payItem.fid,void 0!=payItem.discount&&payItem.discount&&""!=payItem.discount||(payItem.discount=1),console.debug("payItem.discount:"+payItem.discount),this.SCALENUMBER=payItem.buyNumber,this.POSTAGE=payItem.postage,this.SALENUMBER=payItem.buyNumber,this.CHILDBUYNUMBER=payItem.childBuyNumber,this.TOTALPRICE=payItem.totalPaymentMoney,this.PAYMENTTYPE="",this.ORDERCODE=payItem.orderCode,this.COMMODNAME=payItem.name,this.SHIPPING_METHOD=payItem.shippingMethod,this.BESPEAKTIME="",this.BUYERS_MESSAGE=payItem.BUYERS_MESSAGE,payItem.startDate?this.START_DATE=payItem.startDate:this.START_DATE="",payItem.endDate?this.END_DATE=payItem.endDate:this.END_DATE="",""==this.END_DATE&&""==this.START_DATE&&(this.START_DATE=payItem.dates),payItem.expectArrivalTime?this.EXPECT_ARRIVAL_TIME=payItem.expectArrivalTime.value:this.EXPECT_ARRIVAL_TIME="",this.SALEPRICE=payItem.fPrice,this.CHILDPRICE=payItem.childPrice,this.CHILDBUYNUMBER&&(this.SALENUMBER=payItem.buyNumber+this.CHILDBUYNUMBER)};var SubmitOrderInfo=function(){this.ORDERACTION="order",this.PID="",this.MEMBERID="",this.RECVADDRESS="",this.ORGCODE="",this.ELECTTICKID="",this.PAYMENT="",this.COMMODITINFO=new Array,this.SHIPPING_METHOD=1,this.BESPEAKTIME=""};SubmitOrderInfo.prototype.addOrderItem=function(orderItem){this.COMMODITINFO.push(orderItem)};var addShopCard=function(memberId,commdityInfo,formatInfo,buyNumber,action,orderCode){var id=toolsService.uuid().toUpperCase().replace(/-/g,"");orderCode||(orderCode=getOrderCode());var params=new formatAmSqlParams;params.TABLENAME="mall_MemberOrder";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("i"),row.addColumn("OrderCode",orderCode),row.addColumn("MEMBERID",memberId),row.addColumn("CommodityID",commdityInfo.ID),row.addColumn("SPECNAME",formatInfo.NAME),row.addColumn("ORDERSTATE","1");var salePrice=formatInfo.PRICE;row.addColumn("SALEPRICE",salePrice+""),row.addColumn("SPECPRICE",formatInfo.PRICE+""),row.addColumn("SALENUMBER",buyNumber+""),row.addColumn("POSTAGE",formatInfo.POSTAGE),row.addColumn("SPECID",formatInfo.ID),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){action||toolsService.showMessage("加入购物车成功",2)})},saveShopInfoToPayment=function(memberId,commdityInfo,formatInfo,buyNumber,extendData){memberId=memberId;var key="shopInfo";if(localStorage.removeItem(key),!commdityInfo||!formatInfo)return void console.debug("商品信息或规格信息不正确");var orderCode=getOrderCode(),shopInfo={memberId:memberId,commdityInfo:commdityInfo,formatInfo:formatInfo,buyNumber:buyNumber,orderCode:orderCode,groupInfo:[],createTime:(new Date).getTime()};extendData&&(extendData instanceof Array?shopInfo.groupInfo=extendData:(extendData&&extendData.startDate&&(shopInfo.startDate=extendData.startDate,shopInfo.commdityInfo.startDate=extendData.startDate),extendData&&extendData.endDate&&(shopInfo.endDate=extendData.endDate,shopInfo.commdityInfo.endDate=extendData.endDate))),localStorage.setItem(key,JSON.stringify(shopInfo)),addShopCard(memberId,commdityInfo,formatInfo,buyNumber,!0,orderCode)},getPaymentShopInfo=function(memberId){var key="shopInfo",data=localStorage.getItem(key),result=null;if(data)try{result=JSON.parse(data)}catch(e){console&&console.error(e)}return result},memberRecvAddres=null,saveRecvAddres=function(saveRecvAddres){memberRecvAddres=saveRecvAddres},getRecvAddres=function(memberId){if(!memberRecvAddres){var params={memberid:memberId},queryParams=actionManagerService.excuteResource("address",params,"none","none");ajaxManager.ajaxTosyc(queryParams,function(data,header,config,status){data&&data.DATA&&(memberRecvAddres=data.DATA[0])})}return memberRecvAddres},memberShopCardPayments={},saveShopCardPayments=function(orders){memberShopCardPayments=orders},getShopCardPayments=function(){return memberShopCardPayments},getMemberAddresBymId=function(memberId,callFun){var params={memberid:memberId},queryParams=actionManagerService.excuteResource("address",params,"none","none");ajaxManager.ajaxToJson(queryParams,function(data,header,config,status){if(data&&data.DATA){for(var i=0;i<data.DATA.length;i++)data.DATA[i].SELECTED=!1;angular.isFunction(callFun)&&callFun(data.DATA)}})},getMemberCoupByMemberId=function(memberId,callFun){var params={memberid:memberId,usestatus:1},queryParams=actionManagerService.excuteResource("coupon",params,"none","none");ajaxManager.ajaxToJson(queryParams,function(data){data&&data.DATA&&angular.isFunction(callFun)&&callFun(data.DATA)})},getMemberOrderByMemberAndOrders=function(memberId,orderIds,callFun){var result=null;if(orderIds){for(var strs="",i=0;i<orderIds.length;i++)strs+="'"+orderIds[i]+"',";strs+="''";var params={memberid:memberId,orderIds:strs},queryParams=actionManagerService.excuteResource("getMemberOrderComdByOrdes",params,"none","none");ajaxManager.ajaxTosyc(queryParams,function(data,header,config,status){data&&data.DATA&&(result=data.DATA,angular.isFunction(callFun)&&callFun(result))})}return result},getPaymentCommdityInfo=function(memberId,source,callFun){var pcomdsInfo=new Array;if("commodityDetails"==source){var shopInfo=getPaymentShopInfo(memberId);if(shopInfo){var pOrderCode=shopInfo.orderCode,pComdInfo=new PaymentCommodity(pOrderCode);pComdInfo.memberId=shopInfo.memberId,pComdInfo.id=shopInfo.commdityInfo.ID,pComdInfo.name=shopInfo.commdityInfo.NAME,""!=shopInfo.commdityInfo.DISCOUNT&&void 0!=shopInfo.commdityInfo.DISCOUNT&&shopInfo.commdityInfo.DISCOUNT?pComdInfo.discount=shopInfo.commdityInfo.DISCOUNT:pComdInfo.discount=1,pComdInfo.orderstateid=shopInfo.commdityInfo.ORDERSTATEID,pComdInfo.price=shopInfo.commdityInfo.PRICE,pComdInfo.listimage=shopInfo.commdityInfo.LISTIMAGE,pComdInfo.fid=shopInfo.formatInfo.ID,pComdInfo.fname=shopInfo.formatInfo.NAME,pComdInfo.specImages=shopInfo.formatInfo.SPECIMAGES,pComdInfo.fPrice=shopInfo.formatInfo.PRICE,pComdInfo.explain=shopInfo.formatInfo.EXPLAIN,pComdInfo.buyNumber=shopInfo.buyNumber,pComdInfo.orderId="",pComdInfo.postage=0,pComdInfo.supportPaymentMode=shopInfo.commdityInfo.SUPPORTPAYMENTMODE,pComdInfo.payMeoth=shopInfo.commdityInfo.PAY_MEOTH,pComdInfo.scanIn=shopInfo.commdityInfo.MALL_CLASS,pComdInfo.supperReturn=shopInfo.commdityInfo.SUPPER_RETURN,pComdInfo.VALIDITY_DATE_START=shopInfo.commdityInfo.VALIDITY_DATE_START,pComdInfo.VALIDITY_DATE_END=shopInfo.commdityInfo.VALIDITY_DATE_END,pComdInfo.MALL_CLASS=shopInfo.commdityInfo.MALL_CLASS,pComdInfo.cancel=shopInfo.commdityInfo.CANCEL,pComdInfo.startDate=shopInfo.commdityInfo.startDate,pComdInfo.endDate=shopInfo.commdityInfo.endDate,pComdInfo.CAN_STACK=shopInfo.commdityInfo.CAN_STACK,pComdInfo.dates=shopInfo.formatInfo.DATES,pComdInfo.play=shopInfo.commdityInfo.PLAY,pComdInfo.seat=shopInfo.commdityInfo.SEAT,pComdInfo.carTypeName=shopInfo.commdityInfo.CARTYPENAME,pComdInfo.carRentalType=shopInfo.commdityInfo.CAR_RENTAL_TYPE,pComdInfo.everySunday=shopInfo.commdityInfo.EVERY_SUNDAY,pComdInfo.isGroup=shopInfo.commdityInfo.IS_GROUP,pComdInfo.diffInstr=shopInfo.commdityInfo.DIFF_INSTR,pComdInfo.childPrice=shopInfo.formatInfo.CHILDREN_PRICE,pComdInfo.stock=shopInfo.formatInfo.STOCK,pComdInfo.calcPaymentMoney(),pcomdsInfo.push(pComdInfo)}}else if("shopCard"==source){var orderIds=getShopCardPayments(),orders=getMemberOrderByMemberAndOrders(memberId,orderIds);if(console.error(orders),orders&&orders.length>0)for(var i=0;i<orders.length;i++){var pComdInfo=new PaymentCommodity(orders[i].ORDERCODE);pComdInfo.memberId=orders[i].MEMBERID,pComdInfo.id=orders[i].COMMODITYID,pComdInfo.name=orders[i].NAME,""!=orders[i].DISCOUNT&&void 0!=orders[i].DISCOUNT&&orders[i].DISCOUNT?pComdInfo.discount=orders[i].DISCOUNT:pComdInfo.discount=1,pComdInfo.orderstateid=orders[i].ORDERSTATEID,pComdInfo.price=orders[i].PRICE,pComdInfo.listimage=orders[i].LISTIMAGE,pComdInfo.fid=orders[i].FID,pComdInfo.fname=orders[i].FNAME,pComdInfo.specImages=orders[i].SPECIMAGES,pComdInfo.fPrice=orders[i].FPRICE,pComdInfo.explain=orders[i].EXPLAIN,pComdInfo.buyNumber=orders[i].BUYNUMBER,pComdInfo.orderId=orders[i].ID,pComdInfo.postage=0,pComdInfo.supportPaymentMode=orders[i].SUPPORTPAYMENTMODE,pComdInfo.payMeoth=orders[i].PAY_MEOTH,pComdInfo.calcPaymentMoney(),pcomdsInfo.push(pComdInfo)}}else"package"==source&&console.info("根据套餐ID获取商品套餐信息");if(angular.isFunction(callFun)){var fid=pcomdsInfo[0].fid,id=pcomdsInfo[0].id,querData=actionManagerService.getCommodityInfoData(memberId,id,fid,"预订须知");ajaxManager.ajaxToJson(querData,function(data,status,header,config){angular.isFunction(callFun)&&callFun(data)})}return pcomdsInfo},submitComdOrder=function(memberId,recvAddresId,electId,payMent,shopInfo,shippingMethod,bespeakTime,callFun,extendData,paymentShowMsg){var orderInfo,orderAction="order";orderInfo=new SubmitOrderInfo,orderInfo.MEMBERID=memberId,orderInfo.RECVADDRESS=recvAddresId,orderInfo.ORGCODE=appConfig.appOrg,orderInfo.ELECTTICKID=electId?electId:"",orderInfo.PAYMENT=payMent,orderInfo.SHIPPING_METHOD=shippingMethod,orderInfo.BESPEAKTIME=bespeakTime,orderInfo.PAYMENT_SHOW_MSG=paymentShowMsg,shopInfo.childBuyNumber?orderInfo.CHILDBUYNUMBER=shopInfo.childBuyNumber:orderInfo.CHILDBUYNUMBER=0,shopInfo.childPrice?orderInfo.CHILDPRICE=shopInfo.childPrice:orderInfo.CHILDPRICE=0;for(var i=0;i<shopInfo.length;i++){var item=shopInfo[i],orderItem=new OrderItem;orderItem.payComdItemToOrderItem(item),orderInfo.addOrderItem(orderItem)}extendData&&(extendData.expectArrivalTime&&(extendData.expectArrivalTime=extendData.expectArrivalTime.value),extendData=JSON.stringify(extendData));var submitData=actionManagerService.submitOrder(JSON.stringify(orderInfo),orderAction,extendData);ajaxManager.ajaxToJson(submitData,function(data,status,header,config){angular.isFunction(callFun)&&callFun(data,status,header,config)})},addShopCardByPackageID=function(params,callFun){var submitPackage=actionManagerService.submitShopCard(params);ajaxManager.ajaxToJson(submitPackage,function(data,status,header,config){angular.isFunction(callFun)&&callFun(data,status,header,config)})},orderValidate=function(shopInfo,orderData,memberId){var reuslt=!1,mallClass=shopInfo[0].MALL_CLASS;if("2"==mallClass&&!shopInfo[0].expectArrivalTime.value)return reuslt="预计到店时间不能为空！";if("8"==mallClass)for(var i=0;i<orderData.groupOrderInfo.length;i++){var item=orderData.groupOrderInfo[i];if(!item.vname)return reuslt="游客姓名不能为空！";if(!item.identity_code)return reuslt="游客身份证号不能为空！";if(!item.contactPhone)return reuslt="游客电话不能为空！"}if("5"!=mallClass){if(!orderData.contact)return reuslt="联系人信息不能为空！";if(!orderData.contactPhone)return reuslt="电话号码不正确！"}return reuslt};return{addShopCard:addShopCard,addShopCardByPackageID:addShopCardByPackageID,saveShopInfoToPayment:saveShopInfoToPayment,getPaymentShopInfo:getPaymentShopInfo,saveRecvAddres:saveRecvAddres,getRecvAddres:getRecvAddres,saveShopCardPayments:saveShopCardPayments,getShopCardPayments:getShopCardPayments,getMemberAddresBymId:getMemberAddresBymId,getMemberCoupByMemberId:getMemberCoupByMemberId,getPaymentCommdityInfo:getPaymentCommdityInfo,PaymentCommodity:PaymentCommodity,submitComdOrder:submitComdOrder,orderValidate:orderValidate}}]),angular.module("mallMobileApp.services").service("OrderService",["toolsService","Authen","actionManagerService","ajaxManager","appConfig","$state","$http","md5",function(toolsService,Authen,actionManagerService,ajaxManager,appConfig,$state,$http,md5){var goToComplain=function(orderId){var params=JSON.stringify({orderid:orderId});$state.go("member.OrderComplaint",{params:params})},submitOrderComplain=function(orderId,callFun){console.error("submitOrderComplain")},orderCancel=function(orderId){var rData=actionManagerService.MyOrderConfirreceipt(orderId,3,9);ajaxManager.ajaxToJson(rData,function(data){$state.reload()})},orderConfirmRecv=function(orderId){var rData=actionManagerService.MyOrderConfirreceipt(orderId,5,501);ajaxManager.ajaxToJson(rData,function(data){$state.reload()})},orderConfirmationService=function(orderId){var rData=actionManagerService.MyOrderConfirreceipt(orderId,6,"");ajaxManager.ajaxToJson(rData,function(data){$state.reload()})},sellOut=function(orderId,callFun){var postData=actionManagerService.sellOutOrder(orderId);ajaxManager.ajaxToJson(postData,function(data){
data&&data.DATA&&angular.isFunction(callFun)&&callFun(data)})},deleteOrder=function(orderId,memberId,mallClass,orderState,callFun){var postData=actionManagerService.deleteOrder(orderId,memberId,mallClass,orderState);ajaxManager.ajaxToJson(postData,function(data){data&&angular.isFunction(callFun)&&callFun(data)})},orderInfo=null,saveOrderDetails=function(mOrderInfo){orderInfo=mOrderInfo},getOrderDetailsByNet=function(orderId,callFun){var rData=actionManagerService.excuteResource("orderdetails",{orderid:orderId},"","");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&angular.isFunction(callFun)&&callFun(data.DATA[0])})},getOrderDetails=function(orderId,callFun){orderInfo||getOrderDetailsByNet(orderId,callFun),angular.isFunction(callFun)&&callFun(orderInfo)},recvOrRefuseOrder=function(orderId,state,callFun){var postData=actionManagerService.recvOrRefuseOrder(orderId,state);ajaxManager.ajaxToJson(postData,function(data){data&&angular.isFunction(callFun)&&callFun(data)})},refuseOrder=function(orderId,callFun){recvOrRefuseOrder(orderId,"refuse",callFun)},recvOrder=function(orderId,callFun){recvOrRefuseOrder(orderId,"recv",callFun)},distOrderRelease=function(password,orderId,callFun){var postData=actionManagerService.distOrderRelease(password,orderId);ajaxManager.ajaxToJson(postData,function(data){data&&angular.isFunction(callFun)&&callFun(data)})},orderStateEnum={1:"添加到购物车",2:"待支付",3:"处理中",31:"待配送",4:"待配送",401:"待配送",402:"待接单",403:"待配送",404:"待收货",5:"待收货",30:"待配送",320:"待使用",8:"待评价",81:"已完成",82:"已完成",91:"退货处理中",9:"退货成功",910:"退货失败",11:"退款处理中",12:"退款成功",120:"退款失败"},getOrderStateEnum=function(callFun){angular.isFunction(callFun)&&callFun(orderStateEnum)},toPayment=function(orderId,memberId,msgTemplateFun,callFun){var accountStr="",rData=actionManagerService.getOrderInfo(orderId);ajaxManager.ajaxToJson(rData,function(data){if(data){for(var orderInfo=data.ORDERINFO[0],i=0;i<data.PAY_ACCOUNT_INFO.length;i++)accountStr+=data.PAY_ACCOUNT_INFO[i].SA_CODE+",";var msgTemplate="";msgTemplate=angular.isFunction(msgTemplateFun)?msgTemplateFun(data):msgTemplateFun;var uuid=toolsService.uuid().toUpperCase().replace(/-/g,""),params={title:"商品支付",out_account_code:accountStr,in_account_code:"",out_remakes:orderInfo.COMDITYNAME,in_remakes:"",pay_money:orderInfo.TOTALPRICE,msg_template:msgTemplate,business:{payment_id:uuid,memberid:memberId,orders:orderInfo.ID,paymoney:orderInfo.PAYMONEY,success_call_back:"com.am.frame.order.process.OrderBusinessCallBack"},success_url:"member.paymentOrder",lost_url:"member.paymentOrder",pay_id:uuid,pay_type:"1",pay_type_name:"支付"};angular.isFunction(callFun)&&callFun(params)}})},applyReturOrderPrice=function(orderId,memberId,callFun){var rData=actionManagerService.applyReturnPriceByOrderId(orderId,memberId);ajaxManager.ajaxToJson(rData,function(data){angular.isFunction(callFun)&&callFun(data)})},evalOrderProcess=function(evalId,memberId,images,callFun){var rData=actionManagerService.evalOrderProcess(evalId,memberId,images);ajaxManager.ajaxToJson(rData,function(data){angular.isFunction(callFun)&&callFun(data)})},getKuaidi100=function(argCom,argNum,callFun){var url="http://poll.kuaidi100.com/poll/query.do",param={com:argCom,num:argNum},customer=appConfig.kdcustomer,key=appConfig.kdkey,sign=md5.createHash(JSON.stringify(param)+key+customer).toUpperCase(),postData={param:JSON.stringify(param),sign:sign,customer:customer};$http.post(url,postData).success(function(data){console.error(data),angular.isFunction(callFun)&&callFun(data)})};return{getOrderDetailsByNet:getOrderDetailsByNet,goToComplain:goToComplain,submitOrderComplain:submitOrderComplain,orderCancel:orderCancel,orderConfirmationService:orderConfirmationService,orderConfirmRecv:orderConfirmRecv,sellOut:sellOut,saveOrderDetails:saveOrderDetails,getOrderDetails:getOrderDetails,recvOrder:recvOrder,refuseOrder:refuseOrder,distOrderRelease:distOrderRelease,getOrderStateEnum:getOrderStateEnum,deleteOrder:deleteOrder,toPayment:toPayment,applyReturOrderPrice:applyReturOrderPrice,evalOrderProcess:evalOrderProcess,getKuaidi100:getKuaidi100}}]),angular.module("mallMobileApp.controllers").controller("ShopCtrl",["$timeout","$scope","$state","$ionicNavBarDelegate","$rootScope","Authen","commdityService","actionManagerService","ajaxManager","$ionicModal","$ionicBackdrop","toolsService",function($timeout,$scope,$state,$ionicNavBarDelegate,$rootScope,Authen,commdityService,actionManagerService,ajaxManager,$ionicModal,$ionicBackdrop,toolsService){}]),angular.module("mallMobileApp.controllers").controller("ShopCardCtrl",["$scope","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state","$stateParams","appConfig","commdityService",function($scope,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state,$stateParams,appConfig,commdityService){$scope.pageData={shopCardParams:{},memberid:Authen.getUserId(),listEvents:"",shopMoney:0..toFixed(2),settlementnum:0,param:[],selectALL:!1},$scope.pageData.shopCardParams={memberid:$scope.pageData.memberid},$scope.toMessage=function(){$state.go("common.message",{})},$scope.pageData.listEvents={ShopDetails:function(commodityid){$state.go("commodity.comdDetails",{id:commodityid})},ShopMoney:function(){$scope.pageData.shopMoney=0,$scope.pageData.settlementnum=0,$scope.pageData.param=[];for(var str=document.getElementsByName("shopmoney"),number=document.getElementsByName("salenumber"),orderid=document.getElementsByName("orderid"),i=0;i<str.length;i++)1==str[i].checked&&($scope.pageData.shopMoney+=parseFloat(str[i].value)*parseInt(number[i].innerText),$scope.pageData.settlementnum++,$scope.pageData.param.push(orderid[i].innerText));$scope.pageData.shopMoney=$scope.pageData.shopMoney.toFixed(2)},AllChecked:function(){for(var shop=document.getElementsByName("shopmoney"),str=document.getElementsByName("allcheck"),i=0;i<str.length;i++)if(1==str[i].checked)for(var j=0;j<shop.length;j++)document.getElementsByName("shopmoney")[j].checked=!0;else for(var j=0;j<shop.length;j++)document.getElementsByName("shopmoney")[j].checked=!1;$scope.pageData.listEvents.ShopMoney()},DeleteShopOrder:function(ID){var params=new formatAmSqlParams;params.TABLENAME="mall_memberorder";var row=new formatAmSqlupdateRow;row.setID(ID),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0==data.CODE&&(toolsService.showMessage("删除成功",1),$state.go("member.shopcard",{},{reload:!0}))})}},$scope.ShopSettlement=function(){if(0==$scope.pageData.settlementnum)toolsService.showMessage("请选择商品!",1);else{commdityService.saveShopCardPayments($scope.pageData.param);var params={source:"shopCard"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})}}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.privateCustomized",{url:"/privateCustomized",cache:!0,views:{commodity_view:{templateUrl:"app_plugins/private_customized/views/private_customized_page.html",controller:"PrivateCustomizedCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("PrivateCustomizedCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","appConfig","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,appConfig,$ionicHistory){$scope.pageData={customizedData:"",hotelTypeData:"",hotelType:"",vehicleData:"",vehicle:"",nearStoreData:"",nearStore:"",startPeopleNum:"",endPeopleNum:"",startDayNum:"",endDayNum:"",recvName:"",recvPhone:"",scorllwidht:""},$scope.init=function(){$scope.getBannerInfo();var rData=actionManagerService.excuteResource("triph.privateorder.getHotelType","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.hotelTypeData=data.DATA)});var rData=actionManagerService.excuteResource("triph.privateorder.vehicle","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.vehicleData=data.DATA)});var rData=actionManagerService.excuteResource("triph.privateorder.getNearStore","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.nearStoreData=data.DATA,$scope.pageData.nearStoreData.length>=3?$scope.pageData.scorllwidht={width:36*$scope.pageData.nearStoreData.length+"%"}:$scope.pageData.scorllwidht={width:"100%"})})},$scope.getBannerInfo=function(){var bannerParam={condition:" and am_mobliemenuid='menu_customized' and orgcode='"+appConfig.appOrg+"'"},rData=actionManagerService.excuteResource("banner_active_info",bannerParam,"","");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.customizedData=data.DATA,toolsService.createSwiper(".customized_swiper",".customized-pagination"))})},$scope.toPage=function(url){toolsService.toStateOfServerUrl($state,url)},$scope.init(),$scope.validate=function(){return toolsService.isEmpty($scope.pageData.startPeopleNum)?(toolsService.showMessage("请输入最小出游人数",2),!1):toolsService.isEmpty($scope.pageData.endPeopleNum)?(toolsService.showMessage("请输入最大出游人数",2),!1):toolsService.isEmpty($scope.pageData.startDayNum)?(toolsService.showMessage("请输入最小出游天数",2),!1):toolsService.isEmpty($scope.pageData.endDayNum)?(toolsService.showMessage("请输入最大出游天数",2),!1):toolsService.isEmpty($scope.pageData.recvName)?(toolsService.showMessage("请输入联系人",2),!1):toolsService.isEmpty($scope.pageData.recvPhone)?(toolsService.showMessage("请输入联系电话",2),!1):!0},$scope.submit=function(){var hotelTypeArray=new Array,type="";if($scope.validate()){for(var i=0;i<$scope.pageData.hotelTypeData.length;i++)$scope.pageData.hotelTypeData[i].CHECKED&&(hotelTypeArray.push($scope.pageData.hotelTypeData[i].NAME),type+=$scope.pageData.hotelTypeData[i].NAME+",");for(var veh="",i=0;i<$scope.pageData.vehicleData.length;i++)$scope.pageData.vehicleData[i].CHECKED&&(hotelTypeArray.push($scope.pageData.vehicleData[i].NAME),veh+=$scope.pageData.vehicleData[i].NAME+",");console.info(veh);var parentId=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="triph_private_order";var row=new formatAmSqlupdateRow;row.setID(parentId),row.setStatus("i"),row.addColumn("trips_mix_number",$scope.pageData.startPeopleNum),row.addColumn("trips_max_number",$scope.pageData.endPeopleNum),row.addColumn("trips_mix_days",$scope.pageData.startDayNum),row.addColumn("trips_max_days",$scope.pageData.endDayNum),row.addColumn("hotel_type",type),row.addColumn("vehicle",veh),row.addColumn("member_name",$scope.pageData.recvName),row.addColumn("phone",$scope.pageData.recvPhone),row.addColumn("createtime","now"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){if(0!=data.CODE)toolsService.showMessage("提交失败！",1);else for(var storeArray=new Array,storeId="",sonId="",i=0;i<$scope.pageData.nearStoreData.length;i++)if($scope.pageData.nearStoreData[i].CHECKED){sonId=toolsService.uuid(),storeArray.push($scope.pageData.nearStoreData[i].ID),storeId=$scope.pageData.nearStoreData[i].ID;var params=new formatAmSqlParams;params.TABLENAME="triph_customized_scenic_spot";var row=new formatAmSqlupdateRow;row.setID(sonId),row.setStatus("i"),row.addColumn("order_id",parentId),row.addColumn("store_id",storeId),row.addColumn("createtime","now"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("提交失败！",1):$state.go("commodity.privateorderconfirm",{params:JSON.stringify({id:parentId})})})}})}},$scope.goBack=function(){toolsService.goBackPage()},$scope.message=function(){$state.go("common.message",{})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.privateorderconfirm",{url:"/privateorderconfirm/:params",cache:!0,views:{commodity_view:{templateUrl:"app_plugins/private_customized/views/private_order_confirm_index.html",controller:"privateOrderConfirmCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("privateOrderConfirmCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","appConfig","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,appConfig,$ionicHistory){$scope.pageData={id:JSON.parse($state.params.params).id,customizedData:"",privateData:"",scenicSpotData:"",varData:"",scorllwidht:""},$scope.init=function(){console.info($scope.pageData.id),$scope.getBannerInfo();var rData=actionManagerService.excuteResource("triph.private.confirm",{id:$scope.pageData.id},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.privateData=data.DATA[0])});var pData=actionManagerService.excuteResource("triph.privateorder.getStoreInfo",{id:$scope.pageData.id},"none","none");ajaxManager.ajaxToJson(pData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.scenicSpotData=data.DATA,$scope.pageData.scenicSpotData.length>=4?$scope.pageData.scorllwidht={width:34*$scope.pageData.scenicSpotData.length+"%"}:$scope.pageData.scorllwidht={width:"100%"})});var vData=actionManagerService.excuteResource("get_avar_info",{vid:"contactTime"},"none","none");ajaxManager.ajaxToJson(vData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.varData=data.DATA[0],console.info($scope.pageData.varData))})},$scope.getBannerInfo=function(){var bannerParam={condition:" and am_mobliemenuid='menu_customized' and orgcode='"+appConfig.appOrg+"'"},rData=actionManagerService.excuteResource("banner_active_info",bannerParam,"","");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.customizedData=data.DATA;new Swiper("#customized_swiper",{pagination:".swiper-pagination",autoplay:2e3,autoplayDisableOnInteraction:!1,observer:!0})}})},$scope.init(),$scope.confirm=function(){$state.go("mall.home")},$scope.goBack=function(){toolsService.goBackPage()},$scope.message=function(){$state.go("common.message",{})}}]),angular.module("mallMobileApp.controllers").controller("SelectMarketArea",function($scope,Authen,$state){$scope.pageData={title:"公益市场",listEvents:{},banner_menu_code:"PublicWelfare"},$scope.pageData.listEvents={selectProvince:function(proid){var params={type:"province",value:proid};$state.go("commodity.commodityList",{params:JSON.stringify(params)})}}}),angular.module("mallMobileApp.controllers").controller("MarketCustomizedCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={marketData:"",listImages:"",statusEnum:{1:"草稿",2:"申请上架",3:"招商中",4:"强行下架",5:"已支付到平台",6:"已收货"}},$scope.init=function(){var Id={id:$state.params.id},detailsData=actionManagerService.excuteResource("lxny.rural_market.marketCustomized",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.marketData=data.DATA[0],data.DATA[0].LIST_IMAGES&&($scope.pageData.listImages=data.DATA[0].LIST_IMAGES.split(",")))})},$scope.init(),$scope.marketOrderGood=function(){var meId=$scope.pageData.marketData.ID,buyersId=Authen.getUserId(),price=$scope.pageData.marketData.PRICE/100,uuid=toolsService.uuid(),params={title:"我要订货",out_account_code:"CASH_ACCOUNT",in_account_code:"",out_remakes:"农村大市场订货",in_remakes:"农村大市场订货",pay_money:price,business:{payment_id:uuid,id:meId,memberid:buyersId,price:price,orders:uuid},success_url:"ruralMarket.myCustomized",lost_url:"ruralMarket.marketCustomized",pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};console.debug("跳支付页面传的参数"+JSON.stringify(params)),$state.go("common.payment",{params:JSON.stringify(params)})}}]),angular.module("mallMobileApp.controllers").controller("RuralMarketCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={memberid:Authen.getUserId(),provinces:"",recvcity:"",recvarea:"",params:{wherSQL:""},statusEnum:{1:"草稿",2:"申请上架",3:"招商中",4:"强行下架",5:"已支付到平台",6:"已收货"}},$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pageData.listEvents={marketCustomized:function(id){$state.go("ruralMarket.marketCustomized",{id:id})},statusEnum:$scope.pageData.statusEnum},$scope.init=function(){var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){if(data.DATA){$scope.cascadePCZ.provinces=data.DATA,$scope.querytype();for(var i=0;i<$scope.cascadePCZ.provinces.length;i++)if($scope.cascadePCZ.provinces[i].PROID==Authen.getUserInfo().PROVINCE){$scope.pageData.recvProvince=$scope.cascadePCZ.provinces[i];break}}})},$scope.$watch("pageData.recvProvince",function(){if($scope.pageData.recvProvince){var pId={pid:$scope.pageData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){if(data.DATA){$scope.cascadePCZ.cities=data.DATA;for(var i=0;i<$scope.cascadePCZ.cities.length;i++)if($scope.cascadePCZ.cities[i].CITYID==Authen.getUserInfo().CITY){$scope.pageData.recvCity=$scope.cascadePCZ.cities[i];break}}})}}),$scope.$watch("pageData.recvCity",function(){if($scope.pageData.recvCity){var cId={cid:$scope.pageData.recvCity.CITYID},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){if(data.DATA){$scope.cascadePCZ.zones=data.DATA;for(var i=0;i<$scope.cascadePCZ.zones.length;i++)if($scope.cascadePCZ.zones[i].ZONEID==Authen.getUserInfo().ZZONE){$scope.pageData.recvArea=$scope.cascadePCZ.zones[i],$scope.query();break}}})}}),$scope.querytype=function(){var rData=actionManagerService.excuteResource("lxny.rural_market.myBooth.marketClassify","","none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.typedata=data.DATA,console.error($scope.pageData.typedata)})},$scope.init(),$scope.query=function(){var wherSQL="";if($scope.pageData.recvProvince){var pId=$scope.pageData.recvProvince.PROID;wherSQL=" AND me.province = '"+pId+"'"}if($scope.pageData.recvCity){var cId=$scope.pageData.recvCity.CITYID;wherSQL+=" AND me.city='"+cId+"' "}if($scope.pageData.recvArea){var zoneid=$scope.pageData.recvArea.ZONEID;wherSQL+=" AND me.zone='"+zoneid+"' "}if($scope.pageData.classId){var classId=$scope.pageData.classId;wherSQL+=" AND me.class_id='"+classId+"' "}if($scope.pageData.title){var title=$scope.pageData.title;wherSQL+=" AND me.title='"+title+"' "}$scope.pageData.params={wherSQL:wherSQL}},$scope.myBooth=function(){$state.go("ruralMarket.myBooth")},$scope.myCustomized=function(){$state.go("ruralMarket.myCustomized")}}]),angular.module("mallMobileApp.controllers").controller("MyBoothCtrl",["$scope","$state","Authen",function($scope,$state,Authen){$scope.pageData={listEvents:"",params:{memberid:Authen.getUserId()},statusEnum:{1:"草稿",2:"申请上架",3:"招商中",4:"强行下架",5:"已支付到平台",6:"已收货",7:"审核拒绝"}},$scope.recordClick=function(){$state.go("ruralMarket.publishMyBooth")},$scope.pageData.list_events={updateMyBooth:function(id){$state.go("ruralMarket.updateMyBooth",{id:id})},statusEnum:$scope.pageData.statusEnum}}]),angular.module("mallMobileApp.controllers").controller("PublishMyBoothCtrl",["$scope","$ionicPopup","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","FileAccess",function($scope,$ionicPopup,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,FileAccess){function processSave(start){var uuid=dataId,title=$scope.pageData.title,class_id=$scope.pageData.class_id,content=$scope.pageData.content,price=$scope.pageData.price,status=$scope.pageData.status,memberid=Authen.getUserId(),recvProvince=$scope.pageData.recvProvince.PROID,recvCity=$scope.pageData.recvCity.CITYID,recvArea=$scope.pageData.recvArea.ZONEID,imagepaths=$scope.pageData.imagepath;console.error(recvProvince,recvCity,recvArea),savePublishMarket(uuid,title,class_id,content,status,memberid,start,imagepaths,price,recvProvince,recvCity,recvArea)}function savePublishMarket(uuid,title,class_id,content,status,memberid,start,imagepaths,price,recvProvince,recvCity,recvArea){var aData=actionManagerService.saveMarket(uuid,title,class_id,content,status,memberid,start,imagepaths,price,recvProvince,recvCity,recvArea);ajaxManager.ajaxToJson(aData,function(data){$state.go("ruralMarket.myBooth",{},{location:"replace"}),toolsService.showMessage("保存成功！",1)})}$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pageData={vvalue:0,class_id:"",content:"",status:1,title:"",provinces:"",recvcity:"",recvarea:"",memberid:Authen.getUserId(),statusEnum:{1:"草稿",2:"申请上架",3:"招商中",4:"强行下架",5:"已支付到平台",6:"已收货"},inputData:[],imagepath:""};var dataId="";$scope.init=function(){$scope.querytype(),$scope.queryProvince(),$scope.queryAmount(),dataId=toolsService.uuid()},$scope.querytype=function(){var rData=actionManagerService.excuteResource("lxny.rural_market.myBooth.marketClassify","","none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.favoritesdata=data.DATA})},$scope.queryAmount=function(){var vid={vid:"marketplace_release_free"},qData=actionManagerService.excuteResource("variableSql",vid,"none","none");ajaxManager.ajaxToJson(qData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.vvalue=data.DATA[0].VVALUE)})},$scope.queryProvince=function(){var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)})},$scope.$watch("pageData.recvProvince",function(){if($scope.pageData.recvProvince){var pId={pid:$scope.pageData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pageData.recvCity",function(){if($scope.pageData.recvCity){var cId={cid:$scope.pageData.recvCity.CITYID},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),$scope.init(),$scope.cancel=function(){$state.go("ruralMarket.myBooth")},$scope.saveMarket=function(start){if(null==$scope.pageData.class_id||""==$scope.pageData.class_id||void 0==$scope.pageData.class_id)return void toolsService.showMessage("请选择所属分类！",1);if(null==$scope.pageData.title||""==$scope.pageData.title||void 0==$scope.pageData.title)return void toolsService.showMessage("请输入标题！",1);if(null==$scope.pageData.content||""==$scope.pageData.content||void 0==$scope.pageData.content)return void toolsService.showMessage("请输入内容！",1);if(null==$scope.pageData.price||""==$scope.pageData.price||void 0==$scope.pageData.price)return void toolsService.showMessage("请输入金额！",1);if(void 0==$scope.pageData.recvProvince||""==$scope.pageData.recvProvince||null==$scope.pageData.recvProvince)return void toolsService.showMessage("请选择省份！",1);if(void 0==$scope.pageData.recvCity||""==$scope.pageData.recvCity||null==$scope.pageData.recvCity)return void toolsService.showMessage("请选择市！",1);if(void 0==$scope.pageData.recvArea||""==$scope.pageData.recvArea||null==$scope.pageData.recvArea)return void toolsService.showMessage("请选择区！",1);var uploadData=[];console.error($scope.pageData.inputData);for(var i=0;i<$scope.pageData.inputData.length;i++){var item=$scope.pageData.inputData[i];"image"==item.type&&uploadData.push({type:"file",data:{fileName:item.fileName,mimeType:item.mimeType,type:item.type,file:item.file,savePath:"files//MALL_MARKETPLACE_ENTITY//"+dataId+"//bdp_list_images"}})}console.error(uploadData),0==uploadData.length?processSave(start):FileAccess.asUpload(uploadData,function(files){var imagepath=toolsService.fileJsonreturnstr(files,"image");$scope.pageData.imagepath&&$scope.pageData.imagepath.length>1?$scope.pageData.imagepath+=","+imagepath:$scope.pageData.imagepath=imagepath,processSave(start)},null,null,"n_space")},$scope["delete"]=function(value){$ionicPopup.show({title:"确认删除",template:"确认删除选中的图片?",scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>确认</b>",type:"btn1",onTap:function(){for(var i=(JSON.stringify(value),0);i<$scope.pageData.inputData.length;i++)$scope.pageData.imagepath=$scope.pageData.imagepath.replace(value+",",""),$scope.pageData.imagepath=$scope.pageData.imagepath.replace(value,""),$scope.pageData.inputData[i]==value&&$scope.pageData.inputData.splice(i,1)}}]})}}]),angular.module("mallMobileApp.controllers").controller("UpdateMyBoothCtrl",["$scope","$ionicPopup","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","FileAccess",function($scope,$ionicPopup,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,FileAccess){function processSave(){var uuid=dataId,title=$scope.pageData.title,class_id=$scope.pageData.class_id,content=$scope.pageData.content,price=$scope.pageData.price,memberid=Authen.getUserId(),recvProvince=$scope.pageData.recvProvince.PROID,recvCity=$scope.pageData.recvCity.CITYID,recvArea=$scope.pageData.recvArea.ZONEID,imagepaths=$scope.pageData.imagepath;console.error(imagepaths),savePublishMarket(memberid,uuid,title,class_id,content,imagepaths,price,recvProvince,recvCity,recvArea)}function savePublishMarket(memberid,uuid,title,class_id,content,imagepaths,price,recvProvince,recvCity,recvArea){var aData=actionManagerService.updateMarket(memberid,uuid,title,class_id,content,imagepaths,price,recvProvince,recvCity,recvArea);ajaxManager.ajaxToJson(aData,function(data){$state.go("ruralMarket.myBooth",{},{location:"replace"}),toolsService.showMessage("上架成功！",1)})}$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pageData={vvalue:0,class_id:"",content:"",status:"",title:"",provinces:"",recvcity:"",recvarea:"",memberid:Authen.getUserId(),statusEnum:{1:"草稿",2:"申请上架",3:"招商中",4:"强行下架",5:"已支付到平台",6:"已收货",7:"审核拒绝"},inputData:[],imagepath:""};var dataId="";$scope.init=function(){var Id={id:$state.params.id},rData=actionManagerService.excuteResource("lxny.rural_market.myBooth.updateMyBooth",Id,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.marketBuyData=data.DATA[0],$scope.pageData.class_id=data.DATA[0].CLASS_ID,$scope.pageData.title=data.DATA[0].TITLE,$scope.pageData.content=data.DATA[0].ME_CONTENT,$scope.pageData.price=parseInt(data.DATA[0].MONEY),$scope.pageData.status=data.DATA[0].STATUS,$scope.pageData.reviewRemarks=data.DATA[0].REVIEW_REMARKS,$scope.pageData.province=data.DATA[0].PROVINCE,$scope.pageData.city=data.DATA[0].CITY,$scope.pageData.zone=data.DATA[0].ZONE,console.error(data.DATA[0].LIST_IMAGES),data.DATA[0].LIST_IMAGES&&($scope.pageData.inputData=data.DATA[0].LIST_IMAGES.split(",")),$scope.pageData.imagepath=data.DATA[0].LIST_IMAGES,dataId=data.DATA[0].ID,$scope.querytype(),$scope.queryProvince(),$scope.queryAmount())})},$scope.querytype=function(){var rData=actionManagerService.excuteResource("lxny.rural_market.myBooth.marketClassify","","none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.favoritesdata=data.DATA})},$scope.queryAmount=function(){var vid={vid:"marketplace_release_free"},qData=actionManagerService.excuteResource("variableSql",vid,"none","none");ajaxManager.ajaxToJson(qData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.vvalue=data.DATA[0].VVALUE)})},$scope.queryProvince=function(){var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){if(data.DATA){$scope.cascadePCZ.provinces=data.DATA;for(var i=0;i<$scope.cascadePCZ.provinces.length;i++)if($scope.cascadePCZ.provinces[i].PROID==$scope.pageData.province){$scope.pageData.recvProvince=$scope.cascadePCZ.provinces[i];break}}})},$scope.$watch("pageData.recvProvince",function(){if($scope.pageData.recvProvince){var pId={pid:$scope.pageData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){if(data.DATA){$scope.cascadePCZ.cities=data.DATA;for(var i=0;i<$scope.cascadePCZ.cities.length;i++)if($scope.cascadePCZ.cities[i].CITYID==$scope.pageData.city){$scope.pageData.recvCity=$scope.cascadePCZ.cities[i];break}}})}}),$scope.$watch("pageData.recvCity",function(){if($scope.pageData.recvCity){var cId={cid:$scope.pageData.recvCity.CITYID},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){if(data.DATA){$scope.cascadePCZ.zones=data.DATA;for(var i=0;i<$scope.cascadePCZ.zones.length;i++)if($scope.cascadePCZ.zones[i].ZONEID==$scope.pageData.zone){$scope.pageData.recvArea=$scope.cascadePCZ.zones[i];break}}})}}),$scope.init(),$scope.grounding=function(){if(null==$scope.pageData.class_id||""==$scope.pageData.class_id||void 0==$scope.pageData.class_id)return void toolsService.showMessage("请选择所属分类！",1);if(null==$scope.pageData.title||""==$scope.pageData.title||void 0==$scope.pageData.title)return void toolsService.showMessage("请输入标题！",1);if(null==$scope.pageData.content||""==$scope.pageData.content||void 0==$scope.pageData.content)return void toolsService.showMessage("请输入内容！",1);if(null==$scope.pageData.price||""==$scope.pageData.price||void 0==$scope.pageData.price)return void toolsService.showMessage("请输入金额！",1);if(void 0==$scope.pageData.recvProvince||""==$scope.pageData.recvProvince||null==$scope.pageData.recvProvince)return void toolsService.showMessage("请选择省份！",1);if(void 0==$scope.pageData.recvCity||""==$scope.pageData.recvCity||null==$scope.pageData.recvCity)return void toolsService.showMessage("请选择市！",1);if(void 0==$scope.pageData.recvArea||""==$scope.pageData.recvArea||null==$scope.pageData.recvArea)return void toolsService.showMessage("请选择区！",1);var uploadData=[];console.error($scope.pageData.inputData);for(var i=0;i<$scope.pageData.inputData.length;i++){var item=$scope.pageData.inputData[i];"image"==item.type&&uploadData.push({type:"file",data:{fileName:item.fileName,mimeType:item.mimeType,type:item.type,file:item.file,savePath:"files//MALL_MARKETPLACE_ENTITY//"+dataId+"//bdp_list_images"}})}console.error(uploadData),0==uploadData.length?processSave():FileAccess.asUpload(uploadData,function(files){var imagepath=toolsService.fileJsonreturnstr(files,"image");$scope.pageData.imagepath&&$scope.pageData.imagepath.length>1?$scope.pageData.imagepath+=","+imagepath:$scope.pageData.imagepath=imagepath,processSave()},null,null,"n_space")},$scope.undercarriage=function(){var params=new formatAmSqlParams;params.TABLENAME="mall_marketplace_entity";var row=new formatAmSqlupdateRow;row.setID($state.params.id),row.setStatus("u"),row.addColumn("status",1),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("下架失败！",1):(toolsService.showMessage("下架成功！",1),$state.go("ruralMarket.myBooth","",{location:"replace"}))})},$scope.refund=function(){var meId=$state.params.id,buyersId=$scope.pageData.marketBuyData.BUYERS_ID,tradeAmount=$scope.pageData.marketBuyData.TRADE_AMOUNT/100,mtrId=$scope.pageData.marketBuyData.MTRID,aData=actionManagerService.marketRefund(meId,buyersId,tradeAmount,mtrId);ajaxManager.ajaxToJson(aData,function(data){"0"==data.code?(toolsService.tips(data.msg,""),$state.go("ruralMarket.myCustomized")):toolsService.tips(data.msg,"")})},$scope["delete"]=function(value){$ionicPopup.show({title:"确认删除",template:"确认删除选中的图片?",scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>确认</b>",type:"btn1",onTap:function(){for(var i=(JSON.stringify(value),
0);i<$scope.pageData.inputData.length;i++)$scope.pageData.imagepath=$scope.pageData.imagepath.replace(","+value,""),$scope.pageData.imagepath=$scope.pageData.imagepath.replace(value,""),console.error($scope.pageData.imagepath),$scope.pageData.inputData[i]==value&&$scope.pageData.inputData.splice(i,1)}}]})}}]),angular.module("mallMobileApp.controllers").controller("ConfirmReceiptCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={marketData:"",listImages:"",statusEnum:{1:"待确认收货",2:"已收货",3:"已退款"}},$scope.init=function(){var Id={mcid:$state.params.mcid},detailsData=actionManagerService.excuteResource("lxny.rural_market.myCustomized.confirmReceipt",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.marketData=data.DATA[0],data.DATA[0].LIST_IMAGES&&($scope.pageData.listImages=data.DATA[0].LIST_IMAGES.split(",")))})},$scope.init(),$scope.confirmReceipt=function(){var meId=$scope.pageData.marketData.ID,mtrId=$scope.pageData.marketData.MTRID,memberId=$scope.pageData.marketData.MEMBER_ID,price=$scope.pageData.marketData.TRADE_AMOUNT/100,aData=actionManagerService.confirmReceipt(meId,memberId,price,mtrId);ajaxManager.ajaxToJson(aData,function(data){"0"==data.code?(toolsService.tips(data.msg,""),$state.go("ruralMarket.myCustomized",{},{location:"replace"})):toolsService.tips(data.msg,"")})}}]),angular.module("mallMobileApp.controllers").controller("MyCustomizedCtrl",["$scope","$state","Authen","toolsService","actionManagerService","ajaxManager",function($scope,$state,Authen,toolsService,actionManagerService,ajaxManager){$scope.pageData={listEvents:"",statusEnum:{1:"待确认收货",2:"已收货",3:"已退款"}};var params=$state.params.params;if(toolsService.isEmpty(params))$scope.pageData.params={memberid:Authen.getUserId()};else{var meId=JSON.parse($state.params.params).business.id,buyersId=JSON.parse($state.params.params).business.memberid,price=JSON.parse($state.params.params).business.price;console.debug(buyersId);var aData=actionManagerService.marketOrderGoods(meId,buyersId,price);ajaxManager.ajaxToJson(aData,function(data){0==data.code&&(console.error(data),$scope.pageData.params={memberid:Authen.getUserId()},$state.go("ruralMarket.myCustomized",{},{location:"replace"}))})}$scope.pageData.list_events={confirmReceipt:function(id){$state.go("ruralMarket.confirmReceipt",{mcid:id})},statusEnum:$scope.pageData.statusEnum}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("speciality.speciality",{url:"/speciality",cache:!1,views:{speciality_view:{templateUrl:"app_plugins/speciality_product/views/speciality_page.html",controller:"SpecialityCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("SpecialityCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","appConfig","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,appConfig,$ionicHistory){$scope.pageData={specialtyData:"",classifyData:"",featureStoryData:""},$scope.goBack=function(){toolsService.goBackPage()},$scope.message=function(){$state.go("common.message",{})},$scope.init=function(){$scope.getBannerInfo(),$scope.specialityClassify(),$scope.getFeatureStory()},$scope.toSearch=function(){$state.go("common.search",{})},$scope.getBannerInfo=function(){var bannerParam={condition:" and am_mobliemenuid='menu_specialty' and orgcode='"+appConfig.appOrg+"'"},rData=actionManagerService.excuteResource("banner_active_info",bannerParam,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.specialtyData=data.DATA,toolsService.createSwiper(".specialty_swiper",".swiper-pagination"))})},$scope.specialityClassify=function(){var wherSQL={wherSQL:""},rData=actionManagerService.excuteResource("triph.app_plugins.specialityProduct.specialityClassifySql",wherSQL,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.classifyData=data.DATA)})},$scope.toPage=function(url){toolsService.toStateOfServerUrl($state,url)},$scope.getFeatureStory=function(){var menucode={menucode:"featureStory"},storyData=actionManagerService.excuteResource("collegeStudentBook",menucode,"none","none");ajaxManager.ajaxToJson(storyData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.featureStoryData=data.DATA)})},$scope.Jump=function(id){$state.go("speciality.specialityList",{classid:id})},$scope.toDetails=function(id){$state.go("more.contentdetails",{id:id})},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("speciality.specialityList",{url:"/specialityList/:classid",cache:!1,views:{speciality_view:{templateUrl:"app_plugins/speciality_product/views/speciality_list_page.html",controller:"SpecialityListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("SpecialityListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","appConfig","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,appConfig,$ionicHistory){$scope.pageData={list_events:"",specialtyData:"",classifyData:"",title:"",params:{classid:$state.params.classid}},$scope.init=function(){$scope.detailsImage()},$scope.toSearch=function(){$state.go("common.search",{})},$scope.detailsImage=function(){var classId=$state.params.classid,wherSQL={wherSQL:"AND id ='"+classId+"' "},rData=actionManagerService.excuteResource("triph.app_plugins.specialityProduct.specialityClassifySql",wherSQL,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.title=data.DATA[0].TITLE,data.DATA[0].PCDETAILSIMAGE&&($scope.pageData.imageData=data.DATA[0].PCDETAILSIMAGE.split(",")),toolsService.createSwiper(".detailsImage_swiper",".swiper-pagination"))})},$scope.pageData.list_events={goComdDeatils:function(id){$state.go("commodity.comdDetails",{params:JSON.stringify({id:id})})}},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("ScenicSpotListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={title:"景区",SqlParams:{sql:" ",order:" "},List_Events:{},wyqData:"",wyq:"",wywData:"",wyw:"",noopsycheData:[{VALUE:"1",NAME:"离我最近"},{VALUE:"2",NAME:"评价最高"},{VALUE:"3",NAME:"人气最高"},{VALUE:"4",NAME:"价格最低"},{VALUE:"5",NAME:"价格最高"}],noopsyche:"",userLocation:Authen.getDriverLocation()};var lng=$scope.pageData.userLocation.currentPoint.lng,lat=$scope.pageData.userLocation.currentPoint.lat;$scope.init=function(){var sql=" AND ms.mallclass_id = '1' ",order="";toolsService.isEmpty($scope.pageData.wyq)||(sql+=" AND ms.ssjqdqid = '"+$scope.pageData.wyq+"' "),toolsService.isEmpty($scope.pageData.wyw)||(sql+=" AND ms.wyw_id = '"+$scope.pageData.wyw+"' "),"1"==$scope.pageData.noopsyche?order+=" ORDER BY SQRT(("+lng+"-longitud::float)*("+lng+"-longitud::float)+("+lat+"-latitude::float)*("+lat+"-latitude::float)) ASC ":"2"==$scope.pageData.noopsyche?order+=" ORDER BY ms.pjpxdf::FLOAT DESC ":"3"==$scope.pageData.noopsyche?order+=" ORDER BY ms.yscpzs DESC ":"4"==$scope.pageData.noopsyche?order+=" ORDER BY ms.pjjg::FLOAT ASC ":"5"==$scope.pageData.noopsyche&&(order+=" ORDER BY ms.pjjg::FLOAT DESC "),$scope.pageData.SqlParams={sql:sql,order:order,lng:lng,lat:lat}},$scope.init(),$scope.initWyq=function(){var rData=actionManagerService.excuteResource("triph.store.wyqlabel","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.wyqData=data.DATA)})},$scope.initWyq(),$scope.initWyw=function(){var rData=actionManagerService.excuteResource("triph.storelist.getWyw","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.wywData=data.DATA)})},$scope.initWyw()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.grouptour",{url:"/grouptour",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/grouptour/views/group_tour_list_index.html",controller:"GrouptourListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("GrouptourListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={title:"跟团游",SqlParams:{sql:" ",order:" "},List_Events:{},wywData:"",wyw:"",noopsycheData:{name:"智能排序",data:{"综合排序":"1","评价最高":"2","人气最高":"3","价格最低":"4","价格最高":"5"}},noopsyche:"",dayData:"",day:""},$scope.init=function(){var sql="",order="";order="1"==$scope.pageData.noopsyche?" ORDER BY COALESCE(mc.recommendvalue,-1) DESC ":"2"==$scope.pageData.noopsyche?" ORDER BY mc.pjpxdf::FLOAT DESC ":"3"==$scope.pageData.noopsyche?" ORDER BY mc.salenumber::FLOAT DESC ":"4"==$scope.pageData.noopsyche?" ORDER BY mc.price::FLOAT ASC ":"5"==$scope.pageData.noopsyche?" ORDER BY mc.price::FLOAT DESC ":" ORDER BY COALESCE(mc.recommendvalue,-1) DESC ",toolsService.isEmpty($scope.pageData.wyw)||(sql+=" AND mc.my_play_label = '"+$scope.pageData.wyw+"' "),toolsService.isEmpty($scope.pageData.day)||(sql+=" AND mc.days_label = '"+$scope.pageData.day+"' "),$scope.pageData.SqlParams={sql:sql,order:order}},$scope.init(),$scope.initWyw=function(){var rData=actionManagerService.excuteResource("triph.grouptour.getGroupTrouWyw","","none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){var tData=toolsService.formJarryToObject(data.DATA);$scope.pageData.wywData={name:"我要玩",data:tData}}})},$scope.initWyw(),$scope.initDays=function(){var rData=actionManagerService.excuteResource("triph.grouptour.getDays","","none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){var tData=toolsService.formJarryToObject(data.DATA);$scope.pageData.dayData={name:"天数",data:tData}}})},$scope.initDays(),$scope.wywSelect=function(value){$scope.pageData.wyw=value,$scope.init()},$scope.noopsySelect=function(value){$scope.pageData.noopsyche=value,$scope.init()},$scope.daySelect=function(value){$scope.pageData.day=value,$scope.init()},$scope.pageData.List_Events={getDetails:function(id){$state.go("commodity.grouptourdetails",{params:JSON.stringify({id:id})})}},$scope.toSearch=function(){$state.go("common.search",{})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.grouptourdetails",{url:"/grouptourdetails/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/grouptour/views/group_tour_details_index.html",controller:"GrouptourDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("GrouptourDetailsCtrl",["$location","$anchorScroll","$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","AmCommonService","$ionicModal","$ionicPopup","OtherHandleService","$location","$ionicScrollDelegate","commdityService","$timeout","$anchorScroll","$ionicHistory",function($location,$anchorScroll,$scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,AmCommonService,$ionicModal,$ionicPopup,OtherHandleService,$location,$ionicScrollDelegate,commdityService,$timeout,$anchorScroll,$ionicHistory){$scope.pageData={title:"",mainimage:"img/bg.png",dityid:0,comImageNum:0,memberid:Authen.getUserId(),params:"",priceInfo:"",yuanjia:"",linefeaturesClass:"package",travelIntrClass:"reserve_notice",costdesClass:"reserve_notice",orderIntrClass:"reserve_notice",travelagencyClass:"reserve_notice",startData:"",choiceMoney:"",choiceId:"",guigeInfo:"",objArr:[],price:"",TEL:""},$scope.lineFeatures=function(){$scope.pageData.linefeaturesClass="package",$scope.pageData.travelIntrClass="reserve_notice",$scope.pageData.costdesClass="reserve_notice",$scope.pageData.orderIntrClass="reserve_notice",$scope.pageData.travelagencyClass="reserve_notice",$scope.pageData.resoutionState="1",$location.hash("line"),$ionicScrollDelegate.anchorScroll()},$scope.travelIntr=function(){$scope.pageData.linefeaturesClass="reserve_notice",$scope.pageData.travelIntrClass="package",$scope.pageData.costdesClass="reserve_notice",$scope.pageData.orderIntrClass="reserve_notice",$scope.pageData.travelagencyClass="reserve_notice",$location.hash("travelIntr"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.costdes=function(){$scope.pageData.linefeaturesClass="reserve_notice",$scope.pageData.travelIntrClass="reserve_notice",$scope.pageData.costdesClass="package",$scope.pageData.orderIntrClass="reserve_notice",$scope.pageData.travelagencyClass="reserve_notice",$location.hash("costdes"),$location.replace()},$scope.orderIntr=function(){$scope.pageData.linefeaturesClass="reserve_notice",$scope.pageData.travelIntrClass="reserve_notice",$scope.pageData.costdesClass="reserve_notice",$scope.pageData.orderIntrClass="package",$scope.pageData.travelagencyClass="reserve_notice",$location.hash("orderIntr"),$location.replace()},$scope.travelagency=function(){$scope.pageData.linefeaturesClass="reserve_notice",$scope.pageData.travelIntrClass="reserve_notice",$scope.pageData.costdesClass="reserve_notice",$scope.pageData.orderIntrClass="reserve_notice",$scope.pageData.travelagencyClass="package",$location.hash("travelagency"),$location.replace()},$scope.goBack=function(){toolsService.goBackPage()},$scope.init=function(){var id=JSON.parse($state.params.params).id,rData=actionManagerService.discountGroupDetails(id);$scope.pageData.dateData="",$scope.pageData.objArr=[],ajaxManager.ajaxToJson(rData,function(data){if($scope.pageData.mallInfo=data[0],$scope.pageData.mainimage=data[0].MAINIMAGES,toolsService.isEmpty(data[0].MALL_STOREIMAGELIST)||($scope.pageData.fileJSo=toolsService.formImagesToImgpicker(data[0].MALL_STOREIMAGELIST,function(count){$scope.pageData.comImageNum=count})),data[0].MALL_COMMODITYSPECIFICATIONS&&($scope.pageData.priceInfo=data[0].MALL_COMMODITYSPECIFICATIONS,!toolsService.isEmpty($scope.pageData.priceInfo))){$scope.pageData.mixData=$scope.pageData.priceInfo[0].DATES;for(var i=0;$scope.pageData.priceInfo.length>i;i++){var obj={date:$scope.pageData.priceInfo[i].DATES,price:$scope.pageData.priceInfo[i].JIAGE,id:$scope.pageData.priceInfo[i].ID};$scope.pageData.objArr.push(obj)}$scope.pageData.dateData={priceData:$scope.pageData.objArr,selectType:"1",operation:"0",week:[0,1,2,3,4,5,6],startyear:$scope.pageData.mixData}}$scope.pageData.yuanjia=data[0].YUANJIA[0].YUANJIA});var sData=actionManagerService.excuteResource("get_avar_info",{vid:"customer_service"},"","");ajaxManager.ajaxToJson(sData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.TEL=data.DATA[0].VVALUE)})},$scope.init(),$scope.dataResult=function(value){$scope.pageData.startData=value.start.date,$scope.pageData.choiceMoney=value.start.price,$scope.pageData.choiceId=value.start.id;for(var j=0;j<$scope.pageData.priceInfo.length;j++)$scope.pageData.priceInfo[j].ID==$scope.pageData.choiceId&&($scope.pageData.guigeInfo=$scope.pageData.priceInfo[j])},$scope.buyNow=function(){toolsService.isEmpty($scope.pageData.startData)||toolsService.isEmpty($scope.pageData.startData)||toolsService.isEmpty($scope.pageData.startData)?toolsService.showMessage("规格错误",2):(commdityService.saveShopInfoToPayment($scope.pageData.memberid,$scope.pageData.mallInfo.COMMODITY_INFO[0],$scope.pageData.guigeInfo,1,$scope.pageData.startData),$timeout(function(){var params={source:"commodityDetails"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})},300))},$scope.comment=function(item){var id=item.ID,showImgs=item.SHOW_IMGS,badComments=item.BAD_COMMENTS,goodComments=item.GOOD_COMMENTS,qjzs=item.QJZS,pjpxdf=item.PJPXDF,title="商品评价",type=2,params={id:id,title:title,type:type,count:pjpxdf,allTotle:qjzs,greetTotle:goodComments,badTotle:badComments,photoTotle:showImgs};$state.go("common.publiccomment",{params:JSON.stringify(params)})},$scope.addCollection=function(){var id=JSON.parse($state.params.params).id,memberId=$scope.pageData.memberid;AmCommonService.addCollection({id:id,memberid:memberId,type:"commodity"})},$scope.imagePicker=function(){if(0!=$scope.pageData.comImageNum){var title=$scope.pageData.mallInfo.NAME,params=($scope.pageData.fileJSo,{title:title,data:$scope.pageData.fileJSo});$state.go("common.imagePicker",{params:JSON.stringify(params)})}},$scope.share=function(){var id=$scope.pageData.id,content=$scope.pageData.title,img=appConfig.baseUrl+$scope.pageData.mallInfo.MAINIMAGES[0].path,params={id:id,title:content,img:img,url:""};OtherHandleService.share(params)}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.hotel",{url:"/hotel",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/hotel/views/hotel_list_index.html",controller:"HotelListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("HotelListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={title:"酒店",SqlParams:{sql:" ",order:" "},List_Events:{},wyqData:"",wyq:"",wyzData:"",wyz:"",noopsycheData:{name:"智能排序",data:{"综合排序":"1","离我最近":"2","评价最高":"3","人气最高":"4","价格最低":"5","价格最高":"6"}},noopsyche:"",userLocation:Authen.getDriverLocation()};var lng=0,lat=0;lng=$scope.pageData.userLocation.currentPoint.lng,lat=$scope.pageData.userLocation.currentPoint.lat,$scope.init=function(){var sql=" AND ms.mallclass_id = '2' ",order="";toolsService.isEmpty($scope.pageData.wyq)||(sql+=" AND ms.ssjqdqid = '"+$scope.pageData.wyq+"' "),toolsService.isEmpty($scope.pageData.wyz)||(sql+=" AND ms.wyz_id = '"+$scope.pageData.wyz+"' "),order="1"==$scope.pageData.noopsyche?" ORDER BY COALESCE(ms.sort,0) DESC ":"2"==$scope.pageData.noopsyche?" ORDER BY SQRT(("+lng+"-longitud::float)*("+lng+"-longitud::float)+("+lat+"-latitude::float)*("+lat+"-latitude::float)) ASC ":"3"==$scope.pageData.noopsyche?" ORDER BY ms.pjpxdf::FLOAT ASC ":"4"==$scope.pageData.noopsyche?" ORDER BY ms.yscpzs DESC ":"5"==$scope.pageData.noopsyche?" ORDER BY ms.pjjg::FLOAT ASC ":"6"==$scope.pageData.noopsyche?" ORDER BY ms.pjjg::FLOAT DESC ":" ORDER BY COALESCE(ms.sort,0) DESC ",$scope.pageData.SqlParams={sql:sql,order:order,lng:lng,lat:lat}},$scope.init(),$scope.initWyq=function(){var rData=actionManagerService.excuteResource("triph.store.getHotelWyq","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.wyqData={name:"我要去",data:toolsService.formJarryToObject(data.DATA)})})},$scope.initWyq(),$scope.initWyz=function(){var rData=actionManagerService.excuteResource("triph.store.wyzlabel","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.wyzData={name:"我要住",data:toolsService.formJarryToObject(data.DATA)})})},$scope.initWyz(),$scope.noopsySelect=function(value){$scope.pageData.noopsyche=value,$scope.init()},$scope.wyqSelect=function(value){$scope.pageData.wyq=value,console.error($scope.pageData.wyq),$scope.init()},$scope.wywSelect=function(value){$scope.pageData.wyz=value,$scope.init()},$scope.pageData.List_Events={getDetails:function(id){$state.go("commodity.hoteldetails",{params:JSON.stringify({id:id})})}},$scope.toSearch=function(){$state.go("common.search",{})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.hoteldetails",{url:"/hoteldetails/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/hotel/views/hotel_details_index.html",controller:"HotelDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("HotelDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicModal","AmCommonService","$ionicPopup","$location","$ionicScrollDelegate","OtherHandleService","commdityService","$timeout","$ionicBackdrop","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicModal,AmCommonService,$ionicPopup,$location,$ionicScrollDelegate,OtherHandleService,commdityService,$timeout,$ionicBackdrop,$ionicHistory){if($scope.pageData={memberId:Authen.getUserId(),id:JSON.parse($state.params.params).id,title:"",adderssDetlies:"",mainimage:"img/bg.png",comment:"",commentNum:0,avgscore:0,storeImageNum:0,ticketInfoClass:"item-resolution-choice",scenicSpotIntrClass:"item-resolution-not-choice",nearRecClass:"item-resolution-not-choice",commodityData:"",commodityParamData:"",scenicSpotIntrData:"",resoutionState:"1",ticketData:"",goodComments:0,badComments:0,showImgs:0,pjpxdf:0,facilityDetails:[],facilityData:[],commodityNum:0,currentFormat:"",dateData:"",startData:"",endData:"",guigeInfo:"",price:"",fileJSo:[]},Authen.getDriverLocation().currentPoint){var latitude=Authen.getDriverLocation().currentPoint.lat,longitude=Authen.getDriverLocation().currentPoint.lng;$scope.latLng={id:$scope.pageData.id,gps:longitude+","+latitude}}$scope.init=function(){var rData=actionManagerService.getScenicSpotTemplate($scope.pageData.id,"2");ajaxManager.ajaxToJson(rData,function(data){if(console.info(data),$scope.pageData.title=data[0].STORE_NAME,$scope.pageData.adderssDetlies=data[0].ADDRESSDETIL,$scope.pageData.mainimage=data[0].MAINIMGS,$scope.pageData.comment=data[0].COMMENT,$scope.pageData.avgscore=data[0].PJPXDF,$scope.pageData.commentNum=data[0].QJZS,$scope.pageData.commodityData=data[0].MALL_COMMODITY,$scope.pageData.scenicSpotIntrData=data[0].MALL_STOREINFO,toolsService.isEmpty(data[0].MALL_STOREIMAGELIST)||($scope.pageData.fileJSo=toolsService.formImagesToImgpicker(data[0].MALL_STOREIMAGELIST,function(count){$scope.pageData.storeImageNum=count})),$scope.pageData.commodityParamData=data[0].MALL_COMMODITYPARAME,$scope.pageData.goodComments=data[0].GOODCOMMENTS,$scope.pageData.badComments=data[0].BADCOMMENTS,$scope.pageData.showImgs=data[0].SHOW_IMGS,$scope.pageData.pjpxdf=data[0].PJPXDF,toolsService.isEmpty(data[0].FACILITY_DETAILS)||($scope.pageData.facilityDetails=data[0].FACILITY_DETAILS.split(",")),$scope.pageData.facilityDetails.length<=4)for(var i=0;i<$scope.pageData.facilityDetails.length;i++)$scope.pageData.facilityData.push($scope.pageData.facilityDetails[i]);else for(var i=0;4>i;i++)$scope.pageData.facilityData.push($scope.pageData.facilityDetails[i]);$scope.pageData.commodityNum=data[0].MALL_COMMODITY.length})},$scope.init(),$scope.getTicketInfo=function(){$scope.pageData.ticketInfoClass="item-resolution-choice",$scope.pageData.scenicSpotIntrClass="item-resolution-not-choice",$scope.pageData.nearRecClass="item-resolution-not-choice",$scope.pageData.resoutionState="1",$location.hash("homeType"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.getnearRec=function(){$scope.pageData.ticketInfoClass="item-resolution-not-choice",$scope.pageData.scenicSpotIntrClass="item-resolution-not-choice",$scope.pageData.nearRecClass="item-resolution-choice",$scope.pageData.resoutionState="3",$location.hash("nearRec"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.initTicketInfo=function(id){var dataArry=new Array;$scope.pageData.dateData="";for(var i=0;i<$scope.pageData.commodityData.length;i++)$scope.pageData.commodityData[i].ID==id&&($scope.pageData.ticketData=$scope.pageData.commodityData[i],$scope.pageData.currentFormat=$scope.pageData.commodityData[i].MALL_COMMODITYSPECIFICATIONS);if(!toolsService.isEmpty($scope.pageData.currentFormat)){for(var j=0;j<$scope.pageData.currentFormat.length;j++){var obj={date:$scope.pageData.currentFormat[j].DATES,price:$scope.pageData.currentFormat[j].PRICE,id:$scope.pageData.currentFormat[j].ID};dataArry.push(obj)}console.debug(dataArry),$scope.pageData.dateData={priceData:dataArry,selectType:"2",operation:"0",week:[0,1,2,3,4,5,6],startyear:$scope.pageData.currentFormat[0].DATES}}},$scope.dataResult=function(value){$scope.pageData.startData=value.start.date,$scope.pageData.endData=value.end.date,$scope.pageData.choiceId=value.start.id,$scope.pageData.price=value.start.price;for(var j=0;j<$scope.pageData.currentFormat.length;j++)$scope.pageData.currentFormat[j].ID==$scope.pageData.choiceId&&($scope.pageData.guigeInfo=$scope.pageData.currentFormat[j])},$scope.formatBuyNow=function(){toolsService.isEmpty($scope.pageData.guigeInfo)||toolsService.isEmpty($scope.pageData.ticketData)?toolsService.showMessage("规格错误",2):(commdityService.saveShopInfoToPayment($scope.pageData.memberId,$scope.pageData.ticketData,$scope.pageData.guigeInfo,"1",{startDate:$scope.pageData.startData,endDate:$scope.pageData.endData}),$timeout(function(){$scope.closeModal();var params={source:"commodityDetails"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})},300))},$ionicModal.fromTemplateUrl("commonModalTemplate.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){gModal=modal}),$scope.closeModal=function(){gModal.hide(),$ionicBackdrop.release()},$scope.showModal=function(id){$scope.initTicketInfo(id),gModal.show(),$ionicBackdrop.retain(),$(".modal-backdrop").css("width","100%"),$(".modal-backdrop").css("height","85%")},$scope.back=function(){toolsService.goBackPage()},$scope.comment=function(){var id=$scope.pageData.id,showImgs=$scope.pageData.showImgs,badComments=$scope.pageData.badComments,goodComments=$scope.pageData.goodComments,qjzs=$scope.pageData.commentNum,pjpxdf=$scope.pageData.pjpxdf,title="商品评价",type=1,params={id:id,title:title,type:type,count:pjpxdf,allTotle:qjzs,greetTotle:goodComments,badTotle:badComments,photoTotle:showImgs};$state.go("common.publiccomment",{params:JSON.stringify(params)})},$scope.collectionHotel=function(){AmCommonService.addCollection({id:$scope.pageData.id,memberid:$scope.pageData.memberId,type:"store"})},$scope.share=function(){var id=$scope.pageData.id,content=$scope.pageData.title,img=appConfig.baseUrl+$scope.pageData.mainimage[0].path,params={id:id,title:content,img:img,url:""};console.error(params),OtherHandleService.share(params)},$scope.collectionRoom=function(id){AmCommonService.addCollection({id:id,memberid:$scope.pageData.memberId,type:"commodity"})};var dPopup="";$scope.showHotelDetailsPopup=function(){dPopup=$ionicPopup.show({scope:$scope,title:"酒店详情介绍",templateUrl:"app_plugins/store/hotel/views/hotel_details_popup.html"}),$(".popup").css("background-color","#ffffff"),$(".popup").css("width","90%"),$(".popup").css("height","80%"),$(".popup-head").css("border","0px"),$(".popup-body").css("border-bottom","0px")},$scope.closePopup=function(){dPopup.close()},$scope.imagePicker=function(){if(0!=$scope.pageData.storeImageNum){var title=$scope.pageData.title,params=($scope.pageData.fileJSo,{title:title,data:$scope.pageData.fileJSo});$state.go("common.imagePicker",{params:JSON.stringify(params)})}},$scope.$on("$destroy",function(){gModal&&gModal.hide(),dPopup&&dPopup.close()}),$scope.$on("modal.hidden",function(){$ionicBackdrop.release()}),$scope.$on("modal.removed",function(){$ionicBackdrop.release()}),$scope.map=function(){$state.go("commodity.baidumap",{params:JSON.stringify({address:$scope.pageData.adderssDetlies})})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.performing",{url:"/performing",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/performing/views/performing_list_index.html",controller:"PerformingListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("PerformingListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={title:"演艺",SqlParams:{sql:" AND ms.mallclass_id = '4' ",order:" ORDER BY COALESCE(ms.sort,0) DESC "},List_Events:{},userLocation:Authen.getDriverLocation()};var lng=$scope.pageData.userLocation.currentPoint.lng,lat=$scope.pageData.userLocation.currentPoint.lat;$scope.pageData.SqlParams={sql:" AND ms.mallclass_id = '4' ",order:" ORDER BY COALESCE(ms.sort,0) DESC ",lng:lng,lat:lat},$scope.pageData.List_Events={getDetails:function(id){$state.go("commodity.performingdetails",{params:JSON.stringify({id:id})})}},$scope.toSearch=function(){$state.go("common.search",{})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.performingdetails",{url:"/performingdetails/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/performing/views/performing_details_index.html",controller:"PerformingDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("PerformingDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicModal","AmCommonService","commdityService","OtherHandleService","$location","$ionicScrollDelegate","$timeout","$ionicBackdrop","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicModal,AmCommonService,commdityService,OtherHandleService,$location,$ionicScrollDelegate,$timeout,$ionicBackdrop,$ionicHistory){if($scope.pageData={memberId:Authen.getUserId(),id:JSON.parse($state.params.params).id,title:"",adderssDetlies:"",mainimage:"img/bg.png",comment:"",commentNum:"",avgscore:"",storeImageNum:0,screeningsClass:"item-resolution-choice",bookingNotesClass:"item-resolution-not-choice",artsIntroductionClass:"item-resolution-not-choice",nearRecClass:"item-resolution-not-choice",commodityData:"",commodityParamData:"",scenicSpotIntrData:"",resoutionState:"1",ticketData:"",goodComments:0,badComments:0,showImgs:0,pjpxdf:0,buyNumber:1,startData:"",choiceId:"",price:"",dateData:"",currentFormat:"",yscpzs:"",pjj:""},Authen.getDriverLocation().currentPoint){var latitude=Authen.getDriverLocation().currentPoint.lat,longitude=Authen.getDriverLocation().currentPoint.lng;$scope.latLng={id:$scope.pageData.id,gps:longitude+","+latitude}}$scope.init=function(){var rData=actionManagerService.getScenicSpotTemplate($scope.pageData.id,"4");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.title=data[0].STORE_NAME,$scope.pageData.adderssDetlies=data[0].ADDRESSDETIL,$scope.pageData.mainimage=data[0].MAINIMGS,$scope.pageData.comment=data[0].COMMENT,$scope.pageData.avgscore=data[0].PJPXDF,$scope.pageData.commentNum=data[0].QJZS,$scope.pageData.commodityData=data[0].MALL_COMMODITY,$scope.pageData.scenicSpotIntrData=data[0].MALL_STOREINFO,$scope.pageData.yscpzs=data[0].YSCPZS,$scope.pageData.pjj=data[0].PJJG,toolsService.isEmpty(data[0].MALL_STOREIMAGELIST)||($scope.pageData.fileJSo=toolsService.formImagesToImgpicker(data[0].MALL_STOREIMAGELIST,function(count){$scope.pageData.storeImageNum=count})),$scope.pageData.commodityParamData=data[0].MALL_COMMODITYPARAME,$scope.pageData.goodComments=data[0].GOODCOMMENTS,$scope.pageData.badComments=data[0].BADCOMMENTS,$scope.pageData.showImgs=data[0].SHOW_IMGS,$scope.pageData.pjpxdf=data[0].PJPXDF;for(var i=0;i<$scope.pageData.scenicSpotIntrData.length;i++)"预订须知"==$scope.pageData.scenicSpotIntrData[i].CLASSNAME&&($scope.orderKnow=$scope.pageData.scenicSpotIntrData[i].CONTENT),"演艺介绍"==$scope.pageData.scenicSpotIntrData[i].CLASSNAME&&($scope.performingIntr=$scope.pageData.scenicSpotIntrData[i].CONTENT)})},$scope.init(),$scope.getScreenings=function(){$scope.pageData.screeningsClass="item-resolution-choice",$scope.pageData.bookingNotesClass="item-resolution-not-choice",
$scope.pageData.artsIntroductionClass="item-resolution-not-choice",$scope.pageData.nearRecClass="item-resolution-not-choice",$scope.pageData.resoutionState="1",$location.hash("ScenicSpotIntr"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.getBookingNotes=function(){$scope.pageData.screeningsClass="item-resolution-not-choice",$scope.pageData.bookingNotesClass="item-resolution-choice",$scope.pageData.artsIntroductionClass="item-resolution-not-choice",$scope.pageData.nearRecClass="item-resolution-not-choice",$scope.pageData.resoutionState="2",$location.hash("BookingNotes"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.getArtsIntroduction=function(){$scope.pageData.screeningsClass="item-resolution-not-choice",$scope.pageData.bookingNotesClass="item-resolution-not-choice",$scope.pageData.artsIntroductionClass="item-resolution-choice",$scope.pageData.nearRecClass="item-resolution-not-choice",$scope.pageData.resoutionState="3",$location.hash("BookingNotes"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.getnearRec=function(){$scope.pageData.screeningsClass="item-resolution-not-choice",$scope.pageData.bookingNotesClass="item-resolution-not-choice",$scope.pageData.artsIntroductionClass="item-resolution-not-choice",$scope.pageData.nearRecClass="item-resolution-choice",$scope.pageData.resoutionState="4",$location.hash("nearRec"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.initTicketInfo=function(id){$scope.pageData.dateData="",$scope.pageData.guigeInfo="";for(var dataArry=new Array,i=0;i<$scope.pageData.commodityData.length;i++)$scope.pageData.commodityData[i].ID==id&&($scope.pageData.ticketData=$scope.pageData.commodityData[i],$scope.pageData.currentFormat=$scope.pageData.commodityData[i].MALL_COMMODITYSPECIFICATIONS);if(!toolsService.isEmpty($scope.pageData.currentFormat)){for(var j=0;j<$scope.pageData.currentFormat.length;j++){var obj={date:$scope.pageData.currentFormat[j].DATES,price:$scope.pageData.currentFormat[j].PRICE,id:$scope.pageData.currentFormat[j].ID};dataArry.push(obj)}$scope.pageData.dateData={priceData:dataArry,selectType:"1",operation:"0",week:[0,1,2,3,4,5,6],startyear:dataArry[0].date}}},$scope.dataResult=function(value){$scope.pageData.startData=value.start.date,$scope.pageData.choiceId=value.start.id,$scope.pageData.price=value.start.price;for(var j=0;j<$scope.pageData.currentFormat.length;j++)$scope.pageData.currentFormat[j].ID==$scope.pageData.choiceId&&($scope.pageData.guigeInfo=$scope.pageData.currentFormat[j])},$scope.formatBuyNow=function(){toolsService.isEmpty($scope.pageData.ticketData)||toolsService.isEmpty($scope.pageData.guigeInfo)?toolsService.showMessage("规格错误",2):(commdityService.saveShopInfoToPayment($scope.pageData.memberId,$scope.pageData.ticketData,$scope.pageData.guigeInfo,$scope.pageData.buyNumber),console.info($scope.pageData.memberId),$timeout(function(){$scope.closeModal();var params={source:"commodityDetails"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})},300))},$ionicModal.fromTemplateUrl("commonModalTemplate.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){gModal=modal}),$scope.closeModal=function(){gModal.hide(),$ionicBackdrop.release()},$scope.showModal=function(id){$scope.initTicketInfo(id),gModal.show(),$ionicBackdrop.retain(),$(".modal-backdrop").css("width","100%"),$(".modal-backdrop").css("height","85%")},$scope.$on("$destroy",function(){gModal&&gModal.hide()}),$scope.$on("modal.hidden",function(){$ionicBackdrop.release()}),$scope.$on("modal.removed",function(){$ionicBackdrop.release()}),$scope.back=function(){toolsService.goBackPage()},$scope.comment=function(){var id=$scope.pageData.id,showImgs=$scope.pageData.showImgs,badComments=$scope.pageData.badComments,goodComments=$scope.pageData.goodComments,qjzs=$scope.pageData.commentNum,pjpxdf=$scope.pageData.pjpxdf,title="商品评价",type=1,params={id:id,title:title,type:type,count:pjpxdf,allTotle:qjzs,greetTotle:goodComments,badTotle:badComments,photoTotle:showImgs};$state.go("common.publiccomment",{params:JSON.stringify(params)})},$scope.collectionScenicSpot=function(){AmCommonService.addCollection({id:$scope.pageData.id,memberid:$scope.pageData.memberId,type:"store"})},$scope.share=function(){var id=$scope.pageData.id,content=$scope.pageData.title,img=appConfig.baseUrl+$scope.pageData.mainimage[0].path,params={id:id,title:content,img:img,url:""};console.error(params),OtherHandleService.share(params)},$scope.collectionTicket=function(id){AmCommonService.addCollection({id:id,memberid:$scope.pageData.memberId,type:"commodity"})},$scope.imagePicker=function(){if(0!=$scope.pageData.storeImageNum){var title=$scope.pageData.title,params=($scope.pageData.fileJSo,{title:title,data:$scope.pageData.fileJSo});console.error(params),$state.go("common.imagePicker",{params:JSON.stringify(params)})}},$scope.map=function(){$state.go("commodity.baidumap",{params:JSON.stringify({address:$scope.pageData.adderssDetlies})})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.restaurant",{url:"/restaurant",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/restaurant/views/restaurant_list_index.html",controller:"RestaurantListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("RestaurantListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={title:"餐饮",SqlParams:{sql:" ",order:" "},List_Events:{},wyqData:"",wyq:"",wycData:"",wyc:"",noopsycheData:{name:"智能排序",data:{"综合排序":"1","离我最近":"2","评价最高":"3","人气最高":"4","价格最低":"5","价格最高":"6"}},noopsyche:"",userLocation:Authen.getDriverLocation()};var lng=$scope.pageData.userLocation.currentPoint.lng,lat=$scope.pageData.userLocation.currentPoint.lat;$scope.init=function(){var sql=" AND ms.mallclass_id = '3' ",order="";toolsService.isEmpty($scope.pageData.wyq)||(sql+=" AND ms.ssjqdqid = '"+$scope.pageData.wyq+"' "),toolsService.isEmpty($scope.pageData.wyc)||(sql+=" AND ms.wyc_id = '"+$scope.pageData.wyc+"' "),"1"==$scope.pageData.noopsyche?order=" ORDER BY COALESCE(ms.sort,0) DESC ":"2"==$scope.pageData.noopsyche?order=" ORDER BY SQRT(("+lng+"-longitud::float)*("+lng+"-longitud::float)+("+lat+"-latitude::float)*("+lat+"-latitude::float)) ASC ":"3"==$scope.pageData.noopsyche?order=" ORDER BY ms.pjpxdf::FLOAT ASC ":"4"==$scope.pageData.noopsyche?order=" ORDER BY ms.yscpzs DESC ":"5"==$scope.pageData.noopsyche?order=" ORDER BY ms.pjjg::FLOAT ASC ":"6"==$scope.pageData.noopsyche?order+=" ORDER BY ms.pjjg::FLOAT DESC ":order=" ORDER BY COALESCE(ms.sort,0) DESC ",$scope.pageData.SqlParams={sql:sql,order:order,lng:lng,lat:lat}},$scope.init(),$scope.initWyq=function(){var rData=actionManagerService.excuteResource("triph.store.getResWyq","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.wyqData={name:"我要去",data:toolsService.formJarryToObject(data.DATA)})})},$scope.initWyq(),$scope.initWyc=function(){var rData=actionManagerService.excuteResource("triph.store.wyclabel","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.wycData={name:"我要吃",data:toolsService.formJarryToObject(data.DATA)})})},$scope.initWyc(),$scope.noopsySelect=function(value){$scope.pageData.noopsyche=value,$scope.init()},$scope.wyqSelect=function(value){$scope.pageData.wyq=value,$scope.init()},$scope.wycSelect=function(value){$scope.pageData.wyc=value,$scope.init()},$scope.pageData.List_Events={getDetails:function(id){$state.go("commodity.restaurantdetails",{params:JSON.stringify({id:id})})}},$scope.toSearch=function(){$state.go("common.search",{})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.restaurantdetails",{url:"/restaurantdetails/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/restaurant/views/restaurant_details_index.html",controller:"RestaurantDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("RestaurantDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicModal","AmCommonService","$location","$ionicScrollDelegate","OtherHandleService","commdityService","$timeout","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicModal,AmCommonService,$location,$ionicScrollDelegate,OtherHandleService,commdityService,$timeout,$ionicHistory){if($scope.pageData={memberId:Authen.getUserId(),id:JSON.parse($state.params.params).id,title:"",adderssDetlies:"",mainimage:"img/bg.png",comment:"",commentNum:"",avgscore:"",storeImageNum:0,ticketInfoClass:"item-resolution-choice",scenicSpotIntrClass:"item-resolution-not-choice",nearRecClass:"item-resolution-not-choice",commodityData:"",commodityParamData:"",scenicSpotIntrData:"",resoutionState:"",ticketData:"",goodComments:0,badComments:0,showImgs:0,pjpxdf:0,currentFormat:""},Authen.getDriverLocation().currentPoint){var latitude=Authen.getDriverLocation().currentPoint.lat,longitude=Authen.getDriverLocation().currentPoint.lng;$scope.latLng={id:$scope.pageData.id,gps:longitude+","+latitude}}$scope.init=function(){var rData=actionManagerService.getScenicSpotTemplate($scope.pageData.id,"3");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.title=data[0].STORE_NAME,$scope.pageData.adderssDetlies=data[0].ADDRESSDETIL,$scope.pageData.mainimage=data[0].MAINIMGS,$scope.pageData.comment=data[0].COMMENT,$scope.pageData.avgscore=data[0].PJPXDF,$scope.pageData.commentNum=data[0].QJZS,$scope.pageData.commodityData=data[0].MALL_COMMODITY,$scope.pageData.scenicSpotIntrData=data[0].MALL_STOREINFO,toolsService.isEmpty(data[0].MALL_STOREIMAGELIST)||($scope.pageData.fileJSo=toolsService.formImagesToImgpicker(data[0].MALL_STOREIMAGELIST,function(count){$scope.pageData.storeImageNum=count})),$scope.pageData.commodityParamData=data[0].MALL_COMMODITYPARAME,$scope.pageData.goodComments=data[0].GOODCOMMENTS,$scope.pageData.badComments=data[0].BADCOMMENTS,$scope.pageData.showImgs=data[0].SHOW_IMGS,$scope.pageData.pjpxdf=data[0].PJPXDF,console.info()})},$scope.init(),$scope.getTicketInfo=function(){$scope.pageData.ticketInfoClass="item-resolution-choice",$scope.pageData.scenicSpotIntrClass="item-resolution-not-choice",$scope.pageData.nearRecClass="item-resolution-not-choice",$scope.pageData.resoutionState="1",$location.hash("vouchers"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.getScenicSpotIntr=function(){$scope.pageData.ticketInfoClass="item-resolution-not-choice",$scope.pageData.scenicSpotIntrClass="item-resolution-choice",$scope.pageData.nearRecClass="item-resolution-not-choice",$scope.pageData.resoutionState="2",$location.hash("restaurantIntr"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.getnearRec=function(){$scope.pageData.ticketInfoClass="item-resolution-not-choice",$scope.pageData.scenicSpotIntrClass="item-resolution-not-choice",$scope.pageData.nearRecClass="item-resolution-choice",$scope.pageData.resoutionState="3",$location.hash("nearRec"),$ionicScrollDelegate.anchorScroll(),$location.replace()},$scope.back=function(){toolsService.goBackPage()},$scope.comment=function(){var id=$scope.pageData.id,showImgs=$scope.pageData.showImgs,badComments=$scope.pageData.badComments,goodComments=$scope.pageData.goodComments,qjzs=$scope.pageData.commentNum,pjpxdf=$scope.pageData.pjpxdf,title="商品评价",type=1,params={id:id,title:title,type:type,count:pjpxdf,allTotle:qjzs,greetTotle:goodComments,badTotle:badComments,photoTotle:showImgs};$state.go("common.publiccomment",{params:JSON.stringify(params)})},$scope.collectionScenicSpot=function(){AmCommonService.addCollection({id:$scope.pageData.id,memberid:$scope.pageData.memberId,type:"store"})},$scope.share=function(){var id=$scope.pageData.id,content=$scope.pageData.title,img=appConfig.baseUrl+$scope.pageData.mainimage[0].path,params={id:id,title:content,img:img,url:""};console.error(params),OtherHandleService.share(params)},$scope.imagePicker=function(){if(0!=$scope.pageData.storeImageNum){var title=$scope.pageData.title,params=($scope.pageData.fileJSo,{title:title,data:$scope.pageData.fileJSo});console.error(params),$state.go("common.imagePicker",{params:JSON.stringify(params)})}},$scope.formatBuyNow=function(id){for(var i=0;i<$scope.pageData.commodityData.length;i++)$scope.pageData.commodityData[i].ID==id&&($scope.pageData.ticketData=$scope.pageData.commodityData[i],$scope.pageData.currentFormat=$scope.pageData.commodityData[i].MALL_COMSPEC[0]);toolsService.isEmpty($scope.pageData.currentFormat)||toolsService.isEmpty($scope.pageData.ticketData)?toolsService.showMessage("规格错误！",2):(commdityService.saveShopInfoToPayment($scope.pageData.memberId,$scope.pageData.ticketData,$scope.pageData.currentFormat,"1"),$timeout(function(){var params={source:"commodityDetails"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})},300))},$scope.map=function(){$state.go("commodity.baidumap",{params:JSON.stringify({address:$scope.pageData.adderssDetlies})})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.scenicspot",{url:"/scenicspot",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/scenicspot/views/scenic_spot_list_index.html",controller:"ScenicSpotListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ScenicSpotListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={title:"景区",SqlParams:{sql:" ",order:" "},List_Events:{},wyqData:"",wyq:"",wywData:"",wyw:"",noopsycheData:{name:"智能排序",data:{"综合排序":"1","离我最近":"2","评价最高":"3","人气最高":"4","价格最低":"5","价格最高":"6"}},noopsyche:"",userLocation:Authen.getDriverLocation()};var lng=$scope.pageData.userLocation.currentPoint.lng,lat=$scope.pageData.userLocation.currentPoint.lat;$scope.init=function(){var sql=" AND ms.mallclass_id = '1' ",order="";toolsService.isEmpty($scope.pageData.wyq)||(sql+=" AND ms.ssjqdqid = '"+$scope.pageData.wyq+"' "),toolsService.isEmpty($scope.pageData.wyw)||(sql+=" AND ms.wyw_id = '"+$scope.pageData.wyw+"' "),order="1"==$scope.pageData.noopsyche?" ORDER BY COALESCE(ms.sort,0) DESC ":"2"==$scope.pageData.noopsyche?" ORDER BY SQRT(("+lng+"-longitud::float)*("+lng+"-longitud::float)+("+lat+"-latitude::float)*("+lat+"-latitude::float)) ASC ":"3"==$scope.pageData.noopsyche?" ORDER BY ms.pjpxdf::FLOAT ASC ":"4"==$scope.pageData.noopsyche?" ORDER BY ms.yscpzs DESC ":"5"==$scope.pageData.noopsyche?" ORDER BY ms.pjjg::FLOAT ASC ":"6"==$scope.pageData.noopsyche?" ORDER BY ms.pjjg::FLOAT DESC ":" ORDER BY COALESCE(ms.sort,0) DESC ",$scope.pageData.SqlParams={sql:sql,order:order,lng:lng,lat:lat}},$scope.init(),$scope.initWyq=function(){var rData=actionManagerService.excuteResource("triph.store.wyqlabel","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||(data.DATA.push("VALUE","0"),data.DATA.push("NAME","全部"),$scope.pageData.wyqData={name:"我要去",data:toolsService.formJarryToObject(data.DATA)})})},$scope.initWyq(),$scope.initWyw=function(){var rData=actionManagerService.excuteResource("triph.storelist.getWyw","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.wywData={name:"我要玩",data:toolsService.formJarryToObject(data.DATA)})})},$scope.initWyw(),$scope.noopsySelect=function(value){$scope.pageData.noopsyche=value,$scope.init()},$scope.wyqSelect=function(value){$scope.pageData.wyq=value,$scope.init()},$scope.wywSelect=function(value){$scope.pageData.wyw=value,$scope.init()},$scope.pageData.List_Events={getDetails:function(id){$state.go("commodity.scenicspotdetails",{params:JSON.stringify({id:id})})}},$scope.toSearch=function(){$state.go("common.search",{})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("commodity.scenicspotdetails",{url:"/scenicspotdetails/:params",cache:!1,views:{commodity_view:{templateUrl:"app_plugins/store/scenicspot/views/scenic_spot_details_index.html",controller:"ScenicSpotdetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ScenicSpotdetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicModal","AmCommonService","$ionicScrollDelegate","$location","OtherHandleService","commdityService","$timeout","$ionicBackdrop","$anchorScroll","$ionicHistory",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicModal,AmCommonService,$ionicScrollDelegate,$location,OtherHandleService,commdityService,$timeout,$ionicBackdrop,$anchorScroll,$ionicHistory){if(console.debug("ScenicSpotdetailsCtrl.$state.params.params="+$state.params.params),$scope.pageData={memberId:Authen.getUserId(),id:JSON.parse($state.params.params).id,title:"",adderssDetlies:"",mainimage:"",comment:"",commentNum:"",avgscore:"",storeImageNum:0,ticketInfoClass:"item-resolution-choice",scenicSpotIntrClass:"item-resolution-not-choice",nearRecClass:"item-resolution-not-choice",commodityData:"",commodityParamData:"",scenicSpotIntrData:"",resoutionState:"1",ticketData:"",goodComments:0,badComments:0,showImgs:0,pjpxdf:0,fileJSo:"",popupData:"",dataData:{},currentFormat:""},Authen.getDriverLocation().currentPoint){var latitude=Authen.getDriverLocation().currentPoint.lat,longitude=Authen.getDriverLocation().currentPoint.lng;$scope.latLng={id:$scope.pageData.id,gps:longitude+","+latitude}}$scope.init=function(){var rData=actionManagerService.getScenicSpotTemplate($scope.pageData.id,"1");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data)||($scope.pageData.title=data[0].STORE_NAME,$scope.pageData.adderssDetlies=data[0].ADDRESSDETIL,$scope.pageData.mainimage=data[0].MAINIMGS,$scope.pageData.comment=data[0].COMMENT,$scope.pageData.avgscore=data[0].PJPXDF,$scope.pageData.commentNum=data[0].QJZS,$scope.pageData.commodityData=data[0].MALL_COMMODITY,$scope.pageData.scenicSpotIntrData=data[0].MALL_STOREINFO,toolsService.isEmpty(data[0].MALL_STOREIMAGELIST)||($scope.pageData.fileJSo=toolsService.formImagesToImgpicker(data[0].MALL_STOREIMAGELIST,function(count){$scope.pageData.storeImageNum=count})),$scope.pageData.commodityParamData=data[0].MALL_COMMODITYPARAME,$scope.pageData.goodComments=data[0].GOODCOMMENTS,$scope.pageData.badComments=data[0].BADCOMMENTS,$scope.pageData.showImgs=data[0].SHOW_IMGS,$scope.pageData.pjpxdf=data[0].PJPXDF)})},$scope.init(),$scope.getTicketInfo=function(){$scope.pageData.ticketInfoClass="item-resolution-choice",$scope.pageData.scenicSpotIntrClass="item-resolution-not-choice",$scope.pageData.nearRecClass="item-resolution-not-choice",$scope.pageData.resoutionState="1",$location.hash("TicketInfo"),$anchorScroll(),$location.replace()},$scope.getScenicSpotIntr=function(){$scope.pageData.ticketInfoClass="item-resolution-not-choice",$scope.pageData.scenicSpotIntrClass="item-resolution-choice",$scope.pageData.nearRecClass="item-resolution-not-choice",$scope.pageData.resoutionState="2",$location.hash("ScenicSpotIntr"),$anchorScroll(),$location.replace()},$scope.getnearRec=function(){$scope.pageData.ticketInfoClass="item-resolution-not-choice",$scope.pageData.scenicSpotIntrClass="item-resolution-not-choice",$scope.pageData.nearRecClass="item-resolution-choice",$scope.pageData.resoutionState="3",$location.hash("NearRec"),$anchorScroll(),$location.replace()},$scope.initTicketInfo=function(id){for(var i=0;i<$scope.pageData.commodityData.length;i++)$scope.pageData.commodityData[i].ID==id&&($scope.pageData.ticketData=$scope.pageData.commodityData[i],$scope.pageData.currentFormat=$scope.pageData.commodityData[i].MALL_COMSPEC[0])},$ionicModal.fromTemplateUrl("commonModalTemplate.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){gModal=modal}),$scope.closeModal=function(){gModal.hide(),$ionicBackdrop.release()},$scope.showModal=function(id){$scope.initTicketInfo(id),gModal.show(),$ionicBackdrop.retain(),$(".modal-backdrop").css("width","100%"),$(".modal-backdrop").css("height","85%")},$scope.$on("$destroy",function(){gModal&&gModal.hide()}),$scope.$on("modal.hidden",function(){$ionicBackdrop.release()}),$scope.$on("modal.removed",function(){$ionicBackdrop.release()}),$scope.back=function(){toolsService.goBackPage()},$scope.comment=function(){var id=$scope.pageData.id,showImgs=$scope.pageData.showImgs,badComments=$scope.pageData.badComments,goodComments=$scope.pageData.goodComments,qjzs=$scope.pageData.commentNum,pjpxdf=$scope.pageData.pjpxdf,title="商品评价",type=1,params={id:id,title:title,type:type,count:pjpxdf,allTotle:qjzs,greetTotle:goodComments,badTotle:badComments,photoTotle:showImgs};$state.go("common.publiccomment",{params:JSON.stringify(params)})},$scope.collectionScenicSpot=function(){AmCommonService.addCollection({id:$scope.pageData.id,memberid:$scope.pageData.memberId,type:"store"})},$scope.share=function(){var id=$scope.pageData.id,content=$scope.pageData.title,img=appConfig.baseUrl+$scope.pageData.mainimage[0].path,params={id:id,title:content,img:img,url:""};console.error(params),OtherHandleService.share(params)},$scope.collectionTicket=function(id){AmCommonService.addCollection({id:id,memberid:$scope.pageData.memberId,type:"commodity"})},$scope.imagePicker=function(){if(0!=$scope.pageData.storeImageNum){var title=$scope.pageData.title,params=($scope.pageData.fileJSo,{title:title,data:$scope.pageData.fileJSo});console.error(params),$state.go("common.imagePicker",{params:JSON.stringify(params)})}},$scope.formatBuyNow=function(){toolsService.isEmpty($scope.pageData.ticketData)||toolsService.isEmpty($scope.pageData.currentFormat)?toolsService.showMessage("规格错误",2):(commdityService.saveShopInfoToPayment($scope.pageData.memberId,$scope.pageData.ticketData,$scope.pageData.currentFormat,"1"),$timeout(function(){$scope.closeModal();var params={source:"commodityDetails"};$state.go("payment.comdConfirmPayment",{params:JSON.stringify(params)})},300))},$scope.map=function(){stateGo.go("commodity.baidumap",{address:$scope.pageData.adderssDetlies},!1)}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("mall.grassland",{url:"/grassland",cache:!0,views:{"am-grassland":{templateUrl:"app_plugins/through_grassland/views/through_grassland_page.html",controller:"GrasslandCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("GrasslandCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","appConfig",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,appConfig){$scope.pageData={backgroundImage:"/files/MJYC_RESOURCEMANAGEMENT/6b3f56ed-2fed-475c-b5b7-ddbec37dbe72/bdpserverroute/fd309930-9662-4c13-8ed2-d4d9606af6cf.png",grasslandData:""},$scope.init=function(){$scope.getBannerInfo()},$scope.getBannerInfo=function(){var bannerParam={condition:" and am_mobliemenuid='menu_grassland' and orgcode='"+appConfig.appOrg+"'"},rData=actionManagerService.excuteResource("banner_active_info",bannerParam,"","");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.grasslandData=data.DATA,toolsService.createSwiper(".grassland_swiper",".grassland-pagination"))})},$scope.toPage=function(url){toolsService.toStateOfServerUrl($state,url)},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("common.addfriend",{url:"/addfriend/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/uoou/common/addfriends/views/addfriend_page.html",controller:"AddfriendsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("AddfriendsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","$ionicPopup","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,$ionicPopup,stateGo){$scope.pData={account:"",remark:"",friendid:"",groupnumber:"",errormessage:"",groupname:"",tabs:0,active_css:0},$scope.selectTab=function(params){$scope.pData.active_css=params,$scope.pData.tabs=params},toolsService.isEmpty(JSON.parse($state.params.params))||($scope.pData.account=JSON.parse($state.params.params).account),$scope.back=function(){toolsService.goBackPage()},$scope.addfriend=function(){var uuid=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="uu_friends";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("member_id",$scope.pData.friendid),row.addColumn("friend_id",Authen.getUserId()),row.addColumn("care_status","0"),row.addColumn("shield_status","0"),row.addColumn("friends_status","0"),row.addColumn("remark",$scope.pData.remark),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("申请失败,请重启应用！",1):toolsService.showMessage("申请成功,请等待好友审核！",1)})},$scope.selectbyMemberid=function(account){if(toolsService.isEmpty(account))return void toolsService.tips("请输入好友账号!",1e3);var param={account:account},rData=actionManagerService.excuteResource("uoou.selectbymemberaccount",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!(data.DATA.length>0))return void toolsService.tips("此账号不存在,请检查!",1e3);if(data.DATA[0].ID==Authen.getUserId())return void toolsService.tips("不能添加自己为好友!",1e3);$scope.friend_memberid=data.DATA[0].ID;var param1={memberid:data.DATA[0].ID,friend_id:Authen.getUserId()},rData1=actionManagerService.excuteResource("uoou.addfriend.selectFriendsByMemberid",param1,"none","none");ajaxManager.ajaxToJson(rData1,function(data1){data1.DATA.length>0?"0"==data1.DATA[0].FRIENDS_STATUS?toolsService.tips("你已申请过此会员为好友，请等待对方同意!",1e3):toolsService.tips("你们已经是好友!",1e3):($scope.pData.friendid=data.DATA[0].ID,$scope.toMemberInfo($scope.pData.friendid))})})},$scope.toMemberInfo=function(memberid){stateGo.go("dynamic.mydynamic",{id:memberid},!1)},$scope.clickAddFriend=function(){if(toolsService.isEmpty($scope.pData.account))return void toolsService.tips("请输入好友账号!",1e3);var param={loginaccount:$scope.pData.account},rData=actionManagerService.excuteResource("uoou.selectbymemberaccount",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA.length>0&&$scope.selectbyMemberid(data.DATA[0].ID)})},$scope.addgroup=function(groupnumber,id){var uuid=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="uu_group_members";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("demand_status","0"),row.addColumn("uu_group_id",id),row.addColumn("group_member_id",Authen.getUserId()),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("申请失败,请重启应用！",1):toolsService.showMessage("申请成功,请去群组列表查看！",1)})},$scope.checkjoingroup=function(groupnumber,id){var param={groupno:groupnumber,memberid:Authen.getUserId()},rData=actionManagerService.excuteResource("uoou.addfriend.checkWhetherToJoinGroup",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){return data.DATA.length>0?void toolsService.tips("您已加入此群!",1e3):void $scope.addgroup(groupnumber,id)},function(data){})},$scope.checkgroup=function(groupnumber){if(toolsService.isEmpty(groupnumber))return void toolsService.tips("请输入群账号!",1e3);var param={groupno:groupnumber},rData=actionManagerService.excuteResource("uoou.addfriend.checkIsgroup",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){return data.DATA.length<1?void toolsService.tips("此群未找着!",1e3):void $scope.checkjoingroup(groupnumber,data.DATA[0].ID)},function(data){})},$scope.addGroup=function(){$scope.checkgroup($scope.pData.groupnumber)},$scope.qrcode=function(){cordova.plugins.barcodeScanner.scan(function(result){""!=result.text&&$scope.selectbyMemberid(result.text)},function(error){console.debug("扫码错误!")})},$scope.createMyGroup=function(){var rData=actionManagerService.createGroup($scope.pData.groupname,Authen.getUserId());ajaxManager.ajaxToJson(rData,function(data){var templatehtml="<div style='width:100%;text-align: center;'>"+data.MESSAGE+"</div>";toolsService.tops(templatehtml)},function(data){})},$scope.creategroup=function(){$scope.pData.errormessage="",$scope.pData.groupname="";var templatehtml="<div style='width:100%;text-align: center;'><span ng-bind='pData.errormessage'></span><br/><input style='padding-left: 10px;border: 1px solid rgb(221, 221, 221);' type='text' placeholder='请输入群名称' ng-model='pData.groupname'></div>";$ionicPopup.show({template:templatehtml,title:"群组创建",scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>创建</b>",type:"btn1",onTap:function(e){if($scope.pData.groupname){var reg=/\s/;reg.test($scope.pData.groupname)?($scope.pData.errormessage="群名称里存在空格!",e.preventDefault()):$scope.pData.groupname.length>50?($scope.pData.errormessage="群名称长度不允许超过50!",e.preventDefault()):($scope.pData.groupname,$scope.createMyGroup())}else $scope.pData.errormessage="不允许存在空值！",e.preventDefault()}}]})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("common.mess",{url:"/mess",cache:!1,views:{common_view:{templateUrl:"app_plugins/uoou/common/addfriends/views/mess_page.html",controller:"messCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("messCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,$ionicPopup){function parse(arg){return"undefined"!=typeof ioNull?ioNull.emoji.parse(arg):""}$scope.pData={emojihtml:[]};new Swiper(".swiper-container",{pagination:".swiper-pagination",centeredSlides:!0,spaceBetween:30,grabCursor:!0,observer:!0});$scope.emjoi_parse=function(arg){alert(parse(arg))},$scope.renderEmoji=function(){for(var countImgNumber=(4*parseInt(screen.width/32),0),i=0;i<getEmojiList().length;i++)countImgNumber+=getEmojiList()[i].length;for(var thispagenumber=1,emojiarray=new Array,emos=null,i=0;i<getEmojiList().length;i++){emos=getEmojiList()[i];for(var j=0;j<emos.length;j++)emojiarray[thispagenumber]="data:image/png;base64,"+emos[j][2],thispagenumber++;console.info(emojiarray)}}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("common.chat",{url:"/chat/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{common_view:{templateUrl:"app_plugins/uoou/common/chat/views/chat_page.html",controller:"ChatCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ChatCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicScrollDelegate","$timeout","ReceiveMessageService","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicScrollDelegate,$timeout,ReceiveMessageService,stateGo){$scope.pData={pushMessage:[],pushContent:"",memberId:Authen.getUserId(),memberName:Authen.getUserName(),friendId:JSON.parse($state.params.params).friendId,
friendName:"",friendHead:"",friendPhone:"",memberHead:"",phone:Authen.getUserInfo().PHONE,friendMessage:"",imgPath:"",showType:!1,footerHeight:"height:50px;"},ionic.Platform.isAndroid()||($scope.pData.head_line=54,$scope.pData.head_button_top=10),$scope.$on("FromSelf",function(event,data){$scope.getLocaltionInfo(),$scope.$digest(),$scope.scrollBottom(),window.plugins.jPushPlugin.removeLocalNotification("18700424842")}),$scope.scrollBottom=function(){$ionicScrollDelegate.$getByHandle("mainScroll").scrollBottom([!0])},$scope.getLocaltionInfo=function(){var message=localStorage.getItem("message");if(!toolsService.isEmpty(message)){$scope.pData.pushMessage=JSON.parse(message);for(var i=0;i<$scope.pData.pushMessage.length;i++)$scope.pData.pushMessage[i].friendid==$scope.pData.friendId&&$scope.pData.pushMessage[i].memberid==$scope.pData.memberId&&($scope.pData.friendMessage=$scope.pData.pushMessage[i],$scope.pData.pushMessage[i].messagenum=0)}localStorage.setItem("message",JSON.stringify($scope.pData.pushMessage))},$scope.emoji=function(){$("#area2").emoji({button:"#emoji_btn_1",showTab:!0,animation:"none",icons:[{tab_url:"img/face/1.png",name:"表情一",path:"img/face/",maxNum:27,file:".png"},{tab_url:"img/face_2/1.png",name:"表情二",path:"img/face_2/",maxNum:100,file:".png"},{tab_url:"img/face_3/xjx.png",name:"表情三",path:"img/face_3/",maxNum:80,file:".gif"},{tab_url:"img/face_4/pb.png",name:"表情四",path:"img/face_4/",maxNum:33,file:".gif"}]})},$scope.init=function(){var get_user_info_data=actionManagerService.excuteResource("getUserBasInfo",{memberid:$scope.pData.memberId},"none","none");ajaxManager.ajaxToJson(get_user_info_data,function(data){!toolsService.isEmpty(data.DATA)&&data.DATA.length>0&&($scope.pData.memberHead=data.DATA[0].WXHEADIMG)});var rData=actionManagerService.excuteResource("uoou.chat.pushmessage",{friendid:$scope.pData.friendId,memberid:$scope.pData.memberId},"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.getLocaltionInfo(),toolsService.isEmpty(data.DATA)||(toolsService.isEmpty(data.DATA[0].REMARK_NAME)?$scope.pData.friendName=data.DATA[0].MEMBERNAME:$scope.pData.friendName=data.DATA[0].REMARK_NAME,$scope.pData.friendHead=data.DATA[0].WXHEADIMG,$scope.pData.friendPhone=data.DATA[0].PHONE,$scope.getLocaltionInfo(),$scope.emoji())})},$scope.init(),$scope.send_img=function(){var rData="";console.debug($scope.pData.imgPath),rData=actionManagerService.pushMessage($scope.pData.memberName,"[图片]",JSON.stringify($scope.pData.imgPath),$scope.pData.friendId,$scope.pData.memberId,$scope.pData.phone),ajaxManager.ajaxToJson(rData,function(data){if(toolsService.isEmpty(data.msg_id))toolsService.showMessage("目标账户异常!",1e3);else if(toolsService.isEmpty(data.msg_id))toolsService.showMessage("发送失败！请稍后重试！");else{console.debug(data);var myDate=new Date;if(myDate=myDate.Format("yyyy-MM-dd hh:mm:ss"),toolsService.isEmpty($scope.pData.friendMessage)){var message={memberid:$scope.pData.memberId,friendid:$scope.pData.friendId,friendname:$scope.pData.friendName,friendremark:$scope.pData.friendName,friendhead:$scope.pData.friendHead,messagenum:"0",pushtime:myDate,message:[{memberid:$scope.pData.memberId,content:$scope.pData.pushContent,imgcontent:$scope.pData.imgPath,createtime:myDate}]};$scope.pData.pushMessage.push(message)}else for(var message={memberid:$scope.pData.memberId,imgcontent:$scope.pData.imgPath,createtime:myDate},i=0;i<$scope.pData.pushMessage.length;i++)$scope.pData.pushMessage[i].friendid==$scope.pData.friendId&&$scope.pData.pushMessage[i].memberid==$scope.pData.memberId&&($scope.pData.pushMessage[i].message.push(message),$scope.pData.pushMessage[i].messagenum=0);localStorage.setItem("message",JSON.stringify($scope.pData.pushMessage)),$scope.getLocaltionInfo(),$scope.pData.imgPath="",$scope.pData.showType=!1,$scope.pData.footerHeight="height:50px;",$scope.scrollBottom()}})},$scope.send_message=function(){if($scope.pData.pushContent=$("#area2").html().toString(),$scope.pData.pushContent.length>2728)return void toolsService.showMessage("您所输入的消息过长！","1");var rData="";console.debug($scope.pData.imgPath),rData=actionManagerService.pushMessage($scope.pData.memberName,$scope.pData.pushContent,$scope.pData.imgPath,$scope.pData.friendId,$scope.pData.memberId,$scope.pData.phone),ajaxManager.ajaxToJson(rData,function(data){if(toolsService.isEmpty(data.msg_id))toolsService.showMessage("目标账户异常!",1e3);else if(toolsService.isEmpty(data.msg_id))toolsService.showMessage("发送失败！请稍后重试！");else{console.debug(data);var myDate=new Date;if(myDate=myDate.Format("yyyy-MM-dd hh:mm:ss"),toolsService.isEmpty($scope.pData.friendMessage)){var message={memberid:$scope.pData.memberId,friendid:$scope.pData.friendId,friendname:$scope.pData.friendName,friendremark:$scope.pData.friendName,friendhead:$scope.pData.friendHead,messagenum:"0",pushtime:myDate,message:[{memberid:$scope.pData.memberId,content:$scope.pData.pushContent,createtime:myDate}]};$scope.pData.pushMessage.push(message)}else for(var message={memberid:$scope.pData.memberId,content:$scope.pData.pushContent,createtime:myDate},i=0;i<$scope.pData.pushMessage.length;i++)$scope.pData.pushMessage[i].friendid==$scope.pData.friendId&&$scope.pData.pushMessage[i].memberid==$scope.pData.memberId&&($scope.pData.pushMessage[i].message.push(message),$scope.pData.pushMessage[i].messagenum=0);localStorage.setItem("message",JSON.stringify($scope.pData.pushMessage)),$scope.getLocaltionInfo(),$scope.pData.pushContent="",$("#area2").html(""),$scope.pData.showType=!1,$scope.pData.footerHeight="height:50px;",$scope.scrollBottom()}})},$scope.pushMessage=function(){$scope.pData.pushContent=$("#area2").html().toString(),toolsService.isEmpty($scope.pData.imgPath)&&toolsService.isEmpty($scope.pData.pushContent)?toolsService.showMessage("请输入内容！","1"):toolsService.isEmpty($scope.pData.imgPath)&&!toolsService.isEmpty($scope.pData.pushContent)?$scope.send_message():!toolsService.isEmpty($scope.pData.imgPath)&&toolsService.isEmpty($scope.pData.pushContent)?$scope.send_img():($scope.send_message(),$scope.send_img())},$scope.clickImg=function(){$scope.pData.showType?($(".btn-push").css("position","absolute"),$(".ion-plus-circled").css("position","absolute"),$scope.pData.showType=!1,$scope.pData.footerHeight="height:50px;"):($(".btn-push").css("position","inherit"),$(".ion-plus-circled").css("position","inherit"),$scope.pData.showType=!0,$scope.pData.pushContent="",$scope.pData.footerHeight="height:120px;")},$scope.emojiImg=function(){$scope.pData.showType=!1,$scope.pData.footerHeight="height:50px;"},$scope.select_content_focus=function(){$scope.pData.showType&&$scope.clickImg()},$timeout(function(){$scope.scrollBottom()},900),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("common.groupchat",{url:"/groupchat/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{common_view:{templateUrl:"app_plugins/uoou/common/chat/views/group_chat_page.html",controller:"GroupChatCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("GroupChatCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicScrollDelegate","$timeout","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicScrollDelegate,$timeout,stateGo){$scope.pData={groupId:JSON.parse($state.params.params).groupId,groupNo:"",groupName:"",pushContent:"",memberId:Authen.getUserId(),memberName:Authen.getUserName(),memberHead:Authen.getUserInfo().WXHEADIMG,groupMessage:"",pushMessage:[],imgPath:"",showType:!1,footerHeight:"height:50px;"},$scope.$on("GroupFromSelf",function(event,data){$scope.getLocaltionInfo(),$scope.$digest(),$scope.scrollBottom()}),$scope.getLocaltionInfo=function(){var message=localStorage.getItem("group_message");if(!toolsService.isEmpty(message)){$scope.pData.pushMessage=JSON.parse(message);for(var i=0;i<$scope.pData.pushMessage.length;i++)$scope.pData.pushMessage[i].groupid==$scope.pData.groupId&&($scope.pData.groupMessage=$scope.pData.pushMessage[i],$scope.pData.pushMessage[i].messagenum=0)}localStorage.setItem("group_message",JSON.stringify($scope.pData.pushMessage))},$scope.scrollBottom=function(){$ionicScrollDelegate.$getByHandle("mainScroll").scrollBottom([!0])},$scope.personDynamic=function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)},$scope.emoji=function(){$("#area2").emoji({button:"#emoji_btn_1_group",showTab:!0,animation:"none",icons:[{tab_url:"img/face/1.png",name:"表情一",path:"img/face/",maxNum:27,file:".png"},{tab_url:"img/face_2/1.png",name:"表情二",path:"img/face_2/",maxNum:100,file:".png"},{tab_url:"img/face_3/xjx.png",name:"表情三",path:"img/face_3/",maxNum:80,file:".gif"},{tab_url:"img/face_4/pb.png",name:"表情四",path:"img/face_4/",maxNum:33,file:".gif"}]})},$scope.init=function(){var rData=actionManagerService.excuteResource("uoou.chat.groupchat",{memberid:$scope.pData.groupId},"none","none");ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||(console.debug(data),$scope.pData.groupName=data.DATA[0].GROUP_NAME,$scope.pData.groupNo=data.DATA[0].GROUP_NO),$scope.getLocaltionInfo(),$scope.emoji()})},$scope.init(),$scope.send_img=function(){rData=actionManagerService.pushGroupMessage($scope.pData.memberName,"[图片]",JSON.stringify($scope.pData.imgPath),$scope.pData.groupId,$scope.pData.memberId,$scope.pData.groupNo),toolsService.isEmpty($scope.pData.imgPath)&&toolsService.isEmpty($scope.pData.pushContent)?toolsService.showMessage("请输入内容！","1"):ajaxManager.ajaxToJson(rData,function(data){if(toolsService.isEmpty(data.msg_id))toolsService.showMessage("发送失败！请稍后重试！");else{console.debug(data);var myDate=new Date;if(myDate=myDate.Format("yyyy-MM-dd hh:mm:ss"),toolsService.isEmpty($scope.pData.groupMessage)){var message={groupid:$scope.pData.groupId,groupname:$scope.pData.groupName,messagenum:"0",pushtime:myDate,message:[{memberid:$scope.pData.memberId,membername:$scope.pData.memberName,memberhead:$scope.pData.memberHead,imgcontent:$scope.pData.imgPath,createtime:myDate}]};$scope.pData.pushMessage.push(message)}else for(var message={memberid:$scope.pData.memberId,membername:$scope.pData.memberName,memberhead:$scope.pData.memberHead,imgcontent:$scope.pData.imgPath,createtime:myDate},i=0;i<$scope.pData.pushMessage.length;i++)$scope.pData.pushMessage[i].groupid==$scope.pData.groupId&&($scope.pData.pushMessage[i].message.push(message),$scope.pData.pushMessage[i].messagenum=0);localStorage.setItem("group_message",JSON.stringify($scope.pData.pushMessage)),$scope.getLocaltionInfo(),$scope.pData.imgPath="",$scope.pData.showType=!1,$scope.pData.footerHeight="height:50px;",$scope.scrollBottom()}})},$scope.send_Message=function(){$scope.pData.pushContent=$("#area2").html().toString(),rData=actionManagerService.pushGroupMessage($scope.pData.memberName,$scope.pData.pushContent,$scope.pData.imgPath,$scope.pData.groupId,$scope.pData.memberId,$scope.pData.groupNo),toolsService.isEmpty($scope.pData.imgPath)&&toolsService.isEmpty($scope.pData.pushContent)?toolsService.showMessage("请输入内容！","1"):ajaxManager.ajaxToJson(rData,function(data){if(toolsService.isEmpty(data.msg_id))toolsService.showMessage("发送失败！请稍后重试！");else{console.debug(data);var myDate=new Date;if(myDate=myDate.Format("yyyy-MM-dd hh:mm:ss"),toolsService.isEmpty($scope.pData.groupMessage)){var message={groupid:$scope.pData.groupId,groupname:$scope.pData.groupName,messagenum:"0",pushtime:myDate,message:[{memberid:$scope.pData.memberId,membername:$scope.pData.memberName,memberhead:$scope.pData.memberHead,content:$scope.pData.pushContent,createtime:myDate}]};$scope.pData.pushMessage.push(message)}else for(var message={memberid:$scope.pData.memberId,membername:$scope.pData.memberName,memberhead:$scope.pData.memberHead,content:$scope.pData.pushContent,createtime:myDate},i=0;i<$scope.pData.pushMessage.length;i++)$scope.pData.pushMessage[i].groupid==$scope.pData.groupId&&($scope.pData.pushMessage[i].message.push(message),$scope.pData.pushMessage[i].messagenum=0);localStorage.setItem("group_message",JSON.stringify($scope.pData.pushMessage)),$scope.getLocaltionInfo(),$scope.pData.pushContent="",$("#area2").html(""),$scope.pData.showType=!1,$scope.pData.footerHeight="height:50px;",$scope.scrollBottom()}})},$scope.pushMessage=function(){$scope.pData.pushContent=$("#area2").html().toString(),toolsService.isEmpty($scope.pData.imgPath)&&toolsService.isEmpty($scope.pData.pushContent)?toolsService.showMessage("请输入内容！","1"):toolsService.isEmpty($scope.pData.imgPath)&&!toolsService.isEmpty($scope.pData.pushContent)?$scope.send_Message():!toolsService.isEmpty($scope.pData.imgPath)&&toolsService.isEmpty($scope.pData.pushContent)?$scope.send_img():($scope.send_Message(),$scope.send_img())},$scope.clickImg=function(){$scope.pData.showType?($(".btn-push").css("position","absolute"),$(".ion-plus-circled").css("position","absolute"),$scope.pData.showType=!1,$scope.pData.footerHeight="height:50px;"):($(".btn-push").css("position","inherit"),$(".ion-plus-circled").css("position","inherit"),$scope.pData.showType=!0,$scope.pData.pushContent="",$scope.pData.footerHeight="height:120px;")},$scope.select_content_focus=function(){$scope.pData.showType&&$scope.clickImg()},$scope.groupDetails=function(){stateGo.go("contacts.groupdetails",{id:$scope.pData.groupId},!1)},$timeout(function(){$scope.getLocaltionInfo(),console.debug($scope.pData.pushMessage),$scope.scrollBottom()},100),$scope.select_max_length=function(){var t=document.getElementById("area2").innerText;if(t.length>200&&(document.getElementById("area2").innerHTML=t.substring(0,200)),window.getSelection){document.getElementById("area2").focus();var range=window.getSelection();range.selectAllChildren(document.getElementById("area2")),range.collapseToEnd()}else if(document.selection){var range=document.selection.createRange();range.moveToElementText(document.getElementById("area2")),range.collapse(!1),range.select()}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("common.visitors",{url:"/visitors/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/uoou/common/visitor_flow/views/visitor_page.html",controller:"visitorCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("visitorCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo","$ionicScrollDelegate","$timeout",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo,$ionicScrollDelegate,$timeout){$scope.pData={params:{userid:JSON.parse($state.params.params).id},list_events:{}},$scope.pData.list_events={to_dynamic:function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mall.contacts",{url:"/contacts",cache:!1,access_level:ACCESS_LEVELS.user,views:{contacts_view:{templateUrl:"app_plugins/uoou/contacts/views/contacts_view_page.html",controller:"ContactsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ContactsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){$scope.pData={listEvents:"",rightDiv:"<i class='ion-ios-plus-outline addTitle'></i>",memberId:Authen.getUserId(),repeatdata:[],newrepeatdata:[],likerepeatdata:[],param:{memberId:Authen.getUserId(),friendsStatus:1,order:"mem.membername"},groupParam:{memberId:Authen.getUserId(),demandStatus:1},likeFriend:{memberId:Authen.getUserId(),friendsStatus:1,careStatus:1,order:"mem.membername"},newFriend:{memberId:Authen.getUserId(),friendsStatus:0,order:"fr.create_time"}};var currentIndex=0;$scope.pData.type=currentIndex,$scope.pData.comdSelectCards=[{title:"好友",CSS:"school_situation_selected",show:!0},{title:"群组",CSS:"class_exper_rq",show:!1},{title:"关心",CSS:"class_exper_rq",show:!1},{title:"新朋友",CSS:"class_exper_rq",show:!0}],$scope.selectCards=function(index){for(var i=0;i<$scope.pData.comdSelectCards.length;i++)i==index?($scope.pData.comdSelectCards[i].CSS="school_situation_selected",$scope.pData.comdSelectCards[i].show=!0):($scope.pData.comdSelectCards[i].CSS="class_exper_rq",$scope.pData.comdSelectCards[i].show=!1);currentIndex=index,$scope.pData.type=currentIndex,"0"!=$scope.pData.type?$scope.pData.rightDiv="":$scope.pData.rightDiv="<i class='ion-ios-plus-outline addTitle'></i>"},toolsService.isEmpty($state.params.params)||$scope.selectCards(3),$scope.addFriend=function(){stateGo.go("common.addfriend",{},!1)},$scope.pData.list_events={personDynamic:function(id){console.debug(id),stateGo.go("dynamic.mydynamic",{id:id},!1)},store_details:function(id){var rData=actionManagerService.excuteResource("uoou.setstore.getStoreByMemberid",{memberid:id},"none","none");ajaxManager.ajaxToJson(rData,function(data){!toolsService.isEmpty(data)&&data.DATA.length>0&&($scope.pData.storeInfo=data.DATA[0],stateGo.go("message.shopdetails",{id:$scope.pData.storeInfo.ID},!1))})},deleteFriend:function(id,friendid){console.debug(1);var params=new formatAmSqlParams;params.TABLENAME="uu_friends";var row=new formatAmSqlupdateRow;row.setID(id),console.debug(id),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params);toolsService.confirm("删除好友","确定要删除吗？",function(){var rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){for(var i=0;i<$scope.pData.repeatdata.length;i++)if($scope.pData.repeatdata[i].ID==id){$scope.pData.repeatdata.splice(i,1);break}var param1={memberid:friendid,friend_id:Authen.getUserId()},rData1=actionManagerService.excuteResource("uoou.addfriend.selectFriendsByMemberid",param1,"none","none");ajaxManager.ajaxToJson(rData1,function(data1){if(!toolsService.isEmpty(data1)&&data1.DATA.length>0){var params1=new formatAmSqlParams;params1.TABLENAME="uu_friends";var row1=new formatAmSqlupdateRow;row1.setID(data1.DATA[0].ID),console.debug(data1.DATA[0].ID),row1.setStatus("d"),params1.addRow(row1);var dateparam=formatAmSqlParamsToArr(params1),rDatas=actionManagerService.excuteAmUpdate(dateparam);ajaxManager.ajaxToJson(rDatas,function(data){})}})})})},notLike:function(id){var params=new formatAmSqlParams;params.TABLENAME="uu_friends";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("u"),row.addColumn("care_status",0),params.addRow(row);var param=formatAmSqlParamsToArr(params);$ionicPopup.confirm({template:"确定要取消关注吗？",title:"取消关注",buttons:[{text:"取消",type:"btnc"},{text:"确定",type:"btn1",onTap:function(){var rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){for(var i=0;i<$scope.pData.likerepeatdata.length;i++)if($scope.pData.likerepeatdata[i].ID==id){$scope.pData.likerepeatdata.splice(i,1);break}})}}]})},agreeFriend:function(id,friendid){var params=new formatAmSqlParams;params.TABLENAME="uu_friends";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("u"),row.addColumn("friends_status",1),params.addRow(row);var param=formatAmSqlParamsToArr(params);toolsService.confirm("添加好友","确定要同意吗？",function(){var rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){var uuid=toolsService.uuid(),memberid=Authen.getUserId(),params=new formatAmSqlParams;params.TABLENAME="uu_friends";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("member_id",friendid),row.addColumn("friend_id",memberid),row.addColumn("care_status",0),row.addColumn("shield_status",0),row.addColumn("friends_status",1),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){for(var i=0;i<$scope.pData.newrepeatdata.length;i++)if($scope.pData.newrepeatdata[i].ID==id){$scope.pData.newrepeatdata.splice(i,1);break}})})})},scanMessage:function(id){$state.go("common.chat",{params:JSON.stringify({friendId:id})},{})},scanGroupMessage:function(id){console.debug(id),$state.go("common.groupchat",{params:JSON.stringify({groupId:id})},{})}}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("contacts.groupdetails",{url:"/groupdetails/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_contacts:{templateUrl:"app_plugins/uoou/contacts/group_details/views/group_details_page.html",controller:"GroupDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("GroupDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicScrollDelegate","$timeout","ReceiveMessageService","stateGo","$ionicModal","$ionicBackdrop","$ionicPopup","$window",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicScrollDelegate,$timeout,ReceiveMessageService,stateGo,$ionicModal,$ionicBackdrop,$ionicPopup,$window){$scope.pData={memberId:Authen.getUserId(),groupData:"",groupId:JSON.parse($state.params.params).id,groupMemberId:"",groupName:"",groupNo:"",groupMemberData:"",friendData:"",operationStatus:"",operationData:""},$scope.queryGroupMember=function(){var mData=actionManagerService.excuteResource("uoou.contacts.getGroupDetailsBygroupId",{groupid:$scope.pData.groupId},"none","none");ajaxManager.ajaxToJson(mData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.groupMemberData=data.DATA)})},$scope.queryGroupFriend=function(){var mData=actionManagerService.excuteResource("uu.contacts.frinedslist",{memberId:$scope.pData.memberId,friendsStatus:"1",groupId:$scope.pData.groupId},"none","none");ajaxManager.ajaxToJson(mData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.friendData=data.DATA)})},$scope.init=function(){var rData=actionManagerService.excuteResource("uoou.chat.groupchat",{memberid:$scope.pData.groupId},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.groupData=data.DATA[0],console.debug($scope.pData.groupData),$scope.pData.groupName=data.DATA[0].GROUP_NAME,$scope.pData.groupNo=data.DATA[0].GROUP_NO,$scope.pData.groupMemberId=data.DATA[0].MEMBER_ID,$scope.queryGroupMember())})},$scope.init();var gModal="";$ionicModal.fromTemplateUrl("commonModalTemplate.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){gModal=modal});var gModal1="";$ionicModal.fromTemplateUrl("commonModalTemplate1.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){gModal1=modal}),$scope.closeModal=function(){gModal.hide(),gModal1.hide(),$ionicBackdrop.release()},$scope.inviteGroupMember=function(){$scope.pData.friendData="",$scope.pData.operationStatus="1",$scope.queryGroupFriend(),$scope.pData.operationData=$scope.pData.friendData,gModal.show(),$ionicBackdrop.retain(),$(".modal-backdrop").css("width","100%"),$(".modal-backdrop").css("height","85%")},$scope.back=function(){toolsService.goBackPage()},$scope.deleteGroupMember=function(){$scope.pData.groupMemberData="",$scope.pData.operationStatus="2",$scope.queryGroupMember(),gModal1.show(),$ionicBackdrop.retain(),$(".modal-backdrop").css("width","100%"),$(".modal-backdrop").css("height","85%")},$scope.inviteGroupMemberSuccess=function(){var status=!1;if(!toolsService.isEmpty($scope.pData.friendData))for(var i=0;i<$scope.pData.friendData.length;i++)if($scope.pData.friendData[i].CHECKED){status=!0;var id=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="uu_group_members";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("i"),row.addColumn("demand_status","0"),row.addColumn("create_time","now()"),row.addColumn("uu_group_id",$scope.pData.groupId),row.addColumn("group_member_id",$scope.pData.friendData[i].FRIEND_ID),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})}$scope.closeModal(),$scope.pData.friendData="",$scope.init()},$scope.deleteGroupMemberSuccess=function(){var status=!1;if(!toolsService.isEmpty($scope.pData.groupMemberData))for(var i=0;i<$scope.pData.groupMemberData.length;i++)if($scope.pData.groupMemberData[i].CHECKED){status=!0;var params=new formatAmSqlParams;params.TABLENAME="uu_group_members";var row=new formatAmSqlupdateRow;row.setID($scope.pData.groupMemberData[i].ID),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})}$scope.closeModal(),$scope.pData.groupMemberData="",$scope.init()},$scope.deleteGroup=function(){toolsService.confirm("您确定删除群么？","执行此操作后不可返回！",function(){var params=new formatAmSqlParams;params.TABLENAME="uu_group";var row=new formatAmSqlupdateRow;row.setID($scope.pData.groupId),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){if("0"==data.CODE){for(var i=0;i<$scope.pData.groupMemberData.length;i++){var params=new formatAmSqlParams;params.TABLENAME="uu_group_members";var row=new formatAmSqlupdateRow;row.setID($scope.pData.groupMemberData[i].ID),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})}toolsService.showMessage("您的群已删除！","1"),window.history.go(-2)}})})},$scope.quitGroup=function(){toolsService.confirm("您确定删除群么？","执行此操作后不可返回！",function(){for(var i=0;i<$scope.pData.groupMemberData.length;i++)if($scope.pData.groupMemberData[i].GROUP_MEMBER_ID==$scope.pData.memberId){var params=new formatAmSqlParams;params.TABLENAME="uu_group_members";var row=new formatAmSqlupdateRow;row.setID($scope.pData.groupMemberData[i].ID),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE?(window.history.go(-2),toolsService.showMessage("您已退出该群！","1")):toolsService.showMessage("退出失败，请重试！","1")})}})}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mall.dynamic",{url:"/dynamic",cache:!1,access_level:ACCESS_LEVELS.user,views:{dynamic_view:{templateUrl:"app_plugins/uoou/dynamic/views/dynamic_view_page.html",controller:"DynamicCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("DynamicCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={title:"动态",account:"",friendid:"",platformStr:!0},ionic.Platform.isIOS()&&($scope.pData.platformStr=!1),$scope.toPage=function(type){var url="";switch(type){case"1":ionic.Platform.isIOS()?toolsService.tips("敬请期待！",""):url="dynamic.locattyrant";break;case"2":url="common.addfriend";break;case"3":url="dynamic.meteorshowers";break;case"4":url="message.uulife";break;case"5":url="dynamic.extragains";break;case"6":url="message.shopActivity";break;case"7":url="dynamic.frienddynamic";break;case"8":url="dynamic.side";break;case"9":toolsService.showMessage("业务拓展中、暂未开通、敬请期待！","1")}toolsService.isEmpty(url)||stateGo.go(url,{},!1)},$scope.qrcode=function(){cordova.plugins.barcodeScanner.scan(function(result){""!=result.text&&$scope.selectbyMemberid(result.text)},function(error){console.debug("扫码错误!")},{prompt:"请将二维码/条码置于取景框内扫描。"})},$scope.selectbyMemberid=function(account){if(toolsService.isEmpty(account))return void toolsService.tips("请输入好友账号!",1e3);var param={account:account},rData=actionManagerService.excuteResource("uoou.selectbymemberaccount",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!(data.DATA.length>0))return void toolsService.tips("此账号不存在,请检查!",1e3);if(data.DATA[0].ID==Authen.getUserId())return void toolsService.tips("不能添加自己为好友!",1e3);var param1={memberid:data.DATA[0].ID,friend_id:Authen.getUserId()},rData1=actionManagerService.excuteResource("uoou.addfriend.selectFriendsByMemberid",param1,"none","none");ajaxManager.ajaxToJson(rData1,function(data1){data1.DATA.length>0?"0"==data1.DATA[0].FRIENDS_STATUS?toolsService.tips("你已申请过此会员为好友，请等待对方同意!",1e3):toolsService.tips("你们已经是好友!",1e3):($scope.pData.friendid=data.DATA[0].ID,$scope.toMemberInfo($scope.pData.friendid))})})},$scope.toMemberInfo=function(memberid){stateGo.go("dynamic.mydynamic",{id:memberid},!1)}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("dynamic.extragains",{url:"/extragains",access_level:ACCESS_LEVELS.user,cache:!0,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/extra_gains/views/extra_gains_page.html",controller:"ExtraGainsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ExtraGainsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={comdSelectCards:[{title:"抢单赚外快",css:"demo-choice",show:!0},{title:"我的接单",css:"",show:!1},{title:"我的需求",css:"",show:!1}],grabParams:{memberid:Authen.getUserId(),lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,lng1:Authen.getDriverLocation().currentPoint.lng,lat1:Authen.getDriverLocation().currentPoint.lat,orderby:" ORDER BY ud.release_time DESC ",key:"1"},mygainsParams:{memberid:Authen.getUserId(),lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,lng1:Authen.getDriverLocation().currentPoint.lng,lat1:Authen.getDriverLocation().currentPoint.lat,key:"2"},myDemoParams:{memberid:Authen.getUserId(),lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,lng1:Authen.getDriverLocation().currentPoint.lng,lat1:Authen.getDriverLocation().currentPoint.lat,key:"3"},list_events:"",demandClass:"",demandClassId:"",startDate:"",endDate:"",index1:0,bData:[{id:"1",name:"最新",status:"0"},{id:"2",name:"距离",status:"1"},{id:"3",name:"智能排序",status:"1"}],activityIntrState:!1,activityIntrClass:"btn-store-no-choice",storeIntrState:!0,storeIntrClass:"btn-store-choice",recruitmentInfoState:!1,recruitmentInfoClass:"btn-store-no-choice"},$scope.back=function(){toolsService.goBackPage()},$scope.initDemandClass=function(){var rData=actionManagerService.excuteResource("uoou.releaseextragains.demandclass","","none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){console.debug(data),$scope.pData.demandClass=data.DATA,$scope.classData=[],$scope.classData1=[];for(var i=0;i<$scope.pData.demandClass.length;i++)$scope.classData.push($scope.pData.demandClass[i]),(i+1)%10==0&&i+1<$scope.pData.demandClass.length&&($scope.classData1.push($scope.classData),$scope.classData=[]);$scope.classData1.push($scope.classData),console.debug($scope.classData1),setTimeout(function(){new Swiper("#demandClassSwiper",{pagination:".swiper-pagination",autoplayDisableOnInteraction:!1,observer:!0})},200)}})},$scope.initDemandClass(),$scope.demandClassClick=function(id){for(var i=0;i<$scope.pData.demandClass.length;i++)id==$scope.pData.demandClass[i].ID?($scope.pData.demandClass[i].CSS="class_choice",$scope.pData.demandClassId=id):$scope.pData.demandClass[i].CSS="";
toolsService.isEmpty($scope.pData.startDate)?$scope.pData.grabParams={memberid:Authen.getUserId(),lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,lng1:Authen.getDriverLocation().currentPoint.lng,lat1:Authen.getDriverLocation().currentPoint.lat,orderby:" ORDER BY ud.release_time DESC ",classid:id}:$scope.pData.grabParams={memberid:Authen.getUserId(),lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,lng1:Authen.getDriverLocation().currentPoint.lng,lat1:Authen.getDriverLocation().currentPoint.lat,orderby:" ORDER BY ud.release_time DESC ",classid:id}},$scope.releaseDateClick=function(){$scope.pData.startDate=toolsService.dateTostr($scope.pData.startDate),toolsService.isEmpty($scope.pData.demandClassId)?$scope.pData.grabParams={memberid:Authen.getUserId(),lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,lng1:Authen.getDriverLocation().currentPoint.lng,lat1:Authen.getDriverLocation().currentPoint.lat,startdate:$scope.pData.startDate}:$scope.pData.grabParams={memberid:Authen.getUserId(),lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,lng1:Authen.getDriverLocation().currentPoint.lng,lat1:Authen.getDriverLocation().currentPoint.lat,classid:$scope.pData.demandClassId,startdate:$scope.pData.startDate}},$scope.selectCards=function(index){0==index?($scope.pData.index1=0,$scope.pData.comdSelectCards=[{title:"抢单赚外快",css:"demo-choice",show:!0},{title:"我的接单",css:"",show:!1},{title:"我的需求",css:"",show:!1}],$scope.initDemandClass()):1==index?($scope.pData.index1=1,$scope.pData.comdSelectCards=[{title:"抢单赚外快",css:"",show:!1},{title:"我的接单",css:"demo-choice",show:!0},{title:"我的需求",css:"",show:!1}]):"2"==index&&($scope.pData.index1=2,$scope.pData.comdSelectCards=[{title:"抢单赚外快",css:"",show:!1},{title:"我的接单",css:"",show:!1},{title:"我的需求",css:"demo-choice",show:!0}])},$scope.releaseDemand=function(){stateGo.go("dynamic.releaseextragains",{})},$scope.selectedCards=function(type){var strs="";"1"==type?($scope.pData.activityIntrState=!0,$scope.pData.storeIntrState=!1,$scope.pData.recruitmentInfoState=!1,$scope.pData.activityIntrClass="btn-store-no-choice",$scope.pData.storeIntrClass="btn-store-choice",$scope.pData.recruitmentInfoClass="btn-store-no-choice",strs=" ORDER BY ud.release_time DESC "):"2"==type?($scope.pData.activityIntrState=!1,$scope.pData.storeIntrState=!0,$scope.pData.recruitmentInfoState=!1,$scope.pData.activityIntrClass="btn-store-choice",$scope.pData.storeIntrClass="btn-store-no-choice",$scope.pData.recruitmentInfoClass="btn-store-no-choice",strs=" ORDER BY SQRT(("+Authen.getDriverLocation().currentPoint.lng+"-ud.longitude::float)*("+Authen.getDriverLocation().currentPoint.lng+"-ud.longitude::float)+("+Authen.getDriverLocation().currentPoint.lat+"-ud.latitude::float)*("+Authen.getDriverLocation().currentPoint.lat+"-ud.latitude::float)) ASC"):"3"==type&&($scope.pData.activityIntrState=!1,$scope.pData.storeIntrState=!1,$scope.pData.recruitmentInfoState=!0,$scope.pData.activityIntrClass="btn-store-no-choice",$scope.pData.storeIntrClass="btn-store-no-choice",$scope.pData.recruitmentInfoClass="btn-store-choice",strs=" ORDER BY ud.release_time DESC,SQRT(("+Authen.getDriverLocation().currentPoint.lng+"-ud.longitude::float)*("+Authen.getDriverLocation().currentPoint.lng+"-ud.longitude::float)+("+Authen.getDriverLocation().currentPoint.lat+"-ud.latitude::float)*("+Authen.getDriverLocation().currentPoint.lat+"-ud.latitude::float)) ASC"),toolsService.isEmpty($scope.pData.demandClassId)?$scope.pData.grabParams={memberid:Authen.getUserId(),lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,lng1:Authen.getDriverLocation().currentPoint.lng,lat1:Authen.getDriverLocation().currentPoint.lat,orderby:strs,key:"1"}:$scope.pData.grabParams={memberid:Authen.getUserId(),orderby:strs,lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,lng1:Authen.getDriverLocation().currentPoint.lng,lat1:Authen.getDriverLocation().currentPoint.lat,classid:$scope.pData.demandClassId,key:"1"}},$scope.pData.list_events={show0:$scope.pData.index1,show1:$scope.pData.comdSelectCards[1].show,show2:$scope.pData.comdSelectCards[2].show,demandClick:function(id,status){$scope.pData.comdSelectCards[0].show?stateGo.go("dynamic.extragainsdetails",{id:id,type:"0"}):$scope.pData.comdSelectCards[1].show?stateGo.go("dynamic.extragainsdetails",{id:id,type:"1"}):$scope.pData.comdSelectCards[2].show&&("0"==status?stateGo.go("dynamic.releaseextragains",{id:id}):stateGo.go("dynamic.mydemanddetails",{id:id}))},personDynamic:function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)}}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("dynamic.extragainsdetails",{url:"/extragainsdetails/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/extra_gains/views/extra_gains_details.html",controller:"ExtraGainsDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ExtraGainsDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicScrollDelegate","$timeout","ReceiveMessageService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicScrollDelegate,$timeout,ReceiveMessageService){$scope.pData={memberId:Authen.getUserId(),demandid:JSON.parse($state.params.params).id,type:JSON.parse($state.params.params).type,demandData:"",lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,personData:"",decline_cause:"",id:"",member_id:"",loginaccount:"",ordermoney:""},console.debug($state.params.params),$scope.init=function(){var rData=actionManagerService.excuteResource("uoou.extragains.details",{demandid:$scope.pData.demandid,lng:$scope.pData.lng,lat:$scope.pData.lat},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.demandData=data.DATA[0],$scope.pData.id=data.DATA[0].ID,$scope.pData.member_id=data.DATA[0].MEMBER_ID,$scope.pData.ordermoney=data.DATA[0].REMUNERATION)});var tData=actionManagerService.excuteResource("uoou.extragains.gainsperson",{demandid:$scope.pData.demandid,memberid:$scope.pData.memberId},"none","none");ajaxManager.ajaxToJson(tData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.personData=data.DATA[0])})},$scope.init(),$scope.taking=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_receiving_order";var row=new formatAmSqlupdateRow;row.setID(toolsService.uuid()),row.setStatus("i"),row.addColumn("member_id",$scope.pData.memberId),row.addColumn("demand_id",$scope.pData.demandid),row.addColumn("receiving_status","0"),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE?(toolsService.showMessage("申请接单成功,等待客户确认","1"),$scope.init()):toolsService.showMessage("接单失败，请重试！","1")})},$scope.AgreeRefund=function(){var rData=actionManagerService.excuteResource("member_info",{member_id:$scope.pData.member_id},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pData.loginaccount=data.DATA[0].LOGINACCOUNT;var rData=actionManagerService.virementManager("",$scope.pData.loginaccount,"","CASH_ACCOUNT",Number($scope.pData.ordermoney/100).toFixed(2),"","外快订单退款");ajaxManager.ajaxToJson(rData,function(data){"0"==data.code&&($scope.refundCG(),$scope.init())},function(data){})}})},$scope.refuseRefund=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_demand";var row=new formatAmSqlupdateRow;row.setID($scope.pData.id),row.setStatus("u"),row.addColumn("demand_status","4"),row.addColumn("decline_cause",$scope.pData.decline_cause),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&$scope.init()})},$scope.back=function(){toolsService.goBackPage()},$scope.refundCG=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_demand";var row=new formatAmSqlupdateRow;row.setID($scope.pData.id),row.setStatus("u"),row.addColumn("demand_status","6"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&$scope.init()})}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("dynamic.mydemanddetails",{url:"/mydemanddetails/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/extra_gains/views/my_demand_details.html",controller:"MyDemandDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MyDemandDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicScrollDelegate","$timeout","ReceiveMessageService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicScrollDelegate,$timeout,ReceiveMessageService){$scope.pData={memberId:Authen.getUserId(),loginAccount:Authen.getUserAccount(),demandid:JSON.parse($state.params.params).id,type:JSON.parse($state.params.params).type,demandData:"",lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,personData:"",id:"",ordermoney:""},console.debug($state.params.params),$scope.init=function(){var rData=actionManagerService.excuteResource("uoou.extragains.mydemanddetails",{demandid:$scope.pData.demandid},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.demandData=data.DATA[0],$scope.pData.id=data.DATA[0].ID,$scope.pData.ordermoney=data.DATA[0].REMUNERATION,console.debug($scope.pData.demandData))}),$scope.back=function(){toolsService.goBackPage()};var tData=actionManagerService.excuteResource("uoou.extragains.demandperson",{demandid:$scope.pData.demandid},"none","none");ajaxManager.ajaxToJson(tData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.personData=data.DATA)})},$scope.init(),$scope.agree=function(memberid){var rData=actionManagerService.settingDemand("1",$scope.pData.demandid,memberid);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage(data.MSG,"1"),$scope.init()})},$scope.refuse=function(memberid){var rData=actionManagerService.settingDemand("2",$scope.pData.demandid,memberid);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage(data.MSG,"1"),$scope.init()})},$scope.confirmDemand=function(){var rData=actionManagerService.confirmDemand($scope.pData.demandid,Number($scope.pData.demandData.REMUNERATION/100).toFixed());ajaxManager.ajaxToJson(rData,function(data){"999"!=data.CODE?(toolsService.showMessage("确认收货成功","1"),$scope.init()):toolsService.showMessage("确认收货失败","1")})},$scope.refund=function(){var rData=actionManagerService.virementManager("",$scope.pData.loginAccount,"","CASH_ACCOUNT",Number($scope.pData.ordermoney/100).toFixed(2),"","外快订单退款");ajaxManager.ajaxToJson(rData,function(data){"0"==data.code&&($scope.refundCG(),$scope.init())},function(data){})},$scope.refundYJ=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_demand";var row=new formatAmSqlupdateRow;row.setID($scope.pData.id),row.setStatus("u"),row.addColumn("demand_status","7"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&$scope.init()})},$scope.refundCG=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_demand";var row=new formatAmSqlupdateRow;row.setID($scope.pData.id),row.setStatus("u"),row.addColumn("demand_status","6"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&$scope.init()})}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("dynamic.releaseextragains",{url:"/releaseextragains/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/extra_gains/views/release_extragains_page.html",controller:"ReleaseExtragainsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ReleaseExtragainsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={memberId:Authen.getUserId(),demandId:JSON.parse($state.params.params).id,demandstatus:"0",title:"",demandNum:"0",demandClass:"0",demandClassData:"",consumption:"0",completeForm:"0",effectiveTime:"",recvProvince:"",recvCity:"",recvArea:"",meetPlace:"",longitude:"",latitude:"",remuneration:"0",serviceTime:"",content:"",saveStatus:!1,platformStr:!0},$scope.cascadePCZ={provinces:[],cities:[],zones:[]},ionic.Platform.isIOS()&&($scope.pData.platformStr=!1),$scope.init=function(){var rData=actionManagerService.excuteResource("uoou.releaseextragains.demandclass","","none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.demandClassData=data.DATA)});var proData=actionManagerService.excuteResource("province","","none","none");if(ajaxManager.ajaxTosyc(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)}),$scope.back=function(){toolsService.goBackPage()},$scope.$watch("pData.recvProvince",function(){if(console.debug($scope.pData.recvProvince),$scope.pData.recvProvince){var pId={pid:$scope.pData.recvProvince},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxTosyc(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pData.recvCity",function(){if($scope.pData.recvCity){var cId={cid:$scope.pData.recvCity},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxTosyc(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),!toolsService.isEmpty($scope.pData.demandId)){var rData=actionManagerService.excuteResource("uoou.extragains.demanddetails",{id:$scope.pData.demandId},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.title=data.DATA[0].TITLE,$scope.pData.demandstatus=data.DATA[0].DEMAND_STATUS,$scope.pData.demandNum=data.DATA[0].DEMAND_NUM,$scope.pData.demandClass=data.DATA[0].CLASS_ID,$scope.pData.consumption=data.DATA[0].CONSUMPTION,$scope.pData.completeForm=data.DATA[0].COMPLETE_FORM,$scope.pData.effectiveTime=new Date(data.DATA[0].EFFECTIVE_TIME),$scope.pData.recvProvince=data.DATA[0].PROVINCE_ID,$scope.pData.recvCity=data.DATA[0].CITY_ID,$scope.pData.recvArea=data.DATA[0].AREA_ID,$scope.pData.meetPlace=data.DATA[0].MEET_PLACE,$scope.pData.remuneration=parseInt(data.DATA[0].REMUNERATION)/100,$scope.pData.serviceTime=new Date(data.DATA[0].SERVICE_TIME),$scope.pData.content=data.DATA[0].CONTENT,console.debug($scope.pData.recvProvince.PROID))})}},$scope.init(),$scope.validateData=function(){return"0"==$scope.pData.demandClass?(toolsService.showMessage("请选择分类","1"),!1):toolsService.isEmpty($scope.pData.title)?(toolsService.showMessage("请输入需求标题","1"),!1):toolsService.isEmpty($scope.pData.demandNum)||"0"==$scope.pData.demandNum?(toolsService.showMessage("请输入需求人数","1"),!1):"0"==$scope.pData.consumption?(toolsService.showMessage("请选择消费状况","1"),!1):"0"==$scope.pData.completeForm?(toolsService.showMessage("请选择完成形式","1"),!1):toolsService.isEmpty($scope.pData.effectiveTime)?(toolsService.showMessage("请输入有效期","1"),!1):$scope.pData.effectiveTime<new Date?(toolsService.showMessage("有效时间必须大于当前时间","1"),!1):toolsService.isEmpty($scope.pData.recvProvince)?(toolsService.showMessage("请选择省","1"),!1):toolsService.isEmpty($scope.pData.recvCity)?(toolsService.showMessage("请选择市","1"),!1):toolsService.isEmpty($scope.pData.recvArea)?(toolsService.showMessage("请选择区","1"),!1):toolsService.isEmpty($scope.pData.meetPlace)?(toolsService.showMessage("请输入详细地点","1"),!1):toolsService.isEmpty($scope.pData.remuneration)?(toolsService.showMessage("请输入酬金","1"),!1):toolsService.isEmpty($scope.pData.serviceTime)?(toolsService.showMessage("请输入服务时间","1"),!1):$scope.pData.serviceTime<new Date?(toolsService.showMessage("服务时间必须大于当前时间","1"),!1):toolsService.isEmpty($scope.pData.content)?(toolsService.showMessage("请输入需求内容","1"),!1):$scope.pData.effectiveTime<$scope.pData.serviceTime?(toolsService.showMessage("服务时间不可超过有效时间","1"),!1):!0},$scope.addDemand=function(){for(var provinceName="",cityName="",zoneName="",i=0;i<$scope.cascadePCZ.provinces.length;i++)$scope.pData.recvProvince==$scope.cascadePCZ.provinces[i].PROID&&(provinceName=$scope.cascadePCZ.provinces[i].PRONAME);for(var i=0;i<$scope.cascadePCZ.cities.length;i++)$scope.pData.recvCity==$scope.cascadePCZ.cities[i].CITYID&&(cityName=$scope.cascadePCZ.cities[i].CITYNAME);for(var i=0;i<$scope.cascadePCZ.zones.length;i++)$scope.pData.recvArea==$scope.cascadePCZ.zones[i].ZONEID&&(zoneName=$scope.cascadePCZ.zones[i].ZONENAME);var recv_detall=provinceName+cityName+zoneName+$scope.pData.meetPlace,myGeo=new BMap.Geocoder;myGeo.getPoint(recv_detall,function(point){if(point){$scope.pData.longitude=point.lng,$scope.pData.latitude=point.lat;var params=new formatAmSqlParams;params.TABLENAME="uu_demand";var row=new formatAmSqlupdateRow;row.setID($scope.pData.demandId),row.setStatus("i"),row.addColumn("member_id",$scope.pData.memberId),row.addColumn("class_id",$scope.pData.demandClass),row.addColumn("title",$scope.pData.title),row.addColumn("demand_num",new Number($scope.pData.demandNum)),row.addColumn("consumption",$scope.pData.consumption),row.addColumn("complete_form",$scope.pData.completeForm),row.addColumn("effective_time",$scope.pData.effectiveTime),row.addColumn("province_id",$scope.pData.recvProvince),row.addColumn("city_id",$scope.pData.recvCity),row.addColumn("area_id",$scope.pData.recvArea),row.addColumn("meet_place",$scope.pData.meetPlace),row.addColumn("longitude",$scope.pData.longitude),row.addColumn("latitude",$scope.pData.latitude),row.addColumn("remuneration",100*new Number($scope.pData.remuneration)),row.addColumn("service_time",$scope.pData.serviceTime),row.addColumn("content",$scope.pData.content),row.addColumn("demand_status",$scope.pData.demandstatus),row.addColumn("create_time",(new Date).Format("yyyy-MM-dd hh:mm:ss")),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxTosyc(rData,function(data){"0"===data.CODE?toolsService.showMessage("保存成功","1"):toolsService.showMessage("保存失败","1")})}else toolsService.showMessage("请输入正确的约见地点","1")})},$scope.updateDemand=function(){for(var provinceName="",cityName="",zoneName="",i=0;i<$scope.cascadePCZ.provinces.length;i++)$scope.pData.recvProvince==$scope.cascadePCZ.provinces[i].PROID&&(provinceName=$scope.cascadePCZ.provinces[i].PRONAME);for(var i=0;i<$scope.cascadePCZ.cities.length;i++)$scope.pData.recvCity==$scope.cascadePCZ.cities[i].CITYID&&(cityName=$scope.cascadePCZ.cities[i].CITYNAME);for(var i=0;i<$scope.cascadePCZ.zones.length;i++)$scope.pData.recvArea==$scope.cascadePCZ.zones[i].ZONEID&&(zoneName=$scope.cascadePCZ.zones[i].ZONENAME);var recv_detall=provinceName+cityName+zoneName+$scope.pData.meetPlace;console.debug(recv_detall);var myGeo=new BMap.Geocoder;myGeo.getPoint(recv_detall,function(point){if(point){$scope.pData.longitude=point.lng,$scope.pData.latitude=point.lat;var params=new formatAmSqlParams;params.TABLENAME="uu_demand";var row=new formatAmSqlupdateRow;row.setID($scope.pData.demandId),row.setStatus("u"),row.addColumn("member_id",$scope.pData.memberId),row.addColumn("class_id",$scope.pData.demandClass),row.addColumn("title",$scope.pData.title),row.addColumn("demand_num",new Number($scope.pData.demandNum)),row.addColumn("consumption",$scope.pData.consumption),row.addColumn("complete_form",$scope.pData.completeForm),row.addColumn("effective_time",$scope.pData.effectiveTime),row.addColumn("province_id",$scope.pData.recvProvince),row.addColumn("city_id",$scope.pData.recvCity),row.addColumn("area_id",$scope.pData.recvArea),row.addColumn("meet_place",$scope.pData.meetPlace),row.addColumn("longitude",$scope.pData.longitude),row.addColumn("latitude",$scope.pData.latitude),row.addColumn("remuneration",100*new Number($scope.pData.remuneration)),row.addColumn("service_time",$scope.pData.serviceTime),row.addColumn("content",$scope.pData.content),row.addColumn("demand_status",$scope.pData.demandstatus),row.addColumn("create_time",(new Date).Format("yyyy-MM-dd hh:mm:ss")),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"===data.CODE?toolsService.showMessage("保存成功","1"):toolsService.showMessage("保存失败","1")})}else toolsService.showMessage("请输入正确的约见地点","1")})},$scope.saveDemand=function(){$scope.pData.saveStatus=!0,$scope.validateData()&&(toolsService.isEmpty($scope.pData.demandId)?($scope.pData.demandId=toolsService.uuid(),$scope.addDemand()):$scope.updateDemand())},$scope.releaseDemand=function(){$scope.validateData()&&(toolsService.isEmpty($scope.pData.demandId)?($scope.pData.demandId=toolsService.uuid(),$scope.addDemand(),$scope.payment()):($scope.updateDemand(),$scope.payment()))},$scope.payment=function(){var uuid=toolsService.uuid();uuid=uuid.replace(/-/g,"");var params={title:"发布需求",out_account_code:"CASH_ACCOUNT,ALIPAY_ACCOUNT_MODE,WECHAT_ACCOUNT_MODE",in_account_code:"",out_remakes:"发布需求",in_remakes:"发布需求",pay_money:new Number($scope.pData.remuneration),business:{demandId:$scope.pData.demandId,payment_id:uuid,orders:uuid,paymoney:$scope.pData.remuneration,success_call_back:"com.am.uoou.demand.action.ReleaseDemandCallback"},success_url:"dynamic.extragains",lost_url:"dynamic.extragains",pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};stateGo.go("common.payment",JSON.stringify(params),!0)}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("dynamic.frienddynamic",{url:"/frienddynamic/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/friend_dynamic/views/friend_dynamic_page.html",controller:"FriendDynamicCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("FriendDynamicCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo","$ionicScrollDelegate","$ionicGesture","FileAccess",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo,$ionicScrollDelegate,$ionicGesture,FileAccess){$scope.pData={memberId:Authen.getUserId(),title:"好友动态",timer:"",local_time:"",params:null,point_count:"",listEvents:{},interval:null,memberInfo:null,friendInfo:null,inputData:[],user_back_img:"",member_type:[{type:"0",name:"普通用户"},{type:"1",name:"普通会员"},{type:"2",name:"中级会员"},{type:"3",name:"超级会员"},{type:"4",name:"皇冠会员"}],memebr_vip:"",showClass:"bar bar-heade bar-background-color",pageSize:"10",dynamicRepeatDate:"",head_line:0,head_button_top:0,bar_header_ios_height_css:""},ionic.Platform.isAndroid()?($scope.pData.head_line=34,$scope.pData.head_button_top=1,$scope.pData.bar_header_ios_height_css="height:44px"):($scope.pData.head_line=64,$scope.pData.head_button_top=20,$scope.pData.bar_header_ios_height_css="height:64px"),$scope.getFriendInfo=function(){$scope.pData.params={memberid:Authen.getUserInfo().ID,userid:Authen.getUserInfo().ID}},$scope.getUserAccout=function(){var rData=actionManagerService.excuteResource("member_info",{member_id:Authen.getUserInfo().ID},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data)&&data.DATA.length>0){$scope.pData.memberInfo=data.DATA[0],$scope.getFriendInfo(),$scope.pData.inputData=[{path:"",mediaType:"image/jpeg",type:"image",data:""+appConfig.baseUrl+"/"+data.DATA[0].MEMBER_BACKIMG}],$scope.pData.user_back_img=data.DATA[0].MEMBER_BACKIMG,console.debug($scope.pData.user_back_img);for(var i=0;i<$scope.pData.member_type.length;i++)$scope.pData.memberInfo.MEMBER_TYPE==$scope.pData.member_type[i].type&&($scope.pData.memebr_vip=$scope.pData.member_type[i].name)}})},$scope.UpdateUserDynamicImg=function(imagepath){$scope.pData.user_back_img=imagepath;var rData=actionManagerService.updateUserDynamicImg(Authen.getUserInfo().ID,$scope.pData.user_back_img);ajaxManager.ajaxToJson(rData,function(data){})},$scope.UploadheadData=function(){for(var uploadData=[],i=0;i<$scope.pData.inputData.length;i++){var item=$scope.pData.inputData[i];if("image"==item.type){console.error(item),uploadData.push({type:"file",data:{fileName:item.fileName,mimeType:item.mimeType,type:item.type,file:item.file,savePath:"files/AM_MEMBER/"+$scope.pData.memberId+"/wxheadimg"}});break}}if(0==uploadData.length){var imagepath=$scope.pData.images;$scope.UpdateUserDynamicImg(imagepath)}else FileAccess.asUpload(uploadData,function(files){var imagepath=toolsService.fileJsonreturnstr(files,"image");$scope.UpdateUserDynamicImg(imagepath)},null,null,"n_space")},$scope.$watchCollection("pData.inputData",function(){$scope.pData.inputData.length>1&&($scope.pData.inputData[0]=$scope.pData.inputData[$scope.pData.inputData.length-1],console.debug($scope.pData.inputData),$scope.UploadheadData())}),$scope.Release_dynamic=function(){stateGo.go("dynamic.dynamicedit",{})},$scope.sendPack=function(){stateGo.go("dynamic.locattyrantedit",{})},$scope.pData.listEvents={toPage:function(id){stateGo.go("common.comment",{contentid:id},!1)},upPoint:function(id){console.debug($scope.pData.dynamicRepeatDate.length);var rData=actionManagerService.updateDynamicUpPoint(id,Authen.getUserInfo().ID);ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data)||(toolsService.tips(data.msg,""),$scope.pData.params={memberid:Authen.getUserInfo().ID,userid:Authen.getUserInfo().ID,time:new Date})}),$scope.pData.pageSize=$scope.pData.dynamicRepeatDate.length},toMemberInfo:function(memberid){stateGo.go("dynamic.mydynamic",{id:memberid},!1)},beforeProcess:function(data){for(var i=0;i<data.length;i++)data[i].CONTENT_IMGS&&(data[i].CONTENT_IMGS=JSON.parse(data[i].CONTENT_IMGS))}},$scope.toMemberInfo=function(memberid){console.debug(memberid),stateGo.go("dynamic.mydynamic",{id:memberid},!1)},$scope.back=function(){toolsService.goBackPage()},$scope.init=function(){$scope.getUserAccout()},$scope.shield_friend=function(){stateGo.go("dynamic.shieldfriendslist",{},!1)},$scope.init(),$("ion-content").scroll(function(){angular.isUndefined($ionicScrollDelegate.$getByHandle("mainScroll"))||($ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top>60?ionic.Platform.isIOS():$scope.pData.showClass="bar bar-heade bar-background-color","0px"!=$(".scroll-content").css("padding-top")&&$(".scroll-content").css("padding-top","0px"),$scope.$digest())}),$scope.toBrowserPag=function(memberid){stateGo.go("common.visitors",{id:memberid},!1)}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.mydynamic",{url:"/mydynamic/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/friend_dynamic/views/my_dynamic_page.html",controller:"MyDynamicCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MyDynamicCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){$scope.pData={title:"个人动态",timer:"",local_time:"",params:null,listEvents:{},interval:null,paramsObj:null,member_type:[{type:"0",name:"用户等级：普通用户"},{type:"1",name:"用户等级：普通会员"},{type:"2",name:"用户等级：中级会员"},{type:"3",name:"用户等级：超级会员"},{type:"4",name:"用户等级：皇冠会员"}],memebr_vip:"",rightDiv:'<button style="line-height: 30px;min-height: 33px;" class="button button-positive activated"></button>',showStore:!1,storeInfo:"",pageShow:!0,messageShow:!0,addFriendShow:!0,followMyShow:!0,friendInfo:"",followMyShowMsg:"关心",followMyShowStatus:"0",repeatdata:null,remarkName:"",errormessage:"",editRemarkName:""};var parmas=$state.params.params;toolsService.isEmpty(parmas)||($scope.pData.paramsObj=JSON.parse(parmas)),$scope.getUserAccout=function(){var userid=$scope.pData.paramsObj.id;userid!=Authen.getUserInfo().ID?$scope.pData.title="好友动态":$scope.pData.messageShow=!1;var rData=actionManagerService.excuteResource("member_info",{member_id:userid},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data)&&data.DATA.length>0){$scope.pData.memberInfo=data.DATA[0];for(var i=0;i<$scope.pData.member_type.length;i++)$scope.pData.memberInfo.MEMBER_TYPE==$scope.pData.member_type[i].type&&($scope.pData.memebr_vip=$scope.pData.member_type[i].name);$scope.pData.paramsObj.id!=Authen.getUserInfo().ID?($scope.pData.remarkName="备注",$scope.getFriendInfo(),"0"==$scope.pData.memberInfo.MEMBER_TYPE&&($scope.pData.addFriendShow=!1),$scope.upBrowser()):($scope.pData.followMyShow=!1,$scope.pData.messageShow=!1,$scope.pData.addFriendShow=!1),$scope.getStroeInfo()}})},$scope.getStroeInfo=function(){var rData=actionManagerService.excuteResource("uoou.setstore.getStoreByMemberid",{memberid:$scope.pData.paramsObj.id},"none","none");ajaxManager.ajaxToJson(rData,function(data){!toolsService.isEmpty(data)&&data.DATA.length>0?($scope.pData.storeInfo=data.DATA[0],$scope.pData.showStore=!0):$scope.pData.showStore=!1})},$scope.getFriendInfo=function(){var rData=actionManagerService.excuteResource("uoou.addfriend.selectFriendsByMemberid",{friend_id:$scope.pData.paramsObj.id,memberid:Authen.getUserInfo().ID},"none","none");ajaxManager.ajaxToJson(rData,function(data){!toolsService.isEmpty(data)&&data.DATA.length>0?($scope.pData.addFriendShow=!1,$scope.pData.friendInfo=data.DATA[0],"1"==$scope.pData.friendInfo.CARE_STATUS?($scope.pData.followMyShow=!0,$scope.pData.followMyShowStatus=$scope.pData.friendInfo.CARE_STATUS,$scope.pData.followMyShowMsg="取消关心"):($scope.pData.followMyShowStatus=$scope.pData.friendInfo.CARE_STATUS,$scope.pData.followMyShow=!0,$scope.pData.followMyShowMsg="关心"),$scope.pData.remarkName=$scope.pData.friendInfo.REMARK_NAME):$scope.pData.addFriendShow=!0})},$scope.init=function(){$scope.pData.params={memberid:$scope.pData.paramsObj.id},$scope.getUserAccout()},$scope.init(),$scope.send=function(){stateGo.go("dynamic.dynamicedit",{},!1)},$scope.toBrowserPag=function(){stateGo.go("common.visitors",{id:$scope.pData.paramsObj.id},!1)},$scope.insertBrowser=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_visitor";var row=new formatAmSqlupdateRow;row.setID(toolsService.uuid()),row.setStatus("i"),row.addColumn("user_id",$scope.pData.paramsObj.id),row.addColumn("member_id",Authen.getUserId()),row.addColumn("visitor_type","1"),row.addColumn("create_time",new Date),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})},$scope.upBrowser=function(){var params=new formatAmSqlParams;params.TABLENAME="am_member";var row=new formatAmSqlupdateRow;row.setID($scope.pData.paramsObj.id),row.setStatus("u"),row.addColumn("browse_num",new Number($scope.pData.memberInfo.BROWSE_NUM)+1),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);
ajaxManager.ajaxToJson(rData,function(data){$scope.insertBrowser()})},$scope.followMy=function(){if(toolsService.isEmpty($scope.pData.friendInfo))toolsService.tips("对不起,此用户还不是您的好友,请先添加他为好友!",2e3);else{var gz=0,msg="";"1"==$scope.pData.followMyShowStatus?(gz=0,$scope.pData.followMyShowStatus="0",msg="取消关心成功"):(gz=1,$scope.pData.followMyShowStatus=1,msg="关心成功!");var params=new formatAmSqlParams;params.TABLENAME="uu_friends";var row=new formatAmSqlupdateRow;row.setID($scope.pData.friendInfo.ID),row.setStatus("u"),row.addColumn("care_status",gz),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data)||"0"!=data.CODE||(toolsService.tips(msg,""),"0"==gz?$scope.pData.followMyShowMsg="关心":$scope.pData.followMyShowMsg="取消关心")})}},$scope.addFriendfun=function(){var param1={memberid:$scope.pData.paramsObj.id,friend_id:Authen.getUserId()},rData1=actionManagerService.excuteResource("uoou.addfriend.selectFriendsByMemberid",param1,"none","none");ajaxManager.ajaxToJson(rData1,function(data1){data1.DATA.length>0?"0"==data1.DATA[0].FRIENDS_STATUS?toolsService.tips("你已申请过此会员为好友，请等待对方同意!",1e3):toolsService.tips("你们已经是好友!",1e3):$scope.addfriendToServer()})},$scope.toStore=function(){stateGo.go("message.shopdetails",{id:$scope.pData.storeInfo.ID})},$scope.toUserInfo=function(){stateGo.go("member.myinfo",{id:$scope.pData.paramsObj.id})},$scope.toMessage=function(){stateGo.go("common.chat",{friendId:$scope.pData.paramsObj.id},!1)},$scope.toOpenMember=function(){stateGo.go("mine.openmember",{id:Authen.getUserId()},!1)},$scope.pData.listEvents={messageShow:$scope.pData.messageShow,beforeProcess:function(data){for(var i=0;i<data.length;i++)data[i].CONTENT_IMGS&&(data[i].CONTENT_IMGS=JSON.parse(data[i].CONTENT_IMGS))},delete_dynamic:function(id,index){toolsService.confirm("提示","要删除这条数据吗?",function(){var params=new formatAmSqlParams;params.TABLENAME="uu_dynamic";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){}),$scope.pData.repeatdata.splice(index,1)})}},$scope.addfriendToServer=function(){var uuid=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="uu_friends";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("member_id",$scope.pData.paramsObj.id),row.addColumn("friend_id",Authen.getUserId()),row.addColumn("care_status","0"),row.addColumn("shield_status","0"),row.addColumn("friends_status","0"),row.addColumn("remark",$scope.pData.remark),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("申请失败,请重启应用！",1):(param={state:"0",id:$scope.pData.paramsObj.id},rData=actionManagerService.sendJpushApi($scope.pData.paramsObj.id,JSON.stringify(param),"新朋友审核消息","mall.contacts","新朋友审核消息"),ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("申请成功,请等待好友审核！",1)}))})},$scope.editRemakerName=function(){$scope.pData.errormessage="",$scope.pData.editRemarkName=$scope.pData.remarkName;var templatehtml="<div style='width:100%;text-align: center;'><span ng-bind='pData.errormessage'></span><br/><input style='padding-left: 10px;border: 1px solid rgb(221, 221, 221);' type='text' maxlength='5' placeholder='请输入备注名称' ng-model='pData.editRemarkName'></div>";$ionicPopup.show({template:templatehtml,title:"修改备注",scope:$scope,buttons:[{text:"取消",type:"btnc",onTap:function(e){}},{text:"<b>确定</b>",type:"btn1",onTap:function(e){if(console.info($scope.pData.editRemarkName),toolsService.isEmpty($scope.pData.editRemarkName))$scope.pData.errormessage="不允许存在空值！",e.preventDefault();else{var reg=/\s/;reg.test($scope.pData.remarkName)?($scope.pData.errormessage="备注名称里存在空格!",e.preventDefault()):$scope.pData.remarkName.length>10?($scope.pData.errormessage="备注名称长度不能超过10个字符!",e.preventDefault()):($scope.pData.remarkName,$scope.pData.remarkName=$scope.pData.editRemarkName,$scope.editRemakerNameToService())}}}]})},$scope.editRemakerNameToService=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_friends";var row=new formatAmSqlupdateRow;row.setID($scope.pData.friendInfo.ID),row.setStatus("u"),row.addColumn("remark_name",$scope.pData.remarkName),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.friendeditdynamic",{url:"/friendeditdynamic/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/friend_dynamic/views/my_dynamic_edit.html",controller:"FriendEditDynamicCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("FriendEditDynamicCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){$scope.pData={title:"发布动态",timer:"",local_time:"",params:null,listEvents:{},interval:null},$scope.init=function(){$scope.pData.params={num:"0",condition:" and urp.member_id <> '"+Authen.getUserInfo().ID+"' order by surplus_num "}},$scope.init(),$scope.sendPack=function(){stateGo.go("dynamic.locattyrantedit",{})},$scope.pData.listEvents={toPage:function(id){var timer=localStorage.getItem("send_parket_time");toolsService.isEmpty(timer)?$scope.execut(id):$scope.execut(id)}}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("dynamic.dynamicedit",{url:"/dynamicedit/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/friend_dynamic/dynamic_edit/views/dynamic_edit.html",controller:"DynamicEditCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("DynamicEditCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){$scope.pData={title:"发布动态",content:"",memberId:Authen.getUserId(),content_img:""},$scope.Release_save=function(){var id=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="uu_dynamic";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("i"),row.addColumn("member_id",$scope.pData.memberId),row.addColumn("create_time","now()"),row.addColumn("content_imgs",$scope.pData.content_img),row.addColumn("content",$scope.pData.content),row.addColumn("point_num",0),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE?(toolsService.showMessage("发布成功","1"),$scope.pData.content="",stateGo.go("dynamic.frienddynamic","",!0)):toolsService.showMessage("发布失败","1")})},$scope.validate_click=function(){$scope.pData.content.length<1?toolsService.showMessage("内容不能为空！","1"):$scope.Release_save()},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("dynamic.shieldfriendslist",{url:"/shieldfriendslist/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/friend_dynamic/shield_friends/views/shield_friends_list.html",controller:"ShieldFriendsListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ShieldFriendsListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={memberId:Authen.getUserId(),params:{id:"0"},listEvents:"",repeatData:""},$scope.init=function(){$scope.pData.params={id:$scope.pData.memberId}},$scope.init(),$scope.pData.listEvents={beforeProcess:function(data){console.debug(data);for(var i=0;i<data.length;i++)"1"==data[i].SHIELD_STATUS?data[i].SHIELD_STATUS=!0:data[i].SHIELD_STATUS=!1},updateShield:function(id,index){console.debug($scope.pData.repeatData[index].SHIELD_STATUS);var status="";status=$scope.pData.repeatData[index].SHIELD_STATUS?"1":"0";var params=new formatAmSqlParams;params.TABLENAME="uu_friends";var row=new formatAmSqlupdateRow,demandid=toolsService.uuid();row.setID(id),row.setStatus("u"),row.addColumn("shield_status",status),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE?(toolsService.showMessage("修改成功","1"),$scope.pData.demandId=demandid):toolsService.showMessage("修改失败","1")})},headClick:function(id){stateGo.go()}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.locattyrant",{url:"/locattyrant/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/locat_tyrant/views/locat_tyrant_page.html",controller:"LocatTyrantCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("LocatTyrantCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){$scope.pData={title:"红包社区",OrgCode:"org",bannerCode:"menu_home",timer:"",local_time:"",params:null,listEvents:{},interval:null,resourceBgImg:"",repeatData:"",pageSize:"10",Id:"",head_line:0,head_button_top:0,bar_header_ios_height_css:""},$scope.init=function(){$scope.pData.params={num:"0",condition:" and urp.member_id <> '"+Authen.getUserInfo().ID+"'order by total_money DESC"},$scope.pData.local_time=localStorage.getItem("send_parket_time"),toolsService.isEmpty($scope.pData.local_time)||($scope.pData.interval=setInterval(function(){$scope.pData.timer=$scope.getIsTimes($scope.pData.local_time,2),$scope.$digest()},1e3));var rData=actionManagerService.excuteResource("uoou.local_tyrant.getResourceInfo",{code:"uoou_local_tyrant"},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data)||($scope.pData.resourceBgImg="/files/MJYC_RESOURCEMANAGEMENT/bc679221-590f-42e8-9ab2-fd6f835020e0/bdpserverroute/0b2aeeba-3413-4458-a314-0f35c69b4a70.png")})},ionic.Platform.isAndroid()?($scope.pData.head_line=34,$scope.pData.head_button_top=16,$scope.pData.bar_header_ios_height_css="height:44px"):($scope.pData.head_line=34,$scope.pData.head_button_top=20,$scope.pData.bar_header_ios_height_css="height:64px"),$scope.init(),$scope.sendPack=function(){stateGo.go("dynamic.locattyrantedit",{})},$scope.pData.listEvents={toPage:function(id){var timer=localStorage.getItem("send_parket_time");toolsService.isEmpty(timer)?$scope.execut(id):$scope.execut(id)},dynamic:function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)}},$scope.execut=function(id){var surplus_num="";if(toolsService.isEmpty(localStorage.getItem("send_parket_time"))||new Number(localStorage.getItem("send_parket_time"))-(new Date).getTime()<=0){var pData=actionManagerService.excuteResource("uoou.daynamic.redpacket.getRedPackedInfo",{id:id,condition:""},"none","none");$scope.pData.Id=id,ajaxManager.ajaxToJson(pData,function(data){if(!toolsService.isEmpty(data)&&data.DATA.length>0){if(new Number(data.DATA[0].SURPLUS_NUM)>0){var random=Math.floor(100*Math.random(1));if(100==new Number(data.DATA[0].WIN_ODDS)||random>0&&random<=new Number(data.DATA[0].WIN_ODDS)){surplus_num=data.DATA[0].SURPLUS_NUM;var rData=actionManagerService.virementManager("",Authen.getUserInfo().LOGINACCOUNT,"","CASH_ACCOUNT",Number(data.DATA[0].RE_MONEY/100).toFixed(),"","抢红包");ajaxManager.ajaxToJson(rData,function(data){if(console.debug(789),"0"==data.code){var params=new formatAmSqlParams;params.TABLENAME="uu_red_packets";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("u"),row.addColumn("surplus_num",new Number(surplus_num)-1),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param,"");ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&(toolsService.tips("抢红包成功",""),localStorage.setItem("send_parket_time",(new Date).getTime()+12e4),$scope.init(),$scope.addRed(),$scope.pData.pageSize=$scope.pData.repeatData.length,$scope.pData.params={num:"0",condition:" and urp.member_id <> '"+Authen.getUserInfo().ID+"' order by total_money DESC ",time:new Date})})}else toolsService.tips(data.msg,"")})}else toolsService.tips("非常遗憾,您没有抢到红包!","")}}else toolsService.tips("对不起,红包已被抢完","")})}},$scope.addRed=function(){var params=new formatAmSqlParams;params.TABLENAME="red_packets_record";var row=new formatAmSqlupdateRow;row.setID(toolsService.uuid()),row.setStatus("i"),row.addColumn("red_packets_id",$scope.pData.Id),row.addColumn("member_id",Authen.getUserId()),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE})},$scope.getIsTimes=function(time,number){time=new Number(time);var remainingTime="",timer=new Number(localStorage.getItem("send_parket_time"))-(new Date).getTime();if(0>=timer)clearInterval($scope.pData.interval),localStorage.setItem("send_parket_time",""),$scope.pData.timer="";else{var rMillisecond=(new Date(time),new Number(time)-(new Date).getTime()),leftsecond=parseInt(rMillisecond/1e3),day1=Math.floor(leftsecond/86400),hour=Math.floor((leftsecond-24*day1*60*60)/3600),minute=Math.floor((leftsecond-24*day1*60*60-3600*hour)/60),second=Math.floor(leftsecond-24*day1*60*60-3600*hour-60*minute);remainingTime=minute+"分钟"+second+"秒"}return remainingTime},$scope.record=function(){stateGo.go("dynamic.locattyrantrecord",{},!1)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.locattyrantedit",{url:"/locattyrantedit/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/locat_tyrant/views/locat_tyrant_edit.html",controller:"LocatTyrantEditCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("LocatTyrantEditCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){var pageParams=$state.params.params;$scope.pData={title:"发红包",disable:"","abstract":"",coment:"",number:"",single_amount:"",count_amount:"",winning:"",red_money:"",pageObj:null,showButton:!0},$scope.init=function(){toolsService.isEmpty(pageParams)||($scope.pData.pageObj=JSON.parse(pageParams)),toolsService.isEmpty($scope.pData.pageObj.id)||$scope.getRedPacket()},$scope.getRedPacket=function(){var rData=actionManagerService.excuteResource("uoou.daynamic.redpacket.getRedPackedInfo",{id:$scope.pData.pageObj.id},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data)&&data.DATA.length>0&&($scope.pData.disable="disabled",$scope.pData.showButton=!1,$scope.pData["abstract"]=data.DATA[0].ABSTRACT,$scope.pData.coment=data.DATA[0].RP_CONTENT,$scope.pData.number=data.DATA[0].RP_NUMBER,$scope.pData.single_amount=data.DATA[0].RE_MONEY,$scope.pData.count_amount=data.DATA[0].TOTAL_MONEY,$scope.pData.winning=data.DATA[0].WIN_ODDS,$scope.pData.red_money=data.DATA[0].RED_MONEY)})},$scope.$watch("pData.number",function(newValue,oldValue){toolsService.isEmpty($scope.pData.single_amount)||toolsService.isEmpty($scope.pData.number)||($scope.pData.count_amount=new Number($scope.pData.single_amount)*new Number($scope.pData.number))}),$scope.$watch("pData.single_amount",function(newValue,oldValue){toolsService.isEmpty($scope.pData.single_amount)||toolsService.isEmpty($scope.pData.number)||($scope.pData.count_amount=new Number($scope.pData.single_amount)*new Number($scope.pData.number))}),$scope.validate=function(){return toolsService.isEmpty($scope.pData.number)?(toolsService.showMessage("请输入正确的份数","1"),!1):toolsService.isEmpty($scope.pData.single_amount)?(toolsService.showMessage("请输入正确的单个金额","1"),!1):toolsService.isEmpty($scope.pData.winning)?(toolsService.showMessage("请输入正确的抽中率","1"),!1):!Number.isInteger(Number($scope.pData.winning))||Number($scope.pData.winning)>100||Number($scope.pData.winning)<=0?(console.debug($scope.pData.winning),toolsService.showMessage("请输入正确的抽中率","1"),!1):!0},$scope.sendPacket=function(){if($scope.validate()){var paymoney=100*Number($scope.pData.count_amount),remoney=100*Number($scope.pData.single_amount),uuid=toolsService.uuid().toUpperCase();uuid=uuid.replace(/-/g,"");var params={title:"红包支付",out_account_code:"CASH_ACCOUNT,ALIPAY_ACCOUNT_MODE,WECHAT_ACCOUNT_MODE",in_account_code:"",out_remakes:"红包支付",in_remakes:"红包支付",pay_money:new Number(paymoney/100),business:{orders:uuid,payment_id:uuid,member_id:Authen.getUserId(),red_packets:uuid,"abstract":$scope.pData["abstract"],rp_content:$scope.pData.coment,rp_number:$scope.pData.number,re_money:remoney,total_money:paymoney,win_odds:$scope.pData.winning,surplus_num:$scope.pData.number,success_call_back:"com.am.uoou.dynamic.local_tyrant.RedPacketPay"},success_url:"dynamic.locattyrant",lost_url:"dynamic.locattyrant",pay_id:uuid,red_packets:uuid,pay_type:"1",pay_type_name:"支付"};stateGo.go("common.payment",JSON.stringify(params),!0)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.locattyrantrecord",{url:"/locattyrantrecord/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/locat_tyrant/views/locat_tyrant_recode_page.html",controller:"LocatTyrantRecordCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("LocatTyrantRecordCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){$scope.pData={title:"红包记录",OrgCode:"org",params:null,listEvents:""},$scope.init=function(){$scope.pData.params={memberid:Authen.getUserInfo().ID,condition:"ORDER BY urp.create_time DESC"}},$scope.init(),$scope.pData.listEvents={to_red_details:function(id){stateGo.go("dynamic.reddetails",{id:id},!1)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.reddetails",{url:"/reddetails/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/locat_tyrant/red_details/views/red_details.html",controller:"RedDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("RedDetailsCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){$scope.pData={title:"我的红包",redId:JSON.parse($state.params.params).id,params:null},$scope.init=function(){$scope.pData.params={red_id:$scope.pData.redId};var rData=actionManagerService.excuteResource("uoou.locattyrant.reddetails",$scope.pData.params,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.detailsData=data.DATA[0])})},$scope.init(),$scope.pData.listEvents={dynamic:function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)}}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.meteorshowers",{url:"/meteorshowers/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/meteor_shower/views/meteor_shower_page.html",controller:"MeteorShowersCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MeteorShowersCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){$scope.pData={title:"流星雨",selectDoc:"",selected0:"",selected1:"",selected2:""},$scope.record=function(){stateGo.go("dynamic.meteorshowerslist",{type:"1"})},$scope.selectTab=function(type){if(!toolsService.isEmpty(type))switch(type){case"0":$scope.pData.selected0="meteor_shower_footer_content_link",$scope.pData.selected1="",$scope.pData.selected2="",stateGo.go("dynamic.meteorshowersdetail",{});break;case"1":$scope.pData.selected0="",$scope.pData.selected1="meteor_shower_footer_content_link",$scope.pData.selected2="",stateGo.go("dynamic.meteorshowersedit",{});break;case"2":$scope.pData.selected0="",$scope.pData.selected1="",$scope.pData.selected2="meteor_shower_footer_content_link",stateGo.go("dynamic.meteorshowerslist",{type:"0"})}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.meteorshowersdetail",{url:"/meteorshowersdetail/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/meteor_shower/views/meteor_shower_detail_page.html",controller:"MeteorShowersEditCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MeteorShowersEditCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){var pageParams=$state.params.params;$scope.pData={title:"流星雨",content:"",pageObj:null,pageData:"",headimg:"img/default_head.png",name:"",id:"",isShow:!0,dataInvil:!0,friendid:""},$scope.init=function(){toolsService.isEmpty(pageParams)||($scope.pData.pageObj=JSON.parse(pageParams)),toolsService.isEmpty($scope.pData.pageObj.id)?$scope.getMeteorInfo("1"):($scope.pData.id=$scope.pData.pageObj.id,$scope.getMeteorInfo("0"),$scope.pData.isShow=!1)},$scope.getMeteorInfo=function(type){if("0"===type){$scope.pData.isShow=!0;var rData=actionManagerService.excuteResource("uoou.meteor_shower.getMeteorInfo",{id:$scope.pData.pageObj.id},"none","none");ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE?($scope.pData.pageData=data.DATA[0],$scope.pData.content=$scope.pData.pageData.CONTENT,$scope.pData.headimg=$scope.pData.pageData.WXHEADIMG,$scope.pData.name=$scope.pData.pageData.MEMBERNAME,$scope.pData.friendid=$scope.pData.pageData.MEMBER_ID):$scope.pData.dataInvil=!1})}else{var rData=actionManagerService.getMeteorRandomInfo(Authen.getUserInfo().ID);ajaxManager.ajaxToJson(rData,function(data){"0"===data.code?($scope.pData.pageData=data.DATA[0],$scope.pData.id=$scope.pData.pageData.ID,$scope.pData.content=$scope.pData.pageData.CONTENT,$scope.pData.headimg=$scope.pData.pageData.WXHEADIMG,$scope.pData.name=$scope.pData.pageData.MEMBERNAME,$scope.pData.friendid=$scope.pData.pageData.MEMBER_ID):$scope.pData.dataInvil=!1})}},$scope.send=function(type){if("0"==type){var params=new formatAmSqlParams;params.TABLENAME="uu_meteor_shower";var row=new formatAmSqlupdateRow;row.setID($scope.pData.id),row.setStatus("u"),row.addColumn("meteor_status","0"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param,"");ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("传递失败！",1):toolsService.showMessage("传递成功！",1)})}else $scope.scanMessage()},$scope.scanMessage=function(id){$state.go("common.chat",{params:JSON.stringify({friendId:$scope.pData.friendid})},{})},$scope.init(),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.meteorshowersedit",{url:"/meteorshowersedit/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/meteor_shower/views/meteor_shower_edit_page.html",controller:"MeteorShowersEditSendCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MeteorShowersEditSendCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup){$scope.pData={title:"流星雨",content:""},$scope.send=function(){if(toolsService.isEmpty($scope.pData.content))return void toolsService.showMessage("请输入内容","1");var params=new formatAmSqlParams;params.TABLENAME="uu_meteor_shower";var row=new formatAmSqlupdateRow;row.setID(toolsService.uuid()),row.setStatus("i"),row.addColumn("member_id",Authen.getUserInfo().ID),row.addColumn("create_time","now()"),row.addColumn("content",$scope.pData.content),row.addColumn("meteor_status","0"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param,"");ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("保存失败！",1):toolsService.showMessage("您已成功放飞您的星愿！",1)})},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("dynamic.meteorshowerslist",{url:"/meteorshowerslist/:params",cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/meteor_shower/views/meteor_shower_my_list_page.html",controller:"MeteorShowersListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MeteorShowersListCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){var pageParams=$state.params.params;$scope.pData={title:"流星雨",content:"",params:"",listEvents:"",pageObj:null},toolsService.isEmpty(pageParams)||($scope.pData.pageObj=JSON.parse(pageParams)),"0"==$scope.pData.pageObj.type?$scope.pData.params={memberid:Authen.getUserInfo().ID,meteor_status:"1"}:$scope.pData.params={pubmemberid:Authen.getUserInfo().ID,meteor_status:"1"},$scope.pData.listEvents={toPage:function(id){stateGo.go("dynamic.meteorshowersdetail",{id:id},!1)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("dynamic.side",{url:"/side/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_dynamic:{templateUrl:"app_plugins/uoou/dynamic/side/views/side_list_page.html",controller:"SideCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("SideCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicScrollDelegate","$timeout","ReceiveMessageService","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicScrollDelegate,$timeout,ReceiveMessageService,stateGo){$scope.pData={lng:Authen.getDriverLocation().currentPoint.lng,lat:Authen.getDriverLocation().currentPoint.lat,sideMemberData:"",params:"",memberId:Authen.getUserId(),list_events:""},$scope.init=function(){$scope.pData.params={memberid:$scope.pData.memberId,longitude:$scope.pData.lng,longitude1:$scope.pData.lng,latitude:$scope.pData.lat,latitude1:$scope.pData.lat};var params=new formatAmSqlParams;params.TABLENAME="am_member";var row=new formatAmSqlupdateRow;row.setID($scope.pData.memberId),row.setStatus("u"),row.addColumn("longitude",$scope.pData.lng),row.addColumn("latitude",$scope.pData.lat),row.addColumn("gps_update_time",new Date),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})},$scope.init(),$scope.pData.list_events={personDynamic:function(id){console.debug(id),stateGo.go("dynamic.mydynamic",{id:id},!1)},to_shopdetails:function(id){console.debug(id),stateGo.go("message.shopdetails",{id:id},!1)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("common.groupmessage",{url:"/groupmessage/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{common_view:{templateUrl:"app_plugins/uoou/message/views/group_message_page.html",controller:"GroupMessageCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("GroupMessageCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo","OtherHandleService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo,OtherHandleService){$scope.pData={title:"群消息",groupMessageDate:null,memberInfo:null,newGroupMessageDate:[]},$scope.init=function(){var rData=actionManagerService.excuteResource("uu.contacts.grouplist",{memberId:Authen.getUserInfo().ID},"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data)&&data.DATA.length>0&&($scope.pData.memberInfo=data.DATA,!toolsService.isEmpty(localStorage.getItem("group_message")))){$scope.pData.groupMessageDate=JSON.parse(localStorage.getItem("group_message"));for(var i=0;i<$scope.pData.memberInfo.length;i++)for(var j=0;j<$scope.pData.groupMessageDate.length;j++)$scope.pData.memberInfo[i].UU_GROUP_ID==$scope.pData.groupMessageDate[j].groupid&&$scope.pData.newGroupMessageDate.push($scope.pData.groupMessageDate[j])}})},$scope.init(),$scope.back=function(){toolsService.goBackPage()},$scope.toMessage=function(groupid){stateGo.go("common.groupchat",{groupId:groupid},!1)}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mall.message",{url:"/message",cache:!1,access_level:ACCESS_LEVELS.user,views:{message_view:{templateUrl:"app_plugins/uoou/message/views/message_view_page.html",controller:"MessageCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MessageCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo","OtherHandleService","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo,OtherHandleService,$ionicPopup){$scope.pData={memberId:Authen.getUserId(),searchName:"",messageDate:[],groupMessageDate:"",groupNewMessageDateNumber:0,groupAlter:"暂无群新消息",systemAlter:"暂无系统新消息",systemTimer:""},$scope.toAddFridend=function(){stateGo.go("common.addfriend",{account:$scope.pData.searchName},!1)},$scope.personDynamic=function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)},$scope.toMessage=function(type,id){var url="",params="";"1"==type?url="common.message":"2"==type?url="common.groupmessage":(url="common.chat",params={friendId:id}),stateGo.go(url,params,!1)},$scope.init=function(){if(toolsService.isEmpty(localStorage.getItem("message"))||$scope.initFriendMessage(),!toolsService.isEmpty(localStorage.getItem("group_message"))){$scope.pData.groupMessageDate=JSON.parse(localStorage.getItem("group_message"));var groupNumber=0,groupMessage=0,dData=actionManagerService.excuteResource("uu.contacts.grouplist",{
memberId:Authen.getUserInfo().ID},"none","none");ajaxManager.ajaxToJson(dData,function(data){if(!toolsService.isEmpty(data)&&data.DATA.length>0)for(var i=0;i<$scope.pData.groupMessageDate.length;i++)for(var j=0;j<data.DATA.length;j++)$scope.pData.groupMessageDate[i].groupid==data.DATA[j].UU_GROUP_ID&&(groupMessage+=new Number($scope.pData.groupMessageDate[i].messagenum),"0"!=$scope.pData.groupMessageDate[i].messagenum&&groupNumber++);groupNumber>0&&($scope.pData.groupAlter=groupNumber+"个群有"+groupMessage+"条新消息"),$scope.pData.groupNewMessageDateNumber=groupNumber})}var rData=actionManagerService.getMessageNoticeInfo(Authen.getUserInfo().ID);ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data)||(console.info(data),"0"!=data.number&&(console.info(data.timer),$scope.pData.systemAlter="有"+data.number+"条新消息",$scope.pData.systemTimer=data.timer))})},$scope.toService=function(){stateGo.go("dynamic.extragains",{},!1)},$scope.toLife=function(){stateGo.go("message.uulife",{},!1)},$scope.share=function(){OtherHandleService.share({memberid:Authen.getUserInfo().ID,id:"xxxxx",title:appConfig.appName,content:"开店新助手,社交新方式!",imageUrl:appConfig.shareImg,url:"",scope:"1",type:"0",orgcode:appConfig.appOrg,pageParams:""})},$scope.toQrCode=function(){stateGo.go("message.myqrcode",{},!1)},$scope.details=function(key){var contentParams={orgid:"org",key:key},tData=actionManagerService.excuteResource("content",contentParams,"","");ajaxManager.ajaxToJson(tData,function(data){stateGo.go("common.messagedetail",{id:data.DATA[0].ID},!1)})},$scope.deleteFriendMessage=function(id){$scope.deleteId=id,toolsService.confirm("删除","确定要删除吗？",function(){for(var messages=JSON.parse(localStorage.getItem("message")),message_json=[],i=0;i<messages.length;i++)messages[i].friendid!=$scope.deleteId&&message_json.push(messages[i]);localStorage.setItem("message",JSON.stringify(message_json)),$scope.pData.messageDate=[],$scope.init()})},$scope.initFriendMessage=function(){if(toolsService.isEmpty(localStorage.getItem("message")))$scope.pData.messageDate="";else for(var message=JSON.parse(localStorage.getItem("message")),i=0;i<message.length;i++)if(message[i].memberid==$scope.pData.memberId){var rData=actionManagerService.excuteResource("uoou.chat.pushmessage",{friendid:message[i].friendid,memberid:$scope.pData.memberId},"none","none");ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||(message[i].friendname=data.DATA[0].MEMBERNAME,message[i].friendhead=data.DATA[0].WXHEADIMG)}),$scope.pData.messageDate.push(message[i])}},$rootScope.$on("to-parent",function(event,data){$scope.pData.messageDate=[],$scope.init()}),$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("message.myqrcode",{url:"/myqrcode/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_message:{templateUrl:"app_plugins/uoou/message/my_qr_code/views/qrcode_page.html",controller:"MyQRcodeCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("MyQRcodeCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","OtherHandleService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,OtherHandleService){$scope.pData={qrcodeurl:Authen.getUserInfo().QR_CODE_URL},$scope.back=function(){toolsService.goBackPage()},$scope.saveLocalQrcode=function(){if("Android"==$cordovaDevice.getPlatform()){var url=appConfig.baseUrl+"/"+$scope.pData.qrcodeurl,targetPath=cordova.file.externalApplicationStorageDirectory+"../../../DCIM/Camera/uoou_qrcode"+toolsService.uuid()+".png",trustHosts=!0,options={};$cordovaFileTransfer.download(url,targetPath,options,trustHosts).then(function(result){toolsService.tips("保存完成！",1e3)},function(err){toolsService.tips("保存失败,请重新保存！",1e3)},function(progress){})}else console.info("苹果保存!")},$scope.share=function(){OtherHandleService.share({memberid:Authen.getUserInfo().ID,id:"xxxxx",content:"app分享",imageUrl:appConfig.shareImg,url:"",scope:"1",type:"0",orgcode:appConfig.appOrg,pageParams:""})}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("message.classstorelist",{url:"/classstorelist/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_message:{templateUrl:"app_plugins/uoou/message/uu_life/class_store_list/views/class_store_list_page.html",controller:"ClassStoreListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ClassStoreListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){var lng=Authen.getDriverLocation().currentPoint.lng,lat=Authen.getDriverLocation().currentPoint.lat;$scope.pData={params:{QUERY:"",ORDER:"",MAINCLASSID:""},title:JSON.parse($state.params.params).title,mainClassId:JSON.parse($state.params.params).id,cityId:JSON.parse($state.params.params).cityid,subClassData:"",subClass:"",zoneData:"",zoneId:"",tabData:"",tabId:"",tab:"",noopsycheData:{name:"智能排序",data:{"综合排序":" ORDER BY ust.create_time DESC ","热门推荐":" ORDER BY ust.scot DESC ","评论量":" ORDER BY ust.evaluate_num DESC ","访问量":" ORDER BY ust.visitor_num DESC","商业信誉值":" ORDER BY ust.reputation DESC ","关注量":" ORDER BY ust.follow_num DESC ","最近距离":" ORDER BY SQRT(("+lng+"-ust.longitude::float)*("+lng+"-ust.longitude::float)+("+lat+"-ust.latitude::float)*("+lat+"-ust.latitude::float)) DESC "}},noopsyche:"",list_events:""},$scope.init=function(){$scope.pData.params={TABID:$scope.pData.tab,QUERY:"",ORDER:" ORDER BY ust.create_time DESC ",MAINCLASSID:$scope.pData.mainClassId,CITYID:$scope.pData.cityId,lat:lat,lng:lng};var rData=actionManagerService.excuteResource("uoou.uulife.subclass",{mainClassId:$scope.pData.mainClassId},"none","none");ajaxManager.ajaxToJson(rData,function(data){console.debug(data),toolsService.isEmpty(data.DATA)||($scope.pData.subClassData={name:"分类",data:toolsService.formJarryToObject(data.DATA)})});var distData=actionManagerService.excuteResource("uoou.uulife.getZoneByCityId",{cid:$scope.pData.cityId},"none","none");ajaxManager.ajaxToJson(distData,function(data){toolsService.isEmpty(data.DATA)||(data.DATA.push("VALUE","0"),data.DATA.push("NAME","全部"),$scope.pData.zoneData={name:"区域",data:toolsService.formJarryToObject(data.DATA)})})},$scope.init(),$scope.$watch("pData.subClass",function(){var tData=actionManagerService.excuteResource("uoou.uulife.getTabBySubclassId",{classId:$scope.pData.subClass},"none","none");ajaxManager.ajaxToJson(tData,function(data){toolsService.isEmpty(data.DATA)||(data.DATA.push("VALUE","0"),data.DATA.push("NAME","全部"),$scope.pData.tabData={name:"筛选",data:toolsService.formJarryToObject(data.DATA)})})}),$scope.back=function(){toolsService.goBackPage()},$scope.query=function(){var query="",order=" ORDER BY ust.create_time DESC ";toolsService.isEmpty($scope.pData.subClass)||(query+=" AND ust.sub_store_class = '"+$scope.pData.subClass+"' "),toolsService.isEmpty($scope.pData.zoneId)||(query+=" AND ust.area_id = '"+$scope.pData.zoneId+"' "),toolsService.isEmpty($scope.pData.noopsyche)||(order=" "+$scope.pData.noopsyche+" "),toolsService.isEmpty($scope.pData.zoneId)||(query+=" AND ust.area_id = '"+$scope.pData.zoneId+"' "),$scope.pData.params={TABID:$scope.pData.tab,QUERY:query,ORDER:order,MAINCLASSID:$scope.pData.mainClassId,CITYID:$scope.pData.cityId,lat:lat,lng:lng}},$scope.selectSubClass=function(value){$scope.pData.subClass=value,$scope.query()},$scope.selectZone=function(value){$scope.pData.zoneId=value,$scope.query()},$scope.selectNoopsyche=function(value){$scope.pData.noopsyche=value,$scope.query()},$scope.selectTab=function(value){$scope.pData.tab=value,console.debug($scope.pData.tab),$scope.query()},$scope.pData.list_events={personDynamic:function(id){console.debug(id),stateGo.go("dynamic.mydynamic",{id:id},!1)},to_store_details:function(id){var parmas={id:id};stateGo.go("message.shopdetails",parmas,!1)}}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("message.uulife",{url:"/uulife/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_message:{templateUrl:"app_plugins/uoou/message/uu_life/views/uu_life_page.html",controller:"UuLifeCtrl"}}})}]),angular.module("mallMobileApp").filter("trustHtml",function($sce){return function(input){return $sce.trustAsHtml(input)}}),angular.module("mallMobileApp.controllers").controller("UuLifeCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo,$ionicPopup){$scope.pData={memberId:Authen.getUserId(),storeName:"",storeMainClass:"",storeActivityImg:"",longitude:Authen.getDriverLocation().currentPoint.lng,latitude:Authen.getDriverLocation().currentPoint.lat,locationAddressData:Authen.getDriverLocation().addressComponents,provinceData:"",provinceid:"",cityData:"",cityid:"",city:"",cityName:"城市",reputation:0,storeData:"",storeStatus:"",rightDiv:"",storeParam:""},$scope.init=function(){var storeParam={memberId:Authen.getUserId()};console.debug(storeParam);var storeData=actionManagerService.excuteResource("uu.mine.shopActivityList",storeParam,"none","none");ajaxManager.ajaxToJson(storeData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.storeData=data.DATA[0],$scope.pData.storeStatus=data.DATA[0].STORE_STATUS,$scope.pData.reputation=data.DATA[0].REPUTATION),"2"==$scope.pData.storeStatus?$scope.pData.rightDiv="<div style='padding: 11px 0px;'>进入店铺<div>":$scope.pData.rightDiv="<div>免费注册<br>入驻平台</div>"}),$scope.pData.cityName=$scope.pData.locationAddressData.city;var rData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pData.provinceData=data.DATA});var pData=actionManagerService.excuteResource("uoou.uulife.getProvinceByName",{proname:$scope.pData.locationAddressData.province},"none","none");ajaxManager.ajaxToJson(pData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.provinceid=data.DATA[0].PROID)});var tData=actionManagerService.excuteResource("uoou.uulife.getCityByName",{cityname:$scope.pData.locationAddressData.city},"none","none");ajaxManager.ajaxToJson(tData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.cityid=data.DATA[0].CITYID,$scope.pData.cityName=data.DATA[0].CITYNAME,$scope.pData.city=data.DATA[0].CITYID)});var rData=actionManagerService.excuteResource("uoou.uulife.sacnstorneweactivityimg","","none","");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.storeActivityImg=data.DATA[0].SERVERROUTE)})},$scope.init(),$scope.back=function(){toolsService.goBackPage()},$scope.$watch("pData.provinceid",function(){var rData=actionManagerService.excuteResource("city",{pid:$scope.pData.provinceid},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.cityData=data.DATA)})}),$scope.initStoreClass=function(){var rData=actionManagerService.excuteResource("uoou.uulife.storemainclass","","none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pData.storeMainClass=data.DATA,$scope.classData=[],$scope.classData1=[];for(var i=0;i<$scope.pData.storeMainClass.length;i++)$scope.classData.push($scope.pData.storeMainClass[i]),(i+1)%12==0&&i+1<$scope.pData.storeMainClass.length&&($scope.classData1.push($scope.classData),$scope.classData=[]);$scope.classData1.push($scope.classData),setTimeout(function(){new Swiper("#storeMainClassSwiper",{pagination:".swiper-pagination",autoplayDisableOnInteraction:!1,observer:!0})},300)}})},$scope.initStoreClass();var dPopup="";$scope.addressSelect=function(){dPopup=$ionicPopup.show({scope:$scope,title:"请选择",templateUrl:"app_plugins/uoou/message/uu_life/views/uu_life_address_pupup.html",buttons:[{text:"取消",type:"btnc"},{text:"确定",type:"btn1",onTap:function(e){var rData=actionManagerService.excuteResource("uoou.uulife.getCityByCityId",{cityid:$scope.pData.cityid},"none","none");ajaxManager.ajaxToJson(rData,function(data){console.debug(data),toolsService.isEmpty(data.DATA)||($scope.pData.cityName=data.DATA[0].CITYNAME,$scope.pData.city=data.DATA[0].CITYID)})}}]})},$scope.$on("$destroy",function(){dPopup&&dPopup.close()}),$scope.toClassList=function(classId,title){stateGo.go("message.classstorelist",{id:classId,cityid:$scope.pData.cityid,title:title},!1)},$scope.toList=function(){var params={cityid:$scope.pData.city,storename:$scope.pData.storeName};console.debug($scope.pData.city),stateGo.go("message.storelist",params,!1)},$scope.storeActivity=function(){stateGo.go("message.shopActivity","",!1)},$scope.myUStore=function(){"2"==$scope.pData.storeStatus?(stateGo.go("mine.ustore",{id:$scope.pData.memberId},!1),console.debug()):stateGo.go("mine.storestatus",{},!1)}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("message.shopdetails",{url:"/shopdetails/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_message:{templateUrl:"app_plugins/uoou/message/uu_life/shop_details/views/shop_details_view.html",controller:"ShopDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ShopDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo","OtherHandleService","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo,OtherHandleService,$ionicPopup){$scope.pData={id:"1",bData:[{id:"1",name:"活动",status:"0"},{id:"2",name:"评价",status:"1"},{id:"3",name:"简介",status:"1"},{id:"4",name:"招聘",status:"1"}],storeId:JSON.parse($state.params.params).id,serviceTel:"",followname:null,memberId:Authen.getUserId(),fllowStatus:"0",storeMemberId:"",followId:"",orderContent:"",orderPrice:"",orderStatus:"0",address:"",followNum:"",storeImageNum:"",fileJSo:"",shopImgs:"",visitorId:"",visitorFlow:"",right:'<i  class="uoou_welfare_head_img_left ion-android-share-alt"></i>'},$scope.share=function(){OtherHandleService.share({memberid:Authen.getUserInfo().ID,id:"xxxxx",title:appConfig.appName,content:"这店真不错,相当实惠!",imageUrl:appConfig.baseUrl+appConfig.shareImg,url:"",scope:"1",type:"0",orgcode:appConfig.appOrg,pageParams:"",listEvents:""})},$scope.testAClick=function(obj){$scope.pData.id=obj.id},$scope.queryFllowStatus=function(){$scope.pData.params={storeid:$scope.pData.storeId,memberid:$scope.pData.memberId};var rData=actionManagerService.excuteResource("uoou.uulife.shopdetails.follow",$scope.pData.params,"none","none");ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)?$scope.pData.fllowStatus="0":($scope.pData.fllowStatus="1",$scope.pData.detailsData.follow=data.DATA[0],$scope.pData.followId=data.DATA[0].ID)})},$scope.selectShopVisitor=function(){$scope.pData.params={storeid:$scope.pData.storeId,memberid:$scope.pData.memberId};var rData=actionManagerService.excuteResource("uoou.uulife.shopdetailsVisitor",$scope.pData.params,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)?$scope.addVisitor():($scope.addVisitorNum(),$scope.addVisitor())})},$scope.tip=function(){$ionicPopup.show({scope:$scope,title:"店铺正在审核中 <br> 敬请期待",buttons:[{text:"确定",type:"btn2",onTap:function(){toolsService.goBackPage()}}]})},$scope.init=function(){$scope.pData.params={storeid:$scope.pData.storeId};var rData=actionManagerService.excuteResource("uoou.uulife.shopdetails",$scope.pData.params,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pData.detailsData=data.DATA[0],console.debug("店铺状态》》"+data.DATA[0].STORE_STATUS);var store_status=data.DATA[0].STORE_STATUS;if(("1"===store_status||"3"===store_status)&&$scope.tip(),$scope.pData.storeMemberId=data.DATA[0].MEMBER_ID,$scope.pData.address=data.DATA[0].STOREADDRESS,$scope.pData.followNum=data.DATA[0].FOLLOW_NUM,$scope.pData.visitorFlow=data.DATA[0].VISITOR_FLOW,$scope.pData.serviceTel=data.DATA[0].HOTLINE,!toolsService.isEmpty(data.DATA[0].ATLAS)){$scope.pData.shopImgs=JSON.parse(data.DATA[0].ATLAS)[0].path;var atrs=[];atrs.push(JSON.parse(data.DATA[0].ATLAS)),$scope.pData.fileJSo=toolsService.formImagesToImgpicker(atrs,function(count){$scope.pData.storeImageNum=count})}$scope.pData.storeTabs=data.DATA[0].TABS.split(",");for(var params="",i=0;i<$scope.pData.storeTabs.length;i++)params+="'"+$scope.pData.storeTabs[i]+"'",i<$scope.pData.storeTabs.length-1&&(params+=",");$scope.pData.params={params:params};var rData=actionManagerService.excuteResource("uoou.uulife.shopdetailstab",$scope.pData.params,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.detailsDatatab=data.DATA)}),$scope.queryFllowStatus(),$scope.selectShopVisitor()}})},$scope.init(),$scope.addFollow=function(){var id=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="uu_follow_store";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("i"),row.addColumn("member_id",$scope.pData.memberId),row.addColumn("store_id",$scope.pData.storeId),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&(toolsService.showMessage("关注成功","1"),$scope.pData.followNum=Number($scope.pData.followNum)+1,$scope.updateFollowNum(),$scope.pData.fllowStatus="1",$scope.init())})},$scope.deleteFollow=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_follow_store";var row=new formatAmSqlupdateRow;row.setID($scope.pData.followId),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&(toolsService.showMessage("取消关注","1"),$scope.pData.fllowStatus="0",$scope.pData.followNum=Number($scope.pData.followNum)-1,$scope.updateFollowNum(),$scope.init())})},$scope.updateFollowNum=function(){var params=(toolsService.uuid(),new formatAmSqlParams);params.TABLENAME="uu_store";var row=new formatAmSqlupdateRow;row.setID($scope.pData.storeId),row.setStatus("u"),row.addColumn("follow_num",$scope.pData.followNum),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&$scope.init()})},$scope.nextOrder=function(){var param={memberId:$scope.pData.memberId,storeId:$scope.pData.storeId},rData=actionManagerService.excuteResource("uoou.uu_life.shop_details.placing_order",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(data.DATA.length>0){var MSG="您与该商家有未完成订单，完成该订单后才可下新的订单";toolsService.tips(MSG,"")}else{param={memberId:$scope.pData.memberId};var rData=actionManagerService.excuteResource("uoou.uu_life.shop_details.query_default_address",param,"none","none");ajaxManager.ajaxToJson(rData,function(result){if(console.log(result),result.DATA.length>0){var id=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="uu_order";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("i"),row.addColumn("member_id",$scope.pData.memberId),row.addColumn("store_id",$scope.pData.storeId),row.addColumn("order_status",$scope.pData.orderStatus),row.addColumn("create_time","now()"),row.addColumn("contacts",result.DATA[0].RECV_NAME),row.addColumn("phone",result.DATA[0].RECV_PHONE),row.addColumn("address",result.DATA[0].RECV_DETAIL),params.addRow(row),param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param),ajaxManager.ajaxToJson(rData,function(datas){if("0"===datas.CODE){toolsService.showMessage("下单成功,请等待商家联系","1");var obj={id:id},vdata=actionManagerService.sendJpushApi($scope.pData.storeMemberId,JSON.stringify(obj),"您有新的订单","mine.indentstore","您有新的订单");ajaxManager.ajaxToJson(vdata,function(datas){})}else toolsService.showMessage("下单失败,请重试","1")})}else toolsService.confirm("提示信息","请设置默认地址",function(){$state.go("member.address",{},!1)})})}})},$scope.addVisitorNum=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_store";var row=new formatAmSqlupdateRow;row.setID($scope.pData.storeId),row.setStatus("u"),row.addColumn("visitor_flow",Number($scope.pData.visitorFlow)+1),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})},$scope.addVisitor=function(){var id=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="uu_visitor";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("i"),row.addColumn("user_id",$scope.pData.storeId),row.addColumn("member_id",$scope.pData.memberId),row.addColumn("visitor_type",Number(2)),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})},$scope.shopTime=function(){dPopup=$ionicPopup.show({scope:$scope,title:"营业时间",templateUrl:"app_plugins/uoou/message/uu_life/shop_details/views/shop_time.html",buttons:[{text:"确定",type:"btn2",onTap:function(e){}}]})},$scope.businessAddress=function(){$state.go("commodity.baidumap",{params:JSON.stringify({address:$scope.pData.address})})},$scope.pData.listEvents={dynamic:function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)}},$scope.sendMessage=function(){stateGo.go("common.chat",{friendId:$scope.pData.storeMemberId},!1)},$scope.imagePicker=function(){if(0!=$scope.pData.storeImageNum){var title=$scope.pData.detailsData.STORE_NAME,fileJSo=$scope.pData.fileJSo,params={title:title,data:fileJSo};$state.go("common.imagePicker",{params:JSON.stringify(params)})}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("message.storelist",{url:"/storelist/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_message:{templateUrl:"app_plugins/uoou/message/uu_life/store_list/views/store_list_page.html",controller:"StoreListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("StoreListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={cityId:JSON.parse($state.params.params).cityid,storeName:JSON.parse($state.params.params).storename,MemberId:Authen.getUserId(),params:{},list_events:""},console.debug($scope.pData.MemberId);var params=$state.params.params;toolsService.isEmpty(params)||(params=JSON.parse($state.params.params)),$scope.init=function(){$scope.pData.params={cityid:$scope.pData.cityId,storename:$scope.pData.storeName}},$scope.init(),$scope.pData.list_events={store_details:function(id){stateGo.go("message.shopdetails",{id:id},!1)}},$scope.personDynamic=function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.carestore",{url:"/carestore/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/care_store/views/care_store_page.html",controller:"CareStoreCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("CareStoreCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo){$scope.pData={params:{memberid:Authen.getUserId()},list_events:{}},$scope.pData.list_events={to_dynamic:function(id){var parmas={id:id};stateGo.go("dynamic.mydynamic",parmas,!1)},to_store_details:function(id){var parmas={id:id};stateGo.go("message.shopdetails",parmas,!1)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("MineCtrl",["$scope","commdityService","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","stateGo",function($scope,commdityService,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,stateGo){$scope.pData={memberId:Authen.getUserId(),memberCenterListJson:[{address:"mine.myorder",title:"个人订单",icon:"app_plugins/uoou/mine/img/3.12_3.png"},{address:"mine.carestore",title:"我关注的店铺",icon:"app_plugins/uoou/mine/img/3.12_4.png"},{address:"mine.followstore",title:"消费过的店铺",icon:"app_plugins/uoou/mine/img/3.12_5.png"},{address:"mine.setting",title:"设置",icon:"app_plugins/uoou/mine/img/3.12_6.png"}],User_HeadImgUrl:"",User_Name:"",User_Cash:0,User_integral:0,User_account:"",User_account_type:"",MemberType:"",Audit_Role:Authen.getAuditRole(),reputation:0,storeData:"",storeStatus:"",newOrderNumber:null,platformStr:!0},ionic.Platform.isIOS()&&($scope.pData.platformStr=!1);var userInfo=Authen.getUserInfo(),userId=Authen.getUserId();userInfo&&($scope.pData.User_account=userInfo.ACCOUNT_MEMBER,$scope.pData.User_account_type=userInfo.ID_NAME,$scope.pData.MemberType=userInfo.MEMBER_TYPE),commdityService.getMemberCoupByMemberId(userId,function(data){for(var i=0;i<data.length;i++)data[i].SELECTED=!1,data[i].CSS="ion-ios-circle-outline";$scope.pData.coupList=data,$scope.pData.coupListSize=$scope.pData.coupList.length});var param={member_id:$scope.pData.memberId},newOrderNumData=actionManagerService.excuteResource("uu_order_number",param,"none","none");ajaxManager.ajaxToJson(newOrderNumData,function(data){data&&data.DATA.length>0&&($scope.pData.newOrderNumber=data.DATA[0].NEW_ORDER_NUM)});var param={member_id:userId,sa_code:"CASH_ACCOUNT"},rData=actionManagerService.excuteResource("GetAccountInfo",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.User_Cash=data.DATA[0].BALANCE)});var storeParam={memberId:userId},storeData=actionManagerService.excuteResource("uu.mine.shopActivityList",storeParam,"none","none");ajaxManager.ajaxToJson(storeData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.storeData=data.DATA[0],$scope.pData.storeStatus=data.DATA[0].STORE_STATUS,$scope.pData.reputation=data.DATA[0].REPUTATION)});var rData=actionManagerService.excuteResource("member_info",{member_id:userId},"","");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&(data.DATA[0]&&data.DATA[0].WXHEADIMG?$scope.pData.User_HeadImgUrl="/"+data.DATA[0].WXHEADIMG:$scope.pData.User_HeadImgUrl="/img/default_head.png",$scope.pData.User_Name=data.DATA[0].MEMBERNAME,$scope.pData.memberType=data.DATA[0].MEMBER_TYPE,$scope.pData.qrCodeUrl=data.DATA[0].QR_CODE_URL,$scope.pData.User_integral=data.DATA[0].SCORE)}),$scope.Jump=function(url){url&&stateGo.go(""+url,{},!1)},$scope.JumpOpenV=function(url){ionic.Platform.isIOS()?toolsService.tips("敬请期待！",""):url&&stateGo.go(""+url,{},!1)},$scope.myUStore=function(){"2"==$scope.pData.storeStatus?(stateGo.go("mine.ustore",{id:$scope.pData.memberId},!1),console.debug()):stateGo.go("mine.storestatus",{},!1)},$scope.My_information=function(){stateGo.go("member.myinfo",{},!1)},$scope.loginOut=function(){Authen.logout(),$state.go("mall.home")},$scope.toUUWelfare=function(){stateGo.go("mine.welfare",{},"")},$scope.toAccountInfo=function(){ionic.Platform.isIOS()?toolsService.tips("敬请期待！",""):stateGo.go("mine.accountbalance",{},!1)}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.feedbackCtrl",{url:"/feedbackCtrl/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/feedback/views/feedback_page.html",controller:"feedbackCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("feedbackCtrl",["$scope","commdityService","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","stateGo","$cordovaAppVersion",function($scope,commdityService,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,stateGo,$cordovaAppVersion){$scope.pData={content:"",footerHeight:"height:38px;"},ionic.Platform.isIOS()&&($scope.pData.footerHeight="height:58px;"),$scope.submit=function(){if(toolsService.isEmpty($scope.pData.content))toolsService.showMessage("请输入需要反馈的问题!",1);else{var uuid=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="mall_feedback";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("member_id",Authen.getUserId()),row.addColumn("content",$scope.pData.content),row.addColumn("create_datetime","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("反馈失败,请重新反馈!",1):toolsService.showMessage("反馈成功,我们将尽快处理!",1)})}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.followstore",{url:"/followstore/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/follow_store/views/follow_store_page.html",controller:"FollowStoreCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("FollowStoreCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo){$scope.pData={params:{userid:Authen.getUserId()},list_events:{}},$scope.pData.list_events={to_dynamic:function(id){var parmas={id:id};stateGo.go("dynamic.mydynamic",parmas,!1)},to_store_details:function(id){var parmas={id:id};stateGo.go("message.shopdetails",parmas,!1)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.myclient",{url:"/myclient/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_client/views/my_client_page.html",controller:"myclientCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("myclientCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo){$scope.pData={id:{storeid:JSON.parse($state.params.params).id},params:{id:Authen.getUserInfo().ID},list_events:{}},$scope.pData.list_events={to_dynamic:function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)}},$scope.to_edit=function(){stateGo.go("mine.editcontent",{},!1)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){
$stateProvider.state("mine.editcontent",{url:"/editcontent/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_client/edit_content/views/edit_content_page.html",controller:"editcontentCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("editcontentCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo","commdityService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo,commdityService){$scope.pData={params:"",list_events:{},memberId:Authen.getUserId(),uuid:toolsService.uuid(),content:"",order_money:null},$scope.init=function(){var param={vid:"activity_money"},rData=actionManagerService.excuteResource("get_avar_info",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA.length>0&&($scope.pData.order_money=data.DATA[0].VVALUE)})},$scope.init(),$scope.submit_audit=function(){if(toolsService.isEmpty($scope.pData.content))toolsService.uu_Alert("请输入活动内容!");else{var params=new formatAmSqlParams;params.TABLENAME="uu_activity_content";var row=new formatAmSqlupdateRow;row.addColumn("STATUS","0"),row.addColumn("MEMBER_ID",Authen.getUserId()),row.addColumn("CONTENT",$scope.pData.content),row.addColumn("CREATE_DATE",new Date(new Date).Format("yyyy-MM-dd hh:mm:ss")),row.addColumn("PAY_MONEY",$scope.pData.order_money),row.setID($scope.pData.uuid),row.setStatus("i"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxTosyc(rData,function(data){if("0"===data.CODE){var paymoney=new Number($scope.pData.order_money).toFixed(2),pay_params={orderid:$scope.pData.uuid,order_money:paymoney,call_url:"com.am.uoou.mine.shop.ActivityPayCallBack",tourl:"mine.myclient"};stateGo.go("mine.coupon",pay_params,!0)}})}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.ustore",{url:"/ustore/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_u_shop/views/my_store_page.html",controller:"UStoreCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("UStoreCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={memberId:JSON.parse($state.params.params).id,memberType:Authen.getUserInfo().MEMBER_TYPE,storeData:"",listData:[{TITLE:"店铺订单",URL:"mine.storeorderlist",PARAMS:""},{TITLE:"店铺<span class='sx'>｛刷新｝</span>",URL:"mine.refreshstore",PARAMS:"1"},{TITLE:"店铺<span class='sx'>｛置顶｝</span>",URL:"mine.topshstore",PARAMS:""},{TITLE:"店铺<span class='sx'>｛推广｝</span>",URL:"mine.extendShop",PARAMS:""},{TITLE:"我的客户",URL:"mine.myclient",PARAMS:{}}]},$scope.init=function(){var rData=actionManagerService.excuteResource("uoou.myustore.storeinfo",{memberid:$scope.pData.memberId},"none","none");ajaxManager.ajaxTosyc(rData,function(data){console.debug(data),toolsService.isEmpty(data.DATA)||($scope.pData.storeData=data.DATA[0],$scope.pData.listData[0].PARAMS=JSON.stringify({id:data.DATA[0].ID}),$scope.pData.listData[1].PARAMS=JSON.stringify({id:data.DATA[0].ID}),$scope.pData.listData[2].PARAMS=JSON.stringify({id:data.DATA[0].ID}),$scope.pData.listData[3].PARAMS=JSON.stringify({id:data.DATA[0].ID}),console.debug($scope.pData.listData))})},$scope.init(),$scope.linkToPage=function(url){stateGo.go(url,{id:$scope.pData.storeData.ID},!1)},$scope.toVisitors=function(){stateGo.go("common.visitors",{id:$scope.pData.storeData.ID},!1)},$scope.setStore=function(){stateGo.go("mine.setstore",{id:$scope.pData.storeData.ID},!1)},$scope.to_dynamic=function(){var parmas={id:$scope.pData.memberId};stateGo.go("dynamic.mydynamic",parmas,!1)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("mine.extendShop",{url:"/extendShop/:params",cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_u_shop/extend_shop/views/extend_shop_page.html",controller:"ExtendShopCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ExtendShopCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup){$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pData={fwData:{name:"选择推广范围",data:{"全国":"1","全省":"2","全市":"3","全区县":"4"}},querfw:"",vvalue:0,coupMeny:0,recvProvince:"",recvCity:"",recvArea:"",shopId:JSON.parse($state.params.params).id,coupId:"",coupNone:{CSS:"ion-ios-checkmark-outline"}};var params=$state.params.params;toolsService.isEmpty(params.business)||($scope.pData.shopId=JSON.parse($state.params.params).business.shopId);var memberId=Authen.getUserId();$scope.selectClick1=function(value){$scope.pData.querfw=value,$scope.mixMoney()},$scope.mixMoney=function(){var vid="";1==$scope.pData.querfw?vid={vid:"whole_country"}:2==$scope.pData.querfw?vid={vid:"whole_province"}:3==$scope.pData.querfw?vid={vid:"whole_city"}:4==$scope.pData.querfw&&(vid={vid:"whole_county"});var qData=actionManagerService.excuteResource("variableSql",vid,"none","none");ajaxManager.ajaxToJson(qData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.vvalue=data.DATA[0].VVALUE,console.error($scope.pData.vvalue))})};var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)}),$scope.$watch("pData.recvProvince",function(){if($scope.pData.recvProvince){console.error($scope.pData.recvProvince);var pId={pid:$scope.pData.recvProvince},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pData.recvCity",function(){if($scope.pData.recvCity){var cId={cid:$scope.pData.recvCity},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),commdityService.getMemberCoupByMemberId(memberId,function(data){for(var i=0;i<data.length;i++)data[i].SELECTED=!1,data[i].CSS="ion-ios-circle-outline";$scope.pData.coupList=data}),$scope.changeCurrentCoup=function(index){if(-1!=index){if($scope.pData.vvalue<=$scope.pData.coupList[index].CASH)return toolsService.showMessage("无法使用此代金券!",1200),void($scope.pData.coupMeny=new Number(0));$scope.pData.coupNone.CSS="ion-ios-circle-outline";for(var i=0;i<$scope.pData.coupList.length;i++)0==$scope.pData.coupList[i].SELECTED,$scope.pData.coupList[i].CSS="ion-ios-circle-outline";$scope.pData.currentCoup=$scope.pData.coupList[index],$scope.pData.coupList[index].CSS="ion-ios-checkmark-outline"}else{for(var i=0;i<$scope.pData.coupList.length;i++)0==$scope.pData.coupList[i].SELECTED,$scope.pData.coupList[i].CSS="ion-ios-circle-outline";$scope.pData.currentCoup="none",$scope.pData.coupNone.CSS="ion-ios-checkmark-outline"}"none"!=$scope.pData.currentCoup?($scope.pData.coupMeny=new Number($scope.pData.currentCoup.CASH),$scope.pData.coupId=$scope.pData.currentCoup.ID):($scope.pData.coupMeny=new Number(0),$scope.pData.coupId="")},$scope.$watchCollection("pData.vvalue",function(){console.debug("$scope.$watchCollection(pData.shopInfo)"),sumPaymentTotal()}),$scope.$watch("pData.coupMeny",function(){sumPaymentTotal()});var sumPaymentTotal=function(){$scope.pData.paymentTotal=0,$scope.pData.vvalue>$scope.pData.coupMeny&&($scope.pData.paymentTotal=$scope.pData.vvalue-$scope.pData.coupMeny)};$scope.payment=function(){if(null==$scope.pData.querfw||void 0==$scope.pData.querfw||""==$scope.pData.querfw)return void toolsService.showMessage("请选择推广范围！",1);if(2==$scope.pData.querfw&&(null==$scope.pData.recvProvince||""==$scope.pData.recvProvince||void 0==$scope.pData.recvProvince))return void toolsService.showMessage("请选择省份！",1);if(3==$scope.pData.querfw&&(null==$scope.pData.recvCity||""==$scope.pData.recvCity||void 0==$scope.pData.recvCity))return void toolsService.showMessage("请选择市！",1);if(4==$scope.pData.querfw&&(null==$scope.pData.recvArea||""==$scope.pData.recvArea||void 0==$scope.pData.recvArea))return void toolsService.showMessage("请选择省份！",1);var querfw=$scope.pData.querfw,recvProvince=$scope.pData.recvProvince,recvCity=$scope.pData.recvCity,recvArea=$scope.pData.recvArea,moneys=$scope.pData.paymentTotal,uuid=toolsService.uuid();uuid=uuid.replace(/-/g,"");var params={title:"推广铺铺",out_account_code:"CASH_ACCOUNT,ALIPAY_ACCOUNT_MODE,WECHAT_ACCOUNT_MODE",in_account_code:"",out_remakes:"推广铺铺",in_remakes:"推广铺铺",pay_money:new Number(moneys),business:{payment_id:uuid,coupId:$scope.pData.coupId,memberid:memberId,shopId:$scope.pData.shopId,querfw:querfw,recvProvince:recvProvince,recvCity:recvCity,recvArea:recvArea,orders:uuid,success_call_back:"com.am.uoou.mine.shop.ExtendShopCallBack"},success_url:"mine.extendShop",lost_url:"mine.extendShop",pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};$state.go("common.payment",{params:JSON.stringify(params)})},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.indentstore",{url:"/indentstore/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_u_shop/indent_store/views/indent_store_page.html",controller:"IndentStoreCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("IndentStoreCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo","commdityService","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo,commdityService,$ionicPopup){$scope.pData={MemberId:"",UserName:null,UserHeadImg:null,Orderid:null,OrderContent:null,OrderMoney:null,OrderStatus:1,pageStatus:!1,decline_cause:"",pageStatus1:!1,loginaccount:"",state:"订单退款",contacts:null,phone:null,address:null,store_id:null};var params=$state.params.params;toolsService.isEmpty(params)||(params=JSON.parse($state.params.params)),$scope.pData.Orderid=params.id,$scope.init=function(){var rData=actionManagerService.excuteResource("uoou.storeorder.orderdetail",{orderid:$scope.pData.Orderid},"none","none");ajaxManager.ajaxToJson(rData,function(data){console.debug(data),$scope.pData.contacts=data.DATA[0].CONTACTS,$scope.pData.phone=data.DATA[0].PHONE,$scope.pData.address=data.DATA[0].ADDRESS,$scope.pData.MemberId=data.DATA[0].MEMBER_ID,$scope.pData.OrderStatus=data.DATA[0].ORDER_STATUS,data.DATA[0].ORDER_PRICE/100>0?$scope.pData.OrderMoney=data.DATA[0].ORDER_PRICE/100:$scope.pData.OrderMoney=null,$scope.pData.OrderContent=data.DATA[0].ORDER_CONTENT,$scope.pData.UserHeadImg=data.DATA[0].WXHEADIMG,$scope.pData.UserName=data.DATA[0].MEMBERNAME,$scope.pData.decline_cause=data.DATA[0].DECLINE_CAUSE,$scope.pData.loginaccount=data.DATA[0].LOGINACCOUNT,$scope.pData.store_id=data.DATA[0].STORE_ID,$scope.pData.OrderStatus>"1"&&($scope.pData.pageStatus=!0)})},$scope.init(),$scope.save=function(){if(toolsService.isEmpty($scope.pData.OrderMoney))toolsService.tips("金额不能为空!","");else if(toolsService.isNumber($scope.pData.OrderMoney))if(new Number($scope.pData.OrderMoney)>0){var params=new formatAmSqlParams;params.TABLENAME="uu_order";var row=new formatAmSqlupdateRow;row.setID($scope.pData.Orderid),row.setStatus("u"),row.addColumn("order_price",100*$scope.pData.OrderMoney),row.addColumn("order_content",$scope.pData.OrderContent),row.addColumn("order_status","1"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){console.log(6669),console.log(data),"0"==data.CODE?(toolsService.showMessage("保存成功","1"),$scope.init(),stateGo.go("mine.storeorderlist",{id:$scope.pData.store_id},!0)):toolsService.showMessage("保存失败","1")})}else toolsService.tips("请输入合法金额!","");else toolsService.tips("请输入合法金额!","")},$scope.updateOrderStatus=function(){console.debug(3);var params=new formatAmSqlParams;params.TABLENAME="uu_order";var row=new formatAmSqlupdateRow;row.setID($scope.pData.Orderid),row.setStatus("u"),row.addColumn("order_status","6"),row.addColumn("decline_cause",""),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&$scope.init()})},$scope.update_order=function(){var rData=actionManagerService.virementManager("",$scope.pData.loginaccount,"","CASH_ACCOUNT",$scope.pData.OrderMoney,"",$scope.pData.state);ajaxManager.ajaxToJson(rData,function(data){console.debug(1234543234567),console.debug(data.code),"0"==data.code&&(console.debug(2),$scope.updateOrderStatus())},function(data){})},$scope.Agreed_refund=function(){if("5"==$scope.pData.OrderStatus){$ionicPopup.confirm({title:"提示",template:"是否同意退款申请？",buttons:[{text:"取消",type:"btnc"},{text:"确认退款",type:"btn1",onTap:function(e){$scope.update_order()}}]})}},$scope.decline_refund=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_order";var row=new formatAmSqlupdateRow;row.setID($scope.pData.Orderid),row.setStatus("u"),row.addColumn("decline_cause",$scope.pData.decline_cause),row.addColumn("order_status","2"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE?(toolsService.showMessage("保存成功","1"),$scope.init()):toolsService.showMessage("保存失败","1")})},$scope.personDynamic=function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.openstore",{url:"/openstore/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_u_shop/open_store/views/open_store_page.html",controller:"OpenStoreCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("OpenStoreCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={storeId:JSON.parse($state.params.params).id,memberId:Authen.getUserId(),activityIntrState:!1,activityIntrClass:"btn-store-no-choice",storeIntrState:!0,storeIntrClass:"btn-store-choice",recruitmentInfoState:!1,recruitmentInfoClass:"btn-store-no-choice",storeName:"",mainClassData:"",storeMainClass:"",subClassData:"",storeSubClass:"",tabData:"",storeTab:"",recvProvince:"",recvCity:"",recvArea:"",storeAddress:"",businessTime:"",hotline:"",storeIntr:"",storeIntrImg:"",activityIntr:"",activityIntrImg:"",recruitmentInfo:"",recruitmentInfoImg:"",longitude:"",latitude:"",imgPath:"",choice:"",use_vouchers:"0"},$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.activity=function(){$scope.pData.activityIntrState=!0,$scope.pData.storeIntrState=!1,$scope.pData.recruitmentInfoState=!1,$scope.pData.activityIntrClass="btn-store-choice",$scope.pData.storeIntrClass="btn-store-no-choice",$scope.pData.recruitmentInfoClass="btn-store-no-choice"},$scope.store=function(){$scope.pData.activityIntrState=!1,$scope.pData.storeIntrState=!0,$scope.pData.recruitmentInfoState=!1,$scope.pData.activityIntrClass="btn-store-no-choice",$scope.pData.storeIntrClass="btn-store-choice",$scope.pData.recruitmentInfoClass="btn-store-no-choice"},$scope.recruitment=function(){$scope.pData.activityIntrState=!1,$scope.pData.storeIntrState=!1,$scope.pData.recruitmentInfoState=!0,$scope.pData.activityIntrClass="btn-store-no-choice",$scope.pData.storeIntrClass="btn-store-no-choice",$scope.pData.recruitmentInfoClass="btn-store-choice"},$scope.initTabs=function(){var tData=actionManagerService.excuteResource("uoou.setstore.tab",{classId:$scope.pData.storeSubClass},"none","none");ajaxManager.ajaxTosyc(tData,function(data){$scope.pData.tabData=data.DATA})},$scope.init=function(){var mData=actionManagerService.excuteResource("uoou.setstore.mainclass","","none","none");ajaxManager.ajaxTosyc(mData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.mainClassData=data.DATA)}),$scope.$watch("pData.storeMainClass",function(){var sData=actionManagerService.excuteResource("uoou.setstore.subclass",{mainClassId:$scope.pData.storeMainClass},"none","none");ajaxManager.ajaxTosyc(sData,function(data){$scope.pData.subClassData=data.DATA})});var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxTosyc(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)}),$scope.$watch("pData.recvProvince",function(){if($scope.pData.recvProvince){var pId={pid:$scope.pData.recvProvince},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxTosyc(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pData.recvCity",function(){if($scope.pData.recvCity){var cId={cid:$scope.pData.recvCity},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxTosyc(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}});var rData=actionManagerService.excuteResource("uoou.setstore.storedetails",{id:$scope.pData.storeId},"none","none");ajaxManager.ajaxTosyc(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pData.storeName=data.DATA[0].STORE_NAME,$scope.pData.storeMainClass=data.DATA[0].MAIN_STORE_CLASS,$scope.pData.storeSubClass=data.DATA[0].SUB_STORE_CLASS,$scope.pData.storeAddress=data.DATA[0].ADDRESS,$scope.pData.recvProvince=data.DATA[0].PROVINCE_ID,$scope.pData.recvCity=data.DATA[0].CITY_ID,$scope.pData.recvArea=data.DATA[0].AREA_ID,$scope.pData.businessTime=data.DATA[0].BUSINESS_TIME,$scope.pData.hotline=data.DATA[0].HOTLINE,$scope.pData.activityIntr=data.DATA[0].ACTIVITY_INTR,$scope.pData.activityIntrImg=data.DATA[0].ACTIVITY_INTR_IMG,$scope.pData.storeIntr=data.DATA[0].STORE_INTR,$scope.pData.storeIntrImg=data.DATA[0].STORE_INTR_IMG,$scope.pData.recruitmentInfo=data.DATA[0].RECRUITMENT_INFO,$scope.pData.recruitmentInfoImg=data.DATA[0].RECRUITMENT_INFO_IMG,$scope.initTabs();for(var tabs=data.DATA[0].TABS.split(","),i=0;i<tabs.length;i++)for(var j=0;j<$scope.pData.tabData.length;j++)tabs[i]==$scope.pData.tabData[j].ID&&($scope.pData.tabData[j].CHECKED=!0)}})},$scope.init(),$scope.$watch("pData.choice",function(){$scope.pData.choice?$scope.pData.use_vouchers="1":$scope.pData.use_vouchers="0"}),$scope.deleteImg=function(index){"1"==index?$scope.pData.storeIntrImg="":"2"==index?$scope.pData.activityIntrImg="":$scope.pData.recruitmentInfoImg=""},$scope.validate=function(){return toolsService.isEmpty($scope.pData.storeName)?(toolsService.showMessage("请输入店铺名称！","1"),!1):toolsService.isEmpty($scope.pData.storeMainClass)?(toolsService.showMessage("请选择店铺主分类！","1"),!1):toolsService.isEmpty($scope.pData.storeSubClass)?(toolsService.showMessage("请选择店铺子分类！","1"),!1):toolsService.isEmpty($scope.pData.recvProvince)?(toolsService.showMessage("请选择省","1"),!1):toolsService.isEmpty($scope.pData.recvCity)?(toolsService.showMessage("请选择市","1"),!1):toolsService.isEmpty($scope.pData.recvArea)?(toolsService.showMessage("请选择区","1"),!1):toolsService.isEmpty($scope.pData.storeAddress)?(toolsService.showMessage("请输入店铺地址！","1"),!1):toolsService.isEmpty($scope.pData.businessTime)?(toolsService.showMessage("请输入店铺营业时间！","1"),!1):toolsService.isEmpty($scope.pData.hotline)?(toolsService.showMessage("请输入服务热线！","1"),!1):!0},$scope.save=function(){for(var provinceName="",cityName="",zoneName="",i=0;i<$scope.cascadePCZ.provinces.length;i++)$scope.pData.recvProvince==$scope.cascadePCZ.provinces[i].PROID&&(provinceName=$scope.cascadePCZ.provinces[i].PRONAME);for(var i=0;i<$scope.cascadePCZ.cities.length;i++)$scope.pData.recvCity==$scope.cascadePCZ.cities[i].CITYID&&(cityName=$scope.cascadePCZ.cities[i].CITYNAME);for(var i=0;i<$scope.cascadePCZ.zones.length;i++)$scope.pData.recvArea==$scope.cascadePCZ.zones[i].ZONEID&&(zoneName=$scope.cascadePCZ.zones[i].ZONENAME);var recv_detall=provinceName+cityName+zoneName+$scope.pData.meetPlace,myGeo=new BMap.Geocoder;myGeo.getPoint(recv_detall,function(point){point?($scope.pData.longitude=point.lng,$scope.pData.latitude=point.lat,toolsService.isEmpty($scope.pData.storeId)?$scope.insertSave():$scope.updateSave()):toolsService.showMessage("请输入正确的地址！","1")})},$scope.insertSave=function(){$scope.pData.storeId=toolsService.uuid();for(var tabArray=new Array,i=0;i<$scope.pData.tabData.length;i++)$scope.pData.tabData[i].CHECKED&&tabArray.push($scope.pData.tabData[i].ID);var params=new formatAmSqlParams;params.TABLENAME="uu_store";var row=new formatAmSqlupdateRow;row.setID($scope.pData.storeId),row.setStatus("i"),row.addColumn("store_name",$scope.pData.storeName),row.addColumn("main_store_class",$scope.pData.storeMainClass),row.addColumn("sub_store_class",$scope.pData.storeSubClass),row.addColumn("province_id",$scope.pData.recvProvince),row.addColumn("city_id",$scope.pData.recvCity),row.addColumn("area_id",$scope.pData.recvArea),row.addColumn("address",$scope.pData.storeAddress),row.addColumn("business_time",$scope.pData.businessTime),row.addColumn("hotline",$scope.pData.hotline),row.addColumn("tabs",tabArray.toString()),row.addColumn("activity_intr",$scope.pData.activityIntr),row.addColumn("store_intr",$scope.pData.storeIntr),row.addColumn("recruitment_info",$scope.pData.recruitmentInfo),row.addColumn("activity_intr_img",$scope.pData.activityIntrImg),row.addColumn("store_intr_img",$scope.pData.storeIntrImg),row.addColumn("recruitment_info_img",$scope.pData.recruitmentInfoImg),row.addColumn("longitude",$scope.pData.longitude),row.addColumn("latitude",$scope.pData.latitude),row.addColumn("member_id",$scope.pData.memberId),row.addColumn("store_status","1"),row.addColumn("create_time",(new Date).Format("yyyy-MM-dd hh:mm:ss")),row.addColumn("atlas",$scope.pData.imgPath),row.addColumn("use_vouchers",$scope.pData.use_vouchers),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE?(toolsService.showMessage("申请成功，请等待审核！","1"),stateGo.go("mine.storestatus","",!0)):toolsService.showMessage("申请失败，请稍后重试！","1")})},$scope.updateSave=function(){for(var tabArray=new Array,i=0;i<$scope.pData.tabData.length;i++)$scope.pData.tabData[i].CHECKED&&tabArray.push($scope.pData.tabData[i].ID);var params=new formatAmSqlParams;params.TABLENAME="uu_store";var row=new formatAmSqlupdateRow;row.setID($scope.pData.storeId),row.setStatus("u"),row.addColumn("store_name",$scope.pData.storeName),row.addColumn("main_store_class",$scope.pData.storeMainClass),row.addColumn("sub_store_class",$scope.pData.storeSubClass),row.addColumn("province_id",$scope.pData.recvProvince),row.addColumn("city_id",$scope.pData.recvCity),row.addColumn("area_id",$scope.pData.recvArea),row.addColumn("address",$scope.pData.storeAddress),row.addColumn("business_time",$scope.pData.businessTime),row.addColumn("hotline",$scope.pData.hotline),row.addColumn("tabs",tabArray.toString()),row.addColumn("activity_intr",$scope.pData.activityIntr),row.addColumn("store_intr",$scope.pData.storeIntr),row.addColumn("recruitment_info",$scope.pData.recruitmentInfo),row.addColumn("activity_intr_img",$scope.pData.activityIntrImg),row.addColumn("store_intr_img",$scope.pData.storeIntrImg),row.addColumn("recruitment_info_img",$scope.pData.recruitmentInfoImg),row.addColumn("longitude",$scope.pData.longitude),row.addColumn("latitude",$scope.pData.latitude),row.addColumn("store_status","1"),row.addColumn("atlas",$scope.pData.imgPath),row.addColumn("use_vouchers",$scope.pData.use_vouchers),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE?(toolsService.showMessage("申请成功，请等待审核！","1"),$scope.init()):toolsService.showMessage("申请失败，请稍后重试！","1")})},$scope.saveStore=function(){$scope.validate()&&$scope.save()},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.refreshstore",{url:"/refreshstore/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_u_shop/refresh_store/views/refresh_store_page.html",controller:"RefreshStoreCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("RefreshStoreCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo","commdityService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo,commdityService){$scope.pData={sa_code:"",PLATFORM_HOTEL:"",memberId:Authen.getUserId(),storeId:JSON.parse($state.params.params).id,paymentTotal:0,coupList:"",coupMeny:0,currentCoup:"",coupId:"",coupNone:{CSS:"ion-ios-checkmark-outline"}},$scope.refreshStoreMoney=function(){var qData=actionManagerService.excuteResource("variableSql",{vid:"refresh_store"},"none","none");ajaxManager.ajaxToJson(qData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.vvalue=data.DATA[0].VVALUE,sumPaymentTotal())})},$scope.refreshStoreMoney(),commdityService.getMemberCoupByMemberId($scope.pData.memberId,function(data){for(var i=0;i<data.length;i++)data[i].SELECTED=!1,data[i].CSS="ion-ios-circle-outline";$scope.pData.coupList=data}),$scope.changeCurrentCoup=function(index){if(-1!=index){if(Number($scope.pData.vvalue)<=Number($scope.pData.coupList[index].CASH))return console.debug($scope.pData.coupList[index].CASH),toolsService.showMessage("无法使用此代金券!",1),void($scope.pData.coupMeny=new Number(0));$scope.pData.coupNone.CSS="ion-ios-circle-outline";for(var i=0;i<$scope.pData.coupList.length;i++)0==$scope.pData.coupList[i].SELECTED,$scope.pData.coupList[i].CSS="ion-ios-circle-outline";$scope.pData.currentCoup=$scope.pData.coupList[index],$scope.pData.coupList[index].CSS="ion-ios-checkmark-outline"}else{for(var i=0;i<$scope.pData.coupList.length;i++)0==$scope.pData.coupList[i].SELECTED,$scope.pData.coupList[i].CSS="ion-ios-circle-outline";$scope.pData.currentCoup="none",$scope.pData.coupNone.CSS="ion-ios-checkmark-outline"}"none"!=$scope.pData.currentCoup?($scope.pData.coupMeny=new Number($scope.pData.currentCoup.CASH),$scope.pData.coupId=$scope.pData.currentCoup.ID):($scope.pData.coupMeny=new Number(0),$scope.pData.coupId="")},$scope.$watch("pData.coupMeny",function(){sumPaymentTotal()});var sumPaymentTotal=function(){$scope.pData.paymentTotal=0,$scope.pData.vvalue>$scope.pData.coupMeny&&($scope.pData.paymentTotal=$scope.pData.vvalue-$scope.pData.coupMeny)};$scope.payment=function(){var uuid=toolsService.uuid();uuid=uuid.replace(/-/g,"");var params={title:"刷新铺铺",out_account_code:"CASH_ACCOUNT,ALIPAY_ACCOUNT_MODE,WECHAT_ACCOUNT_MODE",in_account_code:"",out_remakes:"刷新铺铺",in_remakes:"刷新铺铺",pay_money:new Number($scope.pData.paymentTotal),business:{storeId:$scope.pData.storeId,payment_id:uuid,coupId:$scope.pData.coupId,memberid:$scope.pData.memberId,orders:uuid,success_call_back:"com.am.uoou.mine.shop.RefreshStoreCallBack"},success_url:"mine.refreshstore",lost_url:"mine.refreshstore",pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};stateGo.go("common.payment",JSON.stringify(params),!0)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.setstore",{url:"/setstore/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_u_shop/set_store/views/set_store_page.html",controller:"SetStoreCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("SetStoreCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={storeId:JSON.parse($state.params.params).id,activityIntrState:!1,activityIntrClass:"btn-store-no-choice",storeIntrState:!0,storeIntrClass:"btn-store-choice",recruitmentInfoState:!1,recruitmentInfoClass:"btn-store-no-choice",storeName:"",mainClassData:"",storeMainClass:"",subClassData:"",storeSubClass:"",tabData:"",storeTab:"",recvProvince:"",recvCity:"",recvArea:"",storeAddress:"",businessTime:"",hotline:"",storeIntr:"",storeIntrImg:"",activityIntr:"",activityIntrImg:"",recruitmentInfo:"",recruitmentInfoImg:"",longitude:"",latitude:"",imgPath:"",choice:"",showData:""},$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.activity=function(){$scope.pData.activityIntrState=!0,$scope.pData.storeIntrState=!1,$scope.pData.recruitmentInfoState=!1,$scope.pData.activityIntrClass="btn-store-choice",$scope.pData.storeIntrClass="btn-store-no-choice",$scope.pData.recruitmentInfoClass="btn-store-no-choice"},$scope.store=function(){$scope.pData.activityIntrState=!1,$scope.pData.storeIntrState=!0,$scope.pData.recruitmentInfoState=!1,$scope.pData.activityIntrClass="btn-store-no-choice",$scope.pData.storeIntrClass="btn-store-choice",$scope.pData.recruitmentInfoClass="btn-store-no-choice"},$scope.recruitment=function(){$scope.pData.activityIntrState=!1,$scope.pData.storeIntrState=!1,$scope.pData.recruitmentInfoState=!0,$scope.pData.activityIntrClass="btn-store-no-choice",$scope.pData.storeIntrClass="btn-store-no-choice",$scope.pData.recruitmentInfoClass="btn-store-choice"},$scope.initTabs=function(){var tData=actionManagerService.excuteResource("uoou.setstore.tab",{classId:$scope.pData.storeSubClass},"none","none");ajaxManager.ajaxTosyc(tData,function(data){$scope.pData.tabData=data.DATA})},$scope.init=function(){var mData=actionManagerService.excuteResource("uoou.setstore.mainclass","","none","none");ajaxManager.ajaxTosyc(mData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.mainClassData=data.DATA)}),$scope.$watch("pData.storeMainClass",function(){var sData=actionManagerService.excuteResource("uoou.setstore.subclass",{mainClassId:$scope.pData.storeMainClass},"none","none");ajaxManager.ajaxTosyc(sData,function(data){$scope.pData.subClassData=data.DATA})});var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxTosyc(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)}),$scope.$watch("pData.recvProvince",function(){if($scope.pData.recvProvince){var pId={pid:$scope.pData.recvProvince},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxTosyc(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pData.recvCity",function(){if($scope.pData.recvCity){var cId={cid:$scope.pData.recvCity},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxTosyc(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}});var rData=actionManagerService.excuteResource("uoou.setstore.storedetails",{id:$scope.pData.storeId},"none","none");ajaxManager.ajaxTosyc(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pData.storeName=data.DATA[0].STORE_NAME,$scope.pData.storeMainClass=data.DATA[0].MAIN_STORE_CLASS,$scope.pData.storeSubClass=data.DATA[0].SUB_STORE_CLASS,
$scope.pData.storeAddress=data.DATA[0].ADDRESS,$scope.pData.recvProvince=data.DATA[0].PROVINCE_ID,$scope.pData.recvCity=data.DATA[0].CITY_ID,$scope.pData.recvArea=data.DATA[0].AREA_ID,$scope.pData.businessTime=data.DATA[0].BUSINESS_TIME,$scope.pData.hotline=data.DATA[0].HOTLINE,$scope.pData.activityIntr=data.DATA[0].ACTIVITY_INTR,$scope.pData.activityIntrImg=data.DATA[0].ACTIVITY_INTR_IMG,$scope.pData.storeIntr=data.DATA[0].STORE_INTR,$scope.pData.storeIntrImg=data.DATA[0].STORE_INTR_IMG,$scope.pData.recruitmentInfo=data.DATA[0].RECRUITMENT_INFO,$scope.pData.recruitmentInfoImg=data.DATA[0].RECRUITMENT_INFO_IMG,$scope.pData.showData=data.DATA[0],"0"==data.DATA[0].USE_VOUCHERS?$scope.pData.choice=!1:$scope.pData.choice=!0,$scope.initTabs();for(var tabs=data.DATA[0].TABS.split(","),i=0;i<tabs.length;i++)for(var j=0;j<$scope.pData.tabData.length;j++)tabs[i]==$scope.pData.tabData[j].ID&&($scope.pData.tabData[j].CHECKED=!0)}})},$scope.init(),$scope.deleteImg=function(index){"1"==index?$scope.pData.storeIntrImg="":"2"==index?$scope.pData.activityIntrImg="":$scope.pData.recruitmentInfoImg=""},$scope.validate=function(){return toolsService.isEmpty($scope.pData.storeName)?(toolsService.showMessage("请输入店铺名称！","1"),!1):toolsService.isEmpty($scope.pData.storeMainClass)?(toolsService.showMessage("请选择店铺主分类！","1"),!1):toolsService.isEmpty($scope.pData.storeSubClass)?(toolsService.showMessage("请选择店铺子分类！","1"),!1):toolsService.isEmpty($scope.pData.recvProvince)?(toolsService.showMessage("请选择省","1"),!1):toolsService.isEmpty($scope.pData.recvCity)?(toolsService.showMessage("请选择市","1"),!1):toolsService.isEmpty($scope.pData.recvArea)?(toolsService.showMessage("请选择区","1"),!1):toolsService.isEmpty($scope.pData.storeAddress)?(toolsService.showMessage("请输入店铺地址！","1"),!1):toolsService.isEmpty($scope.pData.businessTime)?(toolsService.showMessage("请输入店铺营业时间！","1"),!1):toolsService.isEmpty($scope.pData.hotline)?(toolsService.showMessage("请输入服务热线！","1"),!1):!0},$scope.save=function(){for(var tabArray=new Array,i=0;i<$scope.pData.tabData.length;i++)$scope.pData.tabData[i].CHECKED&&tabArray.push($scope.pData.tabData[i].ID);for(var provinceName="",cityName="",zoneName="",i=0;i<$scope.cascadePCZ.provinces.length;i++)$scope.pData.recvProvince==$scope.cascadePCZ.provinces[i].PROID&&(provinceName=$scope.cascadePCZ.provinces[i].PRONAME);for(var i=0;i<$scope.cascadePCZ.cities.length;i++)$scope.pData.recvCity==$scope.cascadePCZ.cities[i].CITYID&&(cityName=$scope.cascadePCZ.cities[i].CITYNAME);for(var i=0;i<$scope.cascadePCZ.zones.length;i++)$scope.pData.recvArea==$scope.cascadePCZ.zones[i].ZONEID&&(zoneName=$scope.cascadePCZ.zones[i].ZONENAME);var use_vouchers="0";$scope.pData.choice&&(use_vouchers="1");var recv_detall=provinceName+cityName+zoneName+$scope.pData.meetPlace,myGeo=new BMap.Geocoder;myGeo.getPoint(recv_detall,function(point){if(point){$scope.pData.longitude=point.lng,$scope.pData.latitude=point.lat;var params=new formatAmSqlParams;params.TABLENAME="uu_store";var row=new formatAmSqlupdateRow;row.setID($scope.pData.storeId),row.setStatus("u"),row.addColumn("store_name",$scope.pData.storeName),row.addColumn("main_store_class",$scope.pData.storeMainClass),row.addColumn("sub_store_class",$scope.pData.storeSubClass),row.addColumn("province_id",$scope.pData.recvProvince),row.addColumn("city_id",$scope.pData.recvCity),row.addColumn("area_id",$scope.pData.recvArea),row.addColumn("address",$scope.pData.storeAddress),row.addColumn("business_time",$scope.pData.businessTime),row.addColumn("hotline",$scope.pData.hotline),row.addColumn("tabs",tabArray.toString()),row.addColumn("activity_intr",$scope.pData.activityIntr),row.addColumn("store_intr",$scope.pData.storeIntr),row.addColumn("recruitment_info",$scope.pData.recruitmentInfo),row.addColumn("activity_intr_img",$scope.pData.activityIntrImg),row.addColumn("store_intr_img",$scope.pData.storeIntrImg),row.addColumn("recruitment_info_img",$scope.pData.recruitmentInfoImg),row.addColumn("longitude",$scope.pData.longitude),row.addColumn("latitude",$scope.pData.latitude),row.addColumn("atlas",$scope.pData.imgPath),row.addColumn("use_vouchers",use_vouchers),row.addColumn("store_status","1"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);console.error($scope.pData.imgPath),ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE?(toolsService.showMessage("保存成功","1"),$scope.init()):toolsService.showMessage("保存失败","1")})}else toolsService.showMessage("请输入正确的地址！","1")})},$scope.saveStore=function(){$scope.validate()&&$scope.save()},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.storeorderlist",{url:"/storeorderlist/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_u_shop/store_order/views/store_order_list.html",controller:"StoreOrderListCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("StoreOrderListCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={storeId:JSON.parse($state.params.params).id,orderStatus:"",params:{status_neworder:"0",storeid:JSON.parse($state.params.params).id},List_Events:{},listData:[{title:"新订单",css:"order-select",params:"0"},{title:"待支付",css:"order-no-select",params:"1"},{title:"已支付",css:"order-no-select",params:"2"},{title:"已完成",css:"order-no-select",params:"4"}]},$scope.to_select=function(index,status){for(var i=0;i<$scope.pData.listData.length;i++)i==index?$scope.pData.listData[i].css="order-select":$scope.pData.listData[i].css="order-no-select";$scope.pData.orderStatus=status,0==index&&($scope.pData.params={status_neworder:$scope.pData.orderStatus,storeid:$scope.pData.storeId}),1==index&&($scope.pData.params={status_unpaid:$scope.pData.orderStatus,storeid:$scope.pData.storeId}),2==index&&($scope.pData.params={status_hastopay:$scope.pData.orderStatus,storeid:$scope.pData.storeId}),3==index&&($scope.pData.params={status_having_fulfilled:$scope.pData.orderStatus,storeid:$scope.pData.storeId})},$scope.pData.List_Events={to_details:function(id){stateGo.go("mine.indentstore",{id:id},!1)},personDynamic:function(id){stateGo.go("dynamic.mydynamic",{id:id},!1)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.storestatus",{url:"/storestatus/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_u_shop/store_status/views/store_status_page.html",controller:"StoreStatusCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("StoreStatusCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo){$scope.pData={storeId:"",storeStatus:"",memberId:Authen.getUserId()};var storeParam={memberId:$scope.pData.memberId},storeData=actionManagerService.excuteResource("uu.mine.shopActivityList",storeParam,"none","none");ajaxManager.ajaxToJson(storeData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.storeId=data.DATA[0].ID,$scope.pData.storeStatus=data.DATA[0].STORE_STATUS)}),$scope.openStore=function(){stateGo.go("mine.openstore",{},!1)},$scope.apply=function(){stateGo.go("mine.openstore",{id:$scope.pData.storeId},!1)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.topshstore",{url:"/topstore/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/my_u_shop/top_store/views/top_store_page.html",controller:"TopStoreCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("TopStoreCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","stateGo","commdityService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,stateGo,commdityService){$scope.pData={memberId:Authen.getUserId(),storeId:JSON.parse($state.params.params).id,topDays:"",paymentTotal:0,coupList:"",coupMeny:0,currentCoup:"",coupId:"",coupNone:{CSS:"ion-ios-checkmark-outline"}},$scope.refreshStoreMoney=function(){var qData=actionManagerService.excuteResource("variableSql",{vid:"top_store"},"none","none");ajaxManager.ajaxToJson(qData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.vvalue=data.DATA[0].VVALUE,sumPaymentTotal())})},$scope.refreshStoreMoney(),commdityService.getMemberCoupByMemberId($scope.pData.memberId,function(data){for(var i=0;i<data.length;i++)data[i].SELECTED=!1,data[i].CSS="ion-ios-circle-outline";$scope.pData.coupList=data}),$scope.changeCurrentCoup=function(index){if(-1!=index){if(Number($scope.pData.vvalue*$scope.pData.topDays)<=Number($scope.pData.coupList[index].CASH))return toolsService.showMessage("无法使用此代金券!",1),void($scope.pData.coupMeny=new Number(0));$scope.pData.coupNone.CSS="ion-ios-circle-outline";for(var i=0;i<$scope.pData.coupList.length;i++)0==$scope.pData.coupList[i].SELECTED,$scope.pData.coupList[i].CSS="ion-ios-circle-outline";$scope.pData.currentCoup=$scope.pData.coupList[index],$scope.pData.coupList[index].CSS="ion-ios-checkmark-outline"}else{for(var i=0;i<$scope.pData.coupList.length;i++)0==$scope.pData.coupList[i].SELECTED,$scope.pData.coupList[i].CSS="ion-ios-circle-outline";$scope.pData.currentCoup="none",$scope.pData.coupNone.CSS="ion-ios-checkmark-outline"}"none"!=$scope.pData.currentCoup?($scope.pData.coupMeny=new Number($scope.pData.currentCoup.CASH),$scope.pData.coupId=$scope.pData.currentCoup.ID):($scope.pData.coupMeny=new Number(0),$scope.pData.coupId="")},$scope.$watch("pData.coupMeny",function(){sumPaymentTotal()}),$scope.$watch("pData.topDays",function(){sumPaymentTotal()});var sumPaymentTotal=function(){$scope.pData.paymentTotal=0,$scope.pData.paymentTotal=$scope.pData.vvalue*$scope.pData.topDays-$scope.pData.coupMeny};$scope.payment=function(){if(toolsService.isEmpty($scope.pData.topDays))return void toolsService.tips("请填写置顶天数！","");var uuid=toolsService.uuid();uuid=uuid.replace(/-/g,"");var params={title:"置顶铺铺",out_account_code:"CASH_ACCOUNT,ALIPAY_ACCOUNT_MODE,WECHAT_ACCOUNT_MODE",in_account_code:"",out_remakes:"置顶铺铺",in_remakes:"置顶铺铺",pay_money:new Number($scope.pData.paymentTotal),business:{payment_id:uuid,coupId:$scope.pData.coupId,memberid:$scope.pData.memberId,storeId:$scope.pData.storeId,topDays:$scope.pData.topDays,orders:uuid,success_call_back:"com.am.uoou.mine.shop.TopStoreCallBack"},success_url:"mine.extendShop",lost_url:"mine.extendShop",pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};$state.go("common.payment",{params:JSON.stringify(params)})},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.myorder",{url:"/myorder/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/myorder/views/myorder_page.html",controller:"myorderCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("myorderCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo){$scope.pData={list_events:{},params:{memberid:Authen.getUserId()}},$scope.pData.list_events={to_info:function(id){stateGo.go("mine.orderinfo",{orderid:id},!1)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.coupon",{url:"/coupon/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/myorder/coupon/views/coupon_page.html",controller:"couponCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("couponCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo){$scope.pData={devList:null,coupon_id:null,coupon_money:0,ordermoney:JSON.parse($state.params.params).order_money,order_id:JSON.parse($state.params.params).orderid,success_call_back:JSON.parse($state.params.params).call_url,to_url:JSON.parse($state.params.params).tourl,store_id:JSON.parse($state.params.params).store_id},$scope.init=function(){var param={memberid:Authen.getUserId(),usestatus:"1"},rData=actionManagerService.excuteResource("coupon",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){var jsonArr=new Array,jsono={};jsono.TEXT="不使用优惠券",jsono.CHECKED=!0,jsono.ID="0",jsono.MONEY="0",jsonArr.push(jsono);for(var i=0;i<data.DATA.length;i++){var jsonObj={};jsonObj.TEXT="代金券 "+data.DATA[i].CASH+" 元",jsonObj.CHECKED=!1,jsonObj.ID=data.DATA[i].ID,jsonObj.MONEY=data.DATA[i].CASH,jsonArr.push(jsonObj)}$scope.pData.devList=jsonArr})},$scope.choice_coupon=function(id){for(var i=0;i<$scope.pData.devList.length;i++)$scope.pData.devList[i].ID==id?($scope.pData.coupon_id=$scope.pData.devList[i].ID,$scope.pData.coupon_money=$scope.pData.devList[i].MONEY,$scope.pData.devList[i].CHECKED=!0):$scope.pData.devList[i].CHECKED=!1},$scope.pay=function(){var paymoney=$scope.pData.ordermoney-$scope.pData.coupon_money,uuid=toolsService.uuid();uuid=uuid.replace(/-/g,"");var params={title:"订单支付",out_account_code:"CASH_ACCOUNT,ALIPAY_ACCOUNT_MODE,WECHAT_ACCOUNT_MODE",in_account_code:"",out_remakes:"订单支付",in_remakes:"订单支付",pay_money:new Number(paymoney),business:{payment_id:uuid,memberid:Authen.getUserId(),orders:uuid,paymoney:new Number(paymoney),orderid:$scope.pData.order_id,coupon_id:$scope.pData.coupon_id,storeid:$scope.pData.store_id,success_call_back:$scope.pData.success_call_back},success_url:$scope.pData.to_url,lost_url:$scope.pData.to_url,pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};stateGo.go("common.payment",JSON.stringify(params),!0)},$scope.next=function(){if(!toolsService.isEmpty($scope.pData.coupon_id))if("0"==$scope.pData.coupon_id)$scope.pay();else{var paymoney=$scope.pData.ordermoney-$scope.pData.coupon_money;paymoney>0?$scope.pay():toolsService.uu_Alert("优惠券金额不能大于订单金额<br>或优惠券金额等于订单金额!")}$scope.pay()},$scope.init(),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.evaluate",{url:"/evaluate/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/myorder/evaluate/views/evaluate_page.html",controller:"orderevaluateCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("orderevaluateCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo,$ionicPopup){$scope.pData={star_level:0,star_state:"s",inputstatus:!1,content:"",textinput:!1,orderid:JSON.parse($state.params.params).orderid,store_id:JSON.parse($state.params.params).store_id,avg_order_fame:0},$scope.init=function(){if("4"==JSON.parse($state.params.params).orderstatus){$scope.pData.textinput=!0,$scope.pData.star_state="s";var param={orderid:$scope.pData.orderid},rData=actionManagerService.excuteResource("uoou.order.evaluate",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pData.star_level=data.DATA[0].STARVALUE,$scope.pData.content=data.DATA[0].CONTENT1})}else $scope.pData.textinput=!1,$scope.pData.star_state="e"},$scope.checkIsNull=function(){return $scope.pData.star_level<1?(toolsService.uu_Alert("请选择商品的星级进行评论!"),!1):toolsService.isEmpty($scope.pData.content)?(toolsService.uu_Alert("请填写评论内容!"),!1):!0},$scope.updateOrderStatus=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_order";var row=new formatAmSqlupdateRow;row.addColumn("order_status","4"),row.setID($scope.pData.orderid),row.setStatus("u"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){var rDatas=actionManagerService.updateEvaluateNum($scope.pData.store_id);ajaxManager.ajaxToJson(rDatas,function(data){$scope.order_reputation()})})},$scope.submit=function(){if($scope.checkIsNull()){var uuid=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="mall_CommodityOrderEvaluation";var row=new formatAmSqlupdateRow;row.addColumn("ORDERID",$scope.pData.orderid),row.addColumn("MEMBERID",Authen.getUserId()),row.addColumn("STARVALUE",$scope.pData.star_level),row.addColumn("CONTENT1",$scope.pData.content),row.addColumn("EVALDATETIME1",new Date(new Date).Format("yyyy-MM-dd hh:mm:ss")),row.addColumn("SHOP_ID",$scope.pData.store_id),row.setID(uuid),row.setStatus("i"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){"0"===data.CODE&&($scope.updateOrderStatus(),$scope.pData.textinput=!0,$scope.pData.star_state="s",toolsService.uu_Alert("评论成功!"))})}},$scope.order_reputation=function(){$scope.pData.params={shopid:$scope.pData.store_id};var rData=actionManagerService.excuteResource("uoou.myorder.update_order_fame",$scope.pData.params,"none","none");ajaxManager.ajaxToJson(rData,function(data){console.debug(data),$scope.pData.avg_order_fame=Number(data.DATA[0].DOF).toFixed(2),console.debug($scope.pData.avg_order_fame),$scope.update_order_reputation()})},$scope.update_order_reputation=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_store";var row=new formatAmSqlupdateRow;row.setID($scope.pData.store_id),row.setStatus("u"),row.addColumn("reputation",$scope.pData.avg_order_fame),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})},$scope.back=function(){toolsService.goBackPage()},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.orderinfo",{url:"/orderinfo/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/myorder/order_info/views/orderinfo_page.html",controller:"orderInfoCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("orderInfoCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo,$ionicPopup){var orderinfo_id=null;orderinfo_id=toolsService.isEmpty(JSON.parse($state.params.params).orderid)?JSON.parse($state.params.params).business.orderid:JSON.parse($state.params.params).orderid,$scope.pData={orderid:orderinfo_id,orderData:null,orderStatus:null,store_memberid:null,ordermoney:0,order_content:null,store_loginaccount:null,store_id:null,use_vouchers:"",decline_cause:"",pageStatus:!0,default_contacts:null,default_phone:null,default_address:null},$scope.init=function(){var param={orderid:$scope.pData.orderid},rData=actionManagerService.excuteResource("uoou.mine.myorder.query",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){console.debug(data),$scope.pData.default_contacts=data.DATA[0].CONTACTS,$scope.pData.default_phone=data.DATA[0].PHONE,$scope.pData.default_address=data.DATA[0].ADDRESS,$scope.pData.orderData=data.DATA[0],$scope.pData.orderStatus=data.DATA[0].ORDER_STATUS,$scope.pData.store_memberid=data.DATA[0].STORE_MEMBERID,$scope.pData.ordermoney=data.DATA[0].ORDERMONEY,$scope.pData.order_content=data.DATA[0].ORDER_CONTENT,$scope.pData.store_loginaccount=data.DATA[0].LOGINACCOUNT,$scope.pData.store_id=data.DATA[0].STORE_ID,$scope.pData.decline_cause=data.DATA[0].DECLINE_CAUSE,console.debug($scope.pData.decline_cause),$scope.pData.use_vouchers=data.DATA[0].USE_VOUCHERS,console.debug($scope.pData.use_vouchers)},function(data){})},$scope.init(),$scope.order_pay=function(){if(console.debug($scope.pData.use_vouchers),"1"==$scope.pData.use_vouchers){var paymoney=new Number($scope.pData.ordermoney/100).toFixed(2),pay_params={orderid:$scope.pData.orderid,order_money:paymoney,store_id:$scope.pData.store_id,call_url:"com.am.uoou.mine.shop.MyorderPayCallBack",tourl:"mine.orderinfo"};stateGo.go("mine.coupon",pay_params,!1)}else{var paymoney=Number($scope.pData.ordermoney/100).toFixed(2),uuid=toolsService.uuid(),params={title:"订单支付",out_account_code:"CASH_ACCOUNT,ALIPAY_ACCOUNT_MODE,WECHAT_ACCOUNT_MODE",in_account_code:"",out_remakes:"订单支付",in_remakes:"订单支付",pay_money:paymoney,business:{payment_id:uuid,memberid:Authen.getUserId(),orders:uuid,orderid:$scope.pData.orderid,coupon_id:"",storeid:$scope.pData.store_id,success_call_back:"com.am.uoou.mine.shop.MyorderPayCallBack"},success_url:"mine.orderinfo",lost_url:"mine.orderinfo",pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};stateGo.go("common.payment",JSON.stringify(params),!0)}},$scope.updateOrderStatus=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_order";var row=new formatAmSqlupdateRow;row.addColumn("order_status","3"),row.addColumn("decline_cause",""),row.setID($scope.pData.orderid),row.setStatus("u"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){$scope.init()})},$scope.update_order=function(){var rData=actionManagerService.virementManager("",$scope.pData.store_loginaccount,"","CASH_ACCOUNT",Number($scope.pData.ordermoney/100).toFixed(2),"",$scope.pData.order_content);ajaxManager.ajaxToJson(rData,function(data){"0"==data.code&&$scope.updateOrderStatus()},function(data){})},$scope.order_confirm=function(){if("2"==$scope.pData.orderStatus){$ionicPopup.confirm({title:"提示",template:"商品是否已签收？",buttons:[{text:"取消",type:"btnc"},{text:"确认收货",type:"btn1",onTap:function(e){$scope.update_order()}}]})}},$scope.updateorder_refund=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_order";var row=new formatAmSqlupdateRow;row.addColumn("order_status","5"),row.setID($scope.pData.orderid),row.setStatus("u"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){$scope.init()})},$scope.order_refund=function(){if("2"==$scope.pData.orderStatus){$ionicPopup.confirm({title:"提示",template:"商品是否进行退款？",buttons:[{text:"取消",type:"btnc"},{text:"确认申请",type:"btn1",onTap:function(e){$scope.updateorder_refund()}}]})}},$scope.deleteorder_refund=function(){var params=new formatAmSqlParams;params.TABLENAME="uu_order";var row=new formatAmSqlupdateRow;row.setID($scope.pData.orderid),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){stateGo.go("mine.myorder",{},!1)})},$scope.order_cancel=function(){if("1"==$scope.pData.orderStatus){$ionicPopup.confirm({title:"提示",template:"是否取消订单？",buttons:[{text:"取消",type:"btnc"},{text:"确认",type:"btn1",onTap:function(e){$scope.deleteorder_refund()}}]})}},$scope.evaluate=function(){("3"==$scope.pData.orderStatus||"4"==$scope.pData.orderStatus)&&stateGo.go("mine.evaluate",{orderid:$scope.pData.orderid,orderstatus:$scope.pData.orderStatus,store_id:$scope.pData.store_id},!1)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.openmember",{url:"/openmember/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/open_member/views/open_member_page.html",controller:"OpenMemberCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("OpenMemberCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$cordovaFileTransfer","$cordovaDevice","stateGo","$timeout",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$cordovaFileTransfer,$cordovaDevice,stateGo,$timeout){$scope.pData={memberId:Authen.getUserId(),memberType:"",memberExpireTime:"",memberMoneyCostData:"",choice:"",paymentMoney:0,cost:1,memberTypeData:[],openMonths:"",costDiscount:"",memberLeave:"",next_step:"",member_ExpireTime:""},$scope.init=function(){var rData=actionManagerService.excuteResource("member_info",{member_id:$scope.pData.memberId},"none","none");ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.memberExpireTime=data.DATA[0].MEMBER_EXPIRE_TIME,$scope.pData.member_ExpireTime=data.DATA[0].TIME,$scope.pData.memberType=data.DATA[0].MEMBER_TYPE)}),$scope.queryMemberMothMoney=function(){var rData=actionManagerService.excuteResource("uoou.openmember.queryMemberMothMoney","","none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pData.memberMoneyCostData=data.DATA;for(var i=0;i<data.DATA.length;i++)Number(data.DATA[i].DEFAULT_VALUE)>0&&($scope.pData.cost=data.DATA[i].ID)}})};var rData=actionManagerService.excuteResource("uoou.mine.penmember.getMemberType","","none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){for(var memberTypeData=data.DATA,ptmonth_cost="",ptgrade_interests="",zjmonth_cost="",zjtgrade_interests="",cjmonth_cost="",cjgrade_interests="",hgmonth_cost="",hggrade_interests="",i=0;i<memberTypeData.length;i++)"1"==memberTypeData[i].GRADE_CODE&&(ptmonth_cost=memberTypeData[i].MONTH_COST,ptgrade_interests=memberTypeData[i].GRADE_INTERESTS),"2"==memberTypeData[i].GRADE_CODE&&(zjmonth_cost=memberTypeData[i].MONTH_COST,zjtgrade_interests=memberTypeData[i].GRADE_INTERESTS),"3"==memberTypeData[i].GRADE_CODE&&(cjmonth_cost=memberTypeData[i].MONTH_COST,cjgrade_interests=memberTypeData[i].GRADE_INTERESTS),"4"==memberTypeData[i].GRADE_CODE&&(hgmonth_cost=memberTypeData[i].MONTH_COST,hggrade_interests=memberTypeData[i].GRADE_INTERESTS);$scope.pData.memberTypeData=[{NAME:"续费普通会员",MONTH_COST:ptmonth_cost,GRADE_INTERESTS:ptgrade_interests,ID:"1",LEAVE:"1",TYPE:"1",SHOW:!1},{NAME:"升级普通会员",MONTH_COST:ptmonth_cost,GRADE_INTERESTS:ptgrade_interests,ID:"2",LEAVE:"1",TYPE:"2",SHOW:!1},{NAME:"续费中级会员",MONTH_COST:zjmonth_cost,GRADE_INTERESTS:zjtgrade_interests,ID:"3",LEAVE:"2",TYPE:"1",SHOW:!1},{NAME:"升级中级会员",MONTH_COST:zjmonth_cost,GRADE_INTERESTS:zjtgrade_interests,ID:"4",LEAVE:"2",TYPE:"2",SHOW:!1},{NAME:"续费超级会员",MONTH_COST:cjmonth_cost,GRADE_INTERESTS:cjgrade_interests,ID:"5",LEAVE:"3",TYPE:"1",SHOW:!1},{NAME:"升级超级会员",MONTH_COST:cjmonth_cost,GRADE_INTERESTS:cjgrade_interests,ID:"6",LEAVE:"3",TYPE:"2",SHOW:!1},{NAME:"续费皇冠会员",MONTH_COST:hgmonth_cost,GRADE_INTERESTS:hggrade_interests,ID:"7",LEAVE:"4",TYPE:"1",SHOW:!1},{NAME:"升级皇冠会员",MONTH_COST:hgmonth_cost,GRADE_INTERESTS:hggrade_interests,ID:"8",LEAVE:"4",TYPE:"2",SHOW:!1}],"0"===$scope.pData.memberType&&($scope.pData.memberTypeData[0].SHOW=!1,$scope.pData.memberTypeData[1].SHOW=!0,$scope.pData.memberTypeData[2].SHOW=!1,$scope.pData.memberTypeData[3].SHOW=!0,$scope.pData.memberTypeData[4].SHOW=!1,$scope.pData.memberTypeData[5].SHOW=!0,$scope.pData.memberTypeData[6].SHOW=!1,$scope.pData.memberTypeData[7].SHOW=!0,$scope.pData.choice=$scope.pData.memberTypeData[1].ID),"1"===$scope.pData.memberType&&($scope.pData.memberTypeData[0].SHOW=!0,$scope.pData.memberTypeData[1].SHOW=!1,$scope.pData.memberTypeData[2].SHOW=!1,$scope.pData.memberTypeData[3].SHOW=!0,$scope.pData.memberTypeData[4].SHOW=!1,$scope.pData.memberTypeData[5].SHOW=!0,$scope.pData.memberTypeData[6].SHOW=!1,$scope.pData.memberTypeData[7].SHOW=!0,$scope.pData.choice=$scope.pData.memberTypeData[0].ID),"2"===$scope.pData.memberType&&($scope.pData.memberTypeData[0].SHOW=!1,$scope.pData.memberTypeData[1].SHOW=!1,$scope.pData.memberTypeData[2].SHOW=!0,$scope.pData.memberTypeData[3].SHOW=!1,$scope.pData.memberTypeData[4].SHOW=!1,$scope.pData.memberTypeData[5].SHOW=!0,$scope.pData.memberTypeData[6].SHOW=!1,$scope.pData.memberTypeData[7].SHOW=!0,$scope.pData.choice=$scope.pData.memberTypeData[2].ID),"3"===$scope.pData.memberType&&($scope.pData.memberTypeData[0].SHOW=!1,$scope.pData.memberTypeData[1].SHOW=!1,$scope.pData.memberTypeData[2].SHOW=!1,$scope.pData.memberTypeData[3].SHOW=!1,$scope.pData.memberTypeData[4].SHOW=!0,$scope.pData.memberTypeData[5].SHOW=!1,$scope.pData.memberTypeData[6].SHOW=!1,$scope.pData.memberTypeData[7].SHOW=!0,$scope.pData.choice=$scope.pData.memberTypeData[4].ID),"4"===$scope.pData.memberType&&($scope.pData.memberTypeData[0].SHOW=!1,$scope.pData.memberTypeData[1].SHOW=!1,$scope.pData.memberTypeData[2].SHOW=!1,$scope.pData.memberTypeData[3].SHOW=!1,$scope.pData.memberTypeData[4].SHOW=!1,$scope.pData.memberTypeData[5].SHOW=!1,$scope.pData.memberTypeData[6].SHOW=!0,$scope.pData.memberTypeData[7].SHOW=!1,$scope.pData.choice=$scope.pData.memberTypeData[6].ID)}}),$scope.queryMemberMothMoney()},$scope.$on("$ionicView.enter",function(event,data){console.log("执行$timeout回调"),$scope.init()}),$scope.CalculationPaymentMoney=function(){for(var i=0;i<$scope.pData.memberMoneyCostData.length;i++)$scope.pData.cost===$scope.pData.memberMoneyCostData[i].ID&&($scope.pData.openMonths=Number($scope.pData.memberMoneyCostData[i].COST_TIME),$scope.pData.costDiscount=Number($scope.pData.memberMoneyCostData[i].COST_DISCOUNT));for(var i=0;i<$scope.pData.memberTypeData.length;i++)if($scope.pData.choice===$scope.pData.memberTypeData[i].ID){$scope.title=$scope.pData.memberTypeData[i].NAME,$scope.pData.memberLeave=$scope.pData.memberTypeData[i].LEAVE,$scope.type=$scope.pData.memberTypeData[i].TYPE;var day=Number((new Date($scope.pData.memberExpireTime)-new Date)/864e5);console.debug("剩余天数"+day);var memberDayMoney=Number($scope.pData.memberTypeData[$scope.pData.memberType].MONTH_COST)/30,surplusMoney=0;day>0&&"2"===$scope.type&&(surplusMoney=memberDayMoney*Number((new Date($scope.pData.memberExpireTime)-new Date)/864e5),console.debug("剩余钱数"+surplusMoney)),$scope.pData.paymentMoney=$scope.pData.memberTypeData[i].MONTH_COST*$scope.pData.costDiscount*$scope.pData.openMonths/30-surplusMoney,console.debug("需要付的金额"+$scope.pData.paymentMoney),$scope.pData.paymentMoney<0?(console.debug("测试的金额"+$scope.pData.paymentMoney),$scope.pData.next_step=!0,toolsService.showMessage("在升级会员等级时，开通会员时限需大于现有会员等级的剩余时间，请您重新选择！","4000")):$scope.pData.next_step=!1,console.debug("显示"+$scope.pData.next_step)}},$scope.$watch("pData.choice",function(){$scope.CalculationPaymentMoney()}),$scope.$watch("pData.cost",function(){$scope.CalculationPaymentMoney()}),$scope.payment=function(){var uuid=toolsService.uuid().toUpperCase();uuid=uuid.replace(/-/g,"");var params={title:$scope.title,out_account_code:"CASH_ACCOUNT,ALIPAY_ACCOUNT_MODE,WECHAT_ACCOUNT_MODE",in_account_code:"",out_remakes:$scope.title,in_remakes:$scope.title,pay_money:new Number($scope.pData.paymentMoney/100).toFixed(2),business:{openType:$scope.type,openMonths:$scope.pData.openMonths,
memberLeave:$scope.pData.memberLeave,payment_id:uuid,coupId:"",memberid:$scope.pData.memberId,shopId:"",orders:uuid,success_call_back:"com.am.uoou.mine.shop.OpenMemberCallBack"},success_url:"mine.openmember",lost_url:"mine.openmember",pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};$scope.init(),stateGo.go("common.payment",JSON.stringify(params),!0)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.setting",{url:"/setting/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/setting/views/setting_page.html",controller:"SettingCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("SettingCtrl",["$scope","commdityService","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","stateGo","$cordovaAppVersion",function($scope,commdityService,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,stateGo,$cordovaAppVersion){$scope.pData={serviceTel:"",noDisturb:!1},$scope.$watch("pData.noDisturb",function(){localStorage.setItem("no_disturb",$scope.pData.noDisturb)}),$scope.init=function(){"true"==localStorage.getItem("no_disturb")?$scope.pData.noDisturb=!0:$scope.pData.noDisturb=!1,console.debug($scope.pData.noDisturb);var sData=actionManagerService.excuteResource("get_avar_info",{vid:"customer_service"},"","");ajaxManager.ajaxToJson(sData,function(data){toolsService.isEmpty(data.DATA)||($scope.pData.serviceTel=data.DATA[0].VVALUE,console.debug($scope.pData.serviceTel))})},$scope.init(),$scope.linkToPage=function(url,params){stateGo.go(url,params,"")},$scope.details=function(key){var contentParams={orgid:"org",key:key},tData=actionManagerService.excuteResource("content",contentParams,"","");ajaxManager.ajaxToJson(tData,function(data){stateGo.go("common.messagedetail",{id:data.DATA[0].ID},"")})},$scope.loginOut=function(){Authen.logout(),$state.go("mall.message")},$scope.detectionUpdate=function(){$cordovaAppVersion.getVersionNumber().then(function(version){console.info(" --- This APP Version ["+version+"] --- "),appConfig.version=version,toolsService.checkAndroidAppVersion(version,!0)})},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("message.shopActivity",{url:"/shopActivity/:params",cache:!1,views:{am_message:{templateUrl:"app_plugins/uoou/mine/shop_activity/views/shop_activity_page.html",controller:"ShopActivityCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ShopActivityCtrl",["$scope","commdityService","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup","stateGo",function($scope,commdityService,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup,stateGo){$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pData={recvProvince:"",recvCity:"",recvArea:"",param:{spreadStatus:1,spreadScope:1},list_events:""};var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)}),$scope.$watch("pData.recvProvince",function(){if($scope.pData.recvProvince){var pId={pid:$scope.pData.recvProvince},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pData.recvCity",function(){if($scope.pData.recvCity){var cId={cid:$scope.pData.recvCity},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),$scope.wholeCountry=function(){$scope.pData.param={spreadStatus:1,spreadScope:1},$scope.pData.recvProvince="",$scope.pData.recvCity="",$scope.pData.recvArea=""},$scope.$watch("pData.recvProvince",function(){$scope.pData.recvProvince&&($scope.pData.param={spreadStatus:1,spreadScope:2,spreadProvince:$scope.pData.recvProvince})}),$scope.$watch("pData.recvCity",function(){$scope.pData.recvCity&&($scope.pData.param={spreadStatus:1,spreadScope:3,spreadProvince:$scope.pData.recvProvince,spreadCity:$scope.pData.recvCity})}),$scope.$watch("pData.recvArea",function(){$scope.pData.recvArea&&($scope.pData.param={spreadStatus:1,spreadScope:4,spreadProvince:$scope.pData.recvProvince,spreadCity:$scope.pData.recvCity,spreadArea:$scope.pData.recvArea})}),$scope.pData.list_events={personDynamic:function(id){console.debug(id),stateGo.go("dynamic.mydynamic",{id:id},!1)},to_store_details:function(id){var parmas={id:id};stateGo.go("message.shopdetails",parmas,!1)}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","$httpProvider","ACCESS_LEVELS","appConfig","$compileProvider",function($stateProvider,$urlRouterProvider,$ionicConfigProvider,$httpProvider,ACCESS_LEVELS,appConfig,$compileProvider){$stateProvider.state("member.uutaskDetails",{url:"/mytaskDetails/:UTID",access_level:ACCESS_LEVELS.user,cache:!1,views:{member_view:{templateUrl:"app_plugins/uoou/mine/uu_welfare/views/uu_task_deatils.html",controller:"myDetailsTaskCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("uutaskDetails",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen","toolsService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen,toolsService){$scope.pData={taskDetail:""};var memberId=Authen.getUserId(),userTaskId=$state.params.UTID,proData=actionManagerService.getTaskDetails(memberId,userTaskId);ajaxManager.ajaxToJson(proData,function(data){0==data.CODE&&($scope.pData.taskDetail=data.VIEW)}),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.welfare",{url:"/welfare/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"app_plugins/uoou/mine/uu_welfare/views/uu_welfare_page.html",controller:"WelfareCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("WelfareCtrl",["OtherHandleService","$scope","commdityService","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","stateGo",function(OtherHandleService,$scope,commdityService,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,stateGo){function init(){initData(),initContentData(),getUserTaskInfo()}$scope.pData={switchCardData:[{NAME:"代金券任务",CSS:"",CODE:""},{NAME:"规则公告",CSS:"selected",CODE:"fund_welfare"}],invitsCode:"",subMemberCount:0,invitsRanking:"",showFundWelfare:!0,fundWelfare:"",userTaskData:[],right:'<i   class="uoou_welfare_head_img_left ion-android-share-alt"></i>',phoneType:!0},ionic.Platform.isIOS()?$scope.pData.phoneType=!1:$scope.pData.phoneType=!0;var currentIndex=1;$scope.switchCard=function(index){$scope.pData.switchCardData[currentIndex].CSS="",$scope.pData.switchCardData[index].CSS="selected",currentIndex=index,1===index?$scope.pData.showFundWelfare=!0:$scope.pData.showFundWelfare=!1};var initData=function(){var queryParams={memberId:Authen.getUserId()},tData=actionManagerService.excuteResource("am.common.getInvInfo",queryParams,"","");ajaxManager.ajaxToJson(tData,function(data){if(data&&data.DATA&&data.DATA.length>0)$scope.pData.subMemberCount=data.DATA[0].COUNT,$scope.pData.invitsRanking=data.DATA[0].ROW_NUMBER,$scope.pData.invitsCode=data.DATA[0].INVITATIONCODE;else{queryParams={memberid:Authen.getUserId()};var tData=actionManagerService.excuteResource("invitationCode",queryParams,"","");ajaxManager.ajaxToJson(tData,function(data){data.DATA&&data.DATA.length&&($scope.pData.invitsCode=data.DATA[0].INVITATIONCODE)})}})},initContentData=function(){var queryParams={orgid:appConfig.appOrg,key:"fund_welfare"},tData=actionManagerService.excuteResource("content",queryParams,"","");ajaxManager.ajaxToJson(tData,function(data){data&&data.DATA&&($scope.pData.fundWelfare=data.DATA[0].DETAILED)})},getUserTaskInfo=function(){var tData=actionManagerService.getTaskList(Authen.getUserId(),1);ajaxManager.ajaxToJson(tData,function(data){if(data&&data.DATA){data=data.DATA;for(var i=0;i<data.length;i++)data[i].TTSKPARAME&&(data[i].content=JSON.parse(data[i].TTSKPARAME).TaskDescription.content);$scope.pData.userTaskData=$scope.pData.userTaskData.concat(data)}}),tData=actionManagerService.getTaskList(Authen.getUserId(),0),ajaxManager.ajaxToJson(tData,function(data){if(data&&data.DATA){data=data.DATA;for(var i=0;i<data.length;i++)data[i].TTSKPARAME&&(data[i].content=JSON.parse(data[i].TTSKPARAME).TaskDescription.content);$scope.pData.userTaskData=$scope.pData.userTaskData.concat(data)}})};$scope.share=function(){OtherHandleService.share({memberid:Authen.getUserInfo().ID,id:"xxxxx",content:appConfig.shareContent,imageUrl:appConfig.shareImg,url:"",scope:"1",type:"0",orgcode:appConfig.appOrg,pageParams:""})},$scope.seeDetails=function(taskId){$state.go("member.uutaskDetails",{UTID:taskId})},$scope.back=function(){toolsService.goBackPage()},init()}]),angular.module("mallMobileApp.controllers").controller("AntiRiskSelfAccount",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={pageTitle:"抗风险自救金账户",balance:0,memberId:Authen.getUserId()},$scope.init=function(){$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"ANTI_RISK_SELF_SAVING_ACCOUNT",condition:""},$scope.getAcccountInfo()},$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberId,sa_code:"ANTI_RISK_SELF_SAVING_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE)})},$scope.toWithPage=function(){$state.go("common.withdraw",{params:JSON.stringify({outAccountId:"ANTI_RISK_SELF_SAVING_ACCOUNT",success_url:"account.antiriskselfaccount",lost_url:"account.antiriskselfaccount"})})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"ANTI_RISK_SELF_SAVING_ACCOUNT"})})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("BounsAccountCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={pageTitle:"经营分红账户",balance:0,count_money:"0",memberId:Authen.getUserId(),d_number:0,f_number:0},$scope.init=function(){$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"BONUS_ACCOUNT",condition:""},$scope.getAcccountInfo()},$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberId,sa_code:"BONUS_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&($scope.pageData.balance=data.DATA[0].BALANCE,$scope.pageData.count_money=data.DATA[0].TOTAL_AMOUNT,$scope.pageData.d_number=data.DATA[0].ENABLED_DIVIDEND_SHARING,$scope.pageData.f_number=data.DATA[0].DISABLE_DIVIDEND_SHARINGS)})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"BONUS_ACCOUNT"})})},$scope.toSendRedPacket=function(){$state.go("common.redpacket",{params:JSON.stringify({title:"发红包",out_account_code:"BONUS_ACCOUNT",in_remakes:"CONSUMER_ACCOUNT",success_url:"account.bounsaccount",lost_url:"account.bounsaccount"})})},$scope.toVirementPage=function(){$state.go("common.virementmanager",{params:JSON.stringify({title:"转账",out_account_code:"BONUS_ACCOUNT",out_remakes:"转账",in_remakes:"转账收入",in_account_code:"CASH_ACCOUNT",success_url:"account.bounsaccount",lost_url:"account.bounsaccount"})})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("CashAccountCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={pageTitle:"社员现金账户",balance:0,memberId:Authen.getUserId()},$scope.init=function(){$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"CASH_ACCOUNT",condition:""},$scope.getAcccountInfo()},$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberId,sa_code:"CASH_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE)})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"CASH_ACCOUNT"})})},$scope.toPayPage=function(){$state.go("common.paymentinput",{params:JSON.stringify({accountCode:"CASH_ACCOUNT",success_url:"account.cashaccount",lost_url:"account.cashaccount",out_account_code:"WECHAT_ACCOUNT_MODE,ALIPAY_ACCOUNT_MODE"})})},$scope.toWithPage=function(){$state.go("common.withdraw",{params:JSON.stringify({outAccountId:"CASH_ACCOUNT",success_url:"account.cashaccount",lost_url:"account.cashaccount"})})},$scope.toVirementPage=function(){$state.go("common.virementmanager",{params:JSON.stringify({title:"转账",out_account_code:"CASH_ACCOUNT",out_remakes:"转账",in_remakes:"转账收入",in_account_code:"CONSUMER_ACCOUNT,CREDIT_MARGIN_ACCOUNT,CREDIT_CARD_ACCOUNT",success_url:"account.cashaccount",lost_url:"account.cashaccount"})})},$scope.toVirementOtherPage=function(){$state.go("common.virementothermanager",{params:JSON.stringify({title:"向他人转账",out_account_code:"CASH_ACCOUNT",out_remakes:"转账",in_remakes:"转账收入",in_account_code:"CASH_ACCOUNT",success_url:"account.cashaccount",lost_url:"account.cashaccount"})})},$scope.toSendRedPacket=function(){$state.go("common.redpacket",{params:JSON.stringify({title:"发红包",out_account_code:"CASH_ACCOUNT",in_remakes:"发红包",success_url:"account.cashaccount",lost_url:"account.cashaccount"})})},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("mine.accountbalance",{url:"/accountbalance/:params",cache:!1,access_level:ACCESS_LEVELS.user,views:{am_mine:{templateUrl:"frame/account/cash_account/uoou/views/account_balance_page.html",controller:"AccountBlanceCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("AccountBlanceCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={pageTitle:"余额宝",balance:0,memberId:Authen.getUserId(),pageState:"0",selectCss_0:"uoou_account_balance_select_css",selectCss_1:""},$scope.init=function(){"0"==$scope.pageData.pageState?$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"CASH_ACCOUNT",condition:""}:$scope.pageData.params={member_id:$scope.pageData.memberid},$scope.getAcccountInfo()},$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberId,sa_code:"CASH_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE)})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"CASH_ACCOUNT"})})},$scope.toPayPage=function(){ionic.Platform.isIOS()?toolsService.tips("敬请期待！",""):$state.go("common.paymentinput",{params:JSON.stringify({accountCode:"CASH_ACCOUNT",success_url:"mine.accountbalance",lost_url:"mine.accountbalance",out_account_code:"ALIPAY_ACCOUNT_MODE,WECHAT_ACCOUNT_MODE"})})},$scope.toWithPage=function(){$state.go("common.withdraw",{params:JSON.stringify({outAccountId:"CASH_ACCOUNT",success_url:"mine.accountbalance",lost_url:"mine.accountbalance"})})},$scope.selectRecord=function(state){"0"==state?($scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"CASH_ACCOUNT",condition:""},$scope.pageData.selectCss_0="uoou_account_balance_select_css",$scope.pageData.selectCss_1="",$scope.pageData.pageState="0"):($scope.pageData.selectCss_1="uoou_account_balance_select_css",$scope.pageData.selectCss_0="",$scope.pageData.pageState="1",$scope.pageData.params={member_id:$scope.pageData.memberId,condition:""})},$scope.back=function(){toolsService.goBackPage()},$scope.init(),$scope.addBackCard=function(){$state.go("member.bankcard",{})}}]),angular.module("mallMobileApp.controllers").controller("ConsumerAccountCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={pageTitle:"消费账户",balance:0,memberId:Authen.getUserId()},$scope.init=function(){$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"CONSUMER_ACCOUNT",condition:""},$scope.getAcccountInfo()},$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberId,sa_code:"CONSUMER_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE)})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"CONSUMER_ACCOUNT"})})},$scope.toPayPage=function(){$state.go("common.paymentinput",{params:JSON.stringify({accountCode:"CONSUMER_ACCOUNT",success_url:"account.consumeraccount",lost_url:"account.consumeraccount",out_account_code:"WECHAT_ACCOUNT_MODE,UNIONPAY_ACCOUNT_MODE,ALIPAY_ACCOUNT_MODE"})})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("CreditCardAccountCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={pageTitle:"信誉卡账户",balance:0,memberId:Authen.getUserId(),credit_amount:"0",used_amount:"0",available_amount:"0",available_cash_amount:"0",used_in_cash:"0",starting_amount:"0",consumer_donor_amount:"0",total_charge_amount:"0",repayment_date:"",late_fee:"",business:"",cash_repayment_date:""},$scope.init=function(){$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"CREDIT_CARD_ACCOUNT",condition:""},$scope.getAcccountInfo(),toolsService.isEmpty($state.params.params)||"1"==JSON.parse($state.params.params).pay_type||"2"==JSON.parse($state.params.params).pay_type||"3"==JSON.parse($state.params.params).pay_type},$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberId,sa_code:"CREDIT_CARD_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE,$scope.pageData.credit_amount=data.DATA[0].CREDIT_AMOUNT,$scope.pageData.used_amount=data.DATA[0].USED_AMOUNT,$scope.pageData.available_amount=data.DATA[0].AVAILABLE_AMOUNT,$scope.pageData.available_cash_amount=data.DATA[0].AVAILABLE_CASH_AMOUNT,$scope.pageData.used_in_cash=data.DATA[0].USED_IN_CASH,$scope.pageData.starting_amount=data.DATA[0].STARTING_AMOUNT,$scope.pageData.consumer_donor_amount=data.DATA[0].CONSUMER_DONOR_AMOUNT,$scope.pageData.total_charge_amount=data.DATA[0].TOTAL_CHARGE_AMOUNT,$scope.pageData.repayment_date=data.DATA[0].REPAYMENT_DATE,$scope.pageData.late_fee=data.DATA[0].LATE_FEE,$scope.pageData.cash_repayment_date=data.DATA[0].CASH_REPAYMENT_DATE)})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"CREDIT_CARD_ACCOUNT"})})},$scope.toPayPage=function(){$state.go("common.paymentinput",{params:JSON.stringify({accountCode:"CREDIT_CARD_ACCOUNT",success_url:"account.creditcardaccount",lost_url:"account.creditcardaccount",in_remakes:"充值",out_account_code:"WECHAT_ACCOUNT_MODE,UNIONPAY_ACCOUNT_MODE,ALIPAY_ACCOUNT_MODE",business:[{pay_type:"1"}]})})},$scope.toVirementWithPage=function(){$state.go("common.virementmanager",{params:JSON.stringify({title:"转账",out_account_code:"CREDIT_CARD_ACCOUNT",out_remakes:"信誉卡取现",in_remakes:"信誉卡取现",in_account_code:"CONSUMER_ACCOUNT",success_url:"account.creditcardaccounts",lost_url:"account.creditcardaccounts",business:[{pay_type:"3"}]})})},$scope.toVirementPage=function(){$state.go("common.virementmanager",{params:JSON.stringify({title:"转账",out_account_code:"CASH_ACCOUNT",out_remakes:"还款",in_remakes:"信誉卡还款",in_account_code:"CREDIT_CARD_ACCOUNT",success_url:"account.creditcardaccounts",lost_url:"account.creditcardaccounts",business:[{pay_type:"3"}]})})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("CreditMarginAccountCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={pageTitle:"信用保证金账户",balance:0,memberId:Authen.getUserId()},$scope.init=function(){$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"CREDIT_MARGIN_ACCOUNT",condition:""},$scope.getAcccountInfo()},$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberId,sa_code:"CREDIT_MARGIN_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE)})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"CREDIT_MARGIN_ACCOUNT"})})},$scope.toPayPage=function(){$state.go("common.paymentinput",{params:JSON.stringify({accountCode:"CREDIT_MARGIN_ACCOUNT",success_url:"account.creditaccount",lost_url:"account.creditaccount",out_account_code:"WECHAT_ACCOUNT_MODE,UNIONPAY_ACCOUNT_MODE,ALIPAY_ACCOUNT_MODE"})})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("FoodSafetyAccountCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={pageTitle:"食品安全追溯账户",balance:0,memberId:Authen.getUserId()},$scope.init=function(){$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"FOOD_SAFETY_TRACING_ACCOUNT",condition:""},$scope.getAcccountInfo()},$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberId,sa_code:"FOOD_SAFETY_TRACING_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data)||toolsService.isEmpty(data.DATA)||($scope.pageData.balance=data.DATA[0].BALANCE)})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"FOOD_SAFETY_TRACING_ACCOUNT"})})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("IdentityStockCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={showView:"prospectus",memberid:"",pageTitle:"社员股金账户",listEvents:"",count_balance:"0",count_money:"0",balance:"0"},$scope.pageData.memberid=Authen.getUserId();var params=$state.params.params;if(!toolsService.isEmpty(params)){var number=JSON.parse($state.params.params).business.number,projectid=JSON.parse($state.params.params).business.projectid,memberid=JSON.parse($state.params.params).business.memberid,stockprice=JSON.parse($state.params.params).business.stockprice;console.debug(memberid);var aData=actionManagerService.investment(number,projectid,memberid,stockprice);ajaxManager.ajaxToJson(aData,function(data){0==data.code&&(console.error(data),$scope.pageData.params={memberid:Authen.getUserId()})})}$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberid,sa_code:"IDENTITY_STOCK_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE,$scope.pageData.count_money=data.DATA[0].TOTAL_AMOUNT)});var rData=actionManagerService.excuteResource("get_identity_stock_account_farm_count",{memberid:$scope.pageData.memberid},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.count_balance=data.DATA[0].SUM)})},$scope.pageData.list_events={prospectus:function(item){var params=item;$state.go("cooperative.projectDetails",{params:params})}},$scope.toFarm=function(){$state.go("cooperative.agroProjList",{})},$scope.toSendRedPacket=function(){$state.go("common.redpacket",{params:JSON.stringify({title:"发红包",out_account_code:"IDENTITY_STOCK_ACCOUNT",in_remakes:"",success_url:"account.identityStock",lost_url:"account.identityStock"})})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"IDENTITY_STOCK_ACCOUNT"})})},$scope.toWithPage=function(){$state.go("common.withdraw",{params:JSON.stringify({outAccountId:"IDENTITY_STOCK_ACCOUNT",success_url:"account.identityStock",lost_url:"account.identityStock"})})};var currentIndex=0;$scope.pageData.type=currentIndex,$scope.pageData.comdSelectCards=[{title:"已投资项目",CSS:"login_cm_select_item_active",show:!0,style:"color:#24B35E;"},{title:"交易明细",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"}],$scope.selectCards=function(index){$scope.pageData.comdSelectCards[index].CSS="login_cm_select_item_active",$scope.pageData.comdSelectCards[index].style="color:#24B35E;",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="login_cm_select_item",$scope.pageData.comdSelectCards[currentIndex].style="color: #585858;",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex,"1"==$scope.pageData.type&&($scope.pageData.params={memberid:$scope.pageData.memberid,sa_code:"IDENTITY_STOCK_ACCOUNT",condition:""})},$scope.getAcccountInfo()}]),angular.module("mallMobileApp.controllers").controller("VolunteerAccountCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={pageTitle:"志愿者服务账户",balance:0,totalAmount:0,memberId:Authen.getUserId()},$scope.init=function(){$scope.pageData.params={memberid:$scope.pageData.memberId,sa_code:"VOLUNTEER_ACCOUNT",condition:""},$scope.getAcccountInfo()},$scope.getAcccountInfo=function(){var rData=actionManagerService.excuteResource("GetAccountInfo",{member_id:$scope.pageData.memberId,sa_code:"VOLUNTEER_ACCOUNT"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.balance=data.DATA[0].BALANCE,$scope.pageData.totalAmount=data.DATA[0].TOTAL_AMOUNT)})},$scope.toPage=function(){$state.go("common.recode",{params:JSON.stringify({accountCode:"VOLUNTEER_ACCOUNT"})})},$scope.toWithPage=function(){$state.go("common.withdraw",{params:JSON.stringify({outAccountId:"DISTRIBUTION_ACCOUNT",success_url:"account.volunteerAccount",lost_url:"account.volunteerAccount"})})},$scope.toVirementPage=function(){$state.go("common.virementmanager",{params:JSON.stringify({title:"转账",out_account_code:"DISTRIBUTION_ACCOUNT",out_remakes:"转账",in_remakes:"转账收入",in_account_code:"CASH_ACCOUNT",success_url:"account.volunteerAccount",lost_url:"account.volunteerAccount"})})},$scope.toSendRedPacket=function(){$state.go("common.redpacket",{params:JSON.stringify({title:"发红包",out_account_code:"DISTRIBUTION_ACCOUNT",in_remakes:"",success_url:"account.volunteerAccount",lost_url:"account.volunteerAccount"})})},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("member.addaddr",{url:"/addaddr/:params",cache:!1,views:{member_view:{templateUrl:"frame/member/address/views/addAddr.html",controller:"AddAddrCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("AddAddrCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){var currentSelectAddIndex=-1;$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pData={recvPostallCode:"",recvName:"",recvPhone:"",recvDetail:"",provinces:"",recvcity:"",recvarea:"",longitud:"",latitude:""};var routeType="list",source={};$scope.init=function(){var params=null;if($state.params&&$state.params.params&&(params=JSON.parse($state.params.params),params.routeType&&(routeType=params.routeType,"ORDER"==routeType&&(source.stateName=params.stateName,source.state=params.state))),params&&params.id){var Id={id:params.id},addreData=actionManagerService.excuteResource("addresDetails",Id,"","");ajaxManager.ajaxToJson(addreData,function(data){if(data.DATA&&($scope.memberAddresList=data.DATA,$scope.pData.recvName=data.DATA[0].RECV_NAME,$scope.pData.recvPhone=data.DATA[0].RECV_PHONE,$scope.pData.recvDetail=data.DATA[0].RECV_DETAIL,$scope.pData.recvPostallCode=data.DATA[0].RECV_POSTAL_CODE,$scope.pData.provinces=data.DATA[0].RECV_PROVINCE,$scope.pData.recvcity=data.DATA[0].RECV_CITY,$scope.pData.recvarea=data.DATA[0].RECV_AREA,currentSelectAddIndex=1,data.DATA[0].DEFAULT&&"true"==data.DATA[0].DEFAULT?$scope.pData.defaultAddr=!0:$scope.pData.defaultAddr=!1,currentSelectAddIndex>=0))for(var i=0;i<$scope.cascadePCZ.provinces.length;i++)if($scope.cascadePCZ.provinces[i].PROID==$scope.pData.provinces){$scope.pData.recvProvince=$scope.cascadePCZ.provinces[i];break}})}};var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)}),$scope.$watch("pData.recvProvince",function(){if($scope.pData.recvProvince){var pId={pid:$scope.pData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){if(data.DATA&&($scope.cascadePCZ.cities=data.DATA,currentSelectAddIndex>=0))for(var i=0;i<$scope.cascadePCZ.cities.length;i++)if($scope.cascadePCZ.cities[i].CITYID==$scope.pData.recvcity){$scope.pData.recvCity=$scope.cascadePCZ.cities[i];break}})}}),$scope.$watch("pData.recvCity",function(){if($scope.pData.recvCity){var cId={cid:$scope.pData.recvCity.CITYID
},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){if(data.DATA&&($scope.cascadePCZ.zones=data.DATA),currentSelectAddIndex>=0)for(var i=0;i<$scope.cascadePCZ.zones.length;i++)if($scope.cascadePCZ.zones[i].ZONEID==$scope.pData.recvarea){$scope.pData.recvArea=$scope.cascadePCZ.zones[i];break}})}}),$scope.saveAddress=function(){if($scope.pData.recvPhone=$scope.pData.recvPhone,$scope.pData.recvName=$scope.pData.recvName,$scope.pData.recvDetail=$scope.pData.recvDetail,$scope.pData.recvPostallCode=$scope.pData.recvPostallCode,null==$scope.pData.recvName||""==$scope.pData.recvName||void 0==$scope.pData.recvName||$scope.pData.recvName.length<2)return void toolsService.showMessage("请输入正确的联系人！",1);if(null==$scope.pData.recvPhone||""==$scope.pData.recvPhone||void 0==$scope.pData.recvPhone||11!=$scope.pData.recvPhone.length)return void toolsService.showMessage("请输入正确的电话号码！",1);if(void 0==$scope.pData.recvProvince||""==$scope.pData.recvProvince||null==$scope.pData.recvProvince)return void toolsService.showMessage("请选择省份！",1);if(void 0==$scope.pData.recvCity||""==$scope.pData.recvCity||null==$scope.pData.recvCity)return void toolsService.showMessage("请选择市！",1);if(void 0==$scope.pData.recvArea||""==$scope.pData.recvArea||null==$scope.pData.recvArea)return void toolsService.showMessage("请选择区！",1);if(null==$scope.pData.recvDetail||""==$scope.pData.recvDetail||void 0==$scope.pData.recvDetail||$scope.pData.recvDetail.length<2)return void toolsService.showMessage("请输入正确的地址！",1);if(null==$scope.pData.recvPostallCode||""==$scope.pData.recvPostallCode||void 0==$scope.pData.recvPostallCode||6!=$scope.pData.recvPostallCode.length)return void toolsService.showMessage("请输入正确的邮政编码！",1);var recv_detall=$scope.pData.recvProvince.PRONAME+$scope.pData.recvCity.CITYNAME+$scope.pData.recvArea.ZONENAME,myGeo=($scope.pData.recvCity.CITYNAME,new BMap.Geocoder);myGeo.getPoint(recv_detall,function(point){point&&($scope.pData.longitud=point.lng,$scope.pData.latitude=point.lat,$scope.updateAddress())})},$scope.updateAddress=function(){var params=null;if($state.params&&$state.params.params&&(params=JSON.parse($state.params.params)),params&&params.id){var ID=params.id,recvProvince=$scope.pData.recvProvince.PROID,recvCity=$scope.pData.recvCity.CITYID,recvArea=$scope.pData.recvArea.ZONEID,params=new formatAmSqlParams;params.TABLENAME="am_addres";var row=new formatAmSqlupdateRow;row.setID(ID),row.setStatus("u"),row.addColumn("recv_phone",$scope.pData.recvPhone),row.addColumn("recv_name",$scope.pData.recvName),row.addColumn("recv_detail",$scope.pData.recvDetail),row.addColumn("recv_postal_code",$scope.pData.recvPostallCode),row.addColumn("recv_province",recvProvince),row.addColumn("recv_city",recvCity),row.addColumn("recv_area",recvArea),row.addColumn("longitud",$scope.pData.longitud),row.addColumn("latitude",$scope.pData.latitude),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){if(0!=data.CODE?toolsService.showMessage("修改失败！",1):toolsService.showMessage("修改成功！",1),"ORDER"==routeType){var rp=JSON.parse(source.state);$state.go(source.stateName,{params:rp.params},{location:"replace"})}else $state.go("member.address",{},{location:"replace"})});var addrid=ID;$scope.updateDefaultAddr(addrid)}else{var recvProvince=$scope.pData.recvProvince.PROID,recvCity=$scope.pData.recvCity.CITYID,recvArea=$scope.pData.recvArea.ZONEID,uuid=toolsService.uuid(),memberid=Authen.getUserId(),params=new formatAmSqlParams;params.TABLENAME="am_addres";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("am_memberid",memberid),row.addColumn("recv_phone",$scope.pData.recvPhone),row.addColumn("recv_name",$scope.pData.recvName),row.addColumn("recv_detail",$scope.pData.recvDetail),row.addColumn("recv_postal_code",$scope.pData.recvPostallCode),row.addColumn("recv_province",recvProvince),row.addColumn("recv_city",recvCity),row.addColumn("recv_area",recvArea),row.addColumn("longitud",$scope.pData.longitud),row.addColumn("latitude",$scope.pData.latitude),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){if(0!=data.CODE?toolsService.showMessage("保存失败！",1):toolsService.showMessage("保存成功！",1),"ORDER"==routeType){var rp=JSON.parse(source.state);$state.go(source.stateName,{params:rp.params},{location:"replace"})}else $state.go("member.address",{},{location:"replace"})}),$scope.updateDefaultAddr(uuid)}},$scope.updateDefaultAddr=function(addrid){var defaultaddr=$scope.pData.defaultAddr,memberid=Authen.getUserId(),aData=actionManagerService.updateDefaultAddr(addrid,defaultaddr,memberid);ajaxManager.ajaxToJson(aData,function(data){})},$scope.back=function(){toolsService.goBackPage()},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("member.address",{url:"/address",cache:!1,intcude:"member.address",intName:"我的地址",views:{member_view:{templateUrl:"frame/member/address/views/address_page.html",controller:"AddressCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("AddressCtrl",["$scope","$rootScope","$state","$ionicPopup","actionManagerService","toolsService","ajaxManager","appConfig","Authen",function($scope,$rootScope,$state,$ionicPopup,actionManagerService,toolsService,ajaxManager,appConfig,Authen){$scope.pageData={listEvents:"",memberid:Authen.getUserId(),params:{memberid:Authen.getUserId()},repeatdata:[],delstate:!1},$scope.recordClick=function(){$state.go("member.addaddr")},$scope.pageData.list_events={editAddres:function(id){$state.go("member.addaddr",{params:JSON.stringify({id:id})})},deleteAdders:function(id){var params=new formatAmSqlParams;params.TABLENAME="am_addres";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params);$ionicPopup.confirm({template:"确定要删除吗？",buttons:[{text:"取消",type:"btnc"},{text:"确定",type:"btn1",onTap:function(){var rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){for(var i=0;i<$scope.pageData.repeatdata.length;i++)if($scope.pageData.repeatdata[i].ID===id){$scope.pageData.repeatdata.splice(i,1);break}})}}]})}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("BankCardCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$ionicPopup){$scope.pageData={params:"",bank_info:"",bank_holder:"",bank_name:"",bank_code:"",listEvents:"",repeatdata:[],accountTypeDataEnum:{1:"银行卡",2:"支付宝",3:"微信"},delstate:!1},$scope.init=function(){$scope.pageData.params={condition:" and member_orgid_id = '"+Authen.getUserId()+"'"}},$scope.pageData.listEvents={deleteAdders:function(id){var params=new formatAmSqlParams;params.TABLENAME="mall_member_bank";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params);$ionicPopup.confirm({template:"确定要删除吗？",buttons:[{text:"取消",type:"btnc"},{text:"确定",type:"btn1",onTap:function(){var rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){for(var i=0;i<$scope.pageData.repeatdata.length;i++)if($scope.pageData.repeatdata[i].ID===id){$scope.pageData.repeatdata.splice(i,1);break}})}}]})},editAddres:function(id){var params={id:id};$state.go("member.bankcardcontent",{params:JSON.stringify(params)})}},$scope.init(),$scope.addBackCard=function(){var params={id:""};$state.go("member.bankcardcontent",{params:JSON.stringify(params)})},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("BankCardDetailCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={params:"",bank_info:"",bank_holder:"",bank_name:"",bank_code:"",listEvents:"",repeatdata:[],paramid:JSON.parse($state.params.params).id,delstate:!1,accountTypeData:[{name:"支付宝",value:"2"}],account_type:"",isWeixin:!1},appConfig.isDerive&&$scope.pageData.accountTypeData.push({name:"微信",value:"3"}),$scope.getBankCardInfo=function(id){if(!toolsService.isEmpty(id)){var rData=actionManagerService.excuteResource("mall_member_bank_info",{condition:" and id = '"+id+"'"});ajaxManager.ajaxTosyc(rData,function(data){data&&data.DATA&&($scope.pageData.bank_holder=data.DATA[0].BANK_HOLDER,$scope.pageData.bank_name=data.DATA[0].BANK_NAME,$scope.pageData.bank_code=data.DATA[0].BANK_CODE,$scope.pageData.account_type=data.DATA[0].ACCOUNT_TYPE)})}},$scope.init=function(){toolsService.isEmpty($scope.pageData.paramid)||$scope.getBankCardInfo($scope.pageData.paramid)},$scope.init(),console.debug($scope.pageData.account_type);$scope.$watch("pageData.account_type",function(){"3"==$scope.pageData.account_type&&($scope.pageData.isWeixin=!0,navigator.weixin.auth(function(data){console.error(data);var params={memberId:Authen.getUserInfo().ID,code:data.code},rData=actionManagerService.getUserOpenIdByCode(params.memberId,params.code);ajaxManager.ajaxToJson(rData,function(mData){mData.RESULT.openid&&($scope.pageData.bank_code=mData.RESULT.openid)})},function(data){console.error(data)}))}),$scope.save=function(){if(console.debug($scope.pageData.account_type),toolsService.isEmpty($scope.pageData.account_type))return void toolsService.tips("未选择账号类型,请完善所填信息","");if(toolsService.isEmpty($scope.pageData.bank_holder))return void toolsService.tips("未填写姓名,请完善所填信息","");if(toolsService.isEmpty($scope.pageData.bank_code))return void toolsService.tips("未填写卡号或账号,请完善所填信息","");if(toolsService.isEmpty($scope.pageData.bank_name)&&"1"==$scope.pageData.account_type)return void toolsService.tips("未填写开户行,请完善所填信息","");if(console.error($scope.pageData.account_type),JSON.parse($state.params.params).id){console.error("修改。。。。。。。。。");var params=new formatAmSqlParams;params.TABLENAME="mall_member_bank";var row=new formatAmSqlupdateRow;row.setID(JSON.parse($state.params.params).id),row.setStatus("u"),row.addColumn("bank_name",$scope.pageData.bank_name),row.addColumn("bank_code",$scope.pageData.bank_code),row.addColumn("bank_holder",$scope.pageData.bank_holder),row.addColumn("account_type",$scope.pageData.account_type),params.addRow(row);var paramss=formatAmSqlParamsToArr(params),upData=actionManagerService.excuteAmUpdate(paramss);ajaxManager.ajaxToJson(upData,function(data){0!=data.CODE?toolsService.tips("修改失败！",""):(toolsService.tips("修改成功！",""),$state.go("member.bankcard",{},{location:"replace"}))})}else{var uuid=toolsService.uuid(),memberid=Authen.getUserId(),params=new formatAmSqlParams;params.TABLENAME="mall_member_bank";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("member_orgid_id",memberid),row.addColumn("bank_name",$scope.pageData.bank_name),row.addColumn("bank_code",$scope.pageData.bank_code),row.addColumn("bank_holder",$scope.pageData.bank_holder),row.addColumn("account_type",$scope.pageData.account_type),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.tips("保存失败！",""):(toolsService.tips("保存成功！",""),$state.go("member.bankcard",{},{location:"replace"}))})}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("BindingAccountCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$stateParams",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$stateParams){$scope.pageData={memberid:Authen.getUserId(),account:"",alipayShow:"",alipayCSS:"",wechatShow:"",wechatCSS:"",bankcardShow:"",bankcardCSS:"",listEvents:{}},$scope.AlipayAccountClick=function(){$scope.pageData.alipayShow=!0,$scope.pageData.wechatShow=!1,$scope.pageData.bankcardShow=!1,$scope.pageData.alipayCSS="active",$scope.pageData.wechatCSS="",$scope.pageData.bankcardCSS=""},$scope.WechatAccountClick=function(){$scope.pageData.alipayShow=!1,$scope.pageData.wechatShow=!0,$scope.pageData.bankcardShow=!1,$scope.pageData.alipayCSS="",$scope.pageData.wechatCSS="active",$scope.pageData.bankcardCSS=""},$scope.BankCardClick=function(){$scope.pageData.alipayShow=!1,$scope.pageData.wechatShow=!1,$scope.pageData.bankcardShow=!0,$scope.pageData.alipayCSS="",$scope.pageData.wechatCSS="",$scope.pageData.bankcardCSS="active"},$scope.init=function(type){"2"==type?$scope.WechatAccountClick():"3"==type?$scope.BankCardClick():$scope.AlipayAccountClick()},$scope.init($stateParams.accounttype),$scope.pageData.listEvents={DeleteAccount:function(id,accounttype){var params=new formatAmSqlParams;params.TABLENAME="mall_transactions_id";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0==data.CODE&&(toolsService.showMessage("解除成功",1),$state.go("member.bindingaccount",{accounttype:accounttype},{reload:!0}))})}},$scope.UpdateClick=function(type){$state.go("member.updateaccount",{type:type},{reload:!0})},$scope.Back=function(){$state.go("mall.member")}}]),angular.module("mallMobileApp.controllers").controller("UpdateAccountCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen","$stateParams",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen,$stateParams){$scope.pageData={memberid:Authen.getUserId(),type:$stateParams.type,idtype:"",account:"",name:"",cardholde:"",paypassword:"",phone:""},$scope.SaveClick=function(){if(toolsService.isEmpty($scope.pageData.account))toolsService.showMessage("请输入账号!","1");else if(toolsService.isEmpty($scope.pageData.paypassword))toolsService.showMessage("请输入支付密码","1");else{var params={code:$scope.pageData.account},rData=actionManagerService.excuteResource("transactions",params,"","");ajaxManager.ajaxToJson(rData,function(data){if(0==data.DATA.length){"alipay"==$stateParams.type?($scope.pageData.idtype=1,$scope.pageData.name="支付宝"):"wechat"==$stateParams.type?($scope.pageData.idtype=2,$scope.pageData.name="微信"):($scope.pageData.idtype=3,$scope.pageData.name="中国建设银行");var rData=actionManagerService.bindingAccount($scope.pageData.memberid,$scope.pageData.account,$scope.pageData.idtype,$scope.pageData.name,$scope.pageData.cardholde,$scope.pageData.paypassword,$scope.pageData.phone);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("添加成功","1"),$state.go("member.bindingaccount",{accounttype:$scope.pageData.idtype},{location:"replace"},{reload:!0})})}else toolsService.showMessage("账号已存在!","1")})}}}]),angular.module("mallMobileApp.controllers").controller("memberCenterCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate){$scope.pData={memberCenterListJson:[{address:"member.shopcard",title:"购物车",icon:"img/user-7.png"},{address:"mine.myorder",title:"我的订单",icon:"img/user-6.png"},{address:"member.myredparket",title:"我的红包",icon:"img/user-8.png"},{address:"member.bankcard",title:"我的收款账户",icon:"img/user-9.png"},{address:"member.address",title:"我的地址",icon:"img/user-10.png"},{address:"member.withdraw",title:"我的提现申请",icon:"img/user-5.png"},{address:"member.favorites",title:"我的收藏",icon:"img/member_03.png"},{address:"mine.extendShop",title:"我的任务",icon:"img/my_task.png"}],memberCenterListJsons:[{address:"mine.shopActivity",title:"联保贷款申请",icon:"img/user-12.png",show:!0},{address:"",title:"农业合作保险",icon:"img/user-11.png",show:!0},{address:"member.Mycomplaint",title:"我的投诉",icon:"img/user-14.png",show:!1},{address:"member.OrderDistList",title:"物流接单-配送人员",icon:"img/user-13.png",show:!1},{address:"member.logisticsOrders",title:"物流接单-物流车辆",icon:"img/user-15.png",show:!1},{address:"member.withdrawaudite",title:"组织提现审核",icon:"img/org_withdraw_audit.png",show:!1},{address:"member.transferaudit",title:"组织转账审核",icon:"img/org_transfer_audit.png",show:!1},{address:"member.logout",title:"社员注销",icon:"img/member_log_off.png",show:!1}],User_HeadImgUrl:"",User_Name:"",User_Cash:0,User_integral:0,User_account:"",User_account_type:"",MemberType:"",Audit_Role:Authen.getAuditRole()};var userInfo=Authen.getUserInfo(),userId=Authen.getUserId();userInfo&&($scope.pData.User_account=userInfo.LOGINACCOUNT,$scope.pData.User_account_type=userInfo.ID_NAME,$scope.pData.MemberType=userInfo.MEMBER_TYPE),$scope.basicinformation=function(){"0"==$scope.pData.Audit_Role?($scope.pData.memberCenterListJsons[5].show=!1,$scope.pData.memberCenterListJsons[6].show=!1):($scope.pData.memberCenterListJsons[5].show=!0,$scope.pData.memberCenterListJsons[6].show=!0);var param={memberid:userId,wherSQL:" AND eb.ent_badge_code IN('Badge.psry','Badge.wlcl' ) "},rData=actionManagerService.excuteResource("getUserBadgeByECode",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(data&&data.DATA&&data.DATA[0])for(var i=0;i<data.DATA.length;i++)"Badge.psry"==data.DATA[i].ENT_BADGE_CODE&&($scope.pData.memberCenterListJsons[3].show=!0),"Badge.wlcl"==data.DATA[i].ENT_BADGE_CODE&&($scope.pData.memberCenterListJsons[4].show=!0)});var param={member_id:userId,sa_code:"CASH_ACCOUNT"},rData=actionManagerService.excuteResource("GetAccountInfo",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&($scope.pData.User_Cash=data.DATA[0].BALANCE)});var rData=actionManagerService.excuteResource("member_info",{member_id:userId},"","");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&(3==data.DATA[0].MEMBER_TYPE&&($scope.pData.memberCenterListJsons[2].show=!0),data.DATA[0]&&data.DATA[0].WXHEADIMG?$scope.pData.User_HeadImgUrl="/"+data.DATA[0].WXHEADIMG:$scope.pData.User_HeadImgUrl="/img/default_head.png",$scope.pData.User_Name=data.DATA[0].MEMBERNAME,$scope.pData.User_integral=data.DATA[0].SCORE)})},$scope.Jump=function(url){url&&$state.go(""+url,{},{reload:!0})},$scope.modify_password=function(){$state.go("member.editpwd",{},{reload:!0})},$scope.My_information=function(){$state.go("member.myinfo",{},{reload:!0})},$scope.loginOut=function(){Authen.logout(),$state.go("mall.home")},$scope.basicinformation()}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("member.cooperation",{url:"/cooperation",cache:!1,views:{member_view:{templateUrl:"frame/member/cooperation/views/cooperation_index.html",controller:"CooperationCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("CooperationCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,Authen){$scope.pageData={contacts:"",phone:"",cooperationIntention:"1",cooperationCategory:"",detailed:"",companyContacts:"",companyPhone:"",companyAddress:"",productClass:"choice-btn",distributionClass:"no-choice-btn",cooperationClassData:[{VALUE:"1",NAME:"景区"},{VALUE:"2",NAME:"酒店"},{VALUE:"3",NAME:"餐饮"},{VALUE:"4",NAME:"演艺"},{VALUE:"5",NAME:"组包车"},{VALUE:"6",NAME:"特产"},{VALUE:"7",NAME:"路线"}]},$scope.init=function(){var cData=actionManagerService.excuteResource("get_avar_info",{vid:"contacts"},"none","none");ajaxManager.ajaxToJson(cData,function(data){data.DATA&&($scope.pageData.companyContacts=data.DATA[0].VVALUE)});var pData=actionManagerService.excuteResource("get_avar_info",{vid:"phone"},"none","none");ajaxManager.ajaxToJson(pData,function(data){data.DATA&&($scope.pageData.companyPhone=data.DATA[0].VVALUE)});var aData=actionManagerService.excuteResource("get_avar_info",{vid:"company_address"},"none","none");ajaxManager.ajaxToJson(aData,function(data){data.DATA&&($scope.pageData.companyAddress=data.DATA[0].VVALUE)})},$scope.init(),$scope.choiceIntentionIsProduct=function(){$scope.pageData.productClass="choice-btn",$scope.pageData.distributionClass="no-choice-btn",$scope.pageData.cooperationIntention="1"},$scope.choiceIntentionIsDistribution=function(){$scope.pageData.productClass="no-choice-btn",$scope.pageData.distributionClass="choice-btn",$scope.pageData.cooperationIntention="2",$scope.pageData.cooperationCategory="",$scope.pageData.detailed=""},$scope.validate=function(){return"1"==$scope.pageData.cooperationIntention?toolsService.isEmpty($scope.pageData.contacts)||$scope.pageData.contacts.length<2?(toolsService.showMessage("请输入正确的联系人！",1),!1):toolsService.isMobile($scope.pageData.phone)?toolsService.isEmpty($scope.pageData.cooperationCategory)?(toolsService.showMessage("请选择合作类别！",2),!1):toolsService.isEmpty($scope.pageData.detailed)?(toolsService.showMessage("请填写详细内容！",2),!1):!0:(toolsService.showMessage("请输入正确的联系电话！",2),!1):"2"==$scope.pageData.cooperationIntention?toolsService.isEmpty($scope.pageData.contacts)||$scope.pageData.contacts.length<2?(toolsService.showMessage("请输入正确的联系人！",1),!1):toolsService.isMobile($scope.pageData.phone)?!0:(toolsService.showMessage("请输入正确的联系电话！",2),!1):void 0},$scope.submitCooperation=function(){if($scope.validate()){var uuid=toolsService.uuid(),params=new formatAmSqlParams;params.TABLENAME="triph_cooperation ";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("contacts",$scope.pageData.contacts),row.addColumn("phone",$scope.pageData.phone),row.addColumn("cooperation_intention",$scope.pageData.cooperationIntention),row.addColumn("cooperation_category",$scope.pageData.cooperationCategory),row.addColumn("detailed",$scope.pageData.detailed),row.addColumn("createtime","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0==data.CODE?($scope.pageData.contacts="",$scope.pageData.phone="",$scope.pageData.cooperationCategory="",$scope.pageData.detailed="",toolsService.showMessage("提交成功",1)):toolsService.showMessage(dat.MESS,1)})}}}]),angular.module("mallMobileApp.controllers").controller("dividendsCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={accountId:""},$scope.init=function(){},$scope.toPage=function(){$state.go("member.virement",{accountId:$scope.pageData.accountId},{})}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("member.editheader",{url:"/editheader",views:{member_view:{templateUrl:"frame/member/editheader/views/editheader.html",controller:"editheaderCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("editheaderCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate","$filter","md5","FileAccess","Upload",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate,$filter,md5,FileAccess,Upload){$scope.pData={User_ID:Authen.getUserId(),User_HeadImgUrl:"",inputData:[],images:"",logintermainal:"",headerStatus:""},$scope.$watchCollection("pData.inputData",function(){$scope.pData.inputData.length>1&&($scope.pData.inputData[0]=$scope.pData.inputData[$scope.pData.inputData.length-1])}),$scope.basicinformation=function(){$scope.pData.logintermainal=toolsService.loginterminal(),console.debug("editheader+logintermainal:"+toolsService.loginterminal()),appConfig.isDerive?$scope.pData.headerStatus="mobile":$scope.pData.headerStatus="pc";var rData=actionManagerService.excuteResource("member_info",{member_id:$scope.pData.User_ID},"","");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&data.DATA[0].WXHEADIMG&&(toolsService.ImgIsExistence(appConfig.baseUrl+"/"+data.DATA[0].WXHEADIMG)?($scope.pData.inputData=[{path:"",mediaType:"image/jpeg",type:"image",data:""+appConfig.baseUrl+"/"+data.DATA[0].WXHEADIMG}],$scope.pData.images=data.DATA[0].WXHEADIMG,$scope.HeadImgUrl=data.DATA[0].WXHEADIMG):($scope.pData.User_HeadImgUrl="/img/default_head.png",$scope.HeadImgUrl="/img/default_head.png"))})},$scope.updateheadimgurl=function(imgurlstr){if(toolsService.isEmpty(imgurlstr))$state.go("mall.mine",{},{location:"replace"});else{var params={memberId:$scope.pData.User_ID,wxheadimg:imgurlstr},rData=actionManagerService.updateUserHeader(params);console.error(rData),ajaxManager.ajaxToJson(rData,function(data){console.error(JSON.stringify(data)),$state.go("mall.mine",{},{location:"replace"})})}},$scope.UploadheadData=function(){var uploadData=[];console.error($scope.pData.inputData);for(var i=0;i<$scope.pData.inputData.length;i++){var item=$scope.pData.inputData[i];if("image"==item.type){console.error(item),uploadData.push({type:"file",data:{fileName:item.fileName,mimeType:item.mimeType,type:item.type,file:item.file,savePath:"files/AM_MEMBER/"+$scope.pData.User_ID+"/wxheadimg"}});break}}if(console.error(uploadData),0==uploadData.length){var imagepath=$scope.pData.images;$scope.updateheadimgurl(imagepath)}else FileAccess.asUpload(uploadData,function(files){var imagepath=toolsService.fileJsonreturnstr(files,"image");$scope.updateheadimgurl(imagepath)},null,null,"n_space")},$scope.UpdateUserHead=function(){appConfig.isDerive?$scope.UploadheadData():$scope.updateheadimgurl($scope.HeadImgUrl)},$scope.basicinformation(),$scope.upload=function(file){var rData=actionManagerService.uploadFileAction(file,"image","files/AM_MEMBER/"+$scope.pData.User_ID+"/wxheadimg");Upload.upload(rData).then(function(resp){$scope.HeadImgUrl="/"+resp.data.NET_FILE_PATH,console.debug($scope.HeadImgUrl)},function(resp){},function(evt){})},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("member.editpwd",{url:"/editpwd",access_level:ACCESS_LEVELS.user,views:{member_view:{templateUrl:"frame/member/editpwsd/views/editpwsd.html",controller:"editPwdCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("editPwdCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate","$filter","md5",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate,$filter,md5){$scope.pData={User_ID:Authen.getUserId(),User_usedPass:"",User_NewPass:"",User_RepeatPass:""},$scope.verification=function(){return toolsService.isEmpty($scope.pData.User_usedPass)?(toolsService.showMessage("旧密码不允许为空!",1),!1):toolsService.isEmpty($scope.pData.User_NewPass)?(toolsService.showMessage("新密码不允许为空!",1),!1):$scope.pData.User_NewPass.length<6?(toolsService.showMessage("新密码长度小于6位!",1),!1):$scope.pData.User_NewPass==$scope.pData.User_usedPass?(toolsService.showMessage("新密码不能与旧密码相同!",1),!1):toolsService.isEmpty($scope.pData.User_RepeatPass)?(toolsService.showMessage("重复密码不允许为空!",1),!1):$scope.pData.User_RepeatPass!=$scope.pData.User_NewPass?(toolsService.showMessage("重复密码与新密码不符!",1),!1):!0},$scope.UpdatePwd=function(){if($scope.verification()){$scope.pData.User_RepeatPass.length>=13?$scope.pData.PwdSecurityGrade="强":$scope.pData.User_RepeatPass.length>6&&$scope.pData.User_RepeatPass.length<13?$scope.pData.PwdSecurityGrade="中":$scope.pData.User_RepeatPass.length<=6&&($scope.pData.PwdSecurityGrade="弱");var rData=actionManagerService.ModifyMemberPassWord(md5.createHash($scope.pData.User_usedPass),md5.createHash($scope.pData.User_RepeatPass),$scope.pData.PwdSecurityGrade,$scope.pData.User_ID);ajaxManager.ajaxToJson(rData,function(data){0==data.CODE?(toolsService.showMessage(data.MSG,1),$state.go("mall.member")):toolsService.showMessage(data.MSG,1)})}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("member.favorites",{url:"/favorites",views:{member_view:{templateUrl:"frame/member/favorites/views/favorites_page.html",controller:"FavoritesCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("FavoritesCtrl",["$scope","$state","$ionicPopup","actionManagerService","ajaxManager","appConfig","Authen","toolsService",function($scope,$state,$ionicPopup,actionManagerService,ajaxManager,appConfig,Authen,toolsService){$scope.pageData={scData:"",favoritesdata:"",list_events:"",ftype:"",repeatdata:[],showView:"",memberid:Authen.getUserId(),params:{member_id:Authen.getUserId()}},$scope.init=function(){var rData=actionManagerService.excuteResource("meFavorites","","","");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.favoritesdata=data.DATA,$scope.pageData.ftype=data.DATA[0];var jgData=toolsService.formJarryToObject(data.DATA);$scope.pageData.scData={name:"我的收藏",data:jgData}}})},$scope.selectClick=function(value){for(var id=value,j=0;j<$scope.pageData.favoritesdata.length;j++)$scope.pageData.favoritesdata[j].ID==id&&($scope.pageData.ftype=$scope.pageData.favoritesdata[j])},$scope.$watch("pageData.ftype",function(){$scope.pageData.ftype&&($scope.pageData.showView=$scope.pageData.ftype.R_CODE)}),$scope.pageData.list_events={deleteFavorites:function(ID){var params=new formatAmSqlParams;params.TABLENAME="am_MemberCollection";var row=new formatAmSqlupdateRow;row.setID(ID),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params);$ionicPopup.confirm({template:"确定要删除吗？",buttons:[{text:"取消",type:"btnc"},{text:"确定",type:"btn1",onTap:function(){var rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){for(var i=0;i<$scope.pageData.repeatdata.length;i++)if($scope.pageData.repeatdata[i].MEMID===ID){$scope.pageData.repeatdata.splice(i,1);break}})}}]})},favoritesDetails:function(id){if($scope.pageData.ftype)var route=$scope.pageData.ftype.ROUTE;$state.go(route,{id:id})}},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("FindPwsdCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","md5","$state",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,md5,$state){$scope.pData={account:"",verificationcode:"",returnsmscode:"",tCount:120,smscodedisabled:!1,smscodetext:"发送验证码"},$scope.verificationisnull=function(){return toolsService.isEmpty($scope.pData.account)?(toolsService.showMessage("手机号不允许为空!",1),!1):toolsService.isEmpty($scope.pData.verificationcode)?(toolsService.showMessage("验证码不允许为空!",1),!1):!0},$scope.time=function(){0==$scope.pData.tCount?($scope.pData.smscodedisabled=!1,$scope.pData.smscodetext="发送验证码",$scope.pData.tCount=120):($scope.pData.smscodedisabled=!0,$scope.pData.smscodetext="重新发送("+$scope.pData.tCount+")",$scope.pData.tCount--,
$timeout(function(){$scope.time()},1e3))},$scope.SMScode=function(){if(!toolsService.isMobile($scope.pData.account))return toolsService.showMessage("手机号不合法！",1),!1;var rData=actionManagerService.MemberaccountIsExistence($scope.pData.account);ajaxManager.ajaxToJson(rData,function(data){if(0!=data.CODE)return console.error(data.MSG),!1;$scope.pData.tCount=120,$scope.$apply;var rData=actionManagerService.SmsVcodebyType($scope.pData.account,"SMS_SEND_CODE","1");ajaxManager.ajaxToJson(rData,function(data,status,headers,config){$scope.time(),$scope.pData.returnsmscode=data.tCode,console.error(data.tCode)})})},$scope.verificationsmscode=function(){var result=!1;return $scope.pData.verificationcode==$scope.pData.returnsmscode&&(result=!0),result},$scope.findpwd=function(){if($scope.verificationisnull())if($scope.verificationsmscode()){var param={ACCOUNT:$scope.pData.account};$state.go("member.setnewpwd",{params:JSON.stringify(param),reparams:$state.params.params},{}),console.debug($state.params.params)}else toolsService.showMessage("验证码不一致!",1)},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("SetNewPwdCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","md5","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,md5,$state){var UrlParam=JSON.parse($state.params.params);$scope.pData={account:UrlParam.ACCOUNT,newpass:"",repeatpass:""},$scope.verificationisnull=function(){return toolsService.isEmpty($scope.pData.newpass)?(toolsService.showMessage("新密码不允许为空!",1),!1):toolsService.isEmpty($scope.pData.repeatpass)?(toolsService.showMessage("确认密码不允许为空!",1),!1):$scope.pData.repeatpass!=$scope.pData.newpass?(toolsService.showMessage("新密码与确认密码不一致!",1),!1):!0},$scope.update=function(){if($scope.verificationisnull()){var rData=actionManagerService.MemberFindUpdatePwd($scope.pData.account,md5.createHash($scope.pData.repeatpass));ajaxManager.ajaxToJson(rData,function(data){if("0"!=data.CODE)console.error(data.MSG);else{var params={TITLE:"忘记密码",SUCCESSMSG:"账号密码修改成功!",welcomeMSG:"亲爱的"+$scope.pData.account+",密码已成功找回,请登录!"};$state.go("member.success",{params:JSON.stringify(params),reparams:$state.params.reparams},{location:"replace"})}})}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("ApplyLoanCtrl",["$scope","$rootScope","$state","$ionicPopup","$timeout","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,$ionicPopup,$timeout,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={bank:"",loanMemberid:new Array,deletemember:new Array,loanMembername:new Array,loginaccount:[Authen.getUserInfo().LOGINACCOUNT],memberid:Authen.getUserId(),formValid:"",loanForm:{},lpStauts:!1,lpgStatusEnum:{1:"审核中",2:"同意",3:"拒绝"},serviceAgreement:""},$scope.init=function(){if($state.params.id){var Id={id:$state.params.id},pData=actionManagerService.excuteResource("applyLoanSQL",Id,"none","none");ajaxManager.ajaxToJson(pData,function(data){data.DATA&&($scope.pageData.applyBank=data.DATA[0].TARGET_ORG_ID,$scope.pageData.appyName=data.DATA[0].APPY_NAME,$scope.pageData.money=data.DATA[0].APPY_AMOUNT/100,$scope.pageData.code=data.DATA[0].ID_CODE,$scope.pageData.expiresDate=new Date(data.DATA[0].EXPIRES_DATE),$scope.pageData.zipCode=data.DATA[0].ZIP_CODE,$scope.pageData.address=data.DATA[0].ADDRESS,$scope.pageData.telephone=data.DATA[0].TELEPHONE,$scope.pageData.phone=data.DATA[0].PHONE,$scope.pageData.lpStauts=data.DATA[0].LP_STAUTS,2==$scope.pageData.lpStauts?$scope.pageData.lpStauts=!1:$scope.pageData.lpStauts=!0)}),$scope.appyGuarantor(Id),$scope.bank()}else $scope.bank()},$scope.appyGuarantor=function(Id){var proData=actionManagerService.excuteResource("applyGuarantor",Id,"none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.pageData.loanMembername=data.DATA)})},$scope.bank=function(){var parentid={parentid:"bank"},proData=actionManagerService.excuteResource("AorgEnumSQL",parentid,"none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.pageData.bank=data.DATA)})},$scope.choiceLoanMember=function(){$scope.data={};$ionicPopup.show({template:'<input type="number" ng-model="data.loanMemberid">',title:"输入添加人员帐号",scope:$scope,buttons:[{text:"<b>取消</d>",type:"btnc"},{text:"<b>添加</d>",type:"btn1",onTap:function(e){if($scope.data.loanMemberid)if($scope.pageData.loginaccount.toString().indexOf($scope.data.loanMemberid)>-1)toolsService.showMessage("不能添加自己的帐号！",1);else if($scope.pageData.loginaccount.toString().indexOf($scope.data.loanMemberid)>-1)toolsService.showMessage("添加人员已经存在！",1);else{$scope.pageData.loginaccount.push($scope.data.loanMemberid);var loginaccount={loginaccount:$scope.data.loanMemberid},rData=actionManagerService.excuteResource("member_info_toaccount",loginaccount,"none","none");ajaxManager.ajaxToJson(rData,function(data){return toolsService.isEmpty(data.DATA)?void toolsService.showMessage("添加人员不存在！",1):($scope.pageData.loanMemberid.push(data.DATA[0].ID),$scope.pageData.loanMembername.push(data.DATA[0]),$scope.data.loanMemberid)})}else e.preventDefault()}}]})},$scope["delete"]=function(item){console.error(item.APPLYID),item.APPLYID&&$scope.pageData.deletemember.push(item.APPLYID),console.error("删除"+$scope.pageData.deletemember),console.error($scope.pageData.loanMembername);for(var i=0;i<$scope.pageData.loanMembername.length;i++)$scope.pageData.loanMembername[i].ID==item.ID&&$scope.pageData.loanMembername.splice(i,1);for(var i=0;i<$scope.pageData.loginaccount.length;i++)$scope.pageData.loginaccount[i]==item.LOGINACCOUNT&&$scope.pageData.loginaccount.splice(i,1);for(var i=0;i<$scope.pageData.loanMemberid.length;i++)if($scope.pageData.loanMemberid[i]==item.ID){$scope.pageData.loanMemberid.splice(i,1);break}},$scope.launchRequest=function(){if(console.error($scope.pageData.applyBank),null==$scope.pageData.applyBank||""==$scope.pageData.applyBank||void 0==$scope.pageData.applyBank)return void toolsService.showMessage("请选择申请银行！",1);if(null==$scope.pageData.appyName||""==$scope.pageData.appyName||void 0==$scope.pageData.appyName)return void toolsService.showMessage("请正确输入申请人！",1);if(null==$scope.pageData.money||""==$scope.pageData.money||void 0==$scope.pageData.money)return void toolsService.showMessage("请正确输入申请金额！",1);if(null==$scope.pageData.code||""==$scope.pageData.code||void 0==$scope.pageData.code||$scope.pageData.code.length<16||$scope.pageData.code.length>18)return void toolsService.showMessage("请正确输入身份证号！",1);if(null==$scope.pageData.expiresDate||""==$scope.pageData.expiresDate||void 0==$scope.pageData.expiresDate)return void toolsService.showMessage("请正确输入证件有效期！",1);if(null==$scope.pageData.zipCode||""==$scope.pageData.zipCode||void 0==$scope.pageData.zipCode)return void toolsService.showMessage("请正确输入邮编！",1);if(null==$scope.pageData.address||""==$scope.pageData.address||void 0==$scope.pageData.address)return void toolsService.showMessage("请正确输入居住地！",1);if(null==$scope.pageData.telephone||""==$scope.pageData.telephone||void 0==$scope.pageData.telephone)return void toolsService.showMessage("请正确输入固定电话！",1);if(null==$scope.pageData.phone||""==$scope.pageData.phone||void 0==$scope.pageData.phone||11!=$scope.pageData.phone.length)return void toolsService.showMessage("请正确输入手机号！",1);if(0==$scope.pageData.agree_type||void 0==$scope.pageData.agree_type)return void toolsService.showMessage("请选择联保贷款申请协议！",1);if($scope.pageData.loanMembername.length<0||0==$scope.pageData.loanMembername.length)return void toolsService.showMessage("请选择联保社员",1);var applyBank=$scope.pageData.applyBank,appyName=$scope.pageData.appyName,memberid=$scope.pageData.memberid,money=$scope.pageData.money,code=$scope.pageData.code,expiresDate=$scope.pageData.expiresDate,zipCode=$scope.pageData.zipCode,address=$scope.pageData.address,telephone=$scope.pageData.telephone,phone=$scope.pageData.phone,loanMemberid=$scope.pageData.loanMemberid,submitexpiresDate=null;if(submitexpiresDate=toolsService.isEmpty(expiresDate)?"":toolsService.dateTostr(expiresDate),console.error(loanMemberid),$state.params.id){var aData=actionManagerService.UpdateGroupLoan($state.params.id,applyBank,appyName,memberid,money,code,submitexpiresDate,zipCode,address,telephone,phone,JSON.stringify(loanMemberid),JSON.stringify($scope.pageData.deletemember));ajaxManager.ajaxToJson(aData,function(data){console.error(data.code),0==data.code?(toolsService.tips(data.msg,""),$state.go("member.groupLending",{},{location:"replace"})):toolsService.tips(data.msg,"")})}else{var aData=actionManagerService.SaveGroupLoan(applyBank,appyName,memberid,money,code,submitexpiresDate,zipCode,address,telephone,phone,JSON.stringify(loanMemberid));ajaxManager.ajaxToJson(aData,function(data){console.error(data.code),0==data.code?(toolsService.tips(data.msg,""),$state.go("member.groupLending",{},{location:"replace"})):toolsService.tips(data.msg,"")})}},$scope.submitApply=function(){if(console.error($scope.pageData.loanMembername),5!=$scope.pageData.loanMembername.length)return void toolsService.showMessage("联保成员不足5人",1);var lpgStatus="",membername="";if($scope.pageData.loanMembername){console.error($scope.pageData.loanMembername);for(var i=0;i<$scope.pageData.loanMembername.length;i++)if(lpgStatus=$scope.pageData.loanMembername[i].LPG_STATUS,membername=$scope.pageData.loanMembername[i].MEMBERNAME,2!=lpgStatus)return void toolsService.showMessage("联保社员"+membername+"没有同意",1)}var params=new formatAmSqlParams;params.TABLENAME="mall_loan_appy";var row=new formatAmSqlupdateRow;row.setID($state.params.id),row.setStatus("u"),row.addColumn("lp_stauts",3),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("修改失败！",1):(toolsService.showMessage("修改成功！",1),$state.go("member.groupLending",{},{location:"replace"}))})},$scope.init(),$scope.agreement=function(){$ionicPopup.confirm({template:$scope.pageData.serviceAgreement,buttons:[{text:"我知道了",type:"btn2",onTap:function(e){}}]})}}]),angular.module("mallMobileApp.controllers").controller("GroupLendingCtrl",["$scope","$rootScope","$state","$ionicPopup","actionManagerService","ajaxManager","appConfig","Authen",function($scope,$rootScope,$state,$ionicPopup,actionManagerService,ajaxManager,appConfig,Authen){$scope.pageData={listEvents:"",memberid:Authen.getUserId(),params:{memberid:Authen.getUserId()},repeatdata:[],delstate:!1};var currentIndex=0;$scope.pageData.type=currentIndex,$scope.pageData.comdSelectCards=[{title:"我发起的贷款",CSS:"login_cm_select_item_active",show:!0,style:"color:#24B35E;"},{title:"邀请我的贷款",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"}],$scope.selectCards=function(index){$scope.pageData.comdSelectCards[index].CSS="login_cm_select_item_active",$scope.pageData.comdSelectCards[index].style="color:#24B35E;",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="login_cm_select_item",$scope.pageData.comdSelectCards[currentIndex].style="color: #585858;",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex},$scope.applyLoan=function(){$state.go("member.applyLoan",{id:""})},$scope.pageData.list_events={editApply:function(id){$state.go("member.applyLoan",{id:id})},myeditApply:function(id){$state.go("member.MyApplyLoan",{id:id})},deleteApply:function(id){var params=new formatAmSqlParams;params.TABLENAME="mall_loan_appy";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("d"),params.addRow(row);var param=formatAmSqlParamsToArr(params);$ionicPopup.confirm({template:"确定要删除吗？",buttons:[{text:"取消",type:"btnc"},{text:"确定",type:"btn1",onTap:function(){var rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){for(var i=0;i<$scope.pageData.repeatdata.length;i++)if($scope.pageData.repeatdata[i].ID===id){$scope.pageData.repeatdata.splice(i,1);break}})}}]})}}}]),angular.module("mallMobileApp.controllers").controller("MyApplyLoanCtrl",["$scope","$rootScope","$state","$ionicPopup","$timeout","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,$ionicPopup,$timeout,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={bank:"",loanMembername:new Array,memberid:Authen.getUserId(),formValid:"",loanForm:{},lpgStatus:!1,lpgStatusEnum:{1:"审核中",2:"同意",3:"拒绝"}},$scope.init=function(){var Id={id:$state.params.id},pData=actionManagerService.excuteResource("applyLoanSQL",Id,"none","none");ajaxManager.ajaxToJson(pData,function(data){data.DATA&&($scope.pageData.applyBank=data.DATA[0].ORGNAME,$scope.pageData.appyName=data.DATA[0].APPY_NAME,$scope.pageData.money=data.DATA[0].APPY_AMOUNT,$scope.pageData.code=data.DATA[0].ID_CODE,$scope.pageData.expiresDate=data.DATA[0].EXPIRES_DATE,$scope.pageData.zipCode=data.DATA[0].ZIP_CODE,$scope.pageData.address=data.DATA[0].ADDRESS,$scope.pageData.telephone=data.DATA[0].TELEPHONE,$scope.pageData.phone=data.DATA[0].PHONE,$scope.pageData.lpStauts=data.DATA[0].LP_STAUTS,$scope.appyGuarantor(Id))})},$scope.appyGuarantor=function(Id){var proData=actionManagerService.excuteResource("applyGuarantor",Id,"none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.pageData.loanMembername=data.DATA,$scope.pageData.lpgStatuss=data.DATA[0].LPG_STATUS,1==$scope.pageData.lpgStatuss?$scope.pageData.lpgStatus=!1:$scope.pageData.lpgStatus=!0)})},$scope.agree=function(){var lpgStatus="2",aData=actionManagerService.UpdateApplyGuarantor($state.params.id,$scope.pageData.memberid,lpgStatus);ajaxManager.ajaxToJson(aData,function(data){console.error(data.code),0==data.code?(toolsService.tips("同意联保成功！",""),$state.go("member.groupLending")):toolsService.tips("同意联保成功！","")})},$scope.noAgree=function(){var lpgStatus="3",aData=actionManagerService.UpdateApplyGuarantor($state.params.id,$scope.pageData.memberid,lpgStatus);ajaxManager.ajaxToJson(aData,function(data){console.error(data.code),0==data.code?(toolsService.tips("拒绝联保成功！",""),$state.go("member.groupLending")):toolsService.tips("拒绝联保成功！","")})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("InvitationMemberCtrl",["$scope","$stateParams","$rootScope","$ionicHistory","$ionicNavBarDelegate","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","md5","$state","$location","$ionicPopup","PlatformManagerService",function($scope,$stateParams,$rootScope,$ionicHistory,$ionicNavBarDelegate,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,md5,$state,$location,$ionicPopup,PlatformManagerService){function processInvcoeData(data){for(var roles={},i=0;i<data.length;i++){var item=data[i];roles[item.IC_ROLE]=item.CSS}var showData=new Array;for(var p in roles){var item={ROLE:p,CSS:roles[p],TITLE:"",items:new Array};showData.push(item)}for(var i=0;i<data.length;i++)for(var item=data[i],j=0;j<showData.length;j++)showData[j].ROLE==item.IC_ROLE&&(showData[j].TITLE=item.TITLE,showData[j].items.push({INVITATIONCODE:item.INVITATIONCODE,ID:item.ID,STATE:item.STATE,MEMBERNAME:item.MEMBERNAME}));$scope.pData.invCodeShowSet=showData}$scope.pData={mRole:"10",invitationSetData:[],invCodeSet:[],memberType:"",invCodeShowSet:[],weiChartImageUrl:"",weiChartTargetUrl:"",qqshow:"1",weixinshow:"1"};var memInfo=Authen.getUserInfo();$scope.pData.mRole=memInfo.MROLE,$scope.pData.memberType=memInfo.MEMBER_TYPE,$scope.pData.invitationSetData=[{CSS:"invite_not_font_1",invCode:new Array,ROLE:"0",title:"邀请码"},{CSS:"invite_not_font_2",invCode:new Array,ROLE:"10",title:"邀请码"},{CSS:"invite_not_font_3",invCode:new Array,ROLE:"20",title:"邀请码"},{CSS:"invite_not_font_4",invCode:new Array,ROLE:"30",title:"邀请码"},{CSS:"invite_not_font_5",invCode:new Array,ROLE:"40",title:"邀请码"},{CSS:"invite_not_font_6",invCode:new Array,ROLE:"50",title:"邀请码"}];var rData=actionManagerService.excuteResource("get_avar_info",{vid:"weiChartImageUrl"},"","");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pData.weiChartImageUrl=data.DATA[0].VVALUE)});var rData=actionManagerService.excuteResource("get_avar_info",{vid:"weiChartTargetUrl"},"","");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pData.weiChartTargetUrl=data.DATA[0].VVALUE)});var rData=actionManagerService.excuteResource("get_avar_info",{vid:"qqshareshow"},"","");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pData.qqshow=data.DATA[0].VVALUE)});var rData=actionManagerService.excuteResource("get_avar_info",{vid:"weixinshareshow"},"","");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pData.weixinshow=data.DATA[0].VVALUE)});new Array;rData=actionManagerService.excuteResource("getInvitationByMemberId",{memberId:memInfo.ID},"",""),ajaxManager.ajaxToJson(rData,function(data){if(data&&data.DATA){for(var start=1,i=0;i<data.DATA.length;i++){start>6&&(start=1);var title="邀请码",css="invite_not_font_"+start;data.DATA[i].EXPLAIN&&(title=data.DATA[i].EXPLAIN+"邀请码"),$scope.pData.invitationSetData[i]=data.DATA[i],$scope.pData.invitationSetData[i].CSS=css,$scope.pData.invitationSetData[i].TITLE=title,start++}processInvcoeData($scope.pData.invitationSetData)}}),$scope.pData.submitDelInveMember=function(invId){var rData=actionManagerService.submitDelInveMember(invId);ajaxManager.ajaxToJson(rData,function(data){data&&(toolsService.showMessage(data.MSG,1600),$state.reload())})},$scope.pData.deleteInveMember=function(invId){$ionicPopup.confirm({template:"您确定要删除吗？",title:"删除确认",scope:$scope,buttons:[{text:"<b>取消</b>",type:"btnc"},{text:"<b>确定</b>",type:"btn1",onTap:function(e){$scope.pData.submitDelInveMember(invId)}}]})},$scope.applyProduction=function(){if($scope.pData.inputInvCode){var rData=actionManagerService.changeMemberTypeWebApi(memInfo.ID,$scope.pData.inputInvCode);ajaxManager.ajaxToJson(rData,function(data){data&&0===data.CODE?(toolsService.showMessage(data.MSG,2e3),$state.reload()):(toolsService.showMessage(data.MSG,1200),$state.reload())})}else toolsService.showMessage("请输入生产者邀请码！",1200)},$scope.shareQQ=function(title,content){var params={id:"",title:title+":"+content,imageUrl:appConfig.baseUrl+"/apk/icon.png",url:$scope.pData.weiChartTargetUrl};PlatformManagerService.otherShareManager(PlatformManagerService.getMobileType(),"1",params,function(success){toolsService.tips("分享成功","")},function(error){toolsService.tips("分享失败","")})},$scope.shareWeiXin=function(title,content){var params={id:"",title:title+":"+content,img:$scope.pData.weiChartImageUrl,url:$scope.pData.weiChartTargetUrl};PlatformManagerService.otherShareManager(PlatformManagerService.getMobileType(),"2",params,function(success){toolsService.tips("分享成功","")},function(error){toolsService.tips("分享失败","")})}}]),angular.module("mallMobileApp.controllers").controller("LoginCtrl",function($scope,$stateParams,$rootScope,$ionicHistory,$ionicNavBarDelegate,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,md5,$state,$location,$ionicViewService){$scope.pData={rememberstate:!1,icon:"icon-select1",useraccount:"",userpassword:""};var currentIndex=0,loginVerification=function(logintype,useraccount,type){var account=$scope.pData.useraccount,tPassWord=$scope.pData.userpassword;toolsService.isEmpty(useraccount)||(account=useraccount),mSaveUserAccount.setAccount($scope.pData.rememberstate,useraccount,type,tPassWord),Authen.login(account,tPassWord,logintype,function(data){"0"===data.CODE?$state.go(toPageParam.ToState.name,toPageParam.ToParams,{location:"replace"}):toolsService.showMessage(data.MSG,"")})},setRememberPassword=function(isState){isState?($scope.pData.rememberstate=!0,$scope.pData.icon="icon-select"):($scope.pData.rememberstate=!1,$scope.pData.icon="icon-select1")},SaveUserAccount=function(){var UserAccount=(Authen.getAccountLableName(),function(sAccountObj){return Authen.getLocalUserAccuot(sAccountObj)});this.init=function(){var tAccount=UserAccount();if(setRememberPassword(tAccount.state),console.debug("LoginCtrl.SaveUserAccount.init().tAccount="+tAccount),tAccount.state&&""===tAccount.type){$scope.pData.useraccount=tAccount.account,$scope.pData.userpassword=tAccount.password;var tType=tAccount.type;toolsService.isEmpty(tAccount.password)||loginVerification("",$scope.pData.useraccount,tType)}},this.clickRememberPassword=function(){setRememberPassword($scope.pData.rememberstate?!1:!0)},this.setAccount=function(state,account,type,pwd){var tAccountObject={state:state,account:account,type:type,password:pwd};UserAccount(tAccountObject)}},customerServiceParam={vid:"customer_service"},customerServiceData=actionManagerService.excuteResource("get_avar_info",customerServiceParam,"none","none");ajaxManager.ajaxToJson(customerServiceData,function(data){toolsService.isEmpty(data)||($scope.pData.customer_service=data.DATA[0].VVALUE,console.log("调用后台的customer_service客服电话"),console.log(data),console.log(data.DATA[0].VVALUE),console.log($scope.pData.customer_service))}),$scope.pData={rememberstate:!1,icon:"icon-select1",useraccount:"",userpassword:"",isInstall:"",isShowOtherLogin:appConfig.isDerive};var currentIndex=0,toPageParam=angular.fromJson($state.params.params),mSaveUserAccount=new SaveUserAccount;mSaveUserAccount.init(),$scope.rememberpassword=function(){mSaveUserAccount.clickRememberPassword()},$scope.verification=function(){var rValue=!1;return toolsService.isEmpty($scope.pData.useraccount)?toolsService.tips("账号不能为空!",""):toolsService.isEmpty($scope.pData.userpassword)?toolsService.tips("密码不能为空!",""):rValue=!0,rValue},$scope.login=function(){$scope.verification()&&loginVerification("",$scope.pData.useraccount,"")},$scope.register=function(){$state.go("member.register",{params:$state.params.params})},$scope.findpassword=function(){$state.go("member.findpwd",{params:$state.params.params})},$scope.pData.comdSelectCards=[{title:"生产社员",CSS:"login_cm_select_item_active",show:!0,style:"color:#24B35E;"},{title:"消费社员",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"},{title:"单位",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"}],$scope.selectCards=function(index){console.error(index),$scope.pData.comdSelectCards[index].CSS="login_cm_select_item_active",$scope.pData.comdSelectCards[index].style="color:#24B35E;",$scope.pData.comdSelectCards[index].show=!0,$scope.pData.comdSelectCards[currentIndex].CSS="login_cm_select_item",$scope.pData.comdSelectCards[currentIndex].style="color: #585858;",$scope.pData.comdSelectCards[currentIndex].show=!1,currentIndex=index},setRememberPassword(!0),$scope.cancle=function(){}}),angular.module("mallMobileApp.controllers").controller("LogisticsOrdersCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={memberid:Authen.getUserId(),departurePlace:"",destination:"",params:{departurePlace:""},listEvents:""},$scope.query=function(){toolsService.isEmpty($scope.pageData.departurePlace)||($scope.pageData.params={departurePlace:"AND from_addres LIKE '%"+$scope.pageData.departurePlace+"%'"}),toolsService.isEmpty($scope.pageData.destination)||($scope.pageData.params={departurePlace:"AND to_addres LIKE '%"+$scope.pageData.destination+"%'"}),toolsService.isEmpty($scope.pageData.departurePlace)||toolsService.isEmpty($scope.pageData.destination)||($scope.pageData.params={departurePlace:"AND from_addres LIKE '%"+$scope.pageData.departurePlace+"%' AND to_addres LIKE '%"+$scope.pageData.destination+"%'"})},$scope.pageData.list_events={logisticsOrdersDetails:function(id){$state.go("member.logisticsOrdersDetails",{id:id})}},$scope.myOrders=function(){$state.go("member.myOrders")}}]),angular.module("mallMobileApp.controllers").controller("LogisticsOrdersDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={statusname:"",detailid:"",deposit:"",freight:"",minBuyNumber:"",explain:"",fromAddres:"",fromContacts:"",fromContactPhone:"",toAddres:"",toContacts:"",toContactPhone:""},$scope.init=function(){var Id={id:$state.params.id},detailsData=actionManagerService.excuteResource("logistics_orders_details",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.statusname=data.DATA[0].STATUSNAME,$scope.pageData.detailid=data.DATA[0].ID,$scope.pageData.freight=data.DATA[0].FREIGHT,$scope.pageData.deposit=data.DATA[0].DEPOSIT,$scope.pageData.explain=data.DATA[0].DESCRIPTION,$scope.pageData.fromAddres=data.DATA[0].FROM_ADDRES,$scope.pageData.fromContacts=data.DATA[0].FROM_CONTACTS,$scope.pageData.fromContactPhone=data.DATA[0].FROM_CONTACT_PHONE,$scope.pageData.toAddres=data.DATA[0].TO_ADDRES,$scope.pageData.toContacts=data.DATA[0].TO_CONTACTS,$scope.pageData.toContactPhone=data.DATA[0].TO_CONTACT_PHONE),console.error($scope.pageData.detailid)})},$scope.confirmOrder=function(){var uuid=toolsService.uuid(),orderId=$scope.pageData.detailid,memberid=Authen.getUserId(),params=new formatAmSqlParams;params.TABLENAME="mall_recv_logistics_info";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("member_id",memberid),row.addColumn("r_type",2),row.addColumn("order_id",orderId),row.addColumn("last_modify_time","now()"),row.addColumn("recv_status",1),row.addColumn("create_time","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){console.error(),0!=data.CODE?toolsService.showMessage("接单失败！",1):toolsService.showMessage("接单成功！",1),$state.go("member.logisticsOrders")}),$scope.updatalogistcs(orderId)},$scope.init(),$scope.updatalogistcs=function(orderId){var params=new formatAmSqlParams;params.TABLENAME="mall_logistics_info";var row=new formatAmSqlupdateRow;row.setID(orderId),row.setStatus("u"),row.addColumn("status",3),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){})}}]),angular.module("mallMobileApp.controllers").controller("MyOrdersCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={listEvents:"",showView:"whole",memberid:Authen.getUserId(),params:{memberid:Authen.getUserId(),recvStatus:""},logisticsParams:{memberid:Authen.getUserId(),recvStatus:"AND info.status= '3'"},receivingParams:{memberid:Authen.getUserId(),recvStatus:"AND info.status= '4'"}};var currentIndex=0;$scope.pageData.type=currentIndex,$scope.pageData.currentPoint=$scope.pageData.comdSelectCards=[{title:"全部",CSS:"login_cm_select_item_active",show:!0,style:"color:#24B35E;"},{title:"物流中",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"},{title:"已收货",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"}],$scope.selectCards=function(index){$scope.pageData.comdSelectCards[index].CSS="login_cm_select_item_active",$scope.pageData.comdSelectCards[index].style="color:#24B35E;",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="login_cm_select_item",$scope.pageData.comdSelectCards[currentIndex].style="color: #585858;",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex},$scope.pageData.list_events={logisticsOrdersDetails:function(id){$state.go("member.logisticsOrdersDetails",{id:id})},currentPoint:{lng:Authen.getBMUserLocation().currentPoint.lng,lat:Authen.getBMUserLocation().currentPoint.lat}}}]),angular.module("mallMobileApp.controllers").controller("MmeberLogoutCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","toolsService","$ionicScrollDelegate","Authen","OrderService","$ionicPopup",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,toolsService,$ionicScrollDelegate,Authen,OrderService,$ionicPopup){$scope.pData={logoutExplain:"",logoutData:{REASONS:"",STATUS:0},showSubmitBtn:!1,statusEnum:{0:"草稿",1:"提交申请",2:"审核通过",3:"审核驳回"}};var memberid=Authen.getUserId(),param={codition:" AND am_mobliemenuid='logout' "},rData=actionManagerService.excuteResource("contentdetailsbycode",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&($scope.pData.logoutExplain=data.DATA[0].DETAILED)}),param={memberid:memberid},rData=actionManagerService.excuteResource("com.am.frame.member.getMemberLogoutInfo",param,"none","none"),ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&($scope.pData.logoutData=data.DATA[0])}),$scope.submitLogoutInfo=function(){if($scope.pData.logoutData.REASONS&&$scope.pData.logoutData.REASONS.length>0){var submitDdata=actionManagerService.submitLogoutInfo(memberid,$scope.pData.logoutData.REASONS);ajaxManager.ajaxToJson(submitDdata,function(data){toolsService.tips("您的注销申请已提交，请等待审核!",1800),$state.reload()})}else toolsService.tips("请输入注销原因!",1800)}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("member.myinfo",{url:"/myinfo/:params",access_level:ACCESS_LEVELS.user,cache:!1,views:{member_view:{templateUrl:"frame/member/myInfo/views/myInfo.html",controller:"myInfoCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("myInfoCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate","$filter",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate,$filter){$scope.pData={User_ID:Authen.getUserId(),User_Account:"",User_Name:"",User_gender:"",memberAge:"",User_memberbirthday:"",constellation:"",motto:"",emotion:"",occupation:"",recvProvince:"",recvCity:"",recvArea:"",User_address:"",member_hobby:"",User_EMAIL:"",introduction:"",constellationData:[{name:"白羊座",code:"1"},{name:"金牛座",code:"2"},{name:"双子座",code:"3"},{name:"巨蟹座",code:"4"},{name:"狮子座",code:"5"},{name:"处女座",code:"6"},{name:"天秤座",code:"7"},{name:"天蝎座",code:"8"},{name:"射手座",code:"9"},{name:"摩羯座",code:"10"},{name:"水瓶座",code:"11"},{name:"双鱼座",code:"12"}],readonly:!0,rightTitle:""},toolsService.isEmpty(JSON.parse($state.params.params).id)?($scope.pData.User_ID=Authen.getUserId(),$scope.pData.rightTitle="保存",$scope.pData.readonly=!1):($scope.pData.User_ID=JSON.parse($state.params.params).id,$scope.pData.readonly=!0),$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.basicinformation=function(){var rData=actionManagerService.excuteResource("member_info",{member_id:$scope.pData.User_ID},"","");ajaxManager.ajaxToJson(rData,function(data){console.debug(data),$scope.pData.User_Account=data.DATA[0].LOGINACCOUNT,$scope.pData.User_Name=data.DATA[0].MEMBERNAME,$scope.pData.User_gender=data.DATA[0].MEMBERSEX,$scope.pData.memberAge=data.DATA[0].MEMBER_AGE,$scope.pData.User_memberbirthday=new Date(data.DATA[0].MEMBERBIRTHDAY),$scope.pData.constellation=data.DATA[0].CONSTELLATION,$scope.pData.motto=data.DATA[0].MOTTO,$scope.pData.emotion=data.DATA[0].EMOTION,$scope.pData.occupation=data.DATA[0].OCCUPATION,$scope.pData.recvProvince=data.DATA[0].PROVINCE,$scope.pData.recvCity=data.DATA[0].CITY,$scope.pData.recvArea=data.DATA[0].ZZONE,$scope.pData.User_address=data.DATA[0].MEMBERADDRESS,
$scope.pData.member_hobby=data.DATA[0].MEMBER_HOBBY,$scope.pData.User_EMAIL=data.DATA[0].EMAIL,$scope.pData.introduction=data.DATA[0].INTRODUCTION})},$scope.save=function(){if(toolsService.isEmpty($scope.pData.User_Name)||$scope.pData.User_Name.length>11)return void toolsService.tips("请输入正确的昵称！","");var str=$("#sts").html().toString();str=str.replace("\r\n","＜br＞"),str=str.split("\n").join("<br />");var params={membername:$scope.pData.User_Name,membersex:$scope.pData.User_gender,memberage:$scope.pData.memberAge,memberbirthday:$scope.pData.User_memberbirthday,constellation:$scope.pData.constellation,motto:$scope.pData.motto,emotion:$scope.pData.emotion,occupation:$scope.pData.occupation,email:$scope.pData.User_EMAIL,memberid:Authen.getUserId(),province:$scope.pData.recvProvince,city:$scope.pData.recvCity,zone:$scope.pData.recvArea,address:$scope.pData.User_address,memberhobby:$scope.pData.member_hobby,introduction:str},rData=actionManagerService.UpdateMemberInfo(JSON.stringify(params));ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage(data.MSG,""),$state.go("mall.mine")})},$scope.init=function(){$scope.basicinformation();var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)})},$scope.$watch("pData.recvProvince",function(){if($scope.pData.recvProvince){var pId={pid:$scope.pData.recvProvince},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pData.recvCity",function(){if($scope.pData.recvCity){var cId={cid:$scope.pData.recvCity},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),$scope.back=function(){toolsService.goBackPage()},$scope.init(),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("MycomplaintCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate){$scope.pData={resourceCode:"com.am.mallComplaintManager.MyComplaint",resPrams:"",listEvents:{}},$scope.pData.resPrams={member_id:Authen.getUserId()},$scope.pData.listEvents={toDetails:function(orderId){$state.go("member.MycomplaintDetails",{orderId:orderId})}}}]),angular.module("mallMobileApp.controllers").controller("MycomplaintDetailsCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate){$scope.pData={complaintData:{}};var userId=Authen.getUserId(),orderId=$stateParams.orderId,param={member_id:userId,order_id:orderId},rData=actionManagerService.excuteResource("com.am.mallComplaintManager.MyComplaintDetails",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&(console.error(data.DATA),$scope.pData.complaintData=data.DATA[0])})}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("member.transferaudit",{url:"/transferaudit",cache:!1,intcude:"member.transferaudit",intName:"组织提现审核",views:{member_view:{templateUrl:"frame/member/organize_transfer_audit/views/transfer_page.html",controller:"TransferAuditCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("TransferAuditCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={memberid:Authen.getUserId(),login_account:Authen.getUserAccount(),audit_role:Authen.getAuditRole(),start_date:"",end_date:"",params:"",listEvents:"",state:0},console.debug($scope.pageData.audit_role),"1"==$scope.pageData.audit_role?$scope.pageData.state=1:"2"==$scope.pageData.audit_role&&($scope.pageData.state=2),$scope.pageData.start_date=(new DataManager).getDateToMonth(-1),$scope.pageData.end_date=new Date,$scope.pageData.params={member_id:$scope.pageData.memberid,login_account:$scope.pageData.login_account,state:$scope.pageData.state,condition:"and to_char(wd.mention_time,'yyyy-mm-dd')::date>= to_date('"+$scope.pageData.start_date.toLocaleString().substring(0,8)+"','yyyy-mm-dd') AND to_char(wd.mention_time,'yyyy-mm-dd')::date<=to_date('"+$scope.pageData.end_date.toLocaleString().substring(0,9)+"','yyyy-mm-dd')"},$scope.query=function(){var str="";if($scope.pageData.start_date&&$scope.pageData.end_date){var startDate=new Date($scope.pageData.start_date).toLocaleString().substring(0,10),endDate=new Date($scope.pageData.end_date).toLocaleString().substring(0,10);str+=" AND ( to_char(wd.mention_time,'yyyy-mm-dd')::date>= to_date(to_char(cast('"+startDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') AND to_char(wd.mention_time,'yyyy-mm-dd')::date<=to_date(to_char(cast('"+endDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') )"}$scope.pageData.params={member_id:$scope.pageData.memberid,login_account:$scope.pageData.login_account,state:$scope.pageData.state,condition:str}},$scope.pageData.listEvents={details:function(id){$state.go("member.transferauditdetail",{id:id})}}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("member.transferauditdetail",{url:"/transferauditdetail/:id",cache:!1,views:{member_view:{templateUrl:"frame/member/organize_transfer_audit/views/transfer_detail_page.html",controller:"TransferAuditDetailCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("TransferAuditDetailCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={id:$state.params.id,useraccount:Authen.getUserAccount(),wd_data:"",audit_opinion:"",director:"",main_audit_opinion:"",audit_role:Authen.getAuditRole()},$scope.init=function(){var rData=actionManagerService.excuteResource("lxny.transferaudit.transferdetails",{wdid:$scope.pageData.id},"none","none");ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.wd_data=data.DATA[0],$scope.pageData.audit_opinion=data.DATA[0].AUDIT_OPINION)})},$scope.init(),$scope.validate=function(){return"1"==$scope.pageData.audit_role?null==$scope.pageData.audit_opinion||""==$scope.pageData.audit_opinion||void 0==$scope.pageData.audit_opinion||$scope.pageData.audit_opinion.length<5?(toolsService.showMessage("请输入正确的审核意见！",1),!1):!0:"2"==$scope.pageData.audit_role?null==$scope.pageData.main_audit_opinion||""==$scope.pageData.main_audit_opinion||void 0==$scope.pageData.main_audit_opinion||$scope.pageData.main_audit_opinion.length<5?(toolsService.showMessage("请输入正确的审核意见！",1),!1):!0:void 0},$scope.transferAuditPass=function(){if($scope.validate()){if("1"==$scope.pageData.audit_role){var aData=rData=actionManagerService.excuteResource("lxny.widthdrawalsaudit.director ",{orgid:$scope.pageData.wd_data.MEMBER_ID},"none","none");ajaxManager.ajaxToJson(aData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.director=data.DATA[0].DIRECTOR;var rData=actionManagerService.transferAuditPass($scope.pageData.id,$scope.pageData.audit_opinion,$scope.pageData.director,$scope.pageData.main_audit_opinion,"1");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("审核成功！","1"),$state.go("member.transferaudit",{},{location:"replace"})})}})}if("2"==$scope.pageData.audit_role){var aData=rData=actionManagerService.excuteResource("lxny.widthdrawalsaudit.director ",{orgid:$scope.pageData.wd_data.MEMBER_ID},"none","none");ajaxManager.ajaxToJson(aData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.director=data.DATA[0].DIRECTOR;var rData=actionManagerService.transferAuditPass($scope.pageData.id,$scope.pageData.audit_opinion,$scope.pageData.director,$scope.pageData.main_audit_opinion,"2");ajaxManager.ajaxToJson(rData,function(data){$scope.transfer()})}})}}},$scope.transferAuditReject=function(){if($scope.validate()){if("1"==$scope.pageData.audit_role){var rData=actionManagerService.transferAuditReject($scope.pageData.id,$scope.pageData.audit_opinion,$scope.pageData.director,$scope.pageData.main_audit_opinion,"3");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("审核成功！","1"),$state.go("member.transferaudit",{},{location:"replace"})})}if("2"==$scope.pageData.audit_role){var rData=actionManagerService.transferAuditReject($scope.pageData.id,$scope.pageData.audit_opinion,$scope.pageData.director,$scope.pageData.main_audit_opinion,"4");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("审核成功！","1"),$state.go("member.transferaudit",{},{location:"replace"})})}}},$scope.transfer=function(){var rData=actionManagerService.virementManager($scope.pageData.wd_data.MEMBER_ID,$scope.pageData.wd_data.OUT_ACCOUNT_CODE,$scope.pageData.wd_data.IN_ACCOUNT_CODE,$scope.pageData.wd_data.CASH_WITHDRAWAL,"","");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("审核成功！","1"),$state.go("member.transferaudit",{},{location:"replace"})})}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("member.withdrawaudite",{url:"/withdrawaudite",cache:!1,intcude:"member.withdrawaudite",intName:"组织提现审核",views:{member_view:{templateUrl:"frame/member/organize_withdraw_audite/views/withdraw_page.html",controller:"withdrawAuditeCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("withdrawAuditeCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={memberid:Authen.getUserId(),login_account:Authen.getUserAccount(),audit_role:Authen.getAuditRole(),start_date:"",end_date:"",params:"",listEvents:"",state:0},console.debug($scope.pageData.audit_role),"1"==$scope.pageData.audit_role?$scope.pageData.state=1:"2"==$scope.pageData.audit_role&&($scope.pageData.state=2),$scope.pageData.start_date=(new DataManager).getDateToMonth(-1),$scope.pageData.end_date=new Date,$scope.pageData.params={member_id:$scope.pageData.memberid,login_account:$scope.pageData.login_account,state:$scope.pageData.state,condition:"and to_char(wd.mention_time,'yyyy-mm-dd')::date>= to_date('"+$scope.pageData.start_date.toLocaleString().substring(0,8)+"','yyyy-mm-dd') AND to_char(wd.mention_time,'yyyy-mm-dd')::date<=to_date('"+$scope.pageData.end_date.toLocaleString().substring(0,9)+"','yyyy-mm-dd')"},$scope.query=function(){var str="";if($scope.pageData.start_date&&$scope.pageData.end_date){var startDate=new Date($scope.pageData.start_date).toLocaleString().substring(0,10),endDate=new Date($scope.pageData.end_date).toLocaleString().substring(0,10);str+=" AND ( to_char(wd.mention_time,'yyyy-mm-dd')::date>= to_date(to_char(cast('"+startDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') AND to_char(wd.mention_time,'yyyy-mm-dd')::date<=to_date(to_char(cast('"+endDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') )"}$scope.pageData.params={member_id:$scope.pageData.memberid,login_account:$scope.pageData.login_account,state:$scope.pageData.state,condition:str}},$scope.pageData.listEvents={details:function(id){$state.go("member.withdrawauditedetail",{id:id})}}}]),angular.module("mallMobileApp").config(["$stateProvider","ACCESS_LEVELS",function($stateProvider,ACCESS_LEVELS){$stateProvider.state("member.withdrawauditedetail",{url:"/withdrawauditedetail/:id",cache:!1,views:{member_view:{templateUrl:"frame/member/organize_withdraw_audite/views/withdraw_detail_page.html",controller:"WithdrawAuditeDetailCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("WithdrawAuditeDetailCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={id:$state.params.id,useraccount:Authen.getUserAccount(),wd_data:"",audit_opinion:"",director:"",audit_role:Authen.getAuditRole(),main_audit_opinion:""},console.debug($scope.pageData.id),$scope.init=function(){var rData=actionManagerService.excuteResource("lxny.widthdrawalsaudit.details",{wdid:$scope.pageData.id},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.wd_data=data.DATA[0],$scope.pageData.audit_opinion=data.DATA[0].AUDIT_OPINION)})},$scope.init(),$scope.validate=function(){return"1"==$scope.pageData.audit_role?null==$scope.pageData.audit_opinion||""==$scope.pageData.audit_opinion||void 0==$scope.pageData.audit_opinion||$scope.pageData.audit_opinion.length<5?(toolsService.showMessage("请输入正确的审核意见！",1),!1):!0:"2"==$scope.pageData.audit_role?null==$scope.pageData.main_audit_opinion||""==$scope.pageData.main_audit_opinion||void 0==$scope.pageData.main_audit_opinion||$scope.pageData.main_audit_opinion.length<5?(toolsService.showMessage("请输入正确的审核意见！",1),!1):!0:void 0},$scope.passWidthdrawAudit=function(){if($scope.validate()){if("1"==$scope.pageData.audit_role){var aData=rData=actionManagerService.excuteResource("lxny.widthdrawalsaudit.director ",{orgid:$scope.pageData.wd_data.MEMBER_ID},"none","none");ajaxManager.ajaxToJson(aData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.director=data.DATA[0].DIRECTOR;var rData=actionManagerService.passWidthdrawAudit($scope.pageData.id,$scope.pageData.audit_opinion,$scope.pageData.director,$scope.pageData.main_audit_opinion,"1");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("审核成功！","1"),$state.go("member.withdrawaudite",{},{location:"replace"})})}})}if("2"==$scope.pageData.audit_role){var aData=rData=actionManagerService.excuteResource("lxny.widthdrawalsaudit.director ",{orgid:$scope.pageData.wd_data.MEMBER_ID},"none","none");ajaxManager.ajaxToJson(aData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.director=data.DATA[0].DIRECTOR;var rData=actionManagerService.passWidthdrawAudit($scope.pageData.id,$scope.pageData.audit_opinion,$scope.pageData.director,$scope.pageData.main_audit_opinion,"2");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("审核成功！","1"),$state.go("member.withdrawaudite",{},{location:"replace"})})}})}}},$scope.rejectWidthdrawAudit=function(){if($scope.validate()){if("1"==$scope.pageData.audit_role){var rData=actionManagerService.rejectWidthdrawAudit($scope.pageData.id,$scope.pageData.audit_opinion,$scope.pageData.director,$scope.pageData.main_audit_opinion,"3");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("审核成功！","1"),$state.go("member.withdrawaudite",{},{location:"replace"})})}if("2"==$scope.pageData.audit_role){var rData=actionManagerService.rejectWidthdrawAudit($scope.pageData.id,$scope.pageData.audit_opinion,$scope.pageData.director,$scope.pageData.main_audit_opinion,"4");ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("审核成功！","1"),$state.go("member.withdrawaudite",{},{location:"replace"})})}}}}]),angular.module("mallMobileApp.controllers").controller("RecordCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={blance:0,id:"",memberid:Authen.getUserId(),paymoney:0,paysource:0,paycontent:"充值支付",amorders:"",accountId:""},$scope.recordBlance=function(){$scope.pageData.paymoney=0;var params={member_id:$scope.pageData.memberid,sa_code:"CASH_ACCOUNT"},rData=actionManagerService.excuteResource("GetAccountInfo",params,"","");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.balance=data.DATA[0].BALANCE/100,$scope.pageData.accountId=data.DATA[0].ID})},$scope.recordBlance(),$scope.recordPayment=function(){if(!toolsService.isNumber($scope.pageData.paymoney))return toolsService.showMessage("请正确输入金额!",1),!1;if(0==$scope.pageData.paymoney)return toolsService.showMessage("请输入金额!",1),!1;$scope.pageData.id=toolsService.uuid();var rData=actionManagerService.addRecordPayment($scope.pageData.id,$scope.pageData.accountId,$scope.pageData.memberid,$scope.pageData.paymoney,$scope.pageData.paysource,$scope.pageData.paycontent,$scope.pageData.amorders);ajaxManager.ajaxToJson(rData,function(data){"0"==data.CODE&&($scope.pageData.paymoney=0,$state.go("member.payment",{RECORDID:$scope.pageData.id,accountId:$scope.pageData.accountId}))})}}]),angular.module("mallMobileApp.controllers").controller("RecordListCtrl",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={memberid:"dabfa38f-0bcf-4f8c-b75d-231afbaf5d93"},$scope.recordParams={memberid:$scope.pageData.memberid},$scope.recordClick=function(){$state.go("member.record")}}),angular.module("mallMobileApp.controllers").controller("BankParketCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","md5","$state","$ionicPopup",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,md5,$state,$ionicPopup){$scope.pageData={title:"我的红包",params:"",account:Authen.getUserAccount(),listEvents:"",count_param:"",packet_number:"0",money_count:"",uname:"",remark:"",packet_id:"",money:0,account_info:"",select_account:"",wxheadimg:""};var currentIndex=0;$scope.pageData.type=currentIndex,$scope.init=function(){$scope.pageData.params={status:"and status=2",condition:" and mrp.recv_login_account = '"+$scope.pageData.account+"' "},$scope.pageData.count_param={condition:" and recv_login_account = '"+$scope.pageData.account+"' "},$scope.getRedPacketSum($scope.pageData.count_param)},$scope.pageData.comdSelectCards=[{title:"已收红包",CSS:"login_cm_select_item_active",show:!0,style:"color:#24B35E;"},{title:"已发红包",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"}],$scope.selectCards=function(index){$scope.pageData.comdSelectCards[index].CSS="login_cm_select_item_active",$scope.pageData.comdSelectCards[index].style="color:#24B35E;",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="login_cm_select_item",$scope.pageData.comdSelectCards[currentIndex].style="color: #585858;",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex,"0"==currentIndex?($scope.pageData.params={status:"and status=2",condition:" and mrp.recv_login_account = '"+$scope.pageData.account+"' "},$scope.pageData.count_param={condition:" and recv_login_account = '"+$scope.pageData.account+"'"},$scope.getRedPacketSum($scope.pageData.count_param)):"1"==currentIndex&&($scope.pageData.params={status:"",condition:" and mrp.send_member_id = '"+Authen.getUserId()+"' "},$scope.pageData.count_param={condition:" and send_member_id = '"+Authen.getUserId()+"'"},$scope.getRedPacketSum($scope.pageData.count_param))},$scope.getRedPacketSum=function(param){var rData=actionManagerService.excuteResource("get_red_packet_count_info",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.packet_number=data.DATA[0].SUM,$scope.pageData.money_count=data.DATA[0].COUNT)})},$scope.sendParket=function(){var params={title:"果蔬红包",out_account_code:"CASH_ACCOUNT,BONUS_ACCOUNT,IDENTITY_STOCK_ACCOUNT",in_account_code:"CASH_ACCOUNT,GROUP_CASH_ACCOUNT",out_remakes:"发红包",business:"",success_url:"member.myredparket",lost_url:"member.myredparket",inMemberid:""};$state.go("common.redpacket",{params:JSON.stringify(params)})},$scope.pageData.listEvents={open:function(id,status,name,remark,headimg){"1"==status&&($scope.pageData.packet_id=id,$scope.pageData.uname=name,$scope.pageData.remark=remark,$scope.pageData.wxheadimg=appConfig.baseUrl+headimg,toolsService.isEmpty(headimg)&&($scope.pageData.wxheadimg=appConfig.baseUrl+"/img/default_head.png"),$scope.showHotelDetailsPopup())}};var dPopup="";$scope.showHotelDetailsPopup=function(){dPopup=$ionicPopup.show({scope:$scope,title:"&nbsp;",templateUrl:"frame/member/red_parket/views/red_parket_pop.html"}),$(".popup").css("background-color","#ffffff"),$(".popup").css("width","90%"),$(".popup").css("height","67%"),$(".popup").css("background-image","url(frame/member/red_parket/img/red_imgs.png)"),$(".popup").css("background-size","100%"),$(".popup").css("background-repeat","no-repeat"),$(".popup-head").css("border","0px"),$(".popup-body").css("border-bottom","0px");var rData=actionManagerService.excuteResource("get_avar_info",{vid:"recv_read_package_account"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.account_info=JSON.parse(data.DATA[0].REMARK).MEMBER)})},$scope.closePopup=function(){dPopup.close(),$scope.pageData.money=0,$scope.pageData.packet_id="",$scope.pageData.uname="",$scope.pageData.remark="",$scope.pageData.wxheadimg=""},$scope.openthis=function(){if(toolsService.isEmpty($scope.pageData.select_account))return void toolsService.tips("请选择拆入账户","");var rData=actionManagerService.openRedPacket({packet_id:$scope.pageData.packet_id,in_account:$scope.pageData.select_account});ajaxManager.ajaxToJson(rData,function(data){data&&("0"==data.code?($scope.pageData.money=data.money,$(".popup").css("background-image","url(frame/member/red_parket/img/red_imgs_ok.png)"),$scope.pageData.params={status:"and status=2",condition:" and mrp.recv_login_account =  '"+$scope.pageData.account+"'  "},$scope.pageData.count_param={condition:" and recv_login_account = '"+$scope.pageData.account+"'"}):toolsService.tips("红包已被拆过",""))})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("BedParketDetailCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","$ionicLoading","$timeout","ACCESS_LEVELS,Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state){$scope.pageData={title:"我的红包",params:"",account:Authen.getUserAccount(),uname:JSON.parse($state.params.params).name,remark:JSON.parse($state.params.params).remark,packet_id:JSON.parse($state.params.params).id,money:0,account_info:"",select_account:""},$scope.openthis=function(){if(toolsService.isEmpty($scope.pageData.select_account))return void toolsService.tips("请选择拆入账户","");var rData=actionManagerService.openRedPacket({packet_id:$scope.pageData.packet_id,in_account:$scope.pageData.select_account});ajaxManager.ajaxToJson(rData,function(data){data&&("0"==data.code?($scope.pageData.money=data.money,toolsService.tips("拆红包成功","")):toolsService.tips("红包已被拆过",""))})},$scope.init=function(){var rData=actionManagerService.excuteResource("get_avar_info",{vid:"recv_read_package_account"},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pageData.account_info=JSON.parse(data.DATA[0].REMARK).MEMBER)})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("RegisterCtrl",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,md5,$state){$scope.pData={account:"",password:"",repeatpwd:"",verificationcode:"",inputSmsCode:"",invitationcode:"",tCount:120,vcodeFlag:!1,MSG:"验证码正确",smscodetext:"获取验证码",smscodedisabled:!1,returnsmscode:"",account_type:"0",land:"",business_name:"",agree_type:!1,member_rules:"",member_identity:"",member_identity_info:"",business_org:"",recvProvince:"",recvCity:"",recvArea:"",debug:!1},$scope.pData.debug=appConfig.debug,$scope.cascadePCZ={provinces:[],cities:[],zones:[]};var currentIndex=0;$scope.pData.account_type=currentIndex,$scope.init=function(){$scope.getIdentityInfo(),$scope.getProvinceInfo()},$scope.verificationisnull=function(){var flag=!0;return toolsService.isEmpty($scope.pData.account)?(toolsService.tips("手机号不能为空!",""),flag=!1):toolsService.isMobile($scope.pData.account)?toolsService.isEmpty($scope.pData.verificationcode)?(toolsService.tips("验证码不能为空!",""),flag=!1):toolsService.isEmpty($scope.pData.password)?(toolsService.tips("密码不能为空!",""),flag=!1):!appConfig.debug&&$scope.pData.password.length<6?(toolsService.tips("密码最小长度为6位",""),flag=!1):toolsService.isEmpty($scope.pData.repeatpwd)?(toolsService.tips("重复密码不能为空!",""),flag=!1):$scope.pData.repeatpwd!=$scope.pData.password?(toolsService.tips("两次密码不一样!",""),flag=!1):"1"==$scope.pData.account_type&&toolsService.isEmpty($scope.pData.invitationcode)?(toolsService.tips("必须填写推荐人代码!",""),flag=!1):$scope.pData.agree_type?flag:(toolsService.tips("您还未同意《用户服务协议》！",""),flag=!1):(toolsService.tips("手机号不合法!",""),flag=!1)},$scope.time=function(){0==$scope.pData.tCount?($scope.pData.smscodedisabled=!1,$scope.pData.smscodetext="发送验证码",$scope.pData.tCount=120):($scope.pData.smscodedisabled=!0,$scope.pData.smscodetext="重新发送("+$scope.pData.tCount+")",$scope.pData.tCount--,$timeout(function(){$scope.time()},1e3))},$scope.pData.comdSelectCards=[{title:"消费社员",CSS:"login_cm_select_item_active",show:!0,style:"color:#24B35E;"},{title:"生产社员",CSS:"login_cm_select_item",show:!1,style:"#585858;"},{title:"单位",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"}],$scope.SMScode=function(){if(!toolsService.isMobile($scope.pData.account))return toolsService.showMessage("手机号不合法!",1),!1;$scope.pData.tCount=120,$scope.$apply;var rData=actionManagerService.SmsVcode($scope.pData.account,"SMS_SEND_CODE");ajaxManager.ajaxToJson(rData,function(data,status,headers,config){0!=data.CODE?toolsService.tips(data.MSG,""):($scope.time(),$scope.pData.returnsmscode=data.tCode,$scope.pData.verificationcode=$scope.pData.returnsmscode,console.error(data.tCode))})},$scope.verificationsmscode=function(){var result=!1;return $scope.pData.inputSmsCode==$scope.pData.returnsmscode&&(result=!0,console.error($scope.pData.returnsmscode)),result},$scope.register=function(){if(console.error("1"),$scope.verificationisnull())if(console.error("2"),$scope.verificationsmscode()){console.error("3");var rData=actionManagerService.MemberRegister($scope.pData.account,md5.createHash($scope.pData.repeatpwd),$scope.pData.invitationcode,appConfig.appOrg,$scope.pData.land,$scope.pData.recvProvince,$scope.pData.recvCity,$scope.pData.recvArea,$scope.pData.member_identity,$scope.pData.business_name,$scope.pData.business_org,$scope.pData.account_type);ajaxManager.ajaxToJson(rData,function(data){if("0"!=data.CODE)toolsService.tips(data.MSG,"");else{var params={TITLE:"用户注册",SUCCESSMSG:"账号注册成功啦!",welcomeMSG:"亲爱的"+$scope.pData.account+",欢迎加入"+appConfig.appName};$state.go("member.success",{params:JSON.stringify(params),reparams:$state.params.params},{location:"replace"})}})}else toolsService.tips("验证码不一致!","")},$scope.getProvinceInfo=function(){var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)})},$scope.$watch("pData.recvProvince",function(){if($scope.pData.recvProvince){var pId={pid:$scope.pData.recvProvince},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pData.recvCity",function(){if($scope.pData.recvCity){var cId={cid:$scope.pData.recvCity},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),$scope.getIdentityInfo=function(){var rData=actionManagerService.excuteResource("account_identity_type",{condition:""},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.pData.member_identity_info=data.DATA)})},$scope.back=function(){toolsService.goBackPage()},$scope.init()}),angular.module("mallMobileApp.controllers").controller("BoundPhoneCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate","$ionicPopup","md5",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate,$ionicPopup,md5){$scope.pageData={User_ID:Authen.getUserId(),User_Phone:"",OldPhone:"",NewPhone:"",OldVerificationCode:"",NewVerificationCode:"",OldCodeText:"发送验证码",newCodeText:"发送验证码",OldSmsCodeDisabled:!1,NewSmsCodeDisabled:!1,returnsmscode:"",OldCount:0,newCount:0,Next:!1,PhoneExist:!1},$scope.basicinformation=function(){var rData=actionManagerService.excuteResource("member_info",{member_id:$scope.pageData.User_ID},"","");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&($scope.pageData.User_Phone=data.DATA[0].PHONE,$scope.time())})},$scope.basicinformation(),$scope.time=function(){0==$scope.pageData.newCount?($scope.pageData.NewSmsCodeDisabled=!1,$scope.pageData.NewCodeText="发送验证码",$scope.pageData.newCount=120):($scope.pageData.NewSmsCodeDisabled=!0,$scope.pageData.NewCodeText="重新发送("+$scope.pageData.newCount+")",$scope.pageData.newCount--,$timeout(function(){$scope.time()},1e3))},$scope.validatePhoneExist=function(){var rData=actionManagerService.excuteResource("triph.setting.getUserInfoByPhone",{phone:$scope.pageData.NewPhone},"","");ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)?$scope.pageData.PhoneExist=!1:($scope.pageData.PhoneExist=!0,console.error($scope.pageData.PhoneExist))})},$scope.sendNewPhoneCode=function(){if($scope.validatePhoneExist(),$scope.pageData.PhoneExist)return toolsService.showMessage("手机号已存在!",1),!1;$scope.pageData.newCount=120,$scope.$apply;var rData=actionManagerService.SmsVcode($scope.pageData.NewPhone,"SMS_SEND_CODE");ajaxManager.ajaxToJson(rData,function(data,status,headers,config){$scope.time(),$scope.pageData.returnsmscode=data.tCode,console.error(data.tCode)})},$scope.verificationSmsCode=function(){toolsService.isMobile($scope.pageData.NewPhone)?toolsService.isEmpty($scope.pageData.NewVerificationCode)?toolsService.showMessage("请输入验证码!",1):$scope.pageData.NewVerificationCode!=$scope.pageData.returnsmscode?toolsService.showMessage("验证码输入错误",1):$scope.updatePhone():toolsService.showMessage("手机号不合法!",1)},$scope.updatePhone=function(){var params=new formatAmSqlParams;params.TABLENAME="am_member";var row=new formatAmSqlupdateRow;
row.setID($scope.pageData.User_ID),row.setStatus("u"),row.addColumn("phone",$scope.pageData.NewPhone),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0==data.CODE?(toolsService.showMessage("修改成功！",1),$state.go("member.setting",{},{location:"replace"})):toolsService.showMessage(data.MESS,1)})}}]),angular.module("mallMobileApp.controllers").controller("SttingCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate","$ionicPopup","md5",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate,$ionicPopup,md5){$scope.pageData={accountdata:[{LEFTICON:"img/member/setting_07.png",RIGHTTITLE:"修改",RIGHTTITLECOLOR:"#0095ff"}],listdata:[{TITLE:"已绑定手机",LEFTICON:"img/member/setting_11.png",BOUNDPHONE:"",RIGHTTITLE:"修改",RIGHTTITLECOLOR:"#0095ff",FUNCTION:"BoundPhone()"},{TITLE:"登录密码",LEFTICON:"img/member/setting_14.png",SecurityGrade:"",RIGHTTITLE:"修改",RIGHTTITLECOLOR:"#0095ff",FUNCTION:"showUpdatePwdPopup()"},{TITLE:"安全问题",LEFTICON:"img/member/setting_16.png",RIGHTTITLE:"修改",RIGHTTITLECOLOR:"#0095ff",FUNCTION:"showSecurityProblemPopup()"}],User_ID:Authen.getUserId(),User_account:"",PassWord:"",Phone:"",User_NewAccount:"",User_ID:Authen.getUserId(),User_usedPass:"",User_NewPass:"",User_RepeatPass:"",SecurityProblemData:"",User_SecurityProblem:"",User_Answer:"",PwdSecurityGrade:"",AccountSecurityGrade:"",AccountExist:"",DriverState:appConfig.isDerive},$scope.mask=function(str,begin,end,char){var fstStr=str.substring(0,begin),lstStr=str.substring(end,str.length);return fstStr+char+lstStr},$scope.basicinformation=function(){var rData=actionManagerService.excuteResource("member_info",{member_id:$scope.pageData.User_ID},"","");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&data.DATA[0]&&($scope.pageData.User_account=data.DATA[0].LOGINACCOUNT,$scope.pageData.User_SecurityProblem=data.DATA[0].SECURITY_PROBLEM_CODE,$scope.pageData.PassWord=data.DATA[0].LOGINPASSWORD,$scope.pageData.Phone=data.DATA[0].PHONE,toolsService.isEmpty($scope.pageData.Phone)||($scope.pageData.listdata[0].BOUNDPHONE=$scope.mask(data.DATA[0].PHONE,3,7,"****")),$scope.pageData.listdata[1].SecurityGrade=data.DATA[0].PWD_SECURITY_GRADE,console.debug(data.DATA[0].PWD_SECURITY_GRADE)),toolsService.isEmpty($scope.pageData.Phone)||toolsService.isEmpty($scope.pageData.PassWord)||toolsService.isEmpty($scope.pageData.User_SecurityProblem)?toolsService.isEmpty($scope.pageData.Phone)||toolsService.isEmpty($scope.pageData.PassWord)||!toolsService.isEmpty($scope.pageData.User_SecurityProblem)?$scope.pageData.AccountSecurityGrade="低":$scope.pageData.AccountSecurityGrade="中":$scope.pageData.AccountSecurityGrade="高",toolsService.isEmpty($scope.pageData.User_account)?($scope.pageData.accountdata[0].RIGHTTITLE="未设置",$scope.pageData.accountdata[0].RIGHTTITLECOLOR="#ff0000"):($scope.pageData.accountdata[0].RIGHTTITLE="修改",$scope.pageData.accountdata[0].RIGHTTITLECOLOR="#0095ff"),toolsService.isEmpty($scope.pageData.Phone)?($scope.pageData.listdata[0].RIGHTTITLE="未设置",$scope.pageData.listdata[0].RIGHTTITLECOLOR="#ff0000"):($scope.pageData.listdata[0].RIGHTTITLE="修改",$scope.pageData.listdata[0].RIGHTTITLECOLOR="#0095ff"),toolsService.isEmpty($scope.pageData.User_SecurityProblem)?($scope.pageData.listdata[2].RIGHTTITLE="未设置",$scope.pageData.listdata[2].RIGHTTITLECOLOR="#ff0000"):($scope.pageData.listdata[2].RIGHTTITLE="修改",$scope.pageData.listdata[2].RIGHTTITLECOLOR="#0095ff")})},$scope.basicinformation(),$scope.validateAccountExist=function(){var rData=actionManagerService.excuteResource("triph.member.setting.getUserInfoByLoginAccount",{loginaccount:$scope.pageData.User_NewAccount},"","");ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)?$scope.pageData.AccountExist=!1:$scope.pageData.AccountExist=!0})};var updatePopup="";$scope.showUpdateAccountPopup=function(){$scope.NewAccountMessage="",updatePopup=$ionicPopup.show({title:"修改账号",template:'<div class="list"><label class="item item-input"><input type="text" placeholder="请输入新账号" ng-model="pageData.User_NewAccount"></label><div style="height:10px;padding-left:20px;"><span style="color:red;font-size:11px;"  ng-bind="NewAccountMessage"></span></div></div>',scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>确认</b>",type:"btn1",onTap:function(e){toolsService.isEmpty($scope.pageData.User_NewAccount)?($scope.NewAccountMessage="账号不能为空",e.preventDefault()):/.*[\u4e00-\u9fa5]+.*$/.test($scope.pageData.User_NewAccount)?($scope.NewAccountMessage="不能含有汉字",e.preventDefault()):($scope.validateAccountExist(),$scope.pageData.AccountExist?($scope.NewAccountMessage="账号已存在",e.preventDefault()):($scope.NewAccountMessage="",$scope.updateAccount()))}}]}),$(".popup-body").css("border","0px")},$scope.updateAccount=function(){var params=new formatAmSqlParams;params.TABLENAME="am_member";var row=new formatAmSqlupdateRow;row.setID($scope.pageData.User_ID),row.setStatus("u"),row.addColumn("loginaccount",$scope.pageData.User_NewAccount),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("设置成功！",2),$scope.basicinformation()})},$scope.BoundPhone=function(){$state.go("member.boundphone",{},{reload:!0})},$scope.showUpdatePwdPopup=function(){$scope.User_usedPassMessage="",$scope.pageData.User_usedPass="",$scope.pageData.User_NewPass="",$scope.pageData.User_RepeatPass="",updatePopup=$ionicPopup.show({title:"修改密码",template:'<div class="list"><div ng-if="pData.DriverState"><span style="color:red;font-size:12px;">第三方登录密码默认为：000</span></div><label class="item item-input"><input type="password" placeholder="请输入旧密码" ng-model="pageData.User_usedPass"></label><div style="height:20px;padding-left:20px;"><span style="color:red;font-size:12px;"  ng-bind="User_usedPassMessage"></span></div><label class="item item-input"><input type="password" placeholder="请输入新密码" ng-model="pageData.User_NewPass"></label><div style="height:20px;padding-left:20px;"><span style="color:red;font-size:11px;"  ng-bind="User_NewPassMessage"></span></div><label class="item item-input"><input type="password" placeholder="请重复密码" ng-model="pageData.User_RepeatPass"></label><div style="height:20px;padding-left:20px;"><span style="color:red;font-size:11px;"  ng-bind="User_RepeatPassMessage"></span></div></div>',scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>确认</b>",type:"btn1",onTap:function(e){return toolsService.isEmpty($scope.pageData.User_usedPass)?($scope.User_usedPassMessage="旧密码不允许为空!",e.preventDefault(),!1):void(toolsService.isEmpty($scope.pageData.User_NewPass)?($scope.User_usedPassMessage="",$scope.User_NewPassMessage="新密码不允许为空!",e.preventDefault()):toolsService.isEmpty($scope.pageData.User_RepeatPass)?($scope.User_NewPassMessage="",$scope.User_RepeatPassMessage="重复密码不允许为空!",e.preventDefault()):$scope.pageData.User_RepeatPass!=$scope.pageData.User_NewPass?($scope.User_RepeatPassMessage="重复密码与新密码不符!",e.preventDefault()):($scope.User_RepeatPassMessage="",$scope.UpdatePwd()))}}]}),$(".popup-body").css("border","0px")},$scope.UpdatePwd=function(){$scope.pageData.User_RepeatPass.length>=13?$scope.pageData.PwdSecurityGrade="强":$scope.pageData.User_RepeatPass.length>6&&$scope.pageData.User_RepeatPass.length<13?$scope.pageData.PwdSecurityGrade="中":$scope.pageData.User_RepeatPass.length<=6&&($scope.pageData.PwdSecurityGrade="弱");var rData=actionManagerService.ModifyMemberPassWord(md5.createHash($scope.pageData.User_usedPass),md5.createHash($scope.pageData.User_RepeatPass),$scope.pageData.PwdSecurityGrade,$scope.pageData.User_ID);ajaxManager.ajaxToJson(rData,function(data){0==data.CODE?(toolsService.showMessage(data.MSG,1),$scope.basicinformation()):toolsService.showMessage(data.MSG,1)})},$scope.getSecurityProblem=function(){var rData=actionManagerService.excuteResource("get_avar_info",{vid:"security_problem"},"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.SecurityProblemData=JSON.parse(data.DATA[0].REMARK))})},$scope.getSecurityProblem(),$scope.showSecurityProblemPopup=function(){$scope.NewAccountMessage="",updatePopup=$ionicPopup.show({title:"安全问题",templateUrl:"frame/member/setting/views/security_problem_index.html",scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>确认</b>",type:"btn1",onTap:function(e){toolsService.isEmpty($scope.pageData.User_Answer)?($scope.User_AnswerMessage="安全问题答案不能为空",e.preventDefault()):($scope.User_AnswerMessage="",$scope.setSecurityProblem())}}]}),$(".popup-body").css("border","0px")},$scope.setSecurityProblem=function(){var params=new formatAmSqlParams;params.TABLENAME="am_member";var row=new formatAmSqlupdateRow;row.setID($scope.pageData.User_ID),row.setStatus("u"),row.addColumn("security_problem_code",$scope.pageData.User_SecurityProblem),row.addColumn("security_problem_answer",$scope.pageData.User_Answer),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("设置成功！",1),$scope.basicinformation()})},$scope.loginOut=function(){Authen.logout(),$state.go("mall.home")},$scope.$on("$destroy",function(){updatePopup&&updatePopup.close()})}]),angular.module("mallMobileApp.controllers").controller("SuccessCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","md5","$state","$ionicNavBarDelegate",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,md5,$state,$ionicNavBarDelegate){var pparams=JSON.parse($state.params.params);$scope.pData={TITLE:pparams.TITLE,SUCCESSMSG:pparams.SUCCESSMSG,welcomeMSG:pparams.welcomeMSG},$ionicNavBarDelegate.showBackButton(!1),$scope.go=function(){$state.go("member.login",{params:$state.params.reparams},{location:"replace"})}}]),angular.module("mallMobileApp.controllers").controller("DistributionCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen){$scope.pageData={listEvents:"",invitationcode:"",params:{memberid:Authen.getUserId()}},$scope.init=function(){var memberid={memberid:Authen.getUserId()},rData=actionManagerService.excuteResource("invitationCode",memberid,"","");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.invitationcode=data.DATA[0].INVITATIONCODE})},$scope.pageData.list_events={distributiondetails:function(LEVEL){$state.go("member.distributiondetails",{level:LEVEL})}},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("DistributionDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen){$scope.pageData={levelname:"",number:"",params:{memberid:Authen.getUserId(),level:$state.params.level}},$scope.init=function(){var level={memberid:Authen.getUserId(),level:$state.params.level},rData=actionManagerService.excuteResource("grade",level,"","");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.levelname=data.DATA[0].LEVEL_NAME,$scope.pageData.number=data.DATA[0].NUMBER})},$scope.init()}]),angular.module("mallMobileApp").config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider","$httpProvider","ACCESS_LEVELS","appConfig","$compileProvider",function($stateProvider,$urlRouterProvider,$ionicConfigProvider,$httpProvider,ACCESS_LEVELS,appConfig,$compileProvider){$stateProvider.state("member.mytaskDetails",{url:"/mytaskDetails/:UTID",access_level:ACCESS_LEVELS.user,cache:!1,views:{member_view:{templateUrl:"frame/member/task/mytask/views/my_task_deatils.html",controller:"myDetailsTaskCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("myDetailsTaskCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen","toolsService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen,toolsService){$scope.pData={taskDetail:""};var memberId=Authen.getUserId(),userTaskId=$state.params.UTID,proData=actionManagerService.getTaskDetails(memberId,userTaskId);ajaxManager.ajaxToJson(proData,function(data){0==data.CODE&&($scope.pData.taskDetail=data.VIEW)}),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("myTaskCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","appConfig","Authen","toolsService",function($scope,$rootScope,$state,actionManagerService,ajaxManager,appConfig,Authen,toolsService){function loadData(){var proData=actionManagerService.getTaskList(memberId,$scope.pageData.userTaskRunState);ajaxManager.ajaxToJson(proData,function(data){if(data=data.DATA)for(var i=0;i<data.length;i++)data[i].TTSKPARAME&&(data[i].content=JSON.parse(data[i].TTSKPARAME).TaskDescription.content);$scope.pageData.repeatdata=data})}$scope.pageData={listEvents:"",params:"",notUsedTaskStatus:"active",useredTaskStatus:"",repeatdata:[],userTaskRunState:"1"};var memberId=Authen.getUserId();$scope.seeDetails=function(taskId){$state.go("member.mytaskDetails",{UTID:taskId})},$scope.notUsedTaskInfo=function(){$scope.pageData.notUsedTaskStatus="common_message_label_on",$scope.pageData.useredTaskStatus="common_message_label_off",$scope.pageData.params={memberid:Authen.getUserId(),taskrunstate:0},$scope.pageData.userTaskRunState=0,loadData()},$scope.usedTaskInfo=function(){$scope.pageData.notUsedTaskStatus="common_message_label_off",$scope.pageData.useredTaskStatus="common_message_label_on",$scope.pageData.params={memberid:Authen.getUserId(),taskrunstate:1},$scope.pageData.userTaskRunState=1,loadData()},$scope.init=function(){$scope.usedTaskInfo(),loadData()},$scope.back=function(){toolsService.goBackPage()},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("TestCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate","$ionicPopup","md5",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate,$ionicPopup,md5){$scope.pageData={}}]),angular.module("mallMobileApp.controllers").controller("withdrawCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={memberid:Authen.getUserId(),start_date:"",end_date:"",params:""},$scope.pageData.start_date=(new DataManager).getDateToMonth(-1),$scope.pageData.end_date=new Date,$scope.pageData.params={member_id:$scope.pageData.memberid,condition:" and to_char(wd.mention_time,'yyyy-mm-dd')::date>= to_date('"+new Date($scope.pageData.start_date).Format("yyyy-MM-dd")+"','yyyy-mm-dd') AND to_char(wd.mention_time,'yyyy-mm-dd')::date<=to_date('"+new Date($scope.pageData.end_date).Format("yyyy-MM-dd")+"','yyyy-mm-dd')"},$scope.query=function(){var str="";if($scope.pageData.start_date&&$scope.pageData.end_date){var startDate=new Date($scope.pageData.start_date).Format("yyyy-MM-dd"),endDate=new Date($scope.pageData.end_date).Format("yyyy-MM-dd");str+=" AND ( to_char(wd.mention_time,'yyyy-mm-dd')::date>= to_date(to_char(cast('"+startDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') AND to_char(wd.mention_time,'yyyy-mm-dd')::date<=to_date(to_char(cast('"+endDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') )"}$scope.pageData.params={member_id:$scope.pageData.memberid,condition:str}}}]),angular.module("mallMobileApp.controllers").controller("withdrawDetailCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state){$scope.pageData={blance:0,outMemberid:Authen.getUserId(),outAccountId:$stateParams.accountId,inAccountId:"",accountInfo:"",paymoney:0,virtementType:"0",zfbInfo:"",wxInfo:"",bankInfo:"",zfbFlag:!0,wxFlag:!0,bankFlag:!0,bindingZfbInfo:new Array,bindingWxInfo:new Array,bindbingBankInfo:new Array,paymentType:""},$scope.init=function(){$scope.getAccountInfo(),$scope.bindingInfo()},$scope.getAccountInfo=function(){var param={memberid:$scope.pageData.outMemberid},rData=actionManagerService.excuteResource("mall_system_account_class",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA)){$scope.pageData.accountInfo=data.DATA;for(var i=0;i<data.DATA.length;i++)data.DATA[i].ID==$stateParams.accountId&&($scope.pageData.paymoney=0,$scope.pageData.balance=data.DATA[i].BALANCE);console.error(JSON.stringify($scope.pageData.accountInfo))}})},$scope.bindingInfo=function(){var param={memberid:$scope.pageData.outMemberid,type:"1,2,3"},rData=actionManagerService.excuteResource("transactionaccount",param,"none","none");ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data.DATA))for(var i=0;i<data.DATA.length;i++)"1"==data.DATA[i].ID_TYPE&&$scope.pageData.bindingZfbInfo.push(data.DATA[i]),"2"==data.DATA[i].ID_TYPE&&$scope.pageData.bindingWxInfo.push(data.DATA[i]),"3"==data.DATA[i].ID_TYPE&&$scope.pageData.bindbingBankInfo.push(data.DATA[i])})},$scope.zfbChange=function(){toolsService.isEmpty($scope.pageData.zfbInfo)?($scope.pageData.zfbFlag=!0,$scope.pageData.wxFlag=!0,$scope.pageData.bankFlag=!0):($scope.pageData.zfbFlag=!0,$scope.pageData.wxFlag=!1,$scope.pageData.bankFlag=!1)},$scope.wxChange=function(){toolsService.isEmpty($scope.pageData.wxInfo)?($scope.pageData.zfbFlag=!0,$scope.pageData.wxFlag=!0,$scope.pageData.bankFlag=!0):($scope.pageData.zfbFlag=!1,$scope.pageData.wxFlag=!0,$scope.pageData.bankFlag=!1)},$scope.bankChange=function(){toolsService.isEmpty($scope.pageData.bankInfo)?($scope.pageData.zfbFlag=!0,$scope.pageData.wxFlag=!0,$scope.pageData.bankFlag=!0):($scope.pageData.zfbFlag=!1,$scope.pageData.wxFlag=!1,$scope.pageData.bankFlag=!0)},$scope.withdrawClick=function(){return toolsService.isEmpty($scope.pageData.zfbInfo)||($scope.pageData.inAccountId=$scope.pageData.zfbInfo,$scope.pageData.paymentType="1"),toolsService.isEmpty($scope.pageData.wxInfo)||($scope.pageData.inAccountId=$scope.pageData.wxInfo,$scope.pageData.paymentType="2"),toolsService.isEmpty($scope.pageData.bankInfo)||($scope.pageData.inAccountId=$scope.pageData.bankInfo,$scope.pageData.paymentType="3"),toolsService.isNumber($scope.pageData.paymoney)?0==$scope.pageData.paymoney?(toolsService.tips("请输入金额",""),!1):toolsService.isEmpty($scope.pageData.inAccountId)?(toolsService.tips("请选择入账账号",""),!1):void toolsService.tips("无第三方提现",""):(toolsService.tips("请正确输入金额",""),!1)},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("AboutCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state","appConfig",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state,appConfig){$scope.pageData={serverhost:appConfig.baseUrl,aboutimage:"",version:appConfig.version,aboutcontent:"",agreement:""},$scope.InitContent=function(){var rData=actionManagerService.excuteResource("about","","","");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.aboutimage=$scope.pageData.serverhost+"/"+data.DATA[0].ABOUTIMAGE,$scope.pageData.aboutcontent=data.DATA[0].ABOUTCONTENT,$scope.pageData.agreement=data.DATA[0].AGREEMENT})},$scope.InitContent(),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("ContentCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state","appConfig","$stateParams",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state,appConfig,$stateParams){$scope.pageData={orgid:appConfig.appOrg,pageData:"",title:"",contentTitle:""},$scope.contentCenterParams={orgid:$scope.pageData.orgid,key:$stateParams.key,wherSQL:""},$scope.pageData.listEvents={ContentDetails:function(id){$state.go("more.contentdetails",{id:id})}},$scope.Title=function(){var titleParams={key:$stateParams.key},rData=actionManagerService.excuteResource("contentmenu",titleParams,"","");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.title=data.DATA[0].NAME})},$scope.Title(),$scope.browse=function(id){var aData=actionManagerService.updateBrowse(id);ajaxManager.ajaxToJson(aData,function(data){})},$scope.query=function(){var wherSQL="";if($scope.pageData.contentTitle){var Name=$scope.pageData.contentTitle;wherSQL=" AND title LIKE '%"+Name+"%'"}$scope.contentCenterParams={orgid:$scope.pageData.orgid,key:$stateParams.key,wherSQL:wherSQL}},$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp").config(["$stateProvider",function($stateProvider){$stateProvider.state("common.messagedetail",{url:"/messagedetail/:params",cache:!1,views:{common_view:{templateUrl:"frame/more/content/views/content_details.html",controller:"ContentDetailsCtrl"}}})}]),angular.module("mallMobileApp.controllers").controller("ContentDetailsCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state","appConfig","$stateParams","$sce","$state",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state,appConfig,$stateParams,$sce,$state){var SaveUserLike=function(){var mUserLikeList,UserAccount=function(sAccountObj){var tAccountObject=angular.fromJson(localStorage.getItem("ContentDetailsCtrl_AccountObject"));return console.debug("localStorage.getItem(ContentDetailsCtrl_AccountObject)="+localStorage.getItem("ContentDetailsCtrl_AccountObject")),angular.isUndefined(sAccountObj)||(tAccountObject=sAccountObj,localStorage.setItem("ContentDetailsCtrl_AccountObject",angular.toJson(sAccountObj))),toolsService.isEmpty(tAccountObject)&&(tAccountObject=new Object),tAccountObject};this.init=function(){mUserLikeList=UserAccount()},this.setLike=function(userID,contentID){var key=userID+"_"+contentID,rValue=!0;return mUserLikeList[key]||(rValue=!1,mUserLikeList[key]=!0,UserAccount(mUserLikeList)),rValue}};$scope.pageData={rememberstate:!1,LikesNumber:0,id:"",collection:!1,orgid:appConfig.appOrg,pageData:"",createdate:"",detailed:"",title:"",listimgage:"",contentTitle:""};var mSaveUserLike=new SaveUserLike;mSaveUserLike.init();var tID="";if(tID=toolsService.isEmpty($state.params.params)?$stateParams.id:angular.fromJson($state.params.params).id,console.debug("ContentDetailsCtrl.tID="+tID),Authen.getDriverLocation().currentPoint){var latitude=Authen.getDriverLocation().currentPoint.lat,longitude=Authen.getDriverLocation().currentPoint.lng;$scope.latLng={id:tID,gps:longitude+","+latitude}}$scope.back=function(){toolsService.goBackPage()},$scope.ContentDetails=function(){$scope.contentParams={contentid:tID},console.debug("tID>>>"+tID);var rData=actionManagerService.excuteResource("contentdetails",$scope.contentParams,"","");ajaxManager.ajaxToJson(rData,function(data){console.debug(data),$scope.pageData.detailed=data.DATA[0].DETAILED,$scope.pageData.createdate=data.DATA[0].CREATEDATE,$scope.pageData.title=data.DATA[0].TITLE,$scope.pageData.contentTitle=data.DATA[0].TITLE,$scope.pageData.LikesNumber=data.DATA[0].LIKE_NUMBER,$scope.pageData.id=data.DATA[0].ID,$scope.browse()})},$scope.browse=function(){var id=tID,aData=actionManagerService.updateBrowse(id);ajaxManager.ajaxToJson(aData,function(data){})},$scope.contentAddCollection=function(contentid){var id=toolsService.uuid(),memberId=Authen.getUserId(),params=new formatAmSqlParams;params.TABLENAME="am_membercollection";var row=new formatAmSqlupdateRow;row.setID(id),row.setStatus("i"),row.addColumn("member_id",memberId),row.addColumn("type","content"),row.addColumn("collectionid",$scope.pageData.id),row.addColumn("createdate","now()"),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("收藏成功！",2)})},$scope.clickLike=function(){if(Authen.isAuthorized()){var memberId=Authen.getUserId(),id=$scope.pageData.id;if(mSaveUserLike.setLike(memberId,id))toolsService.showMessage("您已经点过赞了。",2);else{var aData=actionManagerService.clickLike(id);ajaxManager.ajaxToJson(aData,function(data){toolsService.isEmpty(data)||($scope.pageData.LikesNumber=data.LikesNumber,toolsService.showMessage("感谢您的点赞。",2))})}}else toolsService.showMessage("登陆后才能点赞。",2)},$scope.ContentDetails(),$scope.back=function(){toolsService.goBackPage()}}]),angular.module("mallMobileApp.controllers").controller("MoreCtrl",["$scope","$rootScope","$ionicHistory","$stateParams","$ionicLoading","$timeout","ACCESS_LEVELS","Authen","toolsService","appConfig","actionManagerService","ajaxManager","$state","$ionicNavBarDelegate",function($scope,$rootScope,$ionicHistory,$stateParams,$ionicLoading,$timeout,ACCESS_LEVELS,Authen,toolsService,appConfig,actionManagerService,ajaxManager,$state,$ionicNavBarDelegate){$scope.pageData={orgid:appConfig.appOrg,content:{list:[]},showlist:"0",custMenuList:[]},$scope.pageData.custMenuList=[{address:"more.expertCompound",title:"科普引智专家大院",icon:"img/more-4.png",key:"expertCompound"},{address:"more.koppTrain",title:"理性农业科普培训",icon:"img/more-5.png",key:"koppTrain"},{address:"more.memberPoll",title:"社员代表大会",icon:"img/more-6.png",key:"memberPoll"},{address:"more.socialAssistance",title:"社会救助扶贫帮困",icon:"img/more-8.png",key:"socialAssistance"},{address:"more.studenSupport",title:"大学生资助",icon:"img/more-9.png",key:"studenSupport"},{address:"foodSafety.freezerApply",title:"村头/社区冷柜安装申请",icon:"img/more-11.png",key:"freezerApply"},{address:"more.memberRules",title:"社员守则",icon:"img/more-10.png",key:"memberRules"},{address:"common.message",title:"通知",icon:"img/more-7.png",key:"notice"},{address:"more.share\n",title:"关于",icon:"img/more-12.png",key:"about"}],$scope.custGoto=function(address){var urlState=address;$state.go(urlState)},$scope.ContentMenu=function(){var rData=actionManagerService.excuteResource("mobilemenu","","","");ajaxManager.ajaxToJson(rData,function(data){if(data&&data.DATA)for(var i=0;i<data.DATA.length;i++){var address=data.DATA[i].ADDRESS,key=data.DATA[i].KEY,name=data.DATA[i].NAME,icon=data.DATA[i].ICON;$scope.pageData.content.list.push({address:"more."+address,title:""+name,icon:""+icon,key:""+key})}})},$scope.ContentMenu(),$scope.details=function(key){var contentParams={orgid:$scope.pageData.orgid,key:key},tData=actionManagerService.excuteResource("content",contentParams,"","");ajaxManager.ajaxToJson(tData,function(data){$state.go("more.contentdetails",{id:data.DATA[0].ID})})},$scope.Jump=function(key){var rData=actionManagerService.excuteResource("contentmenu",{key:key},"","");ajaxManager.ajaxToJson(rData,function(data){0==parseInt(data.DATA[0].SHOWLIST)?$state.go("more.content",{key:key},{reload:!0}):$scope.details(key)})}}]),angular.module("mallMobileApp.controllers").controller("expertCompoundCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={ftype:"",showView:"",memberid:Authen.getUserId(),params:{wherSQL:""}},$scope.init=function(){var rData=actionManagerService.excuteResource("category_settings","","none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.favoritesdata=data.DATA,$scope.queryBadge()})},$scope.queryBadge=function(){$scope.badgename="1234567"},$scope.pageData.listEvents={seeDetails:function(id){var params={id:id};$state.go("more.expertCompoundDetails",{params:JSON.stringify(params)})}},$scope.myArticles=function(){$state.go("more.myPublishArticles")},$scope.publishArticles=function(){$state.go("more.publishArticles",{id:1})},$scope.init(),$scope.query=function(){var wherSQL="";if($scope.pageData.pcTitle){var Name=$scope.pageData.pcTitle;wherSQL=" AND c_title LIKE '%"+Name+"%'"}$scope.pageData.ftype&&(wherSQL+=" AND category_id = '"+$scope.pageData.ftype+"'"),$scope.pageData.params={wherSQL:wherSQL}}}]),angular.module("mallMobileApp.controllers").controller("expertCompoundDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={id:"",membername:"",pubtime:"",content:"",title:"",statusname:"",flowerNumber:"",LikesNumber:"",count:"",loginaccount:"",memberid:Authen.getUserId()},$scope.init=function(){var Id=null,params=JSON.parse($state.params.params).id;void 0==params||""==params?(console.error($state.params.params),Id={id:JSON.parse($state.params.params).business.contentid}):Id={id:JSON.parse($state.params.params).id};var rData=actionManagerService.excuteResource("myPublishArticlesDetails",Id,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.id=data.DATA[0].ID,$scope.pageData.title=data.DATA[0].C_TITLE,$scope.pageData.content=data.DATA[0].C_CONTENT,$scope.pageData.membername=data.DATA[0].MEMBERNAME,$scope.pageData.pubtime=data.DATA[0].PUBTIME,$scope.pageData.flowerNumber=data.DATA[0].FLOWERNUMBER,$scope.pageData.LikesNumber=data.DATA[0].LIKESNUMBER,$scope.pageData.count=data.DATA[0].COUNT,$scope.pageData.loginaccount=data.DATA[0].LOGINACCOUNT})},$scope.init(),$scope.flower=function(id){var field="flower_number",aData=actionManagerService.flowerLikes(id,field);ajaxManager.ajaxToJson(aData,function(data){toolsService.isEmpty(data)||($scope.pageData.flowerNumber=data.flowerNumber,$scope.pageData.LikesNumber=data.LikesNumber)})},$scope.likes=function(id){var field="likes_number",aData=actionManagerService.flowerLikes(id,field);ajaxManager.ajaxToJson(aData,function(data){toolsService.isEmpty(data)||($scope.pageData.flowerNumber=data.flowerNumber,$scope.pageData.LikesNumber=data.LikesNumber)})},$scope.comment=function(id){var params={contentid:id};$state.go("common.comment",{params:JSON.stringify(params)})},$scope.thankSharing=function(id){var payMoney="";payMoney=null==$scope.pageData.paymoney||""==$scope.pageData.paymoney||void 0==$scope.pageData.paymoney?$scope.pageData.money:$scope.pageData.paymoney;var params={title:"感谢分享",out_account_code:"CASH_ACCOUNT",in_account_code:"CASH_ACCOUNT",out_remakes:"感谢分享",in_remakes:"感谢分享",business:{contentid:id},success_url:"more.expertCompoundDetails",lost_url:"more.expertCompoundDetails",paymoney:"",inMemberid:$scope.pageData.loginaccount};$state.go("common.virementothermanager",{params:JSON.stringify(params)})}}]),angular.module("mallMobileApp.controllers").controller("myPublishArticlesCtrl",["$scope","$state","Authen",function($scope,$state,Authen){$scope.pageData={memberid:Authen.getUserId(),params:{categoryid:""}},$scope.pageData.listEvents={seeDetails:function(id){console.error(id),
$state.go("more.publishArticles",{id:id})}}}]),angular.module("mallMobileApp.controllers").controller("publishArticlesCtrl",["$scope","$ionicPopup","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen","FileAccess",function($scope,$ionicPopup,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen,FileAccess){function processSave(start){var uuid=dataId,title=$scope.pageData.title,pay_type=$scope.pageData.pay_type,content=$scope.pageData.content,status=$scope.pageData.status,memberid=Authen.getUserId(),imagepaths=$scope.pageData.imagepath;console.error(imagepaths),saveArtcles(uuid,title,pay_type,content,status,memberid,start,imagepaths)}function saveArtcles(uuid,title,pay_type,content,status,memberid,start,imagepaths){if(1==$state.params.id){var aData=actionManagerService.saveArtcles(uuid,title,pay_type,content,status,memberid,start,imagepaths);ajaxManager.ajaxToJson(aData,function(data){$state.go("more.myPublishArticles"),toolsService.showMessage("保存成功！",1)})}else{var aData=actionManagerService.updateArtcles(title,pay_type,content,status,uuid,start,imagepaths);ajaxManager.ajaxToJson(aData,function(data){$state.go("more.myPublishArticles"),toolsService.showMessage("保存成功！",1)})}}$scope.pageData={pay_type:"",favoritesdata:"",content:"",status:1,title:"",statusname:"",statutype:"",showView:"",reviewRemarks:"",memberid:Authen.getUserId(),statusEnum:{1:"草稿",2:"审核中",3:"审核通过",4:"驳回"},inputData:[],imagepath:""};var dataId="";$scope.init=function(){if(console.error($state.params.id),1==$state.params.id)$scope.pageData.statusname=1,$scope.querytype(),dataId=toolsService.uuid();else{$scope.querytype();var Id={id:$state.params.id};dataId=$state.params.id;var rData=actionManagerService.excuteResource("myPublishArticlesDetails",Id,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.title=data.DATA[0].C_TITLE,$scope.pageData.content=data.DATA[0].C_CONTENT,$scope.pageData.status=data.DATA[0].STATUS,$scope.pageData.pay_type=data.DATA[0].CATEGORY_ID,$scope.pageData.statusname=data.DATA[0].STATUSNAME,$scope.pageData.statutype=data.DATA[0].STATUTYPE,$scope.pageData.reviewRemarks=data.DATA[0].REVIEW_REMARKS,console.error($scope.pageData.inputData),data.DATA[0].C_ENCLOSURE&&($scope.pageData.inputData=data.DATA[0].C_ENCLOSURE.split(",")),$scope.pageData.imagepath=data.DATA[0].C_ENCLOSURE,console.error($scope.pageData.inputData)})}},$scope.querytype=function(){var rData=actionManagerService.excuteResource("category_settings","","none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.favoritesdata=data.DATA})},$scope.init(),$scope.cancel=function(){$state.go("more.expertCompound")},$scope.saveArtcles=function(start){if(null==$scope.pageData.title||""==$scope.pageData.title||void 0==$scope.pageData.title)return void toolsService.showMessage("请输入标题！",1);if(null==$scope.pageData.pay_type||""==$scope.pageData.pay_type||void 0==$scope.pageData.pay_type)return void toolsService.showMessage("请选择技术栏目！",1);if(null==$scope.pageData.content||""==$scope.pageData.content||void 0==$scope.pageData.content)return void toolsService.showMessage("请输入内容！",1);var uploadData=[];console.error($scope.pageData.inputData);for(var i=0;i<$scope.pageData.inputData.length;i++){var item=$scope.pageData.inputData[i];"image"==item.type&&uploadData.push({type:"file",data:{fileName:item.fileName,mimeType:item.mimeType,type:item.type,file:item.file,savePath:"files//MALL_COPE_ARTICLE//"+dataId+"//bdp_c_enclosure"}})}console.error(uploadData),0==uploadData.length?processSave(start):(console.error("dhjsadhjas djasdhjashdjashdjash"),FileAccess.asUpload(uploadData,function(files){var imagepath=toolsService.fileJsonreturnstr(files,"image");$scope.pageData.imagepath&&$scope.pageData.imagepath.length>1?$scope.pageData.imagepath+=","+imagepath:$scope.pageData.imagepath=imagepath,processSave(start)},null,null,"n_space"))},$scope["delete"]=function(value){$ionicPopup.show({title:"确认删除",template:"确认删除选中的图片?",scope:$scope,buttons:[{text:"取消",type:"btnc"},{text:"<b>确认</b>",type:"btn1",onTap:function(){for(var i=(JSON.stringify(value),0);i<$scope.pageData.inputData.length;i++)$scope.pageData.imagepath=$scope.pageData.imagepath.replace(","+value,""),$scope.pageData.imagepath=$scope.pageData.imagepath.replace(value,""),console.error($scope.pageData.imagepath),$scope.pageData.inputData[i]==value&&$scope.pageData.inputData.splice(i,1)}}]})}}]),angular.module("mallMobileApp.controllers").controller("confirmSignUpCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={memberid:Authen.getUserId(),reltime:"",pcTitle:"",maxNumber:"",minNumber:"",cost:"",totalCost:"",peopleNumber:1,id:"",money:""},$scope.init=function(){var params=JSON.parse($state.params.params).id;if(console.error(params),void 0==params){console.error($state.params);var Id={id:JSON.parse($state.params.params).business.pcid},detailsData=actionManagerService.excuteResource("signUpDetails",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.id=data.DATA[0].ID,$scope.pageData.money=data.DATA[0].MONEY,$scope.pageData.reltime=data.DATA[0].RELTIME,$scope.pageData.pcTitle=data.DATA[0].PC_TITLE,$scope.pageData.maxNumber=data.DATA[0].MAX_NUMBER,$scope.pageData.minNumber=data.DATA[0].MIN_NUMBER,$scope.pageData.cost=data.DATA[0].COST)})}else{var Id={id:JSON.parse($state.params.params).id};console.error(Id);var detailsData=actionManagerService.excuteResource("signUpDetails",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.id=data.DATA[0].ID,$scope.pageData.money=data.DATA[0].MONEY,$scope.pageData.reltime=data.DATA[0].RELTIME,$scope.pageData.pcTitle=data.DATA[0].PC_TITLE,$scope.pageData.maxNumber=data.DATA[0].MAX_NUMBER,$scope.pageData.minNumber=data.DATA[0].MIN_NUMBER,$scope.pageData.cost=data.DATA[0].COST)})}},$scope.init(),$scope.confirmSignUp=function(){var uuid=toolsService.uuid(),params={title:"科普培训报名",out_account_code:"CASH_ACCOUNT",in_account_code:"",out_remakes:"科普培训报名",in_remakes:"科普培训报名",pay_money:$scope.pageData.money,business:{payment_id:uuid,memberid:$scope.pageData.memberid,pcid:$scope.pageData.id,count:$scope.pageData.peopleNumber},success_url:"more.mySignUp",lost_url:"more.confirmSignUp",pay_id:uuid,pay_type:"1",pay_type_name:"支付"};$state.go("common.payment",{params:JSON.stringify(params)},{location:"replace"})}}]),angular.module("mallMobileApp.controllers").controller("koppTrainCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={showView:"prospectus",memberid:Authen.getUserId(),access:"0",pcTitle:"",params:{menuCode:"article",wherSQL:""}},$scope.pageData.listEvents={toRead:function(id,cost,count,money){var params={memberid:Authen.getUserId(),id:id},rData=actionManagerService.excuteResource("purchaseRecords",params,"","");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.access=data.DATA[0].ACCESS,console.error(parseInt($scope.pageData.access))),console.error(count),0==cost?$state.go("more.koppTrainDetails",{id:id}):parseInt($scope.pageData.access)>parseInt(count)?(console.error(parseInt(count)),$scope.payment(id,cost,count,money)):$scope.pageData.access>0||-1==$scope.pageData.access?($state.go("more.koppTrainDetails",{id:id}),$scope.browse(id,$scope.pageData.memberid)):$scope.payment(id,cost,count,money)})}},$scope.myArticle=function(){$state.go("more.myArticle",{params:""})},$scope.signUp=function(){$state.go("more.signUp")},$scope.payment=function(id,cost,count,money){var uuid=toolsService.uuid(),params={title:"科普培训文章购买",out_account_code:"CASH_ACCOUNT",in_account_code:"",out_remakes:"科普培训文章购买",in_remakes:"科普培训文章购买",pay_money:money,business:{payment_id:uuid,id:id,count:count,cost:cost,orders:uuid,memberid:$scope.pageData.memberid},success_url:"more.myArticle",lost_url:"more.koppTrain",pay_id:uuid,orders:uuid,pay_type:"1",pay_type_name:"支付"};$state.go("common.payment",{params:JSON.stringify(params)})},$scope.browse=function(id,memberid){var aData=actionManagerService.updateRecordsAccess(id,memberid);ajaxManager.ajaxToJson(aData,function(data){})},$scope.query=function(){var wherSQL="";if($scope.pageData.pcTitle){var Name=$scope.pageData.pcTitle;wherSQL=" AND pc_title LIKE '%"+Name+"%'"}$scope.pageData.params={menuCode:"article",wherSQL:wherSQL}}}]),angular.module("mallMobileApp.controllers").controller("koppTrainDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){function initVoid(){var vPath=$scope.pageData["void"];if(vPath&&vPath.indexOf("?")>1){for(var params=vPath.split("?")[1].split("&"),uu="",vu="",i=0;i<params.length;i++)params[i].indexOf("uu=")>-1&&(uu=params[i].split("=")[1]),params[i].indexOf("vu=")>-1&&(vu=params[i].split("=")[1]);var player=new CloudVodPlayer,params={uu:uu,vu:vu,controls:0,autoSize:1};console.error(params),player.init(params,"koppTrainPlayDiv")}}$scope.pageData={reltime:"",pcTitle:"",pcContent:"","void":""},$scope.init=function(){var Id={id:$state.params.id},detailsData=actionManagerService.excuteResource("koppTrainDetails",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData["void"]=data.DATA[0].VIDEO,$scope.pageData.reltime=data.DATA[0].RELTIME,$scope.pageData.pcTitle=data.DATA[0].PC_TITLE,$scope.pageData.pcContent=data.DATA[0].CONTENT,$scope.pageData["void"]&&$scope.pageData["void"].length>1&&initVoid())})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("myArticleCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={memberid:Authen.getUserId(),access:"0"};var params=$state.params.params;if(!toolsService.isEmpty(params)){var payid=JSON.parse($state.params.params).pay_id,id=JSON.parse($state.params.params).business.id,count=JSON.parse($state.params.params).business.count,cost=JSON.parse($state.params.params).business.cost,memberid=JSON.parse($state.params.params).business.memberid,rData=actionManagerService.purchaseArticles(payid,id,count,cost,memberid);ajaxManager.ajaxToJson(rData,function(data){0!=data.code&&$state.go("more.myArticle",{params:""},{location:"replace"})})}$scope.pageData.listEvents={toRead:function(pcid,id,shengyu){if(0==shengyu)return void toolsService.showMessage("可阅读次数不足！",1);$state.go("more.koppTrainDetails",{id:pcid});var memberid=Authen.getUserId();$scope.browse(pcid,memberid)}},$scope.browse=function(pcid,memberid){var aData=actionManagerService.updateRecordsAccess(pcid,memberid);ajaxManager.ajaxToJson(aData,function(data){})}}]),angular.module("mallMobileApp.controllers").controller("mySignUpCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={showView:"notStart",memberid:Authen.getUserId()};var params=$state.params.params;if(!toolsService.isEmpty(params)){var payid=JSON.parse($state.params.params).pay_id,pcid=JSON.parse($state.params.params).business.pcid,memberid=JSON.parse($state.params.params).business.memberid,count=JSON.parse($state.params.params).business.count,rData=actionManagerService.confirmSignUp(payid,pcid,memberid,count);ajaxManager.ajaxToJson(rData,function(data){0!=data.code&&$state.go("more.mySignUp",{params:""},{location:"replace"})})}var currentIndex=0;$scope.pageData.type=currentIndex,$scope.pageData.comdSelectCards=[{title:"未开始课程",CSS:"login_cm_select_item_active",show:!0,style:"color:#24B35E;"},{title:"已结束课程",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"}],$scope.selectCards=function(index){console.error(index),$scope.pageData.comdSelectCards[index].CSS="login_cm_select_item_active",$scope.pageData.comdSelectCards[index].style="color:#24B35E;",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="login_cm_select_item",$scope.pageData.comdSelectCards[currentIndex].style="color: #585858;",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex},$scope.pageData.listEvents={signUpDetails:function(id){$state.go("more.signUpDetails",{id:id})}}}]),angular.module("mallMobileApp.controllers").controller("signUpCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={showView:"prospectus",memberid:Authen.getUserId(),provinces:"",recvcity:"",recvarea:"",params:{menuCode:"school_sign_up",wherSQL:""}},$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pageData.listEvents={signUpDetails:function(id){$state.go("more.signUpDetails",{id:id})}},$scope.init=function(){var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)})},$scope.$watch("pageData.recvProvince",function(){if($scope.pageData.recvProvince){var pId={pid:$scope.pageData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pageData.recvCity",function(){if($scope.pageData.recvCity){var cId={cid:$scope.pageData.recvCity.CITYID},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),$scope.mySignUp=function(){$state.go("more.mySignUp",{params:""})},$scope.init(),$scope.query=function(){var wherSQL="";if($scope.pageData.recvProvince){var pId=$scope.pageData.recvProvince.PROID;wherSQL=" AND pc.province = '"+pId+"'"}if($scope.pageData.recvCity){var cId=$scope.pageData.recvCity.CITYID;wherSQL+=" AND pc.city='"+cId+"' "}if($scope.pageData.recvArea){var zoneid=$scope.pageData.recvArea.ZONEID;console.error(zoneid),wherSQL+=" AND pc.zone='"+zoneid+"' "}if($scope.pageData.startDate&&$scope.pageData.endDate){var startDate=new Date($scope.pageData.startDate).Format("yyyy-MM-dd"),endDate=new Date($scope.pageData.endDate).Format("yyyy-MM-dd");wherSQL+=" AND ( pc.startl_time>= to_date('"+startDate+"','yyyy-mm-dd') AND pc.startl_time<=to_date('"+endDate+"','yyyy-mm-dd') )"}$scope.pageData.params={menuCode:"school_sign_up",wherSQL:wherSQL}}}]),angular.module("mallMobileApp.controllers").controller("signUpDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={reltime:"",pcTitle:"",pcContent:"",zonename:"",maxNumber:"",minNumber:"",cost:"",countPeoper:"",pcId:$state.params.id},$scope.init=function(){var Id={id:$state.params.id},detailsData=actionManagerService.excuteResource("signUpDetails",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.reltime=data.DATA[0].RELTIME,$scope.pageData.pcTitle=data.DATA[0].PC_TITLE,$scope.pageData.pcContent=data.DATA[0].CONTENT,$scope.pageData.zonename=data.DATA[0].ZONENAME,$scope.pageData.maxNumber=data.DATA[0].MAX_NUMBER,$scope.pageData.minNumber=data.DATA[0].MIN_NUMBER,$scope.pageData.cost=data.DATA[0].COST,$scope.pageData.countPeoper=data.DATA[0].COUNTPEOPER)})},$scope.init(),$scope.signUp=function(){var params={id:$scope.pageData.pcId};$state.go("more.confirmSignUp",{params:JSON.stringify(params)},{location:"replace"})}}]),angular.module("mallMobileApp.controllers").controller("ecologyTourismCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={showView:"prospectus",memberid:Authen.getUserId(),provinces:"",recvcity:"",recvarea:"",startDate:new Date,endDate:(new DataManager).getDateToMonth(1),params:{menuCode:"appear",wherSQL:""}},$scope.cascadePCZ={provinces:[],cities:[],zones:[]},$scope.pageData.listEvents={travelDetails:function(id){$state.go("more.ecologyTourismDetails",{id:id})}},$scope.init=function(){var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){if(data.DATA){$scope.cascadePCZ.provinces=data.DATA;for(var i=0;i<$scope.cascadePCZ.provinces.length;i++)if($scope.cascadePCZ.provinces[i].PROID==Authen.getUserInfo().PROVINCE){$scope.pageData.recvProvince=$scope.cascadePCZ.provinces[i];break}}})},$scope.$watch("pageData.recvProvince",function(){if($scope.pageData.recvProvince){var pId={pid:$scope.pageData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){if(data.DATA){$scope.cascadePCZ.cities=data.DATA;for(var i=0;i<$scope.cascadePCZ.cities.length;i++)if(console.error($scope.cascadePCZ.cities),$scope.cascadePCZ.cities[i].CITYID==Authen.getUserInfo().CITY){$scope.pageData.recvCity=$scope.cascadePCZ.cities[i];break}}})}}),$scope.$watch("pageData.recvCity",function(){if($scope.pageData.recvCity){var cId={cid:$scope.pageData.recvCity.CITYID},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){if(data.DATA){$scope.cascadePCZ.zones=data.DATA;for(var i=0;i<$scope.cascadePCZ.zones.length;i++)if($scope.cascadePCZ.zones[i].ZONEID==Authen.getUserInfo().ZZONE){$scope.pageData.recvArea=$scope.cascadePCZ.zones[i],$scope.query();break}}})}}),$scope.mySignUp=function(){$state.go("more.myEcologyTourism",{params:""})},$scope.init(),$scope.query=function(){var wherSQL="";if(!toolsService.isEmpty($scope.pageData.recvProvince)){var pId=$scope.pageData.recvProvince.PROID;wherSQL=" AND pc.province = '"+pId+"'"}if(!toolsService.isEmpty($scope.pageData.recvCity)){var cId=$scope.pageData.recvCity.CITYID;wherSQL+=" AND pc.city='"+cId+"' "}if(!toolsService.isEmpty($scope.pageData.recvArea)){var zoneid=$scope.pageData.recvArea.ZONEID;wherSQL+=" AND pc.zone='"+zoneid+"' "}if(!toolsService.isEmpty($scope.pageData.startDate)&&!toolsService.isEmpty($scope.pageData.endDate)){var startDate=new Date($scope.pageData.startDate).Format("yyyy-MM-dd"),endDate=new Date($scope.pageData.endDate).Format("yyyy-MM-dd");wherSQL+=" AND ( pc.startl_time>=  to_date(to_char(cast('"+startDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') AND pc.startl_time<= to_date(to_char(cast('"+endDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd'))"}$scope.pageData.params={menuCode:"appear",wherSQL:wherSQL}}}]),angular.module("mallMobileApp.controllers").controller("ecologyTourismDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={reltime:"",pcTitle:"",pcContent:"",zonename:"",maxNumber:"",minNumber:"",cost:"",countPeoper:"",pcId:$state.params.id},$scope.init=function(){var Id={id:$state.params.id},detailsData=actionManagerService.excuteResource("signUpDetails",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.reltime=data.DATA[0].RELTIME,$scope.pageData.pcTitle=data.DATA[0].PC_TITLE,$scope.pageData.pcContent=data.DATA[0].CONTENT,$scope.pageData.zonename=data.DATA[0].ZONENAME,$scope.pageData.maxNumber=data.DATA[0].MAX_NUMBER,$scope.pageData.minNumber=data.DATA[0].MIN_NUMBER,$scope.pageData.cost=data.DATA[0].COST,$scope.pageData.countPeoper=data.DATA[0].COUNTPEOPER)})},$scope.init(),$scope.travelSignUp=function(){var params={id:$scope.pageData.pcId};$state.go("more.travelSignUp",{params:JSON.stringify(params)})}}]),angular.module("mallMobileApp.controllers").controller("MyEcologyTourismCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={showView:"notStart",memberid:Authen.getUserId()};var currentIndex=($state.params.params,0);$scope.pageData.type=currentIndex,$scope.pageData.comdSelectCards=[{title:"未开始活动",CSS:"login_cm_select_item_active",show:!0,style:"color:#24B35E;"},{title:"已结束活动",CSS:"login_cm_select_item",show:!1,style:"color: #585858;"}],$scope.selectCards=function(index){console.error(index),$scope.pageData.comdSelectCards[index].CSS="login_cm_select_item_active",$scope.pageData.comdSelectCards[index].style="color:#24B35E;",$scope.pageData.comdSelectCards[index].show=!0,$scope.pageData.comdSelectCards[currentIndex].CSS="login_cm_select_item",$scope.pageData.comdSelectCards[currentIndex].style="color: #585858;",$scope.pageData.comdSelectCards[currentIndex].show=!1,currentIndex=index,$scope.pageData.type=currentIndex},$scope.pageData.listEvents={travelDetails:function(id){$state.go("more.ecologyTourismDetails",{id:id})}}}]),angular.module("mallMobileApp.controllers").controller("TravelSignUpCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={memberid:Authen.getUserId(),reltime:"",pcTitle:"",maxNumber:"",minNumber:"",cost:"",totalCost:"",peopleNumber:"",id:"",money:"",sumCost:0,shengYuPeople:"",countpeoper:""},$scope.init=function(){var params=JSON.parse($state.params.params).id;if(void 0==params){console.error($state.params);var Id={id:JSON.parse($state.params.params).business.pcid},detailsData=actionManagerService.excuteResource("signUpDetails",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.id=data.DATA[0].ID,$scope.pageData.money=data.DATA[0].MONEY,$scope.pageData.reltime=data.DATA[0].RELTIME,$scope.pageData.pcTitle=data.DATA[0].PC_TITLE,$scope.pageData.maxNumber=data.DATA[0].MAX_NUMBER,$scope.pageData.minNumber=data.DATA[0].MIN_NUMBER,$scope.pageData.cost=data.DATA[0].COST,$scope.pageData.countpeoper=data.DATA[0].COUNTPEOPER)})}else{var Id={id:JSON.parse($state.params.params).id},detailsData=actionManagerService.excuteResource("signUpDetails",Id,"none","none");ajaxManager.ajaxToJson(detailsData,function(data){toolsService.isEmpty(data.DATA)||($scope.pageData.id=data.DATA[0].ID,$scope.pageData.money=data.DATA[0].MONEY,$scope.pageData.reltime=data.DATA[0].RELTIME,$scope.pageData.pcTitle=data.DATA[0].PC_TITLE,$scope.pageData.maxNumber=data.DATA[0].MAX_NUMBER,$scope.pageData.minNumber=data.DATA[0].MIN_NUMBER,$scope.pageData.cost=data.DATA[0].COST,$scope.pageData.countpeoper=data.DATA[0].COUNTPEOPER)})}},$scope.init(),$scope.$watch("pageData.peopleNumber",function(){$scope.pageData.peopleNumber&&($scope.pageData.sumCost=$scope.pageData.peopleNumber*$scope.pageData.money)}),$scope.confirmSignUp=function(){if($scope.pageData.shengYuPeople=$scope.pageData.maxNumber-$scope.pageData.countpeoper,null==$scope.pageData.peopleNumber||""==$scope.pageData.peopleNumber||void 0==$scope.pageData.peopleNumber)return void toolsService.showMessage("请输入报名人数！",1);if(parseInt($scope.pageData.peopleNumber)>parseInt($scope.pageData.shengYuPeople))return void toolsService.showMessage("报名人数大于剩余报名人数！",1);var uuid=toolsService.uuid();uuid=uuid.replace(/-/g,"");var params={title:"生态旅游报名",out_account_code:"CASH_ACCOUNT",in_account_code:"",out_remakes:"生态旅游报名",in_remakes:"生态旅游报名",pay_money:$scope.pageData.sumCost,business:{payment_id:uuid,memberid:$scope.pageData.memberid,pcid:$scope.pageData.id,count:$scope.pageData.peopleNumber,orders:uuid,success_call_back:"com.am.more.kopp_train.ConfirmSignUpBusinessCallBack"},success_url:"more.myEcologyTourism",lost_url:"more.travelSignUp",pay_id:uuid,pay_type:"1",pay_type_name:"支付"};$state.go("common.payment",{params:JSON.stringify(params)})}}]),angular.module("mallMobileApp.controllers").controller("memberPollCtrl",["$scope","$state","Authen",function($scope,$state,Authen){$scope.pageData={listEvents:"",params:{wherSQL:""},startDate:(new DataManager).getDateToMonth(-1),endDate:new Date};var startDate=new Date($scope.pageData.startDate).Format("yyyy-MM-dd"),endDate=new Date($scope.pageData.endDate).Format("yyyy-MM-dd");$scope.pageData.params={wherSQL:"AND ( to_char(push_time,'yyyy-mm-dd')::date>= to_date('"+startDate+"','yyyy-mm-dd') AND to_char(push_time,'yyyy-mm-dd')::date<=to_date('"+endDate+"','yyyy-mm-dd') )"},$scope.pageData.listEvents={memberPollDetails:function(id){$state.go("more.memberPollDetails",{id:id})}},$scope.query=function(){var wherSQL="";if($scope.pageData.pcTitle){var Name=$scope.pageData.pcTitle;wherSQL=" AND title LIKE '%"+Name+"%'"}if($scope.pageData.startDate&&$scope.pageData.endDate){var startDate=new Date($scope.pageData.startDate).Format("yyyy-MM-dd"),endDate=new Date($scope.pageData.endDate).Format("yyyy-MM-dd");wherSQL+=" AND ( push_time>= to_date(to_char(cast('"+startDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') AND push_time<=to_date(to_char(cast('"+endDate+"' as timestamp),'yyyy-MM-dd'),'yyyy-MM-dd') )"}$scope.pageData.params={wherSQL:wherSQL}}}]),angular.module("mallMobileApp.controllers").controller("memberPollDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={id:"",pollid:"",title:"",descript:"",pushtime:"",optionid:"",type:"",count:"",submitVote:!0,pollId:{pollId:$state.params.id},memberid:Authen.getUserId()},$scope.init=function(){var rData=actionManagerService.excuteResource("memberPollDetails",$scope.pageData.pollId,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.id=data.DATA[0].ID,$scope.pageData.title=data.DATA[0].TITLE,$scope.pageData.descript=data.DATA[0].DESCRIPT,$scope.pageData.pushtime=data.DATA[0].PUSHTIME,$scope.pageData.type=data.DATA[0].MP_TYPE,$scope.pageData.count=data.DATA[0].COUNT,$scope.poll_options(),$scope.voteYesOrNo()})},$scope.poll_options=function(){var rData=actionManagerService.excuteResource("poll_options",$scope.pageData.pollId,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.option=data.DATA,$scope.pageData.pollid=data.DATA[0].ID,$scope.pageData.votes=data.DATA[0].VOTES})},$scope.voteYesOrNo=function(){var params={pollId:$state.params.id,memberid:Authen.getUserId()},rData=actionManagerService.excuteResource("voteYesOrNo",params,"none","none");ajaxManager.ajaxToJson(rData,function(data){toolsService.isEmpty(data.DATA)?$scope.pageData.submitVote=!0:$scope.pageData.submitVote=!1})},$scope.issueVote=function(){var paramsOptions=new Array;$scope.pageData.optionid&&paramsOptions.push($scope.pageData.optionid);for(var i=0;i<$scope.option.length;i++)$scope.option[i].checked&&paramsOptions.push($scope.option[i].ID);console.error(paramsOptions);var memberid=Authen.getUserId(),pollId=$state.params.id,aData=actionManagerService.issueVote(JSON.stringify(paramsOptions),memberid,pollId);ajaxManager.ajaxToJson(aData,function(data){toolsService.isEmpty(data)||(0!=data.code?toolsService.showMessage("投票失败！",1):(toolsService.showMessage("投票成功！",1),$scope.pageData.submitVote=!1))})},$scope.comment=function(id){var params={contentid:id};$state.go("common.comment",{params:JSON.stringify(params)})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("memberRulesCtrl",["$scope","actionManagerService","ajaxManager",function($scope,actionManagerService,ajaxManager){$scope.pageData={title:"",createdate:"",detailed:""},$scope.init=function(){var menucode={menucode:"memberRules"},rData=actionManagerService.excuteResource("collegeStudentBook",menucode,"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pageData.title=data.DATA[0].TITLE,$scope.pageData.createdate=data.DATA[0].CREATEDATE,$scope.pageData.detailed=data.DATA[0].DETAILED)})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("NoticeCtrl",["$scope","$rootScope","$ionicHistory","$ionicNavBarDelegate","ACCESS_LEVELS","Authen","actionManagerService","ajaxManager","toolsService","$state","appConfig",function($scope,$rootScope,$ionicHistory,$ionicNavBarDelegate,ACCESS_LEVELS,Authen,actionManagerService,ajaxManager,toolsService,$state,appConfig){$scope.pageData={noticeInfo:"",memberId:Authen.getUserId(),params:{memberid:Authen.getUserId()},listEvents:""},$scope.pageData.listEvents={socialAssistanceDetails:function(url){if("http://"!=url.substr(0,7).toLowerCase())if(url.indexOf("/")>0){var arr=url.split("/"),urlParams=arr[1];console.error(urlParams);var routeParams={params:JSON.stringify(arr[1].params)};$state.go(arr[0],routeParams)}else $state.go(url,{})}}}]),angular.module("mallMobileApp.controllers").controller("socialAssistanceCtrl",["$scope","$state","Authen",function($scope,$state,Authen){$scope.pageData={listEvents:"",title:"",params:{wherSQL:""}},$scope.pageData.listEvents={socialAssistanceDetails:function(id){var params={id:id};$state.go("more.socialAssistanceDetails",{params:JSON.stringify(params)})}},$scope.query=function(){var wherSQL="";if($scope.pageData.title){var Name=$scope.pageData.title;wherSQL=" AND title LIKE '%"+Name+"%'"}$scope.pageData.params={wherSQL:wherSQL}}}]),angular.module("mallMobileApp.controllers").controller("socialAssistanceDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={id:"",rescueName:"",title:"",money:"",cedata:"",optionid:"",inMemberid:"",helpAccount:"",contentId:{contentid:$state.params.id},memberid:Authen.getUserId()},$scope.init=function(){var Id=null,params=JSON.parse($state.params.params).id;void 0==params||""==params?(console.error($state.params.params),Id={contentid:JSON.parse($state.params.params).business.contentId}):Id={contentid:JSON.parse($state.params.params).id};var rData=actionManagerService.excuteResource("socialAssistanceDetails",Id,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.id=data.DATA[0].ID,$scope.pageData.title=data.DATA[0].TITLE,$scope.pageData.detailed=data.DATA[0].DETAILED,$scope.pageData.cedata=data.DATA[0].CEDATA,$scope.pageData.money=data.DATA[0].MONEY,$scope.pageData.inMemberid=data.DATA[0].INMEMBERID,$scope.pageData.helpAccount=data.DATA[0].HELP_ACCOUNT,$scope.pageData.rescueName="捐助"+data.DATA[0].MONEY+"元"})},$scope.rescue=function(){var payMoney="";payMoney=null==$scope.pageData.paymoney||""==$scope.pageData.paymoney||void 0==$scope.pageData.paymoney?$scope.pageData.money:$scope.pageData.paymoney;var params={title:"社会救助",out_account_code:"CASH_ACCOUNT",in_account_code:"CASH_ACCOUNT",out_remakes:"社会救助",in_remakes:"社会救助",business:{contentId:$scope.pageData.id},success_url:"more.socialAssistanceDetails",lost_url:"more.socialAssistanceDetails",paymoney:payMoney,inMemberid:$scope.pageData.helpAccount};$state.go("common.virementothermanager",{params:JSON.stringify(params)})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("applySupportCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){function saveSupport(memberid,amountSubsidy,cardNumber,gender,email,school,address,phone,reasons_remake){var uuid=toolsService.uuid(),params=new formatAmSqlParams;
params.TABLENAME="mall_college_student_aid";var row=new formatAmSqlupdateRow;row.setID(uuid),row.setStatus("i"),row.addColumn("member_id",memberid),row.addColumn("amount_of_subsidy",100*amountSubsidy),row.addColumn("id_card_number",cardNumber),row.addColumn("gender",gender),row.addColumn("email",email),row.addColumn("phone",phone),row.addColumn("school",school),row.addColumn("address",address),row.addColumn("reasons_remake",reasons_remake),row.addColumn("create_time","now()"),row.addColumn("status",2),params.addRow(row);var param=formatAmSqlParamsToArr(params),rData=actionManagerService.excuteAmUpdate(param);ajaxManager.ajaxToJson(rData,function(data){0!=data.CODE?toolsService.showMessage("保存失败！",1):(toolsService.showMessage("保存成功！",1),$scope.pageData.amountSubsidy="",$scope.pageData.cardNumber="",$scope.pageData.gender="",$scope.pageData.email="",$scope.pageData.school="",$scope.pageData.address="",$scope.pageData.phone="",$scope.pageData.reasons_remake="",$state.go("more.myApply",{},{location:"replace"}))})}$scope.pageData={genderEnum:[{value:"1",name:"男"},{value:"2",name:"女"}],amountSubsidy:"",cardNumber:"",gender:"",email:"",school:"",address:"",phone:"",title:"",detailed:"",reasons_remake:"",memberid:Authen.getUserId(),membername:""},$scope.pageData.membername=Authen.getUserName(),console.error(Authen),$scope.init=function(){var menucode={menucode:"collegeStudentBook"},rData=actionManagerService.excuteResource("collegeStudentBook",menucode,"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pageData.title=data.DATA[0].TITLE,$scope.pageData.detailed=data.DATA[0].DETAILED)})},$scope.init(),$scope.submit=function(){if(null==$scope.pageData.amountSubsidy||""==$scope.pageData.amountSubsidy||void 0==$scope.pageData.amountSubsidy)return void toolsService.showMessage("请输入正确的资助金额！",1);if(null==$scope.pageData.cardNumber||""==$scope.pageData.cardNumber||void 0==$scope.pageData.cardNumber||$scope.pageData.cardNumber.length<16||$scope.pageData.cardNumber.length>18)return void toolsService.showMessage("请输入正确的身份证号！",1);if(console.error($scope.pageData.email),console.error($scope.pageData.phone.length),null==$scope.pageData.phone||""==$scope.pageData.phone||void 0==$scope.pageData.phone||11!=$scope.pageData.phone.length)return void toolsService.showMessage("请输入正确的电话号码！",1);if(null==$scope.pageData.gender||""==$scope.pageData.gender||void 0==$scope.pageData.gender)return void toolsService.showMessage("请选择性别！",1);if(null==$scope.pageData.email||""==$scope.pageData.email||void 0==$scope.pageData.email)return void toolsService.showMessage("请输入正确的邮箱！",1);if(null==$scope.pageData.school||""==$scope.pageData.school||void 0==$scope.pageData.school)return void toolsService.showMessage("请输入正确的学校！",1);if(null==$scope.pageData.address||""==$scope.pageData.address||void 0==$scope.pageData.address)return void toolsService.showMessage("请输入正确的地址！",1);if(null==$scope.pageData.reasons_remake||""==$scope.pageData.reasons_remake||void 0==$scope.pageData.reasons_remake)return void toolsService.showMessage("请输入申请原因！",1);var amountSubsidy=$scope.pageData.amountSubsidy,cardNumber=$scope.pageData.cardNumber,gender=$scope.pageData.gender,email=$scope.pageData.email,school=$scope.pageData.school,address=$scope.pageData.address,phone=$scope.pageData.phone,memberid=Authen.getUserId(),reasons_remake=$scope.pageData.reasons_remake;saveSupport(memberid,amountSubsidy,cardNumber,gender,email,school,address,phone,reasons_remake)}}]),angular.module("mallMobileApp.controllers").controller("myApplyCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={memberid:Authen.getUserId(),params:""},$scope.pageData.params={memberid:Authen.getUserId()},$scope.pageData.listEvents={myApplyDetails:function(id){var params={id:id};$state.go("more.myApplyDetails",{params:JSON.stringify(params)})}}}]),angular.module("mallMobileApp.controllers").controller("myApplyDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={id:"",membername:"",amountOfSubsidy:"",money:"",cardNumber:"",phone:"",gender:"",address:"",school:"",loginaccount:"",createtime:"",statusname:"",name:"",memberid:Authen.getUserId()},$scope.init=function(){var collegeId=null,params=JSON.parse($state.params.params).id;void 0==params||""==params?(console.error($state.params.params),collegeId={collegeId:JSON.parse($state.params.params).business.collegeId}):collegeId={collegeId:JSON.parse($state.params.params).id};var rData=actionManagerService.excuteResource("myApplyDetails",collegeId,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.id=data.DATA[0].ID,$scope.pageData.loginaccount=data.DATA[0].LOGINACCOUNT,$scope.pageData.status=data.DATA[0].STATUS,$scope.pageData.membername=data.DATA[0].MEMBERNAME,$scope.pageData.statusname=data.DATA[0].STATUSNAME,$scope.pageData.name=data.DATA[0].NAME,$scope.pageData.amountOfSubsidy=data.DATA[0].AMOUNT_OF_SUBSIDY,$scope.pageData.cardNumber=data.DATA[0].ID_CARD_NUMBER,$scope.pageData.phone=data.DATA[0].PHONE,$scope.pageData.gendername=data.DATA[0].GENDERNAME,$scope.pageData.email=data.DATA[0].EMAIL,$scope.pageData.school=data.DATA[0].SCHOOL,$scope.pageData.address=data.DATA[0].ADDRESS,$scope.pageData.createtime=data.DATA[0].CREATETIME,$scope.pageData.reasons_remake=data.DATA[0].REASONS_REMAKE})},$scope.thankYou=function(){var params={title:"感恩答谢",out_account_code:"CASH_ACCOUNT",in_account_code:"CASH_ACCOUNT",out_remakes:"感恩答谢",in_remakes:"感恩答谢",business:{collegeId:$scope.pageData.id},success_url:"more.myApplyDetails",lost_url:"more.myApplyDetails",paymoney:"",inMemberid:$scope.pageData.loginaccount};$state.go("common.virementothermanager",{params:JSON.stringify(params)},{location:"replace"})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("mySupportCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={memberid:Authen.getUserId(),provinces:"",recvcity:"",recvarea:"",params:{memberid:""}};var params=JSON.parse($state.params.params).memberid;if(void 0==params||""==params){var payid=JSON.parse($state.params.params).pay_id,collegeId=JSON.parse($state.params.params).business.collegeId,tomemberId=JSON.parse($state.params.params).business.tomemberId,paymoney=JSON.parse($state.params.params).paymoney,memberid=$scope.pageData.memberid,rData=actionManagerService.collegeHelper(payid,collegeId,paymoney,memberid,tomemberId);ajaxManager.ajaxToJson(rData,function(data){if(0!=data.code){var params={memberid:$scope.pageData.memberid};$state.go("more.mySupport",{params:JSON.stringify(params)},{location:"replace"})}})}else $scope.pageData.params={memberid:JSON.parse($state.params.params).memberid};$scope.pageData.listEvents={wishPlatform:function(tomemberid,membername){console.error(tomemberid);var params={tomemberid:tomemberid,membername:membername};$state.go("more.wishPlatform",{params:JSON.stringify(params)})}}}]),angular.module("mallMobileApp.controllers").controller("studenSupportCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={memberid:Authen.getUserId(),provinces:"",recvcity:"",recvarea:"",params:{wherSQL:""},type:""},$scope.cascadePCZ={provinces:[],cities:[],zones:[]},Authen.getUserInfo()&&($scope.pageData.type=Authen.getUserInfo().MEMBER_TYPE),$scope.pageData.listEvents={studentSupportDetails:function(id){var params={id:id};$state.go("more.studentSupportDetails",{params:JSON.stringify(params)})}},$scope.init=function(){var proData=actionManagerService.excuteResource("province","","none","none");ajaxManager.ajaxToJson(proData,function(data){data.DATA&&($scope.cascadePCZ.provinces=data.DATA)})},$scope.$watch("pageData.recvProvince",function(){if($scope.pageData.recvProvince){var pId={pid:$scope.pageData.recvProvince.PROID},cityData=actionManagerService.excuteResource("city",pId,"none","none");ajaxManager.ajaxToJson(cityData,function(data){data.DATA&&($scope.cascadePCZ.cities=data.DATA)})}}),$scope.$watch("pageData.recvCity",function(){if($scope.pageData.recvCity){var cId={cid:$scope.pageData.recvCity.CITYID},distData=actionManagerService.excuteResource("district",cId,"none","none");ajaxManager.ajaxToJson(distData,function(data){data.DATA&&($scope.cascadePCZ.zones=data.DATA)})}}),$scope.init(),$scope.query=function(){var wherSQL="";if($scope.pageData.recvProvince){var pId=$scope.pageData.recvProvince.PROID;wherSQL=" AND mem.province = '"+pId+"'"}if($scope.pageData.recvCity){var cId=$scope.pageData.recvCity.CITYID;wherSQL+=" AND mem.city='"+cId+"' "}if($scope.pageData.recvArea){var zoneid=$scope.pageData.recvArea.ZONEID;console.error(zoneid),wherSQL+=" AND mem.zzone='"+zoneid+"' "}$scope.pageData.params={wherSQL:wherSQL}},$scope.applySupport=function(){$state.go("more.applySupport")},$scope.myApply=function(){$state.go("more.myApply")},$scope.mySupport=function(){var params={memberid:$scope.pageData.memberid};$state.go("more.mySupport",{params:JSON.stringify(params)})}}]),angular.module("mallMobileApp.controllers").controller("studentSupportDetailsCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={id:"",tomemberid:"",membername:"",amountOfSubsidy:"",money:"",cardNumber:"",phone:"",gender:"",address:"",school:"",loginaccount:"",createtime:"",memberid:Authen.getUserId(),reasons_remake:""},$scope.init=function(){var collegeId=null,params=JSON.parse($state.params.params).id;void 0==params||""==params?(console.error($state.params.params),collegeId={collegeId:JSON.parse($state.params.params).business.collegeId}):collegeId={collegeId:JSON.parse($state.params.params).id};var rData=actionManagerService.excuteResource("studentSupportDetails",collegeId,"none","none");ajaxManager.ajaxToJson(rData,function(data){$scope.pageData.id=data.DATA[0].ID,$scope.pageData.membername=data.DATA[0].MEMBERNAME,$scope.pageData.tomemberid=data.DATA[0].MEMBER_ID,$scope.pageData.loginaccount=data.DATA[0].LOGINACCOUNT,$scope.pageData.amountOfSubsidy=data.DATA[0].AMOUNT_OF_SUBSIDY,$scope.pageData.cardNumber=data.DATA[0].ID_CARD_NUMBER,$scope.pageData.money=data.DATA[0].MONEY,$scope.pageData.phone=data.DATA[0].PHONE,$scope.pageData.gendername=data.DATA[0].GENDERNAME,$scope.pageData.email=data.DATA[0].EMAIL,$scope.pageData.school=data.DATA[0].SCHOOL,$scope.pageData.address=data.DATA[0].ADDRESS,$scope.pageData.createtime=data.DATA[0].CREATETIME,$scope.pageData.reasons_remake=data.DATA[0].REASONS_REMAKE})},$scope.confirmSupport=function(){var payMoney=$scope.pageData.money,params={title:"大学生资助",out_account_code:"CASH_ACCOUNT",in_account_code:"CASH_ACCOUNT",out_remakes:"大学生资助",in_remakes:"大学生资助",business:{collegeId:$scope.pageData.id,tomemberId:$scope.pageData.tomemberid},success_url:"more.mySupport",lost_url:"more.studentSupportDetails",paymoney:payMoney,inMemberid:$scope.pageData.loginaccount};$state.go("common.virementothermanager",{params:JSON.stringify(params)},{location:"replace"})},$scope.init()}]),angular.module("mallMobileApp.controllers").controller("wishPlatformCtrl",["$scope","$rootScope","$state","actionManagerService","ajaxManager","toolsService","Authen",function($scope,$rootScope,$state,actionManagerService,ajaxManager,toolsService,Authen){$scope.pageData={title:"",DetailedImages:"",detailed:"",id:"",totalAidTimes:0,sholdAidTimes:0,alreadyAidTimes:0,memberid:Authen.getUserId(),membername:JSON.parse($state.params.params).membername},console.error($scope.pageData.membername),$scope.init=function(){var memberid={member_id:JSON.parse($state.params.params).tomemberid},rData=actionManagerService.excuteResource("member_info",memberid,"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pageData.id=data.DATA[0].ID,$scope.pageData.totalAidTimes=data.DATA[0].TOTAL_AID_TIMES,$scope.pageData.sholdAidTimes=data.DATA[0].SHOLD_AID_TIMES,$scope.pageData.alreadyAidTimes=data.DATA[0].ALREADY_AID_TIMES,$scope.wishPlatform())})},$scope.init(),$scope.wishPlatform=function(){var menucode={menucode:"collegeStudentWishPlatform"},rData=actionManagerService.excuteResource("collegeStudentBook",menucode,"none","none");ajaxManager.ajaxToJson(rData,function(data){data.DATA&&($scope.pageData.title=data.DATA[0].TITLE,$scope.pageData.DetailedImages=data.DATA[0].DETAILEDIMAGES,$scope.pageData.detailed=data.DATA[0].DETAILED)})},$scope.mySupport=function(memberid){var params={memberid:memberid};$state.go("more.mySupport",{params:JSON.stringify(params)})}}]);var amSdk=angular.module("am.sdk",["ng"]);angular.module("am.sdk").service("ajaxManager",["$rootScope","$http","$log","$q","$ionicPopup","$location","md5","appConfig","$ionicPlatform","$cordovaDevice","actionManagerService","base64",function($rootScope,$http,$log,$q,$ionicPopup,$location,md5,appConfig,$ionicPlatform,$cordovaDevice,actionManagerService,base64){var tonkenstatus=!1,getTonken_service=function(code){if(null==appConfig.Tonken||"40006"==code){var secret_key=AOCS0203049574831,reg=/\S/;if(reg.test(secret_key)&&null!=secret_key){var rData=actionManagerService.requestTonken(secret_key);$.ajax({type:"POST",url:rData.url,async:!1,dataType:"json",data:rData.data,success:function(data){"40000"==data.CODE&&(appConfig.Tonken=data.SECRETKEY)}})}else{$ionicPlatform.on("deviceready",function(){secret_key=$cordovaDevice.getDevice().tonken}),secret_key=md5.createHash(secret_key);var rData=actionManagerService.requestTonken(secret_key);$.ajax({type:"POST",url:rData.url,async:!1,dataType:"json",data:rData.data,success:function(data){"40000"==data.CODE&&(appConfig.Tonken=data.SECRETKEY)}})}}};return{getTonken:getTonken_service,$get:function(){return this},ajaxToJson:function(tData,successfun,errorfun){var str="",params_Serialization="";for(var p in tData.data)"undefined"!=typeof tData.data[p]&&(str+=tData.data[p]+"@",params_Serialization+=p+",");console.info("str:"+str),console.info("params_Serialization:"+params_Serialization);var tonken=appConfig.Tonken,params=base64.encode(str+"@"+tonken);tData.data.platform_sign=md5.createHash(params),tData.data.serialization=base64.encode(params_Serialization),null==tonken&&(getTonken_service(),tonken=appConfig.Tonken,params=base64.encode(str+"@"+tonken),tData.data.platform_sign=md5.createHash(params)),console.info("值:"+str+"@"+tonken),$http(tData).success(function(data,header,config,status){console.info(data),"40006"==data.CODE?tonkenstatus||($ionicPopup.alert({title:"警告",template:"用户信息已过期，请退出APP重新进入!"}),tonkenstatus=!0):successfun&&successfun(data,header,config,status)}).error(function(data,header,config,status){errorfun&&errorfun(data,header,config,status)})},ajaxTosyc:function(tDta,successfun,errorfun){var str="",params_Serialization="";for(var p in tDta.data)"undefined"!=typeof tDta.data[p]&&(str+=tDta.data[p]+"@",params_Serialization+=p+",");var tonken=appConfig.Tonken,params=base64.encode(str+"@"+tonken);tDta.data.platform_sign=md5.createHash(params),tDta.data.serialization=base64.encode(params_Serialization),console.info("值:"+str+"@"+tonken),null==tonken&&(getTonken_service(),tonken=appConfig.Tonken,params=base64.encode(str+"@"+tonken),tDta.data.platform_sign=md5.createHash(params)),$.ajax({type:"POST",url:tDta.url,async:!1,dataType:"json",data:tDta.data,success:function(data,header,config,status){"40006"==data.CODE?tonkenstatus||($ionicPopup.alert({title:"警告",template:"用户信息已过期，请退出APP重新进入!"}),tonkenstatus=!0):successfun&&successfun(data,header,config,status)},error:errorfun})}}}]).service("toolsService",["$rootScope","$http","$log","$q","$ionicPopup","$location","$cordovaToast","appConfig","actionManagerService","ajaxManager","$timeout",function($rootScope,$http,$log,$q,$ionicPopup,$location,$cordovaToast,appConfig,actionManagerService,ajaxManager,$timeout){function formJarryToObject(sArray){for(var rValue=new Object,i=0;i<sArray.length;i++)rValue[sArray[i].NAME]=sArray[i].VALUE;return console.error(rValue),rValue}function setFirstRun(value){var key="firstRun_"+AppThisVer;localStorage.setItem(key,value)}function platform(){var u=navigator.userAgent,isAndroid=u.indexOf("Android")>-1||u.indexOf("Adr")>-1;return isAndroid}function registXingeToken(memberId,token,mobile){if(!isEmpty(mobile)&&!isEmpty(token)){var rData=actionManagerService.registUserToken(memberId,token,mobile);ajaxManager.ajaxToJson(rData,function(data){"0"!=data.code?console.log("信鸽初始化成功>>token::"+token):console.log("信鸽初始化失败>>token::"+token)})}}function isNewVersion(){var key="firstRun_"+appConfig.version;return key}function checkAndroidAppVersion(version){var tKey=actionManagerService.isNewAppVersion(version);ajaxManager.ajaxToJson(tKey,function(data){console.debug(" checkAndroidAppVersion().data="+data.android_path+" | "+data.ios_path),isEmpty(data)||$ionicPopup.confirm({title:"版本更新",subTitle:"您当前版本为v"+data.app_tv+",发现新版本v"+data.app_nv+"，您现在下载并升级吗？",template:data.app_content,buttons:[{text:"取消",type:"btnc"},{text:"确定",type:"btn1",onTap:function(){ionic.Platform.isIOS()?window.open(data.ios_path,"_system"):ionic.Platform.isAndroid()&&window.open(data.android_path,"_system")}}]})})}function arrunique(arr){for(var elem,result=[],hash={},i=0;null!=(elem=arr[i]);i++)hash[elem]||(result.push(elem),hash[elem]=!0);return result}function dateTostr(datetime){var year=datetime.getFullYear(),month=datetime.getMonth()+1,date=datetime.getDate(),hour=datetime.getHours(),minutes=datetime.getMinutes(),second=datetime.getSeconds();10>month&&(month="0"+month),10>date&&(date="0"+date),10>hour&&(hour="0"+hour),10>minutes&&(minutes="0"+minutes),10>second&&(second="0"+second);var time=year+"-"+month+"-"+date;return time}function ImgIsExistence(imgurl){var ImgObj=new Image;return ImgObj.src=imgurl,ImgObj.fileSize>0||ImgObj.width>0&&ImgObj.height>0?!0:!1}function loginterminal(){var returnplatfromName="",u=navigator.userAgent,platform=(navigator.appVersion,{trident:u.indexOf("Trident")>-1,opera:u.indexOf("Presto")>-1,"safari/chrome":u.indexOf("AppleWebKit")>-1,firefox:u.indexOf("Gecko")>-1&&-1==u.indexOf("KHTML"),mobile:!!u.match(/AppleWebKit.*Mobile.*/),ios:!!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:u.indexOf("Android")>-1||u.indexOf("Linux")>-1,iPhone:u.indexOf("iPhone")>-1,iPad:u.indexOf("iPad")>-1,webApp:-1==u.indexOf("Safari"),weixin:u.indexOf("MicroMessenger")>-1,qq:" qq"==u.match(/\sQQ/i)});for(var item in platform)platform[item]&&(returnplatfromName=item);return returnplatfromName}function uu_Alert(content){$ionicPopup.alert({title:"提示",template:content,buttons:[{type:"btn2",text:"确定"}]})}function Alert(title,text,fun){$rootScope.showAlert=function(){var alertPopup=$ionicPopup.alert({title:title,template:text});alertPopup.then(function(res){fun(res)})}}function getServeDate(){return null==currentServiceTime&&getResource("getServiceTime").success(function(data,status,headers,cofnig){data&&(currentServiceTime=data,setInterval(function(){currentServiceTime=new Number(currentServiceTime)+new Number(1e3)},1e3))}),new Number(currentServiceTime)}function tops(msg){var params={theme:"confirm",msg:msg,title:"提示信息"};$rootScope.$broadcast("dialog",params);var popupAlert=$ionicPopup.alert({subTitle:'<div class="fs_15 cl_1 fw_7">'+params.title+"</div>",template:params.msg,okText:"确认",okType:"btn2"});popupAlert.then(function(){})}function confirm(title,msg,callback,carback){$ionicPopup.confirm({subTitle:'<span class="fs-14 tzsx_f_c_51" >'+title+"</span>",template:"<div class='row' style='padding:0px 0px 10px 0px; color:#101010;'><div class='col' style='text-align:center;font-size:14px;color: rgb(102,102,102);'>"+msg+"</div></div>",buttons:[{text:"取消",type:"btnc",onTap:function(){angular.isFunction(carback)&&carback()}},{text:"确认",type:"btn1",onTap:function(){callback()}}]})}function tips(msg,second){var myPopup=$ionicPopup.show({title:msg});""==second&&(second=1e3),$timeout(function(){myPopup.close()},second)}function ttips(msg,second){}function showMessage(msg,second){var myPopup=$ionicPopup.show({title:msg});(""==second||1==second||2==second||3==second)&&(second=1e3),$timeout(function(){myPopup.close()},second)}function isEmpty(value){return null==value?!0:""===value||""==value?!0:void 0==value||"undefined"==value?!0:0===value.length?!0:!1}function isNumber(value){return value+="",isEmpty(value)?!1:isNaN(value)?!1:value.match(/^[0-9].*$/)?!0:!1}function isMobile(s){if(isEmpty(s))return!1;var patrn=/^(1[0-9]{10})$/;return patrn.test(s)?!0:!1}function isEmail(str){return isEmpty(str)?!1:"."==str.charAt(0)||"@"==str.charAt(0)||-1==str.indexOf("@",0)||-1==str.indexOf(".",0)||str.lastIndexOf("@")==str.length-1||str.lastIndexOf(".")==str.length-1||str.indexOf("@.")>-1?!1:!0}function isQQ(qq){var filter=/^\s*[.0-9]{5,11}\s*$/;return filter.test(qq)?!0:!1}function isIdCard(N){N=N.toLowerCase();var r=/^[1-9]\d{5}[0-9]{4}(((0[13578]|(10|12))(0[1-9]|[1-2][0-9]|3[0-1]))|(02-(0[1-9]|[1-2][0-9]))|((0[469]|11)(0[1-9]|[1-2][0-9]|30)))\d{3}[0-9|x]$/;if(!r.test(N))return!1;for(var arr=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2),checkArr=new Array("1","0","x","9","8","7","6","5","4","3","2"),sum=0,lastNo="",i=0,v=0;17>i;i++)v=N.charAt(i)*arr[i],sum+=v;return lastNo=checkArr[sum%11],N.charAt(17)==lastNo?!0:!1}function checkZip(zip){var reg=/^[1-9]\d{5}(?!\d)$/;return 0==reg.test(zip)?!1:!0}function error(tag,msg){isDebug&&$log.error(tag+"["+(new Date).getTime()+"]-->	"+msg)}function log(tag,msg){isDebug&&$log.log(tag+"["+(new Date).getTime()+"]-->	"+msg)}function debug(tag,msg){isDebug&&$log.debug(tag+"["+(new Date).getTime()+"]-->	"+msg)}function info(tag,msg){isDebug&&$log.info(tag+"["+(new Date).getTime()+"]-->	"+msg)}function warn(msg){isDebug&&$log.warn(tag+"["+(new Date).getTime()+"]-->	"+msg)}function ReplaceImgPath(str){var tRegExp=new RegExp('src="/',"g");return str.replace(tRegExp,'src="'+baseUrl+"/")}function ReplaceAll(str1,str2,str3){var tRegExp=new RegExp(str2,"g");return str1.replace(tRegExp,str3)}function ReplaceIMGAll(str1){var tRegExp=new RegExp("#IMG#","g");return str1.replace(tRegExp,baseUrl)}function TransformNumberIntoCHN(number){if(isNaN(number))return"";number-=0;var unit="仟佰拾亿仟佰拾万仟佰拾元角分",str="";number+="00";var point=number.indexOf(".");point>=0&&(number=number.substring(0,point)+number.substr(point+1,2)),unit=unit.substr(unit.length-number.length);for(var i=0;i<number.length;i++)str+="零壹贰叁肆伍陆柒捌玖".charAt(number.charAt(i))+unit.charAt(i);return str.replace(/零(仟|佰|拾|角)/g,"零").replace(/(零)+/g,"零").replace(/零(万|亿|元)/g,"$1").replace(/(亿)万|(拾)/g,"$1$2").replace(/^元零?|零分/g,"").replace(/元$/g,"元整")}function replaceImgPath(str){var tRegExp=new RegExp('src="/',"g");return str.replace(tRegExp,'src="'+baseUrl+"/")}function getLocalStorage(){var storage="";return storage=window.localStorage?window.localStorage:""}function refreshLocalData(name,data){ToolsService.isEmpty(name)||ToolsService.isEmpty(storage.getItem(name))||storage.setItem(name,data)}function jsonToStr(jsonObject){var strf="";return isEmpty(jsonObject)||(strf=JSON.stringify(jsonObject)),strf}function strToJson(str){var json="";if(!isEmpty(str))try{json=JSON.parse(str)}catch(e){console.error(e),console.error(str+"转换成JSON出错！")}return json}function uuid(len,radix){var i,CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),chars=CHARS,uuid=[];if(radix=radix||chars.length,len)for(i=0;len>i;i++)uuid[i]=chars[0|Math.random()*radix];else{var r;for(uuid[8]=uuid[13]=uuid[18]=uuid[23]="-",uuid[14]="4",i=0;36>i;i++)uuid[i]||(r=0|16*Math.random(),uuid[i]=chars[19==i?3&r|8:r])}return uuid.join("")}function getCurentTime(){var date=new Date,Thisdate=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+" "+date.getHours()+":"+date.getMinutes()+":"+date.getSeconds();return Thisdate}function getCurentDate(){var date=new Date,Thisdate=date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate();return Thisdate}function fileJsonreturnstr(json,status){for(var returnstr="",i=0;i<json.length;i++)json[i].type&&json[i].type.indexOf(status)>-1&&(""==returnstr?returnstr=json[i].path:returnstr+=","+json[i].path);return returnstr}var currentServiceTime=null,AppThisVer=appConfig.version;return{$get:function(){return this},debug:debug,log:log,info:info,warn:warn,error:error,tops:tops,tips:tips,Alert:Alert,uu_Alert:uu_Alert,ttips:ttips,confirm:confirm,isEmpty:isEmpty,isNumber:isNumber,isIdCard:isIdCard,isMobile:isMobile,isEmail:isEmail,isQQ:isQQ,checkZip:checkZip,loginterminal:loginterminal,ReplaceIMGAll:ReplaceIMGAll,ReplaceAll:ReplaceAll,getLocalStorage:getLocalStorage,refreshLocalData:refreshLocalData,jsonToStr:jsonToStr,strToJson:strToJson,ImgIsExistence:ImgIsExistence,uuid:uuid,showMessage:showMessage,fileJsonreturnstr:fileJsonreturnstr,dateTostr:dateTostr,arrunique:arrunique,getServeDate:getServeDate,getCurentTime:getCurentTime,getCurentDate:getCurentDate,TransformNumberIntoCHN:TransformNumberIntoCHN,ReplaceImgPath:ReplaceImgPath,replaceImgPath:replaceImgPath,checkAndroidAppVersion:checkAndroidAppVersion,registXingeToken:registXingeToken,platform:platform,isNewVersion:isNewVersion,setFirstRun:setFirstRun,formJarryToObject:formJarryToObject,formImagesToImgpicker:function(imgList,callFun){for(var tobj=null,rValue=[],tCount=0,i=0;imgList.length>i;i++)console.debug(imgList),tobj=new Object,tobj["店铺图集"]=imgList[i],rValue.push(tobj),tCount+=imgList[i].length;return callFun(tCount),rValue},toStateOfServerUrl:function($state,url){var regex=/^http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?$/i;if(console.info("数据："+JSON.stringify(url)),!isEmpty(url))if(JSON.stringify(url).indexOf("{")>-1&&JSON.stringify(url).indexOf("}")>-1&&JSON.stringify(url).indexOf("params")<0&&JSON.stringify(url).indexOf("url")<0)if(url.indexOf("/")>0){var arr=url.split("/");$state.go(arr[0],{params:arr[1]})}else $state.go(url,{});else regex.test(url.url)?cordova.InAppBrowser.open(url.url,"_blank","location=yes"):$state.go(url.url,{params:url.params})},toStateOfServermessage:function($state,url){var regex=/^http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?$/i;if(console.info("数据："+JSON.stringify(url)),!isEmpty(url))if(JSON.stringify(url).indexOf("{")>-1&&JSON.stringify(url).indexOf("}")>-1)if(url.indexOf("/")>0){var arr=url.split("/");$state.go(arr[0],{params:arr[1]})}else $state.go(url,{});else regex.test(url.url)?cordova.InAppBrowser.open(url.url,"_blank","location=yes"):$state.go(url.url,{params:url.params})},toStateOfServerUrlNew:function($state,data){console.info(JSON.stringify(data));var regex=/^http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?$/i;regex.test(data.url)?cordova.InAppBrowser.open(data.url,"_blank","location=yes"):"common.boySign"==data.url?"0"==localStorage.getItem("zlb_Sign_Type")?$state.go("common.boySign",{params:JSON.stringify(data.params)}):$state.go("common.girlSign",{params:JSON.stringify(data.params)}):$state.go(data.url,{params:JSON.stringify(data.params)})},goBackPage:function(){history.back()},createSwiper:function(contentSelecter,pagSelect,autoplay){void 0==autoplay&&(autoplay=2e3),$timeout(function(){new Swiper(contentSelecter,{pagination:pagSelect,autoplay:autoplay,autoplayDisableOnInteraction:!1,observer:!0,observeParents:!0,preloadImages:!1,lazyLoading:!1})},800)}}}]).directive("aslist",["$ionicHistory","$sce","$location","ajaxManager","toolsService","actionManagerService",function($ionicHistory,$sce,$location,ajaxManager,toolsService,actionManagerService){var count=0,pageSize=10,currentPage=1,loadDataBySQL=function(rcode,params,callFun){var rData=actionManagerService.getListData(currentPage,rcode,params,pageSize);ajaxManager.ajaxToJson(rData,function(data,status,headers,config){data&&data.DATA&&callFun&&(callFun(data.DATA),(data.DATA=pageSize)&&currentPage++)})};return{restrict:"AE",replace:!0,template:function(elem,attrs){return"<ion-list>        <ion-item ng-if='!item' ng-repeat='value in repeatdata' >        <div ng-include=\"'"+attrs.tempUrl+"'\">{{item}}</div>        </ion-item>        <div ng-if='item' ng-repeat='value in repeatdata'>        <div ng-include=\"'"+attrs.tempUrl+"'\">{{item}}</div>        </div>        <div ng-if='!noShowMore' id='list_item_more' ng-click='loadMoredData()' class='"+attrs.moreClass+"' >        <span class='fs-13' ng-if='laodData'>点击加载更多        </span>        <span class='fs-13' ng-if='initData'>o(╯□╰)o 没有找到数据        </span>        </div>        </ion-list>"},scope:{sql:"@",rcode:"@",params:"@",item:"@",data:"=",listNumber:"@",parentDivId:"@",moreClass:"@",listEvents:"=",beforeProcess:"=",afterProcess:"=",repeatdata:"=",pageSize:"=",nodataTips:"@",loadTips:"@",noShowMore:"@"},link:function(scope,element,attrs,listController){count=0,currentPage=1,scope.pageSize&&(pageSize=scope.pageSize)},controller:function($scope){var record="",params="";if(record=$scope.rcode,params=$scope.params,$scope.initData=!1,$scope.laodData=!0,$scope.listEvents)for(var p in $scope.listEvents)$scope[p]=$scope.listEvents[p];$scope.$watchCollection("rcode",function(){record!=$scope.record&&(record=$scope.rcode,params=$scope.params,count=0,currentPage=1,$scope.pageSize&&(pageSize=$scope.pageSize),loadDataBySQL($scope.rcode,$scope.params,function(data){angular.isFunction($scope.beforeProcess)&&$scope.beforeProcess(data),$scope.repeatdata=data,console.debug(data.length),data.length<1?$scope.initData=!0:$scope.initData=!1,data&&data.length<pageSize?$scope.laodData=!1:$scope.laodData=!0,angular.isFunction($scope.afterProcess)&&$scope.afterProcess($scope.repeatdata)}))}),$scope.$watchCollection("params",function(){params!=$scope.params&&(record=$scope.rcode,params=$scope.params,count=0,currentPage=1,$scope.pageSize&&(pageSize=$scope.pageSize),loadDataBySQL($scope.rcode,$scope.params,function(data){angular.isFunction($scope.beforeProcess)&&$scope.beforeProcess(data),$scope.repeatdata=data,data&&data.length<pageSize?$scope.laodData=!1:$scope.laodData=!0,console.debug(data.length),data.length<1?$scope.initData=!0:$scope.initData=!1,angular.isFunction($scope.afterProcess)&&$scope.afterProcess($scope.repeatdata)}))}),$scope.loadMoredData=function(){$scope.laodData&&loadDataBySQL($scope.rcode,$scope.params,function(data){angular.isFunction($scope.beforeProcess)&&$scope.beforeProcess(data),$scope.repeatdata=$scope.repeatdata.concat(data),data&&data.length<pageSize?$scope.laodData=!1:$scope.laodData=!0,data.length<1?$scope.initData=!0:$scope.initData=!1,angular.isFunction($scope.afterProcess)&&$scope.afterProcess($scope.repeatdata)})}}}}]).directive("aswfall",["$ionicHistory","$sce","$location","ajaxManager","toolsService","actionManagerService","appConfig",function($ionicHistory,$sce,$location,ajaxManager,toolsService,actionManagerService,appConfig){var count=0,pageSize=10,currentPage=1,loadDataBySQL=function(rcode,params,callFun){var rData=actionManagerService.getListData(currentPage,rcode,params,pageSize);console.info("loadDataBySQL pageSize:"+pageSize),ajaxManager.ajaxToJson(rData,function(data,status,headers,config){data&&data.DATA&&callFun&&(callFun(data.DATA),data.DATA===pageSize&&currentPage++)})};return{restrict:"AE",replace:!0,template:function(elem,attrs){return"<div>        <div class='bg-2 row ' style='flex-wrap:wrap;-webkit-flex-wrap:wrap;'>            <div class='{{itemCss}}' ng-repeat='value in repeatdata'>              <div ng-include src=\"'"+attrs.tempUrl+"'\" ></div>            </div>        </div>        <div ng-if='!noShowMore' id='list_item_more' ng-click='loadMoredData()' class='"+attrs.moreClass+"' >              <span class='fs-13' ng-if='laodData'>点击加载更多              </span>              <span class='fs-13' ng-if='initData'>o(╯□╰)o 没有找到数据              </span>          </div>        </div>";
},scope:{itemCss:"@",rcode:"@",params:"@",data:"=",listNumber:"@",parentDivId:"@",moreClass:"@",listEvents:"=",beforeProcess:"=",afterProcess:"=",repeatdata:"=",pageSize:"@",nodataTips:"@",loadTips:"@",noShowMore:"@"},link:function(scope,element,attrs,listController){count=0,currentPage=1,scope.itemCss||(scope.itemCss="col-50 waterfall"),scope.pageSize&&(console.info("asfull pageSize:"+scope.pageSize),pageSize=scope.pageSize),loadDataBySQL(scope.rcode,scope.params,function(data){1==appConfig.debug&&console.dir(data),angular.isFunction(scope.beforeProcess)&&scope.beforeProcess(data),scope.repeatdata=data,data.length<1&&($scope.initData=!0),data&&data.length<pageSize?scope.laodData=!1:scope.laodData=!0,angular.isFunction(scope.afterProcess)&&scope.afterProcess(scope.repeatdata)})},controller:function($scope){if($scope.initData=!1,$scope.laodData=!0,$scope.listEvents)for(var p in $scope.listEvents)$scope[p]=$scope.listEvents[p];$scope.$watchCollection("listEvents",function(){if($scope.listEvents)for(var p in $scope.listEvents)$scope[p]=$scope.listEvents[p]}),$scope.$watchCollection("rcode",function(){count=0,currentPage=1,$scope.pageSize&&(pageSize=$scope.pageSize,console.info("$scope.$watchCollection rcode:"+pageSize)),loadDataBySQL($scope.rcode,$scope.params,function(data){angular.isFunction($scope.beforeProcess)&&$scope.beforeProcess(data),$scope.repeatdata=data,data.length<1&&($scope.initData=!0),data&&data.length<pageSize?$scope.laodData=!1:$scope.laodData=!0,angular.isFunction($scope.afterProcess)&&$scope.afterProcess($scope.repeatdata)})}),$scope.$watchCollection("params",function(){count=0,currentPage=1,$scope.pageSize&&(pageSize=$scope.pageSize,console.info("$scope.$watchCollection params:"+pageSize)),loadDataBySQL($scope.rcode,$scope.params,function(data){angular.isFunction($scope.beforeProcess)&&$scope.beforeProcess(data),$scope.repeatdata=data,data.length<1&&($scope.initData=!0),data&&data.length<pageSize?$scope.laodData=!1:$scope.laodData=!0,angular.isFunction($scope.afterProcess)&&$scope.afterProcess($scope.repeatdata)})}),$scope.loadMoredData=function(){$scope.laodData&&loadDataBySQL($scope.rcode,$scope.params,function(data){angular.isFunction($scope.beforeProcess)&&$scope.beforeProcess(data),$scope.repeatdata=$scope.repeatdata.concat(data),data.length<1&&($scope.initData=!0),data&&data.length<pageSize?$scope.laodData=!1:$scope.laodData=!0,angular.isFunction($scope.afterProcess)&&$scope.afterProcess($scope.repeatdata)})}}}}]).directive("mallActiveData",["$timeout",function($timeout){var htmlTemlate='<div>      <div ng-if="mallType==2">        <div class="row mall_storage_txt_end" ng-if="outState==0">            <div class="col-33 pl-10 mall_storage_txt_title ng-binding" ng-bind="mallTitle"></div>            <div class="col-33 mall_storage_txt_content">距离开始:{{timedata}}</div>             <div class="col-33 mall_storage_txt_end_bar">即将开始</div>        </div>        <div class="row mall_storage_txt_start" ng-if="outState==1">            <div class="col-33 pl-10 mall_storage_txt_title ng-binding" ng-bind="mallTitle"></div>            <div class="col-33 mall_storage_txt_content">距离结束:{{timedata}}</div>             <div class="col-33 mall_storage_txt_start_bar">开始抢购</div>        </div>        <div class="row mall_storage_txt_start" ng-if="outState==2">            <div class="col-50 pl-10 mall_storage_txt_title ng-binding" ng-bind="mallTitle"></div>            <div class="col-25 mall_storage_txt_content"></div>             <div class="col-25 mall_storage_txt_start_bar">已结束</div>        </div>      </div>      <div class="row mall_storage_txt_start" ng-if="mallType==0">            <div class="col-50 pl-10 mall_storage_txt_title ng-binding" ng-bind="mallTitle"></div>            <div class="col-25 mall_storage_txt_content"></div>             <div class="col-25 mall_storage_txt_start_bar">推荐</div>      </div></div>';return{restrict:"AE",replace:!0,template:htmlTemlate,scope:{endTime:"@",startTime:"@",endTimeMins:"@",startTimeMins:"@",timedata:"@",mallType:"@",outState:"=",mallTitle:"@",type_msg:"@"},link:function(scope,element,attrs,listController){""==scope.mallType},controller:function($scope){function getIsTimes(time){var rMillisecond=time-new Date;rMillisecond=Math.abs(rMillisecond);var rDay=parseInt(rMillisecond/1e3/60/60/24,10),rHour=parseInt(rMillisecond/1e3/60/60%24,10),rMinute=parseInt(rMillisecond/1e3/60%60,10),rSecond=parseInt(rMillisecond/1e3%60,10);rDay=24*rDay,rHour+=rDay;var timres={t_h:rHour,t_m:rMinute,t_s:rSecond};return timres}function getTimes(time){var rMillisecond=new Date(time)-new Date;rMillisecond=Math.abs(rMillisecond);var rDay=parseInt(rMillisecond/1e3/60/60/24,10),rHour=parseInt(rMillisecond/1e3/60/60%24,10),rMinute=parseInt(rMillisecond/1e3/60%60,10),rSecond=parseInt(rMillisecond/1e3%60,10),remainingTime=rDay+"天 "+rHour+"小时"+rMinute+"分钟 "+rSecond+"秒";return remainingTime}var updateTime=function(){ionic.Platform.isIOS()?$scope.endTimeMins-(new Date).getTime()>0?$scope.startTimeMins-(new Date).getTime()>0?($scope.timedata=getIsTimes($scope.startTimeMins),$scope.outState="0",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.timedata=getIsTimes($scope.endTimeMins),$scope.outState="1",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.outState="2",$scope.time_h="0",$scope.time_m="0",$scope.time_s="0"):new Date($scope.endTime)-new Date>0?new Date($scope.startTime)-new Date>0?($scope.timedata=getTimes($scope.startTime),$scope.outState="0",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.timedata=getTimes($scope.endTime),$scope.outState="1",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.outState="2",$scope.time_h="0",$scope.time_m="0",$scope.time_s="0"),$timeout(function(){updateTime()},1e3)};updateTime()}}}]).directive("timeOutFmtData",["$timeout","toolsService","appConfig",function($timeout,toolsService,appConfig){var htmlTemlate='<div  class="row col fs-15"  style="text-align: center;margin-bottom: 15px;">                      <div class="mall_time_limit_lab_width" style="text-align:right;">                        <span class="mall_time_limit_1" ng-bind="time_h"></span><span class="mall_time_limit_lab">时</span>                      </div>                      <div class="mall_time_limit_lab_width" style="text-align: center;">                         <span class="mall_time_limit_1" ng-bind="time_m"></span><span class="mall_time_limit_lab">分</span>                      </div>                      <div class="mall_time_limit_lab_width" style="text-align: left;">                        <span class="mall_time_limit_1" ng-bind="time_s"></span><span class="mall_time_limit_lab">秒</span>                      </div>                    </div>';return{restrict:"AE",replace:!0,template:htmlTemlate,scope:{endTime:"@",startTime:"@",endTimeMins:"@",startTimeMins:"@",timedata:"@",outState:"=",time_h:"@",time_m:"@",time_s:"@",type:"@"},link:function(scope,element,attrs,listController){},controller:function($scope){function getIsTimes(time){var rMillisecond=time-new Date;rMillisecond=Math.abs(rMillisecond);var rDay=parseInt(rMillisecond/1e3/60/60/24,10),rHour=parseInt(rMillisecond/1e3/60/60%24,10),rMinute=parseInt(rMillisecond/1e3/60%60,10),rSecond=parseInt(rMillisecond/1e3%60,10);rDay=24*rDay,rHour+=rDay;var timres={t_h:rHour,t_m:rMinute,t_s:rSecond};return timres}function getTimes(time){var rMillisecond=new Date(time)-new Date;rMillisecond=Math.abs(rMillisecond);var rDay=parseInt(rMillisecond/1e3/60/60/24,10),rHour=parseInt(rMillisecond/1e3/60/60%24,10),rMinute=parseInt(rMillisecond/1e3/60%60,10),rSecond=parseInt(rMillisecond/1e3%60,10);rDay=24*rDay,rHour+=rDay;var timres={t_h:rHour,t_m:rMinute,t_s:rSecond};return timres}var updateTime=function(){ionic.Platform.isIOS()?$scope.endTimeMins-(new Date).getTime()>0?$scope.startTimeMins-(new Date).getTime()>0?($scope.timedata=getIsTimes($scope.startTimeMins),$scope.outState="0",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.timedata=getIsTimes($scope.endTimeMins),$scope.outState="1",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.outState="2",$scope.time_h="0",$scope.time_m="0",$scope.time_s="0"):new Date($scope.endTime)-new Date>0?new Date($scope.startTime)-new Date>0?($scope.timedata=getTimes($scope.startTime),$scope.outState="0",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.timedata=getTimes($scope.endTime),$scope.outState="1",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.outState="2",$scope.time_h="0",$scope.time_m="0",$scope.time_s="0"),$timeout(function(){updateTime()},1e3)};updateTime()}}}]).directive("acotimeOutFmtData",["$timeout",function($timeout){var htmlTemlate='<div  class="row col fs-12"  style="text-align: center;padding:0px 0px 15px 0px;">                      <div class=""  style="display: inline-block;" ng-bind-html="title|imgFmt"></div>                      <div class="mall_time_limit_lab_width_2" style="text-align:right;">                        <span class="mall_time_limit_2" ng-bind="time_h"></span>                      </div>                      <div class="mall_time_limit_lab_01" style="color:#FFFFFF;">:</div>                      <div class="mall_time_limit_lab_width_2" style="text-align: center;">                         <span class="mall_time_limit_2" ng-bind="time_m"></span>                      </div>                      <div class="mall_time_limit_lab_01"  style="color:#FFFFFF;">:</div>                      <div class="mall_time_limit_lab_width_2" style="text-align: left;">                        <span class="mall_time_limit_2" ng-bind="time_s"></span>                      </div>                    </div>';return{restrict:"AE",replace:!0,template:htmlTemlate,scope:{endTime:"@",startTime:"@",timedata:"@",endTimeMins:"@",startTimeMins:"@",outState:"=",time_h:"@",time_m:"@",time_s:"@",type:"@",title:"@"},link:function(scope,element,attrs,listController){},controller:function($scope){function getIsTimes(time){var rMillisecond=time-new Date;rMillisecond=Math.abs(rMillisecond);var rDay=parseInt(rMillisecond/1e3/60/60/24,10),rHour=parseInt(rMillisecond/1e3/60/60%24,10),rMinute=parseInt(rMillisecond/1e3/60%60,10),rSecond=parseInt(rMillisecond/1e3%60,10);rDay=24*rDay,rHour+=rDay;var timres={t_h:rHour,t_m:rMinute,t_s:rSecond};return timres}function getTimes(time){var rMillisecond=new Date(time)-new Date;rMillisecond=Math.abs(rMillisecond);var rDay=parseInt(rMillisecond/1e3/60/60/24,10),rHour=parseInt(rMillisecond/1e3/60/60%24,10),rMinute=parseInt(rMillisecond/1e3/60%60,10),rSecond=parseInt(rMillisecond/1e3%60,10);rDay=24*rDay,rHour+=rDay;var timres={t_h:rHour,t_m:rMinute,t_s:rSecond};return timres}var updateTime=function(){ionic.Platform.isIOS()?$scope.endTimeMins-(new Date).getTime()>0?$scope.startTimeMins-(new Date).getTime()>0?($scope.timedata=getIsTimes($scope.startTimeMins),$scope.outState="0",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.timedata=getIsTimes($scope.endTimeMins),$scope.outState="1",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.outState="2",$scope.time_h="0",$scope.time_m="0",$scope.time_s="0"):new Date($scope.endTime)-new Date>0?new Date($scope.startTime)-new Date>0?($scope.timedata=getTimes($scope.startTime),$scope.outState="0",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.timedata=getTimes($scope.endTime),$scope.outState="1",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.outState="2",$scope.time_h="0",$scope.time_m="0",$scope.time_s="0"),$timeout(function(){updateTime()},1e3)};updateTime()}}}]).directive("tctimeOutFmtData",["$timeout",function($timeout){var htmlTemlate='<div  class="col fs-13"  style="text-align: right;padding:0px;">                  <div class="mall_time_limit_lab_width" style="text-align:right;">                    <span class="mall_time_limit_1" ng-bind="time_h"></span><span class="mall_time_limit_lab">:</span>                  </div>                  <div class="mall_time_limit_lab_width" style="text-align: center;">                     <span class="mall_time_limit_1" ng-bind="time_m"></span><span class="mall_time_limit_lab">:</span>                  </div>                  <div class="mall_time_limit_lab_width" style="text-align: left;">                    <span class="mall_time_limit_1" ng-bind="time_s"></span><span class="mall_time_limit_lab"></span>                  </div>                </div>';return{restrict:"AE",replace:!0,template:htmlTemlate,scope:{endTime:"@",startTime:"@",timedata:"@",endTimeMins:"@",startTimeMins:"@",outState:"=",time_h:"@",time_m:"@",time_s:"@",type:"@"},link:function(scope,element,attrs,listController){},controller:function($scope){function getIsTimes(time){var rMillisecond=time-new Date;rMillisecond=Math.abs(rMillisecond);var rDay=parseInt(rMillisecond/1e3/60/60/24,10),rHour=parseInt(rMillisecond/1e3/60/60%24,10),rMinute=parseInt(rMillisecond/1e3/60%60,10),rSecond=parseInt(rMillisecond/1e3%60,10);rDay=24*rDay,rHour+=rDay;var timres={t_h:rHour,t_m:rMinute,t_s:rSecond};return timres}function getTimes(time){var rMillisecond=new Date(time)-new Date;rMillisecond=Math.abs(rMillisecond);var rDay=parseInt(rMillisecond/1e3/60/60/24,10),rHour=parseInt(rMillisecond/1e3/60/60%24,10),rMinute=parseInt(rMillisecond/1e3/60%60,10),rSecond=parseInt(rMillisecond/1e3%60,10);rDay=24*rDay,rHour+=rDay;var timres={t_h:rHour,t_m:rMinute,t_s:rSecond};return timres}var updateTime=function(){ionic.Platform.isIOS()?$scope.endTimeMins-(new Date).getTime()>0?$scope.startTimeMins-(new Date).getTime()>0?($scope.timedata=getIsTimes($scope.startTimeMins),$scope.outState="0",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.timedata=getIsTimes($scope.endTimeMins),$scope.outState="1",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.outState="2",$scope.time_h="0",$scope.time_m="0",$scope.time_s="0"):new Date($scope.endTime)-new Date>0?new Date($scope.startTime)-new Date>0?($scope.timedata=getTimes($scope.startTime),$scope.outState="0",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.timedata=getTimes($scope.endTime),$scope.outState="1",$scope.time_h=$scope.timedata.t_h,$scope.time_m=$scope.timedata.t_m,$scope.time_s=$scope.timedata.t_s):($scope.outState="2",$scope.time_h="0",$scope.time_m="0",$scope.time_s="0"),$timeout(function(){updateTime()},1e3)};updateTime()}}}]).directive("stringToNumber",function(){return{require:"ngModel",link:function(scope,element,attrs,ngModel){ngModel.$parsers.push(function(value){return""+value}),ngModel.$formatters.push(function(value){return parseFloat(value,10)})}}}).filter("hostFilter",["appConfig","toolsService",function(appConfig,toolsService){return function(input,params){if("ImageJSON"===params){var temp=input;try{"object"!=typeof input&&(temp=angular.fromJson(input)),temp[0]&&temp[0].path&&(input=temp[0].path)}catch(e){}}return input=toolsService.isEmpty(input)?appConfig.defaultImg:"/"===input.substring(0,1)?appConfig.baseUrl+input:appConfig.baseUrl+"/"+input}}]).filter("ImgStringToJSON",["appConfig","toolsService",function(appConfig,toolsService){return function(input){return toolsService.isEmpty(input)||(input=JSON.parse(input)),console.debug(input),input}}]).filter("imgFmt",["appConfig","$sce",function(AppConfig,$sce){return function(str){var tRegExp=new RegExp('src="/',"g"),tRegExp1=new RegExp("src='/","g"),baseUrl=AppConfig.baseUrl;return str?(str=str.replace(tRegExp,'src="'+baseUrl+"/"),str=$sce.trustAsHtml(str.replace(tRegExp1,"src='"+baseUrl+"/"))):""}}]).filter("ptoy",[function(){return function(number){var result=number;try{result=new Number(number/100).toFixed(2)}catch(e){console.error(e)}return result}}]).filter("enum",[function(){return function(input){var result=input;return(0===arguments[1]||arguments[1])&&arguments[1][input]&&(result=arguments[1][input]),result}}]).directive("addResource",["$cordovaCamera","$ionicActionSheet","$ionicPopup","appConfig",function($cordovaCamera,$ionicActionSheet,$ionicPopup,appConfig){return{template:appConfig.isDerive?"":function(ele,attrs){var tempHtml=null;return ele.removeAttr("add-resource"),ele.attr("ngf-select",""),ele.attr("ng-model","files"),ele.attr("ngf-max-size","2MB"),tempHtml=ele[0].outerHTML},restrict:"AE",replace:!0,scope:{outData:"=",type:"@"},link:function(scope,element,attrs){appConfig.isDerive&&element.bind("click",function(){scope.addEnclosure()})},controller:function($scope){function getRecordData(callback){$scope.record={isRecord:!1,recordCss:"#7A9AD6",filePath:"",recordIcon:"ion-ios-mic-off",src:"",callback:callback};var templateHtml='<div class="record_div">                              <div class="recv" ng-click="recrod()">                                <i class="icon ion-ios-mic-outline {{record.recordIcon}}" style="font-size:60px;color:{{record.recordCss}}"></i>                                </div>                            </div>';$scope.recordPopup=$ionicPopup.show({template:templateHtml,title:"录制声音",scope:$scope,buttons:[]})}function getPicture(sourctType,callback){var options={quality:20,destinationType:Camera.DestinationType.DATA_URL,sourceType:sourctType,allowEdit:!0,encodingType:Camera.EncodingType.JPEG,popoverOptions:CameraPopoverOptions,saveToPhotoAlbum:!1,correctOrientation:!1};$cordovaCamera.getPicture(options).then(function(imageData){for(var binary=atob(imageData),array=[],i=0;i<binary.length;i++)array.push(binary.charCodeAt(i));var fileName=(new Date).getTime()+".jpg",the_file=new window.File([new Blob([new Uint8Array(array)],{type:"image/jpeg"})],fileName,{type:"image/jpeg",encoding:"utf-8"});if(angular.isFunction(callback)){var item={path:"",mediaType:"image/jpeg",type:"image",data:"data:image/jpeg;base64,"+imageData,encode:"utf-8",fileName:fileName,file:the_file};console.info("item:"+item),callback(item)}},function(err){angular.isFunction(callback)&&callback(err)})}function getResource(type,callback){switch(type){case 0:getPicture(type,callback);break;case 1:getPicture(type,callback);break;case 2:getRecordData(callback)}}function buildOutData(item){$scope.outData?$scope.outData instanceof Array?item&&item.type&&$scope.outData.push(item):console&&console.error("输出资源必须是一个数组!"):$scope.outData=new Array}var files=null;$scope.files||($scope[files]=null),!$scope.outData instanceof Array&&console.error("输出数据 out-data 必须为数组"),$scope.showRecord=function(){var templateHtml='<div class="record_div">                      <div class="recv" ng-click="recrod()">                          <i class="icon {{record.recordIcon}}" style="font-size:60px;color:{{record.recordCss}}"></i>                          </div>                        </div>';$scope.recordPopup=$ionicPopup.show({template:templateHtml,title:"录制声音",buttons:[]})},$scope.recrod=function(){var fileName=(new Date).getTime()+""+new Number(1e3*Math.random(1,2)).toFixed(0);if($scope.record.mediaRec&&$scope.record.mediaRec.release(),$scope.record.isRecord){if($scope.record.recordCss="#7A9AD6",$scope.record.isRecord=!1,$scope.record.recordIcon="ion-ios-mic-off",setTimeout(function(){$scope.recordPopup.close()},300),$scope.record.mediaRec.stopRecord(),$scope.record.mediaRec.stop(),console.error("录音文件地址："+$scope.record.src),angular.isFunction($scope.record.callback)){var item={path:$scope.record.src,mediaType:"audio/mp3",type:"audio",data:"",encode:"utf-8",file:"",fileName:""};$scope.record.callback(item)}}else $scope.record.src=fileName+".mp3",$scope.record.mediaRec=new Media($scope.record.src,function(){console.log("recordAudio():Audio Success")},function(err){console.log("recordAudio():Audio Error: "+err.code),$scope.record.mediaRec.release()}),$scope.record.recordCss="#0ee",$scope.record.isRecord=!0,$scope.record.recordIcon="ion-ios-mic-outline",$scope.record.mediaRec.startRecord(),console.error("start startRecord ------------")};var btns=[];$scope.addEnclosure=function(){btns=[{text:"从相册",id:0},{text:"拍照",id:1},{text:"录音",id:2}],("0"==$scope.type||$scope.type)&&(btns=[],$scope.type.indexOf("0")>-1&&btns.push({text:"拍照",id:1}),$scope.type.indexOf("1")>-1&&btns.push({text:"从相册",id:0}),$scope.type.indexOf("2")>-1&&btns.push({text:"录音",id:2})),$ionicActionSheet.show({buttons:btns,titleText:'<b style="font-size:16px;">选择附件</b>',cancelText:'<b style="color:red;">取消</b>',cancel:function(){},buttonClicked:function(index){var type=btns[index].id;return getResource(type,buildOutData),!0}})},$scope.$watch("files",function(){if(console.error($scope.files),$scope.files){var reader=new FileReader;reader.readAsDataURL($scope.files),reader.onload=function(e){var item={path:"",type:$scope.files.type,encode:"utf-8",data:this.result,fileName:$scope.files.name,file:$scope.files};buildOutData(item),$scope.files=null}}}),$scope.$on("$destroy",function(){$scope.outData=null})}}}]).factory("loadingMarker",["$q","$injector",function($q,$injector){var loadingMarker={request:function(request){return $injector.get("$ionicLoading").show({template:'<ion-spinner icon="android" id="submitloading"></ion-spinner>'}),request},response:function(response){return $injector.get("$ionicLoading").hide(),response},requestError:function(rejection){return $injector.get("$ionicLoading").hide(),response},responseError:function(rejection){return $injector.get("$ionicLoading").hide(),rejection}};return loadingMarker}]).filter("dateDiff",["$sce",function($sce){return function(input,params){return console.info((new Date).getFmtDate(params).toString()),new Number((new CalendarManager).DateDiff((new Date).getFmtDate(input).Format("yyyy-MM-dd"),(new Date).getFmtDate(params).Format("yyyy-MM-dd")))}}]).filter("dateFormatToMonth",["$sce",function($sce){return function(input,params){var date=new Date(input);return date.getMonth()+1+"/"+date.getDate()}}]).filter("dateFormatToMonthYear",["$sce","toolsService",function($sce,toolsService){return function(input,params){var date=new Date(input),fmt=input;return"请选择起始日期"!=input&&"Invalid Date"!=date&&"go"==params?fmt=date.getMonth()+1+"月"+date.getDate()+"日起始":"请选择结束日期"!=input&&"Invalid Date"!=date&&"stop"==params&&(fmt=date.getMonth()+1+"月"+date.getDate()+"日结束"),fmt}}]).filter("dateFormat",["$sce",function($sce){return function(input,params){return input?new Date(input).Format(params):input}}]).filter("contentSplitFmt",["$sce",function($sce){return function(input,params){var content=input;return""!=input&&(content=content.substring(0,params)+"..."),content}}]).directive("footerpadding",[function(){var htmlTemlate="<div>                  <br><br><br><br><br>                </div>";return{restrict:"AE",replace:!0,template:htmlTemlate,scope:{},link:function(scope,element){},controller:function($scope){}}}]);var CalendarManager=function(){var now=new Date;now.getFullYear(),now.getMonth(),now.getDate();this.DateDiff=function(sDate1,sDate2){var aDate,oDate1,oDate2,iDays;return aDate=sDate1.split("-"),oDate1=new Date(aDate[0]+"-"+aDate[1]+"-"+aDate[2]),aDate=sDate2.split("-"),oDate2=new Date(aDate[0]+"-"+aDate[1]+"-"+aDate[2]),iDays=parseInt(Math.abs(oDate1-oDate2)/1e3/60/60/24)},this.getStartWeek=function(date){var nows=new Date(date),tempnum=nows.getDate()%7,week=nows.getDay()+1,startweek=week+7-tempnum;return startweek>7?startweek%7:startweek},this.getNowMonthDays=function(year,month){var isy=!1;switch((year%400==0||year%4==0&&year%100!=0)&&(isy=!0),month){case 1:case 3:case 5:case 7:case 8:case 10:case 12:return 31;case 4:case 6:case 9:case 11:return 30;case 2:return isy?28:29}},this.getCurrentYear=function(){return(new Date).getFullYear()},this.getCurrentMonth=function(){return(new Date).getMonth()+1},this.getWeekDate=function(){return(new Date).getDay()},this.isLeap=function(year){return year%4==0?year%100!=0?1:year%400==0?1:0:0}},CalendarDateManger=function(option,date){for(var calendarManager=new CalendarManager,year=new Date(date).getFullYear(),month=new Number(new Date(date).getMonth())+1,weekToMonth=(new Date(date).getDate(),calendarManager.getNowMonthDays(year,month),calendarManager.getStartWeek(date)),days_per_month=new Array(31,28+calendarManager.isLeap(year),31,30,31,30,31,31,30,31,30,31),str_nums=(new Array,Math.ceil((weekToMonth+days_per_month[month])/7)),optionArrData=option.priceData,accessWeekArr=option.week,obj={Data:new Array},i=({0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array},0);str_nums>i;i+=1)for(k=0;k<7;k++){var idx=7*i+k,weekDate=idx-weekToMonth+1;weekDate=0>=weekDate||weekDate>days_per_month[month-1]?0:idx-weekToMonth+1,obj.Data.push({date:"",day:weekDate,price:"",isAccess:!1,type:"1",id:""})}this.weekday=function(){var day=new Array("日","一","二","三","四","五","六");return day},this.getDateObj=function(){for(var i=0;i<obj.Data.length;i++)for(var j=0;j<optionArrData.length;j++)if(obj.Data[i].day==new Date(optionArrData[j].date).getDate()&&month==new Number(new Date(optionArrData[j].date).getMonth())+1&&year==new Date(optionArrData[j].date).getFullYear()){var weekFlag=!1,type="2";accessWeekArr.indexOf(i%7)>-1&&(weekFlag=!0),type=""!=optionArrData[j].price||null!=optionArrData[j].price?"2":"1";var countDate=new Number(new Date(optionArrData[j].date).getMonth())+1;new Number(countDate)<10&&(countDate="0"+countDate);var cdated=obj.Data[i].day;new Number(cdated)<10&&(cdated="0"+cdated),obj.Data[i].date=new Date(date).getFullYear()+"-"+countDate+"-"+cdated,obj.Data[i].day=obj.Data[i].day,obj.Data[i].price=optionArrData[j].price,obj.Data[i].isAccess=weekFlag,obj.Data[i].type=type,obj.Data[i].id=optionArrData[j].id}for(var rows=Math.ceil(obj.Data.length/7),arr1=(new Array(rows),new Array),arr2=new Array,arr3=new Array,arr4=new Array,arr5=new Array,arr6=new Array,ContArr=new Array,i=0;i<obj.Data.length;i++)7>i&&arr1.push(obj.Data[i]);for(var i=0;i<obj.Data.length;i++)i>=7&&14>i&&arr2.push(obj.Data[i]);for(var i=0;i<obj.Data.length;i++)i>=14&&21>i&&arr3.push(obj.Data[i]);for(var i=0;i<obj.Data.length;i++)i>=21&&28>i&&arr4.push(obj.Data[i]);for(var i=0;i<obj.Data.length;i++)i>=28&&35>i&&arr5.push(obj.Data[i]);for(var i=0;i<obj.Data.length;i++)i>=35&&42>i&&arr6.push(obj.Data[i]);return ContArr.push(arr1),ContArr.push(arr2),ContArr.push(arr3),ContArr.push(arr4),ContArr.push(arr5),ContArr.push(arr6),ContArr},this.getRowSize=function(){return Math.ceil(obj.Data.length/7)}};Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(fmt)&&(fmt=fmt.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var k in o)new RegExp("("+k+")").test(fmt)&&(fmt=fmt.replace(RegExp.$1,1==RegExp.$1.length?o[k]:("00"+o[k]).substr((""+o[k]).length)));return fmt},Date.prototype.getFmtDate=function(datStr){var str=datStr,datas=str.split("-");datas[1]<10&&(datas[1]="0"+datas[1]),datas[2]<10&&(datas[2]="0"+datas[2]),str=datas[0]+"-"+datas[1]+"-"+datas[2];var resultDate=new Date;return resultDate.setFullYear(datas[0]),resultDate.setMonth(datas[1]-1),resultDate.setDate(datas[2]),resultDate},Date.prototype.initFmtDate=function(dataStr){var date=dataStr.split(/\s+/),str=date[0],datas=str.split("-");datas[1]<10&&(datas[1]="0"+datas[1]),datas[2]<10&&(datas[2]="0"+datas[2]),str=datas[0]+"-"+datas[1]+"-"+datas[2];var resultDate=new Date;if(resultDate.setFullYear(datas[0]),resultDate.setMonth(datas[1]-1),resultDate.setDate(datas[2]),2==date.length){var time=date[1].split(":");resultDate.setHours(time[0]),resultDate.setMinutes(time[1]),resultDate.setSeconds(time[2])}return resultDate};var registrePushManager=function(){this.registerPush=function(successCall){xgpush.getToken(successCall)},this.pushClick=function(successCall){xgpush.on("click",successCall)}},shakeManager=function(successCall,errorCall){var options={frequency:1e3};navigator.accelerometer.watchAcceleration(function(acceleration){(Math.abs(new Number(acceleration.x))>14||Math.abs(new Number(acceleration.y))>14||Math.abs(new Number(acceleration.z))>14)&&(navigator.vibrate(500),successCall())},onError,options)},scanCodeManager=function(successCall,errorCall){cordova.plugins.barcodeScanner.scan(successCall,errorCall,{preferFrontCamera:!1,showFlipCameraButton:!0,prompt:"请将设备摄像头对准二维码进行扫描操作！",formats:"QR_CODE,PDF_417",orientation:"portrait"})},DataManager=function(){};DataManager.prototype.getDateToMonth=function(month){var nowData=new Date,endDate=new Date,number=nowData.getMonth()+new Number(month),year=Math.floor(number/11),month=number%11;endDate.setMonth(month),endDate.setFullYear(year+nowData.getFullYear()),number=0;var yearToMonth=12*(endDate.getFullYear()-nowData.getFullYear());return number+=yearToMonth,monthToMonth=endDate.getMonth()-nowData.getMonth(),number+=monthToMonth,endDate},angular.module("am.sdk").directive("carendarBar",["ajaxManager","toolsService","actionManagerService","$sce","$ionicModal","$compile","$sce","$rootScope","$ionicPopup",function(ajaxManager,toolsService,actionManagerService,$sce,$ionicModal,$compile,$sce,$rootScope,$ionicPopup){var showCalendarHtml="app_plugins/common/common_template/calendar_bar_template.html";return{restrict:"AE",replace:!1,templateUrl:showCalendarHtml,scope:{optionsParams:"@",selectClick:"=",startDate:"@",endDate:"@",toOtherDate:"=",modalTempUrl:"@",selectDateClick:"=",resultStartDate:"=",resultEndDate:"=",resultFun:"="},link:function($scope,element,attrs){var selectPickerObj=null,nextPickerObj=null,myPopup=null,calendarManager=new CalendarManager;$scope.seletClickCss="";$scope.$watchCollection("optionsParams",function(){if(!toolsService.isEmpty($scope.optionsParams)){$scope.OptionObject=JSON.parse($scope.optionsParams);JSON.parse($scope.optionsParams).selectType;if($scope.liveData=0,$scope.selectDateTab=new Array,!toolsService.isEmpty($scope.OptionObject.startyear)){for(var i=0;i<$scope.OptionObject.priceData.length;i++)$scope.selectDateTab.push($scope.OptionObject.priceData[i]);"1"==$scope.OptionObject.selectType?($scope.startDateFlag=!0,$scope.datecss="calendar_bar_selected_on"):($scope.startDateFlag=!1,$scope.startPageDate={date:"请选择起始日期"},$scope.endPageDate={date:"请选择结束日期"})}}}),$scope.closePopShow=function(){if($scope.resultStartDate=$scope.startDate,$scope.resultEndDate=$scope.endDate,2==$scope.OptionObject.selectType)toolsService.isEmpty($scope.endDate)?(toolsService.tips("您还未选择结束时间",""),$scope.endPageDate={date:"请选择结束日期"}):($scope.resultFun({start:$scope.startDate,end:$scope.endDate}),$scope.liveData=calendarManager.DateDiff($scope.endDate.date,$scope.startDate.date),$scope.startDate=null,$scope.endDate=null,selectPickerObj="",nextPickerObj="",$scope.closePop());else{$scope.resultFun({start:$scope.startDate,end:""}),$scope.selectDateTab.length=0;for(var i=0;i<$scope.OptionObject.priceData.length;i++)new Date($scope.startDate.date).getFullYear()==new Date($scope.OptionObject.priceData[i].date).getFullYear()&&new Date($scope.startDate.date).getMonth()==new Date($scope.OptionObject.priceData[i].date).getMonth()&&new Date($scope.startDate.date).getDate()==new Date($scope.OptionObject.priceData[i].date).getDate()?($scope.selectDateTab.push($scope.OptionObject.priceData[i]),$scope.seletClickCss=0):$scope.selectDateTab.length>0&&$scope.selectDateTab.push($scope.OptionObject.priceData[i]);$scope.startDate=null,$scope.endDate=null,selectPickerObj="",nextPickerObj="",$scope.closePop();
}},$scope.toOtherDate=function(){$scope.showPop()},$scope.showPop=function(){myPopup=$ionicPopup.show({templateUrl:"app_plugins/common/common_template/calendar_bar_template_show.html",title:"日历",subTitle:"",scope:$scope,buttons:[{text:"<b>取消</b>",type:"btnc",onTap:function(e){$scope.endDate="",$scope.startDate="",$scope.startPageDate={date:"请选择起始日期"},$scope.endPageDate={date:"请选择结束日期"},$scope.closePop()}},{text:"<b>确定</b>",type:"btn1",onTap:function(e){$scope.closePopShow()}}]}),$scope.crateCalendarShow(),$(".popup").css("background-color","#ffffff"),$(".popup").css("padding","0px"),$(".popup").css("width","98%"),$(".popup").css("height","98%"),$(".popup-head").css("border","0px"),$(".popup-body").css("border-bottom","0px"),$(".popup-body").css("height","100%")},$scope.closePop=function(){myPopup.close()},$scope.selectClick=function(data,$event){toolsService.isEmpty(selectPickerObj)?("0"==$scope.seletClickCss&&($scope.seletClickCss="1"),selectPickerObj=$event.target,selectPickerObj.setAttribute("class","col col-25 calendar_bar_selected_off"),$scope.startDate=JSON.parse(data),$scope.startPageDate=data):(selectPickerObj.setAttribute("class","col col-25 calendar_bar_selected_on"),selectPickerObj=$event.target,selectPickerObj.setAttribute("class","col col-25 calendar_bar_selected_off"),$scope.startDate=JSON.parse(data),$scope.startPageDate=data),$scope.resultStartDate=$scope.startDate,$scope.resultFun({start:$scope.startDate,end:$scope.endDate})},$scope.crateCalendarShow=function(){var m=(new Array,new Date($scope.OptionObject.startyear).getMonth()),y=new Date($scope.OptionObject.startyear).getFullYear(),d=new Date($scope.OptionObject.startyear).getDate();m=new Number(m)+1,10>m&&(m="0"+m);var countdate=y+"-"+m+"-"+d,nextdate="";$scope.countPagYears=y+"年"+m+"月",$scope.nextPagYears=y+"年"+(new Number(m)+1)+"月",new Number(m)>=12?(nextdate=new Number(y)+1+"-01-"+d,$scope.nextPagYears=new Number(y)+1+"年1月"):(m=new Number(m)+1,10>m&&(m="0"+m),nextdate=y+"-"+m+"-"+d),$scope.contenDatas=$scope.createCalendar(countdate),$scope.nextDatas=$scope.createCalendar(nextdate)},$scope.createCalendar=function(date){var calendarDateManger=new CalendarDateManger($scope.OptionObject,date);$scope.weekday=calendarDateManger.weekday();var datas=calendarDateManger.getDateObj();$scope.calendarRows=calendarDateManger.getRowSize(),$scope.calendarCol=7;return datas},$scope.selectDateClick=function(data,$event){var Jso=JSON.parse(data),isAccess=Jso.isAccess,type=Jso.type;Jso.date,Jso.price;if(null!=Jso&&2==type&&isAccess)if(1==$scope.OptionObject.selectType)toolsService.isEmpty(selectPickerObj)?(selectPickerObj=$event.target,selectPickerObj.setAttribute("style","border:1px solid #ec0c0c;"),$scope.startDate=Jso,$scope.startPageDate=Jso):(selectPickerObj.setAttribute("style",""),selectPickerObj=$event.target,selectPickerObj.setAttribute("style","border:1px solid #ec0c0c;"),$scope.startDate=Jso,$scope.startPageDate=Jso);else if(toolsService.isEmpty(selectPickerObj)&&toolsService.isEmpty(nextPickerObj)?(selectPickerObj=$event.target,selectPickerObj.setAttribute("style","border:1px solid #ec0c0c;"),$scope.startDate=Jso,$scope.startPageDate=Jso):!toolsService.isEmpty(selectPickerObj)&&toolsService.isEmpty(nextPickerObj)?(nextPickerObj=$event.target,nextPickerObj.setAttribute("style","border:1px solid #ec0c0c;"),$scope.endDate=Jso,$scope.endPageDate=Jso):toolsService.isEmpty(selectPickerObj)||toolsService.isEmpty(nextPickerObj)||(selectPickerObj.setAttribute("style",""),nextPickerObj.setAttribute("style",""),selectPickerObj="",nextPickerObj="",$scope.startPageDate="",$scope.endPageDate="",$scope.endDate="",$scope.startDate="",selectPickerObj=$event.target,selectPickerObj.setAttribute("style","border:1px solid #ec0c0c;"),$scope.startDate=Jso,$scope.startPageDate=Jso),!toolsService.isEmpty(selectPickerObj)&&!toolsService.isEmpty(nextPickerObj)&&new Date($scope.endDate.date).getTime()<=new Date($scope.startDate.date).getTime())return toolsService.tips("所选日期需大于起始日期",""),selectPickerObj.setAttribute("style",""),nextPickerObj.setAttribute("style",""),selectPickerObj="",nextPickerObj="",$scope.endDate="",$scope.startDate="",$scope.startPageDate={date:"请选择起始日期"},void($scope.endPageDate={date:"请选择结束日期"})}},controller:["$scope",function($scope){}]}}]),angular.module("am.sdk").directive("recommendList",["$ionicActionSheet","$ionicPopup","actionManagerService","ajaxManager","toolsService","$state",function($ionicActionSheet,$ionicPopup,actionManagerService,ajaxManager,toolsService,$state){return{templateUrl:"app_plugins/common/common_template/recommend_list_template.html",restrict:"AE",replace:!1,scope:{optionParams:"@"},link:function(scope,element,attrs){},controller:function($scope){$scope.jbuttonCss="rgb(0,135,255)",$scope.dbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.cbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.zbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);";var type=1,id="",countGps="";$scope.shows=!0,$scope.$watchCollection("optionsParams",function(){toolsService.isEmpty($scope.optionParams)||(id=JSON.parse($scope.optionParams).id,countGps=JSON.parse($scope.optionParams).gps,$scope.getRecommendInfos(type),$scope.recodetype="1")}),$scope.getRecommendInfos=function(type){var rData=actionManagerService.getRecommendInfo(id,countGps,type);ajaxManager.ajaxToJson(rData,function(data){$scope.pageData=data.DATA})},$scope.selectClick=function(type){$scope.shows=!0,"1"==type&&($scope.jbuttonCss="rgb(0,135,255);color:#FFFFFF",$scope.dbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.cbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.zbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.recodetype="1"),"2"==type&&($scope.jbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.dbuttonCss="rgb(0,135,255);color:#FFFFFF",$scope.cbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.zbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.recodetype="2"),"3"==type&&($scope.jbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.dbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.cbuttonCss="rgb(0,135,255);color:#FFFFFF",$scope.zbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.recodetype="3"),"7"==type&&($scope.shows=!1,$scope.jbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.dbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.cbuttonCss="#FFFFFF;color:#000000;border:1px solid rgb(0,135,255);",$scope.zbuttonCss="rgb(0,135,255);color:#FFFFFF",$scope.recodetype="7"),$scope.getRecommendInfos(type)},$scope.toPage=function(id){var url="",params={id:""};"1"==$scope.recodetype&&(url="commodity.scenicspotdetails"),"2"==$scope.recodetype&&(url="commodity.hoteldetails"),"3"==$scope.recodetype&&(url="commodity.restaurantdetails"),"7"==$scope.recodetype&&(url="commodity/discountGroupDetails"),params.id=id,$scope.stateGo(url,params)},$scope.stateGo=function(url,param){$state.go(url,{params:JSON.stringify(param)})}}}}]),angular.module("mallMobileApp.controllers").directive("asStart",["$ionicHistory","$sce",function($ionicHistory,$sce){return{restrict:"AE",replace:!0,template:function(elem,attrs){return"<div>                    <i ng-click='setValue(\"{{$index}}\")' ng-dblclick='setdbValue(\"{{$index}}\")'                        class='icon {{item.value}} ' ng-repeat='item in starts track by $index' ></i>                </div>"},scope:{value:"@",model:"@",max:"@",asModel:"="},link:function(scope,element,attrs,listController){},controller:function($scope){function initStart(){for(var i=0;maxStart>i;i++)$scope.starts.push({value:"ion-ios-star-outline "})}function syncView(){if("s"==$scope.model)for(var i=0;i<$scope.value;i++){if(!($scope.value-i>=1)){$scope.starts[i].value="ion-ios-star-half";break}$scope.starts[i].value="ion-ios-star"}if("e"==$scope.model){for(var i=0;maxStart>i;i++)$scope.starts[i].value="ion-ios-star-outline";for(var i=0;i<$scope.value;i++){if(!($scope.value-i>=1)){$scope.starts[i].value="ion-ios-star-half";break}$scope.starts[i].value="ion-ios-star"}}}$scope.starts=new Array;var maxStart=$scope.max;$scope.model||($scope.model="s"),maxStart||(maxStart=5),initStart(),$scope.setValue=function(index){"s"!=$scope.model&&($scope.value=new Number(index)+1,$scope.asModel=$scope.value,syncView())},$scope.setdbValue=function(index){$scope.asModel=$scope.value,"s"!=$scope.model&&($scope.value=new Number(index)+.5,syncView())},syncView(),$scope.$watch("value",function(){syncView()})}}}]),angular.module("am.sdk").directive("suspendBox",["$ionicGesture","$ionicActionSheet","$ionicPopup","$ionicScrollDelegate","$ionicGesture","$cacheFactory","actionManagerService","ajaxManager","toolsService",function($ionicGesture,$ionicActionSheet,$ionicPopup,$ionicScrollDelegate,$ionicGesture,$cacheFactory,actionManagerService,ajaxManager,toolsService){var mPhone="",tipTemplate="<div ng-show='showView' class='avd_banner' id ='avd_top_div'><a href='tel:{{phone}}' class='avd_banner_a_01'></a><a ng-click='scrollTop()' class='avd_banner_a_02'></a></div>";return{template:function(elem,attrs){return tipTemplate},restrict:"AE",replace:!0,scope:{phone:"@",showView:"@"},link:function($scope,element,attrs){$scope.showView=!1,$scope.scrollTop=function(){$ionicScrollDelegate.scrollTop()},$("ion-content").scroll(function(){angular.isUndefined($ionicScrollDelegate.$getByHandle("mainScroll"))||($ionicScrollDelegate.$getByHandle("mainScroll").getScrollPosition().top>=100?$scope.showView=!0:$scope.showView=!1)}),$ionicGesture.on("swipeup",function(){},element,"")},controller:function($scope){if(toolsService.isEmpty(mPhone)){var rData=actionManagerService.excuteResource("get_avar_info",{vid:"customer_service"},"","");ajaxManager.ajaxToJson(rData,function(data){data.DATA.length>0&&(mPhone=data.DATA[0].VVALUE,$scope.phone=mPhone)})}$scope.$watchCollection("phone",function(){$scope.phone=mPhone})}}}]),angular.module("am.sdk").directive("album",["$ionicModal","$compile","FileAccess","Upload","toolsService","appConfig",function($ionicModal,$compile,FileAccess,Upload,toolsService,appConfig){var tipTemplate='<div class="row" class="album" style="flex-wrap:wrap;">                                <div class="col-25" ng-repeat="item in pData.showImage track by $index">                                    <img  src="{{item.showPath||item.path}}" img-zoom style="width:64px;height:64px;">                                    <i ng-click="deleteItem($index)" class="icon ion-close-circled" style="color: red;position: relative;float: right;right: 9px;top: -12px;font-size:20px;"></i>                                </div>                                <div class="col-25" ng-if="viewMode!=\'s\'&&pData.showImage.length<max">                                    <img add-resource type="0,1" out-data="pData.inputData"  src="img/button-a.png" style="width:64px;height:64px;">                                </div>                            </div>';return{template:function(elem,attrs){return tipTemplate},restrict:"AE",replace:!0,scope:{viewMode:"@",outData:"=",table:"@",field:"@",pvalue:"@",source:"@",max:"@"},link:function($scope,element,attrs){},controller:function($scope){$scope.pData={inputData:[],showImage:[],putData:[]},$scope.isInit=!1,$scope.max||($scope.max=4),$scope.$watch("source",function(){if($scope.source&&$scope.source.length>0&&!$scope.isInit){try{$scope.outData=[];for(var tempJson=JSON.parse($scope.source),i=0;i<tempJson.length;i++){var item={showPath:appConfig.baseUrl+"/"+tempJson[i].path};$scope.pData.showImage.push(item)}$scope.outData=tempJson,$scope.pData.putData=$scope.outData}catch(e){}$scope.isInit=!0}}),$scope.deleteItem=function(index){for(var temp=[],delShowPath="",i=0;i<$scope.pData.showImage.length;i++)if(i!==index){var item=$scope.pData.showImage[i];temp.push(item)}else delShowPath=$scope.pData.showImage[i].showPath;$scope.pData.showImage=temp;for(var stemp=[],tempJson=JSON.parse($scope.source),i=0;i<tempJson.length;i++)delShowPath!==appConfig.baseUrl+"/"+tempJson[i].path&&stemp.push(tempJson[i]);$scope.outData=stemp,$scope.pData.putData=$scope.outData},$scope.$watchCollection("pData.inputData",function(){if(console.info("监听"),$scope.pData.inputData[0]&&$scope.pData.inputData[0].type.indexOf("image")>-1){var item=$scope.pData.inputData[$scope.pData.inputData.length-1];if(toolsService.isEmpty(item))return void console.error("ITME 为空，则无法显示数据。");item.showPath=item.data,$scope.pData.showImage.push(item);var updataDta=[],updateItem={type:"file",data:{fileName:item.fileName,mimeType:item.mimeType,type:item.type,file:item.file,savePath:"/files/"+$scope.table+"/"+$scope.pvalue+"/"+$scope.field}};updataDta.push(updateItem),FileAccess.asUpload(updataDta,function(files){var imagepath=toolsService.fileJsonreturnstr(files,"image");if(imagepath&&imagepath.length>0){var fileName=imagepath.substring(imagepath.lastIndexOf("\\")+1,imagepath.length),updateFileItem={path:imagepath,name:fileName};$scope.pData.putData.push(updateFileItem),$scope.outData=$scope.pData.putData,console.error("outData:"+JSON.stringify($scope.outData))}},null,null,"n_space")}})}}}]),angular.module("am.sdk").directive("amsearch",["$state",function($state){var searchTemplate='<div class="list {{searchCss}} " >    <label class="item-input" style="padding:1px 0px 1px 16px;"   >        <i style="font-size:15px;" class="icon ion-search placeholder-icon"></i>        <input type="text" ng-model="searchInput" placeholder="输入搜索商品">    </label>     <a ng-click="startSearch($event)" class="search-btn button button-clear">      搜索    </a>  </div>';return{restrict:"AE",replace:!0,template:function(elem,attrs){return searchTemplate},scope:{target:"@",key:"@",searchCss:"@",searchInput:"@",goBack:"@",attch:"@",searchWord:"="},link:function(scope,element,attrs,listController){},controller:function($scope){$scope.searchCss&&void 0!=$scope.searchCss||($scope.searchCss="mall_search"),$scope.$watch("searchInput",function(){$scope.searchWord=$scope.searchInput}),$scope.startSearch=function($event){if($scope.searchInput){var params={},options={};params.searchInput=$scope.searchInput,$scope.attch&&(params.attch=$scope.attch),$scope.goBack&&(params.goBack=$scope.goBack,options.location="replace");var pstr=JSON.stringify(params);$state.go($scope.target,{cparams:pstr},options)}}}}}]).directive("buyNumber",[function(){var templateHtml='<div class="fs-16 tr_buynumber" >              <table>                <colgroup style="width:20%;"></colgroup>                <colgroup style="width:60%;text-align: center;"></colgroup>                <colgroup style="width:20%;"></colgroup>                <tr>                  <td ng-click="minus()">                    <i class="fs-18 icon ion-ios-minus-outline"></i>                  </td>                  <td style="text-align:center;">                    <input style="height:25px;display:inline;color:#0094ff;margin-bottom:7px;font-size:16px;"                     class="talign-c buy-bumber-input" type="text" value="23" ng-model="outdata"                       ng-readonly="true" >                  </td>                  <td style="color:#0094ff;" ng-click="plus()" >                    <i class="fs-18 icon ion-ios-plus-outline"></i>                  </td>                </tr>              </table>            </div>   ';return{template:templateHtml,restrict:"A",replace:!0,scope:{min:"@",outdata:"=",aClick:"=",errorTips:"=",minData:"@",maxData:"@",zoneMsg:"@"},link:function(scope,element,attrs){},controller:["$scope",function($scope){$scope.outdata||($scope.outdata=1),void 0==$scope.minData?$scope.minData=1:$scope.outdata=$scope.minData,void 0==$scope.maxData&&($scope.minData=9999),$scope.plus=function(){void 0==$scope.maxData&&($scope.maxData=9999),$scope.outdata<$scope.maxData?($scope.outdata++,$scope.aClick&&angular.isFunction($scope.aClick)&&$scope.aClick(1)):angular.isFunction($scope.errorTips)&&$scope.errorTips("plugError")},$scope.minus=function(){void 0==$scope.minData&&($scope.minData=1),$scope.outdata>$scope.minData?($scope.outdata--,$scope.aClick&&angular.isFunction($scope.aClick)&&$scope.aClick(-1)):angular.isFunction($scope.errorTips)&&$scope.errorTips("minusError")}}]}}]).directive("bannerActive",["$ionicHistory","$sce","$location","ajaxManager","toolsService","actionManagerService","$state",function($ionicHistory,$sce,$location,ajaxManager,toolsService,actionManagerService,$state){var loadDataBySQL=function(params,callFun){var rData=actionManagerService.excuteResource("banner_active_info",{condition:" and am_mobliemenuid = '"+params+"'"},"none","none");ajaxManager.ajaxToJson(rData,function(data,status,headers,config){data&&data.DATA&&callFun&&callFun(data.DATA)})};return{restrict:"AE",replace:!0,template:function(elem,attrs){return'<div class="swiper-container" id="anner_swiper"> <div class="swiper-wrapper"> <div class="swiper-slide" ng-repeat="item in repeatdata"> <img ng-click="toPage(\'{{item.URL}}\')" ng-src="{{item.LISTIMGAGE|hostFilter}}" style="width:100%;"> </div> </div> <div class="swiper-pagination"></div> </div>'},scope:{params:"@",data:"=",listEvents:"="},link:function(scope,element,attrs,listController){loadDataBySQL(scope.params,function(data){scope.repeatdata=data,setTimeout(function(){new Swiper("#anner_swiper",{pagination:".swiper-pagination",loop:!0,autoplay:3e3})},1500)})},controller:function($scope,$state){$scope.toPage=function(url){toolsService.toStateOfServerUrl($state,url)},$scope.$watchCollection("params",function(){loadDataBySQL($scope.params,function(data){$scope.repeatdata=data,setTimeout(function(){new Swiper("#anner_swiper",{pagination:".swiper-pagination",autoplay:2e3,autoplayDisableOnInteraction:!1,observer:!0})})}),$scope.toPage=function(url){console.debug("进没进"),toolsService.toStateOfServerUrl($state,url)}})}}}]).directive("freight",["ajaxManager","toolsService","actionManagerService",function(ajaxManager,toolsService,actionManagerService){var searchTemplate="<div>                      <span ng-if='isPostage==1'>包邮</span>                      <span ng-if='isPostage==0'>邮费:￥<e ng-bind='free'></e></span>                      </div>";return{restrict:"AE",replace:!0,template:function(elem,attrs){return searchTemplate},scope:{isPostage:"@",comdityId:"@",free:"="},controller:function($scope){$scope.$watch("comdityId",function(){if(0==$scope.isPostage){var rData=actionManagerService.excuteResource("getFreight",{comdityId:$scope.comdityId},"none","none");ajaxManager.ajaxToJson(rData,function(data,status,headers,config){data&&data.DATA&&data.DATA[0]&&($scope.free=new Number(data.DATA[0].PRICE).toFixed(2))})}})}}}]).directive("formatAreaInfo",["ajaxManager","toolsService","actionManagerService",function(ajaxManager,toolsService,actionManagerService){var searchTemplate="<span>                 <span ng-bind='result'></span>                </span>";return{restrict:"AE",replace:!0,template:function(elem,attrs){return searchTemplate},scope:{province:"@",city:"@",zone:"@",result:"="},controller:function($scope){var rData=actionManagerService.excuteResource("get_area_info",{pid:$scope.province,cid:$scope.city,zid:$scope.zone},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.result=data.DATA[0].PRONAME+data.DATA[0].CITYNAME+data.DATA[0].ZONENAME)})}}}]).directive("tipsModal",["ajaxManager","toolsService","actionManagerService","$sce","$ionicModal",function(ajaxManager,toolsService,actionManagerService,$sce,$ionicModal){var showTemplate="<a href='JavaScript:void(0);' ng-click='showModal()' ng-bind-html='title'></a>";return{restrict:"AE",replace:!1,template:function(elem,attrs){return showTemplate},scope:{title:"@",id:"@",busId:"@",menucode:"@",modalTempUrl:"@"},controller:function($scope){angular.element().find("#commonModalTemplate.html");$scope.contentData={};var gModal,coditionSQL=" ";$scope.modalTempUrl||($scope.modalTempUrl="commonModalTemplate"),$ionicModal.fromTemplateUrl("commonModalTemplate.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){gModal=modal}),$scope.closeModal=function(){gModal.hide()},$scope.menucode&&(coditionSQL=" AND am_mobliemenuid='"+$scope.menucode+"' "),$scope.busId&&(coditionSQL+=" AND business_code='"+$scope.busId+"' "),$scope.id&&(coditionSQL+=" AND id='"+$scope.id+"' ");var rData=actionManagerService.excuteResource("contentdetailsbycode",{codition:coditionSQL},"none","none");ajaxManager.ajaxToJson(rData,function(data){data&&data.DATA&&($scope.contentData=data.DATA[0])}),$scope.showModal=function(){gModal.show(),$(".modal-backdrop").css("width","100%"),$(".modal-backdrop").css("height","100%"),$(".modal-backdrop").css("position","fixed"),$(".modal-backdrop").css("top","0px"),$(".modal-backdrop").css("left","0px")}}}}]).directive("showPrice",[function(){var showTemplate="<span class='{{rootcss}}'>                  <font class='{{intcss}}' ng-bind='p.int'></font>                  <font class='{{decmcss}}' ng-bind='p.decm'></font>                  </span>";return{restrict:"AE",replace:!0,template:function(elem,attrs){return showTemplate},scope:{price:"@",rootcss:"@",intcss:"@",decmcss:"@"},controller:function($scope){var price=$scope.price,p=price,temp=new Number(p).toFixed(2);p["int"]=new Number(p).toFixed(0),p.decm=(temp+"").substring((temp+"").indexOf("."),(temp+"").length)}}}]),angular.module("am.banner",["ng"]),angular.module("am.banner").directive("banner",["ajaxManager","toolsService","actionManagerService",function(ajaxManager,toolsService,actionManagerService){return{restrict:"AE",replace:!0,transclude:!0,template:function(elem,attrs){return'<div class="swiper-container swiper_{{controlid}}" style="width: {{bwidth}}{{wmetering}};height:{{bheight}}{{hmetering}} "><div class="swiper-wrapper"><div class="swiper-slide" ng-repeat="item in repeatdata"><img ng-src="{{item.LISTIMGAGE|hostFilter}}"style="width: 100%;" /><span style="display:none;">{{item.URL}}</span></div></div><div class="swiper-pagination"></div></div>'},scope:{menucode:"@",repeatdata:"=",bwidth:"@",bheight:"@",controlid:"@",orgcode:"@"},controller:function($scope,$state,$timeout){$scope.$watchCollection("menucode",function(){var bannerParam={condition:" and am_mobliemenuid='"+$scope.menucode+"' and orgcode='"+$scope.orgcode+"'",status:"2"},bannerData=actionManagerService.excuteResource("banner_active_info",bannerParam,"","");ajaxManager.ajaxToJson(bannerData,function(data){toolsService.isEmpty(data.DATA)||($scope.repeatdata=data.DATA)})}),$scope.toPage=function(url){if(url.indexOf("http://")>0||url.indexOf("https://")>0||url.indexOf("www.")>0)window.open(url,"_system","location=yes");else if(console.debug("banner_unit.url="+url),url.indexOf("/")>0){var arr=url.split("/");console.debug("toolsService.toStateOfServerUrl().$state.go("+arr[0]+",{params:"+arr[1]+"})"),$state.go(arr[0],{params:arr[1]})}else $state.go(url,{})},$timeout(function(){new Swiper(".swiper_"+$scope.controlid,{pagination:".swiper-pagination",paginationClickable:!1,autoplay:5e3,initialSlide:0,autoplayDisableOnInteraction:!1,observer:!0,onTap:function(swiper){$scope.toPage(swiper.clickedSlide.childNodes[1].innerText)}})},200)},link:function(scope,element,attrs,controller){}}}]),angular.module("am.bar",["ng"]),angular.module("am.bar").directive("buttonbar",["$ionicHistory","$sce","$location","ajaxManager","toolsService","actionManagerService",function($ionicHistory,$sce,$location,ajaxManager,toolsService,actionManagerService){var barcss="left:0;top:0;width: 100%; overflow: hidden;background:rgba(0,0,0,0);font: 12px/40px hiragino sans gb, microsoft yahei, simsun;",swiper_slide="width:auto;";return{restrict:"AE",replace:!0,template:function(elem,attrs){return'<div style="'+barcss+'" class="swiper-container-horizontal swiper-container-free-mode button_bar{{controlid}}"><div class="swiper-wrapper" style="transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><div class="swiper-slide" ng-click="choice({{value}},{{$index}})" id="bar_{{$index}}" style="width:{{bwith}}" ng-repeat="value in repeatdata" ng-include="btemplte">{{value}}</div>'},scope:{name:"@",save:"&",params:"@",repeatdata:"=",controlid:"=",aClick:"=",btemplte:"@",bwith:"@"},controller:function($scope){var panes=[],params="";this.addData=function(pane){0==panes.length&&(panes.push(pane),params=eval(panes[0].params),setTimeout(function(){for(var initslidenumber=0,i=0;i<panes[0].repeatdata.length;i++)"0"==panes[0].repeatdata[i].status&&(initslidenumber=i);new Swiper(".button_bar"+panes[0].controlid,{freeMode:!0,slidesPerView:"auto",observer:!0,initialSlide:initslidenumber})},50))},$scope.choice=function(obj,index){for(var i=0;i<panes[0].repeatdata.length;i++)i==index?$scope.repeatdata[i].status="0":$scope.repeatdata[i].status="1";$scope.aClick&&angular.isFunction($scope.aClick)&&$scope.aClick(obj)}},link:function(scope,element,attrs,controller){scope.repeatdata=eval(scope.params),controller.addData(scope)}}}]),angular.module("am.sdk").directive("scrollHeight",function($window){return{restrict:"AE",link:function(scope,element,attr){element[0].style.height=$window.innerHeight-.3*$window.innerHeight-42+"px"}}}),angular.module("am.sdk").directive("ctlSelectDirective",["ajaxManager","toolsService","$cacheFactory","$sce","$ionicModal","$compile","$sce","$rootScope","$state","$ionicBackdrop",function(ajaxManager,toolsService,$cacheFactory,$sce,$ionicModal,$compile,$sce,$rootScope,$state,$ionicBackdrop){var thisURL=function(url){var BASE_URL="sdk/directives/control/select_control/";return BASE_URL+url};return{templateUrl:thisURL("SelectPageView.html"),restrict:"AE",replace:!1,scope:{styleType:"@",selectData:"@",defautLable:"@",clickSelect:"=",StorageData:"@"},link:function($scope,element,attr){},controller:["$scope","$ionicScrollDelegate","$timeout",function($scope,$ionicScrollDelegate,$timeout){function getJsonObjLength(jsonObj){var Length=0;for(var item in jsonObj)Length++;return Length}var list_height=0,getlocalStorage=function(){var rValue={name:"最近搜索",data:{}};return toolsService.isEmpty(localStorage.getItem($scope.mDefautLable))||(rValue=angular.fromJson(localStorage.getItem($scope.mDefautLable))),$scope.StorageData=rValue,rValue},putLocalStorage=function(lable,value){angular.isUndefined($scope.StorageData)&&($scope.StorageData=getlocalStorage()),$scope.StorageData.data[lable]=value,"1"===$scope.styleType&&($scope.ListData[0]=$scope.StorageData),localStorage.setItem($scope.mDefautLable,angular.toJson($scope.StorageData))},showModel=function(isShow,isModal){isShow?($(".backdrop").css("background-color","rgba(0, 0, 0,0)"),isModal&&$scope.modal.show(),$ionicBackdrop.retain(),$scope.ImageUrl=thisURL("img/select_02.png"),$("html").bind("click",function(evt){"HTML"==$(evt.target.nodeName).selector&&$scope.modal.hide()})):($(".backdrop").css("background-color","rgba(0, 0, 0,0)"),$scope.ImageUrl=thisURL("img/select_01.png"),isModal&&$scope.modal.hide(),$ionicBackdrop.release())};console.info("am.sdk.ctlSelectDirective[v1.0.3] start run ..."),$ionicModal.fromTemplateUrl("control/select_control/select-modal.html",{scope:$scope,animation:"slide-in-up"}).then(function(modal){$scope.modal=modal}),$scope.mDefautLable=$scope.defautLable,$scope.ImageUrl=thisURL("img/select_01.png"),$scope.$watchCollection("selectData",function(){var mListData=new Array;"2"===$scope.styleType?toolsService.isEmpty($scope.selectData)||mListData.push(JSON.parse($scope.selectData)):"1"===$scope.styleType&&(mListData.push(getlocalStorage()),toolsService.isEmpty($scope.selectData)||mListData.push(JSON.parse($scope.selectData))),$scope.ListData=mListData}),$scope.buttonClick=function(){0!==$scope.ListData.length&&(list_height=40*getJsonObjLength($scope.ListData[0].data),showModel(!0,!0))},$scope.close=function(){showModel(!1,!0)},$scope.ItemClick=function(lable,value,index){$scope.defautLable=lable,showModel(!1,!0),putLocalStorage(lable,value),$scope.clickSelect&&angular.isFunction($scope.clickSelect)&&$scope.clickSelect(value)},$scope.$on("$destroy",function(){$(".backdrop").css("background-color","rgba(0, 0, 0,0)"),$scope.modal.remove()}),$scope.$on("modal.hidden",function(){$(".backdrop").css("background-color","rgba(0, 0, 0,0)"),showModel(!1,!1)}),$scope.$on("modal.removed",function(){$(".backdrop").css("background-color","rgba(0, 0, 0,0)"),showModel(!1,!1)})}]}}]),angular.module("am.sdk").directive("imgZoom",["$ionicGesture","$ionicModal","$compile",function($ionicGesture,$ionicModal,$compile){var tipTemplate='<ion-modal-view>                                  <ion-content ng-click="closeModa()"><ion-scroll zooming="true" direction="xy" style="width: 100%; height: 100%; position: absolute; top: 0; bottom: 0; left: 0; right: 0; ">                                    <div style="width: 100%; height: 100%; background: url({{src}});background-size: 100%;background-repeat: no-repeat;background-position:center center;"></div>                                    </ion-scroll>                                  </ion-content>                                </ion-modal-view>';return{template:function(elem,attrs){var html="";return html=elem.context?elem.context.outerHTML.replace('img-zoom=""',""):elem[0].outerHTML.replace('img-zoom=""',"")},restrict:"AE",replace:!0,scope:{src:"@",clickFun:"="},link:function($scope,element,attrs){element.on("click",function(){$scope.showZoomView()})},controller:function($scope){$scope.zoomViewModal=$ionicModal.fromTemplate(tipTemplate,{scope:$scope,animation:"slide-in-up"});var scrollContentTop="";$scope.showZoomView=function(){angular.element(document.querySelector("modal-backdrop active")).attr("css",""),$scope.zoomViewModal.show(),$(".modal-backdrop").css("width","100%"),$(".modal-backdrop").css("height","100%"),$(".modal-backdrop").css("position","fixed"),$(".modal-backdrop").css("top","0px"),$(".modal-backdrop").css("left","0px"),scrollContentTop=$(".scroll-content").css("padding-top"),$(".scroll-content").css("padding-top","0px"),$(".modal-backdrop-bg").css("height","100%")},$scope.closeModa=function(){$scope.zoomViewModal.hide(),$(".scroll-content").css("padding-top",scrollContentTop)},$scope.$on("$destroy",function(){console.debug("1"),$scope.zoomViewModal.isShown()&&($scope.closeModa(),$scope.zoomViewModal.remove())})}}}]),angular.module("am.sdk").directive("mallShelvesDirective",["ajaxManager","toolsService","actionManagerService","$sce","$ionicModal","$compile","$sce","$rootScope","$state","appConfig",function(ajaxManager,toolsService,actionManagerService,$sce,$ionicModal,$compile,$sce,$rootScope,$state,appConfig){var templateurl="sdk/directives/mall/template/mall_activity_directive_template.html";return{templateUrl:templateurl,restrict:"AE",replace:!1,scope:{pageType:"@"},link:function($scope,element,attr){},controller:function($scope){$scope.toPage=function(ctype,ttype,id,url,param,start,end){$scope.toUrl(ctype,ttype,id,start,end)},$scope.host_address=appConfig.baseUrl;var isActiveStartOrEnd=function(startDate,endDate){var rValue=!0,tMsg="";return toolsService.isEmpty(startDate)&&toolsService.isEmpty(endDate)||(new Date(startDate)-new Date>0?(tMsg="活动未开始，请等待！",rValue=!1):new Date-new Date(endDate)>0&&(tMsg="对不起，活动已结束！",rValue=!1),""!==tMsg&&toolsService.tips(tMsg,"")),rValue};$scope.toUrl=function(ctype,ttype,id,startDate,endDate){console.debug("ctype"+ctype),console.debug("ttype"+ttype);var urlObj=new Array;urlObj["1-1"]="commodity.scenicspotdetails",urlObj["1-2"]="commodity.comdDetails",urlObj["2-1"]="commodity.hoteldetails",urlObj["2-2"]="commodity.comdDetails",urlObj["3-1"]="commodity.restaurantdetails",urlObj["3-2"]="commodity.comdDetails",urlObj["4-1"]="commodity.performingdetails",urlObj["4-2"]="commodity.comdDetails",urlObj["5-1"]="speciality.specialityList",urlObj["5-2"]="commodity.comdDetails",urlObj["6-1"]="commodity.carRentalDetails",urlObj["6-2"]="commodity.comdDetails",urlObj["7-1"]="commodity.discountGroupDetails",
urlObj["7-2"]="commodity.comdDetails",urlObj["8-1"]="commodity.grouptourdetails",urlObj["8-2"]="commodity.comdDetails",urlObj["9-1"]="commodity.carRentalDetails",urlObj["9-2"]="commodity.comdDetails",urlObj["11-2"]="commodity.comdDetails",urlObj[-2]="commodity.comdDetails";var tUrl=urlObj[ttype+"-"+ctype];if(isActiveStartOrEnd)var params={id:id};toolsService.isEmpty(tUrl)||("commodity.comdDetails"==tUrl?$state.go(tUrl,params):$state.go(tUrl,{params:JSON.stringify(params)}))};var result_data=null;$scope.getMallTemplateInfo=function(type){var rData=actionManagerService.getMallActivitytemplate(type);ajaxManager.ajaxToJson(rData,function(data){if(!toolsService.isEmpty(data)){result_data=JSON.parse(data.DATA),$scope.ShelvesData=result_data;for(var i=0;i<$scope.ShelvesData.length;i++){if("6"==$scope.ShelvesData[i].ACTIVITIESTYPE||"8"==$scope.ShelvesData[i].ACTIVITIESTYPE&&!toolsService.isEmpty($scope.ShelvesData[i].MALL_COMMODITYCLASS))for(var j=0;j<$scope.ShelvesData[i].MALL_COMMODITYCLASS.length;j++)$scope.swiperInit($scope.ShelvesData[i].MALL_COMMODITYCLASS[j].ID,j);if("10"===$scope.ShelvesData[i].ACTIVITIESTYPE&&!toolsService.isEmpty($scope.ShelvesData[i].MALL_COMMODITYCLASS))for(var j=0;j<$scope.ShelvesData[i].MALL_COMMODITYCLASS.length;j++)$scope.swiperInit2($scope.ShelvesData[i].MALL_COMMODITYCLASS[j].ID,j)}}})},$scope.getMallTemplateInfo($scope.pageType),$scope.swiperInit=function(idx,index){setTimeout(function(){new Swiper(".mall_activity_adv_"+idx+"_"+index,{effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",autoplay:"3000",autoplayDisableOnInteraction:!1,observer:!0,resizeReInit:!0,loop:!0,initialSlide:1,coverflow:{rotate:50,stretch:0,depth:100,modifier:1}})},100)},$scope.swiperInit2=function(idx,index){setTimeout(function(){new Swiper(".mall_activity_adv_"+idx+"_"+index,{slidesPerView:3,paginationClickable:!0,spaceBetween:5,observer:!0,observeParents:!0})},100)}}}}]),angular.module("am.sdk").directive("mallShelvesDirectiveChild",["ajaxManager","toolsService","actionManagerService","$sce","$ionicModal","$compile","$sce","$rootScope","$state",function(ajaxManager,toolsService,actionManagerService,$sce,$ionicModal,$compile,$sce,$rootScope,$state){var templateurl="sdk/directives/mall/template/mall_activity_directive_child_template.html";return{templateUrl:templateurl,restrict:"AE",replace:!1,scope:{htmlDiv:"@",title:"@",itype:"@"},link:function($scope,element,attr){toolsService.isEmpty($scope.htmlDiv)||($scope.classItem=JSON.parse($scope.htmlDiv),$scope.divShow="true",$scope.cssTitleA="mall_title_active_on",$scope.cssTitleB="down_hr_b",$scope.ptitle=$scope.title),$scope.selectTitle=function(item){"0"==item?($scope.divShow=!0,$scope.cssTitleA="mall_title_active_on",$scope.cssTitleB="down_hr_b"):($scope.divShow=!1,$scope.cssTitleA="down_hr_b",$scope.cssTitleB="mall_title_active_on")},$scope.toUrlOthert=function(url,param){$state.go($scope.classItem.URL,$scope.classItem.URL_PARAM)},$scope.toUrlt=function(ctype,ttype,id,startDate,endDate){var urlObj=new Array;urlObj["5-1"]="speciality.specialityList",urlObj["5-2"]="commodity.comdDetails";var tUrl=urlObj[ttype+"-"+$scope.itype],params={id:id};$state.go(tUrl,{params:JSON.stringify(params)})}},controller:function($scope){}}}]),angular.module("am.sdk").directive("mallShelvesDirectiveChild01",["ajaxManager","toolsService","actionManagerService","$sce","$ionicModal","$compile","$sce","$rootScope","$state","appConfig",function(ajaxManager,toolsService,actionManagerService,$sce,$ionicModal,$compile,$sce,$rootScope,$state,appConfig){var templateurl="sdk/directives/mall/template/mall_activity_directive_child_template_01.html";return{templateUrl:templateurl,restrict:"AE",replace:!1,scope:{htmlDiv:"@",title:"@",itype:"@"},link:function($scope,element,attr){toolsService.isEmpty($scope.htmlDiv)||($scope.classItem=JSON.parse($scope.htmlDiv),$scope.divShow="true",$scope.cssTitleA="mall_title_active_on",$scope.cssTitleB="down_hr_b",$scope.ptitle=$scope.title),$scope.toClassDeatils=function(url,stateData,endData,param,title,state,end_time,start_time){if(ionic.Platform.isIOS())if("2"==state){if((new Date).getTime()-start_time<0)return void toolsService.tips("活动还未开始","");if((new Date).getTime()-end_time>0)return void toolsService.tips("活动已结束","");var classId="";toolsService.isEmpty(param)||(classId=JSON.parse(param).id);var p={id:classId,title:title};$state.go(url,{params:JSON.stringify(p)})}else{toolsService.isEmpty(param)||(classId=JSON.parse(param).id);var p={id:classId,title:title};$state.go(url,{params:JSON.stringify(p)})}else if("2"==state){if((new Date).getTime()-new Date(stateData).getTime()<0)return void toolsService.tips("活动还未开始","");if((new Date).getTime()-new Date(endData).getTime()>0)return void toolsService.tips("活动已结束","");var classId="";toolsService.isEmpty(param)||(classId=JSON.parse(param).id);var p={id:classId,title:title};$state.go(url,{params:JSON.stringify(p)})}else{toolsService.isEmpty(param)||(classId=JSON.parse(param).id);var p={id:classId,title:title};$state.go(url,{params:JSON.stringify(p)})}}},controller:function($scope){}}}]),angular.module("am.sdk").filter("dateComparison",[function(){return function(input,endtime,type){function getTimes(time){var rMillisecond=new Date(time)-new Date;rMillisecond=Math.abs(rMillisecond);var rDay=parseInt(rMillisecond/1e3/60/60/24,10),rHour=parseInt(rMillisecond/1e3/60/60%24,10),rMinute=parseInt(rMillisecond/1e3/60%60,10),rSecond=parseInt(rMillisecond/1e3%60,10),remainingTime=rDay+"天 "+rHour+"小时"+rMinute+"分钟 "+rSecond+"秒";return remainingTime}if(""!=type)return new Date(endtime)-new Date<0?void(new Date(input)-new Date>0?setInterval(function(){return"距离开始时间:"+getTimes(input)},1e3):setInterval(function(){return"距离结束时间:"+getTimes(endtime)},1e3)):"已经结束"}}]),angular.module("am.sdk").filter("datefmttoday",["toolsService",function(toolsService){return function(input,type){var resultTimer=input,currentyear=(new Date).getFullYear(),currentmonth=(new Date).getMonth()+1,currentday=(new Date).getDate(),inputDate=null;return toolsService.isEmpty(input)||(inputDate=(new Date).initFmtDate(input),currentyear==inputDate.getFullYear()&&currentmonth==inputDate.getMonth()+1&&(currentday==inputDate.getDate()?resultTimer=inputDate.getHours()+":"+inputDate.getMinutes():inputDate.getDate()+1==currentday&&(resultTimer="昨天"))),resultTimer}}]),angular.module("am.sdk").filter("getMemberInfoFilter",["toolsService",",actionManagerService","ajaxManager",function(toolsService,actionManagerService,ajaxManager){return function(input,type){var inputResource=null,rData=actionManagerService.excuteResource("getUserBasInfo",{memberid:input},"none","none");return ajaxManager.ajaxToJson(rData,function(data){!toolsService.isEmpty(data)&&data.DATA[0].length>0&&(inputResource=data.DATA[0])}),inputResource}}]),angular.module("mallMobileApp.services").service("FileAccess",["$rootScope","$cordovaFile","Upload","Authen","appConfig",function($rootScope,$cordovaFile,Upload,Authen,appConfig){function mkdir(path,callback){$cordovaFile.checkDir(path,"").then(function(success){angular.isFunction(callback)&&callback(success)},function(error){$cordovaFile.createDir(path,"",!0).then(function(success){angular.isFunction(callback)&&callback(success)},function(error){})})}function createFile(path,fileName,callback){mkdirFile(path,function(){$cordovaFile.checkFile(path,fileName).then(function(success){angular.isFunction(callback)&&callback(success)},function(error){$cordovaFile.createFile(path,fileName,!0).then(function(success){angular.isFunction(callback)&&callback(success)},function(error){})})})}function writeData(data,filePaht,fileName,append,callback){createFile(filePaht,fileName,function(){var mData=JSON.stringify(data);append?$cordovaFile.writeExistingFile(filePaht,fileName,mData).then(function(success){console.error("文件数据写入成功！"),console.error("filePaht:\n"+filePaht+"fileName:\n"+fileName),angular.isFunction(callback)&&callback(filePaht,fileName)},function(error){}):$cordovaFile.writeFile(filePaht,fileName,mData,!0).then(function(data){console.error("文件数据写入成功！"),console.error("filePaht:\n"+filePaht+"fileName:\n"+fileName),angular.isFunction(callback)&&callback(filePaht,fileName,data)},function(error){})})}function readerData(readFilePaht,fileName,callback,type){var readFun=$cordovaFile.readAsText;"text"===type?readFun=$cordovaFile.readAsText:"url"===type?readFun=$cordovaFile.readAsDataURL:"binary"===type?readFun=$cordovaFile.readAsBinaryString:"array"===type&&(readFun=$cordovaFile.readAsArrayBuffer),readFun(readFilePaht,fileName).then(function(success){angular.isFunction(callback)&&callback(success)},function(error){console.error(JSON.stringify(error))})}function clearFileData(filePath,fileName,callback){writeData("",filePath,fileName,!1,callback)}function asUpload(data,callback,afterProcess,befoProcess,businessType){var uploadUrl=appConfig.uploadurl,files=[];befoProcess&&""!=befoProcess||!memberId||(befoProcess=""),afterProcess&&""!=afterProcess||(afterProcess="");for(var i=0;i<data.length;i++){var item=data[i];if("file"==item.type)item.data.userId=memberId,item.data.afterProcess=afterProcess,item.data.beforeProcess=befoProcess,businessType&&(item.data.businessType=businessType),console.error("asUpload"),console.error(item.data),Upload.upload({url:uploadUrl,data:item.data}).then(function(resp){console.error(JSON.stringify(resp.data)),files.push({path:resp.data.NET_FILE_PATH,type:resp.data.TYPE}),files.length==data.length&&angular.isFunction(callback)&&callback(files)},function(resp){console.log("Error status: "+resp.status)},function(evt){var progressPercentage=parseInt(100*evt.loaded/evt.total);console.log("progress: "+progressPercentage+"% "+evt.config.data.file.name)});else if("path"==item.type){var pathToFile=item.data.path;pathToFile=cordova.file.externalRootDirectory+item.data.path,console.error("pathToFile:\n"+pathToFile);var fileURL=pathToFile,uri=encodeURI(uploadUrl),options=new FileUploadOptions;options.fileKey="file",options.fileName=fileURL.substr(fileURL.lastIndexOf("/")+1),options.mimeType="audio/mp3",options.type="audio",options.userId=memberId,options.params={},options.params.userId=memberId,options.params.afterProcess=afterProcess,options.params.userId=memberId,options.params.afterProcess=afterProcess,options.params.beforeProcess=befoProcess,options.params.businessType=businessType,options.headers={headerParam:"headerValue"};var ft=new FileTransfer;ft.onprogress=function(progressEvent){progressEvent.lengthComputable?loadingStatus.setPercentage(progressEvent.loaded/progressEvent.total):loadingStatus.increment()},ft.upload(fileURL,uri,function(r){console.error(JSON.stringify(r));var resp=JSON.parse(r.response);files.push({path:resp.NET_FILE_PATH,type:resp.TYPE}),files.length==data.length&&angular.isFunction(callback)&&callback(files)},function(error){console.error(error)},options)}}}var memberId=Authen.getUserId();return{mkdir:mkdir,createFile:createFile,writeData:writeData,readerData:readerData,clearFileData:clearFileData,asUpload:asUpload}}]),angular.module("mallMobileApp.services").service("stateGo",["toolsService","$state","$rootScope","appConfig","actionManagerService","ajaxManager","md5","PlatformManagerService",function(toolsService,$state,$rootScopem,appConfig,actionManagerService,ajaxManager,md5,PlatformManagerService){return{go:function(url,params,replace){var lstr={location:"replace"},str=null;replace||(lstr=""),str="string"==typeof params?params:JSON.stringify(params),$state.go(url,{params:str},lstr)}}}]),angular.module("mallMobileApp.services").service("Authen",["toolsService","$state","$rootScope","appConfig","actionManagerService","ajaxManager","md5","PlatformManagerService",function(toolsService,$state,$rootScopem,appConfig,actionManagerService,ajaxManager,md5,PlatformManagerService){function getLocationOfBMap(){var geolocation=new BMap.Geolocation;geolocation.getCurrentPosition(function(r){var lng=r.point.lng,lat=r.point.lat;console.info("Authen.getLocationOfBMap.position = "+lat+" | "+lng),setDriverGpsLocation(lng,lat)})}var mDriverLocation={currentPoint:{lng:"119.735623",lat:"49.2179031"},address:"",addressComponents:{}},mThisUser={isLogin:!1,MemberData:{},MPOPENID:""},mLoginCtrlAccountObjectName="LoginCtrl_AccountObject",saveLocalUserAccuot=function(sAccountObj){var mAccountLableName=mLoginCtrlAccountObjectName,tAccountObject=angular.fromJson(localStorage.getItem(mAccountLableName));return angular.isUndefined(sAccountObj)||(tAccountObject=sAccountObj,localStorage.setItem(mAccountLableName,angular.toJson(sAccountObj))),toolsService.isEmpty(tAccountObject)&&(tAccountObject={state:!1,account:"",type:"",password:""}),tAccountObject},setAccount=function(state,account,type,pwd){var tAccountObject={state:state,account:account,type:type,password:pwd};saveLocalUserAccuot(tAccountObject)},loginOfServer=function(account,pass,logintype,funSucess){var UserPassword=md5.createHash(pass),rData=actionManagerService.MemberLogin(logintype,account,UserPassword,"","",toolsService.loginterminal(),mDriverLocation.address,mDriverLocation.currentPoint.lat,mDriverLocation.currentPoint.lng);ajaxManager.ajaxToJson(rData,function(data){"0"===data.CODE&&(toolsService.isEmpty(data.MEMBER_DATA)||(mThisUser.MemberData=data.MEMBER_DATA,mThisUser.isLogin=!0,PlatformManagerService.registXingeToken(data.MEMBER_DATA.ID,"",PlatformManagerService.getMobileType()))),funSucess(data)})},getGpsPointToBMapPoint=function(lng,lat,callFun){if(toolsService.platform())callFun(lng,lat);else{console.debug("Authen.getGpsPointToBMapPoint.position(1) = "+lat+" | "+lng);var gpsPoint=new BMap.Point(lng,lat);console.debug("Authen.getGpsPointToBMapPoint.position(2) = "+lat+" | "+lng),BMap.Convertor.translate(gpsPoint,2,function(point){console.debug("Authen.getGpsPointToBMapPoint.position(3) = "+point.lat+" | "+point.lng),callFun(point.lng,point.lat)})}},setDriverGpsLocation=function(lng,lat){console.info("Authen.setDriverGpsLocation.position(1) = "+lat+" | "+lng),getGpsPointToBMapPoint(lng,lat,function(lng,lat){mDriverLocation.currentPoint.lng=lng,mDriverLocation.currentPoint.lat=lat,console.info("Authen.setDriverGpsLocation.position(2) = "+lat+" | "+lng),getPointToAddressOfBaidu(lng,lat)})},getPointToAddressOfBaidu=function(lng,lat){var gc=new BMap.Geocoder,tPoint=new BMap.Point(lng,lat);gc.getLocation(tPoint,function(GeocoderResult){GeocoderResult&&(mDriverLocation.address=GeocoderResult.address,mDriverLocation.addressComponents=GeocoderResult.addressComponents,console.debug(mDriverLocation))})};return{getUserId:function(){return mThisUser.MemberData.ID},getUserName:function(){return mThisUser.MemberData.MEMBERNAME},getUserPass:function(){return mThisUser.MemberData.LOGINPASSWORD},getUserAccount:function(){return mThisUser.MemberData.LOGINACCOUNT},getUserInfo:function(){return mThisUser.MemberData},getAuditRole:function(){return mThisUser.MemberData.AUDIT_ROLE},isAuthorized:function(){return mThisUser.isLogin},login:function(account,pass,logintype,funSucess){loginOfServer(account,pass,logintype,funSucess)},getAccountLableName:function(){return mLoginCtrlAccountObjectName},logout:function(){mThisUser.isLogin=!1,mThisUser.MemberData={};var tAccountObj=saveLocalUserAccuot();setAccount(tAccountObj.state,tAccountObj.account,tAccountObj.type,"")},getDriverLocation:function(){return appConfig.isDerive===!1&&getLocationOfBMap(),mDriverLocation},setDriverLocation:function(lng,lat){setDriverGpsLocation(lng,lat)},getBMUserLocation:function(){return mDriverLocation},isRoleUser:function(targetRole){var result=!1;return console.info("AuthenService.isRoleUser().targetRole="+targetRole),mThisUser.isLogin&&mThisUser.MemberData.MEMBER_TYPE===targetRole&&(result=!0),result},getUserMPOpenId:function(){return document.getElementById("wx_open_id")&&(mThisUser.MPOPENID=document.getElementById("wx_open_id").value),mThisUser.MPOPENID},getLocalUserAccuot:function(sAccountObj){return saveLocalUserAccuot(sAccountObj)},loginOfAuto:function(funSucess){var tAccount=saveLocalUserAccuot(),account=tAccount.account,tPassWord=tAccount.password;tAccount.type;toolsService.isEmpty(tAccount.password)||loginOfServer(account,tPassWord,"",funSucess)},getLocationOfBMap:getLocationOfBMap}}]),angular.module("mallMobileApp.services").service("AmCommonService",["toolsService","$state","$rootScope","appConfig","actionManagerService","ajaxManager","$ionicActionSheet",function(toolsService,$state,$rootScopem,appConfig,actionManagerService,ajaxManager,$ionicActionSheet){var addCollection=function(value){if(!toolsService.isEmpty(value))if(toolsService.isEmpty(value.memberid))toolsService.showMessage("您还未登陆！","");else{var rData=actionManagerService.collectionManager(value.id,value.memberid,value.type);ajaxManager.ajaxToJson(rData,function(data){toolsService.showMessage("收藏成功！","")})}};return{addCollection:addCollection}}]),angular.module("mallMobileApp.services").service("PlatformManagerService",["toolsService","$state","$rootScope","appConfig","actionManagerService","ajaxManager","$ionicActionSheet","$cacheFactory",function(toolsService,$state,$rootScopem,appConfig,actionManagerService,ajaxManager,$ionicActionSheet,$cacheFactory){var mobileType="",otherInstallObj=null,setMobileType=function(type){initInstall(),mobileType=type},getMobileType=function(){return mobileType},getOtherInstall=function(){return otherInstall(),otherInstallObj},registXingeToken=function(memberId,token,mobile){var cashtoken=$cacheFactory.get("cash_xg_token");if(toolsService.isEmpty(cashtoken)&&!toolsService.isEmpty(token)){var caches=$cacheFactory("cash_xg_token");caches.put("xg_token",token)}else toolsService.isEmpty(cashtoken)||(token=cashtoken.get("xg_token"));if(!toolsService.isEmpty(mobile)&&!toolsService.isEmpty(token)){var rData=actionManagerService.registUserToken(memberId,token,mobile);ajaxManager.ajaxToJson(rData,function(data){"0"==data.code?console.log("PlatformManagerService.registXingeToken.success.token>>"+token):console.log("PlatformManagerService.registXingeToken.lost.token>>"+token)})}},otherInstall=function(){"android"==mobileType?(appAvailability.check(otherInstallObj.android[0].app,function(){otherInstallObj.android[0].isin=!0},function(){otherInstallObj.android[0].isin=!1}),appAvailability.check(otherInstallObj.android[1].app,function(){otherInstallObj.android[1].isin=!0},function(){otherInstallObj.android[1].isin=!1}),appAvailability.check(otherInstallObj.android[2].app,function(){otherInstallObj.android[2].isin=!0},function(){otherInstallObj.android[2].isin=!1})):"ios"==mobileType&&(appAvailability.check(otherInstallObj.ios[0].app,function(){otherInstallObj.ios[0].isin=!0},function(){otherInstallObj.ios[0].isin=!1}),appAvailability.check(otherInstallObj.ios[1].app,function(){otherInstallObj.ios[1].isin=!0},function(){otherInstallObj.ios[1].isin=!1}),appAvailability.check(otherInstallObj.ios[2].app,function(){otherInstallObj.ios[2].isin=!0},function(){otherInstallObj.ios[2].isin=!1}))},initInstall=function(){otherInstallObj={android:[{app:"com.tencent.mobileqq",isin:!0,name:"分享至腾讯QQ"},{app:"com.tencent.mm",isin:!0,name:"分享至微信朋友圈"},{app:"com.tencent.mm",isin:!0,name:"分享至微信朋友"},{app:"com.sina.weibo",isin:!0,name:"分享至新浪微博"}],ios:[{app:"mqq://",isin:!0,name:"分享至腾讯QQ"},{app:"weixin:/",isin:!0,name:"分享至微信朋友圈"},{app:"weixin:/",isin:!0,name:"分享至微信朋友"},{app:"weibo://",isin:!0,name:"分享至新浪微博"}],mobile_brower:[{app:"",isin:!0,name:"QQ分享"},{app:"",isin:!0,name:"新浪微博分享"}]}},otherLoginManager=function(platformType,loginType,json,successCall,errorCall){"1"==loginType&&navigator.QQ.ssoLogin(successCall,errorCall,json),"2"==loginType&&navigator.weixin.auth(successCall,errorCall),"3"==loginType&&navigator.Weibo.ssoLogin(successCall,errorCall,json)},otherShareManager=function(platformType,loginType,json,successCall,errorCall){var title=appConfig.appName;json.hasOwnProperty("title")&&(title=json.title);var newJso={img:appConfig.shareImg,description:json.content,title:title,imageUrl:appConfig.shareImg,url:appConfig.shareUrl};"1"===loginType&&navigator.QQ.shareToQQ(function(){toolsService.tips("分享成功","")},function(error){},newJso),"2"===loginType&&(console.debug("PlatformManagerService.js_otherShareManager.json[2微信_JSON]=="+JSON.stringify(json)),console.debug("PlatformManagerService.js_otherShareManager.lgin_type[2微信_img_url]=="+json.img),navigator.weixin.share({message:{title:title,description:json.content,mediaTagName:title,thumb:appConfig.shareImg,media:{type:navigator.weixin.Type.WEBPAGE,webpageUrl:appConfig.shareUrl}},scene:navigator.weixin.Scene.TIMELINE},function(){toolsService.tips("分享成功","")},function(reason){})),"4"===loginType&&(console.debug("PlatformManagerService.js_otherShareManager.json[2微信_JSON]=="+JSON.stringify(json)),console.debug("PlatformManagerService.js_otherShareManager.lgin_type[2微信_img_url]=="+json.img),navigator.weixin.share({message:{title:title,description:json.content,mediaTagName:title,thumb:appConfig.shareImg,media:{type:navigator.weixin.Type.WEBPAGE,webpageUrl:appConfig.shareUrl}},scene:navigator.weixin.Scene.SESSION},function(){toolsService.tips("分享成功","")},function(reason){})),"3"===loginType&&navigator.Weibo.shareToWeibo(function(){toolsService.tips("分享成功","")},function(error){toolsService.tips(error,"")},newJso)},shock=function(time){navigator.vibrate(time)},otherWapLoginManager=function(platformType,loginType,json,successCall,errorCall){"2"==loginType&&navigator.weixin.auth(successCall,errorCall),"3"==loginType&&navigator.Weibo.ssoLogin(successCall,errorCall,json)};return{registXingeToken:registXingeToken,setMobileType:setMobileType,getMobileType:getMobileType,otherShareManager:otherShareManager,otherLoginManager:otherLoginManager,otherInstall:otherInstall,getOtherInstall:getOtherInstall,shock:shock,initInstall:initInstall,otherWapLoginManager:otherWapLoginManager}}]);var sdk_services_common_service_payment_IPayment=function(orderInfo,onSuccess,onError){this.execute=function(orderInfo,onSuccess,onError){}},sdk_services_common_service_payment_IPayment_impl_AlipayPayment=function(orderInfo,onSuccess,onError){this.execute=function(orderInfo,onSuccess,onError){navigator.alipay&&navigator.alipay.pay&&navigator.alipay.pay(orderInfo,onSuccess,onError)}},sdk_services_common_service_payment_IPayment_impl_MpWeiChartPaymentImpl=function(prepayId,onSuccess,onError){this.execute=function(data,callFun){function onBridgeReady(){WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:data.appId,timeStamp:data.timeStamp,nonceStr:data.nonceStr,"package":data["package"],signType:"MD5",paySign:data.paySign},function(res){console.info("微信公众账号支付返回res参数:"+JSON.stringify(res)),callFun&&callFun(res)})}"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",onBridgeReady,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",onBridgeReady),document.attachEvent("onWeixinJSBridgeReady",onBridgeReady)):(console.error(onBridgeReady),onBridgeReady())}},sdk_services_common_service_payment_IPayment_impl_WxpayPayment=function(prepayId,onSuccess,onError){this.execute=function(prepayId,onSuccess,onError){navigator.weixin.sendPayReq(prepayId,onSuccess,onError)}};angular.module("mallMobileApp.services").service("JPushService",["$rootScope","$cordovaFile","Upload","Authen","appConfig","toolsService","actionManagerService","ajaxManager",function($rootScope,$cordovaFile,Upload,Authen,appConfig,toolsService,actionManagerService,ajaxManager){var onReceiveMessage=function(event){var message="";try{message="Android"==ionic.Platform.isAndroid()?event.message:event.content}catch(exception){console.log("JPushPlugin:onReceiveMessage-->"+exception)}return message},onReceiveNotification=function(event){try{var alertContent;return alertContent="Android"==ionic.Platform.isAndroid()?event.alert:event.aps.alert}catch(exception){console.log(exception)}},onOpenNotification=function(event){try{var alertContent;alertContent="Android"==ionic.Platform.isAndroid()?event.alert:event.aps.alert,alert("open Notification:"+alertContent)}catch(exception){console.log("JPushPlugin:onOpenNotification"+exception)}};return{onReceiveMessage:onReceiveMessage,onReceiveNotification:onReceiveNotification,onOpenNotification:onOpenNotification}}]),angular.module("mallMobileApp.services").service("OtherHandleService",["toolsService","$state","$rootScope","appConfig","actionManagerService","ajaxManager","$ionicActionSheet","PlatformManagerService","ShareService",function(toolsService,$state,$rootScopem,appConfig,actionManagerService,ajaxManager,$ionicActionSheet,PlatformManagerService,ShareService){var shareJSON=null,share=function(params){var installs=PlatformManagerService.getOtherInstall(),buttons=[];if("android"===PlatformManagerService.getMobileType()){for(var i=0;i<installs.android.length>0;i++)if(installs.android[i].isin){var obj={text:installs.android[i].name,id:i,shareType:"1"};buttons.push(obj)}}else if("ios"===PlatformManagerService.getMobileType()){for(var i=0;i<installs.ios.length>0;i++)if(installs.ios[i].isin){var obj={text:installs.ios[i].name,id:i,shareType:"1"};buttons.push(obj)}}else buttons=[{text:"QQ分享",id:0,shareType:"1"},{text:"微信分享",id:1},{text:"微博分享",id:2,shareType:"1"}];"0"!=params.type&&buttons.push({text:"内部分享",id:"3",shareType:"2"},{text:"内部分享",id:"4",shareType:"2"},{text:"内部分享",id:"5",shareType:"2"},{text:"内部分享",id:"6",shareType:"2"},{text:"内部分享",id:"7",shareType:"2"},{text:"内部分享",id:"8",shareType:"2"},{text:"内部分享",id:"9",shareType:"2"},{text:"内部分享",id:"10",shareType:"2"},{text:"内部分享",id:"11",shareType:"2"},{text:"内部分享",id:"12",shareType:"2"},{text:"内部分享",id:"13",shareType:"2"},{text:"内部分享",id:"14",shareType:"2"},{text:"内部分享",id:"15",shareType:"2"},{text:"内部分享",id:"16",shareType:"2"},{text:"内部分享",id:"17",shareType:"2"},{text:"内部分享",id:"18",shareType:"2"},{text:"内部分享",id:"19",shareType:"2"});for(var i=buttons.length-1;i>=0;i--)"0"===params.scope?"0"===params.type?"2"===buttons[i].shareType&&buttons.splice(i,1):"2"===buttons[i].shareType&&buttons[i].id!==params.type&&buttons.splice(i,1):"1"===params.scope?"2"===buttons[i].shareType&&buttons.splice(i,1):"2"==params.scope&&("1"===buttons[i].shareType||buttons[i].id!==params.type)&&buttons.splice(i,1);shareJSON=params,shareJSON.imageUrl=appConfig.shareImg,shareJSON.shareToUrl=appConfig.shareUrl;var title="分享";showTips(shareJSON,title,buttons)},shareClick=function(type,params){"0"==type?PlatformManagerService.otherShareManager(PlatformManagerService.getMobileType(),"1",params,function(success){toolsService.tips("分享成功","")},function(error){toolsService.tips("分享失败","")}):"1"==type?PlatformManagerService.otherShareManager(PlatformManagerService.getMobileType(),"2",params,function(success){toolsService.tips("分享成功","")},function(error){toolsService.tips("分享失败","")}):"2"==type?PlatformManagerService.otherShareManager(PlatformManagerService.getMobileType(),"4",params,function(success){toolsService.tips("分享成功","")},function(error){toolsService.tips("分享失败","")}):"3"==type?PlatformManagerService.otherShareManager(PlatformManagerService.getMobileType(),"3",params,function(success){toolsService.tips("分享成功","")},function(error){toolsService.tips("分享失败","")}):type>=4&&PlatformManagerService.otherInnerShareManager(type,params,function(success){toolsService.tips("分享成功","")},function(error){toolsService.tips("分享失败","")})},showTips=function(params,title,btns){console.debug(btns),$ionicActionSheet.show({buttons:btns,titleText:'<b style="font-size:16px;">'+title+"</b>",cancelText:'<b style="color:red;">取消</b>',cancel:function(){},buttonClicked:function(index){var type=btns[index].id;return shareClick(type,params),!0}})};return{share:share}}]),formatAmSqlParams.prototype.addRow=function(obj){this.ROWS.push(obj)},formatAmSqlupdateRow.prototype.setStatus=function(status){this.STATUS=status},formatAmSqlupdateRow.prototype.setID=function(id){this.ID=id},formatAmSqlupdateRow.prototype.addColumn=function(colName,colValue){var obj={};obj[colName.toString()]=colValue,this.COLUMNS.push(obj)},angular.module("mallMobileApp.services").service("ReceiveMessageService",["$rootScope","$cordovaFile","Upload","Authen","appConfig","toolsService","actionManagerService","ajaxManager",function($rootScope,$cordovaFile,Upload,Authen,appConfig,toolsService,actionManagerService,ajaxManager){var myDate=new Date;myDate=myDate.Format("yyyy-MM-dd hh:mm:ss");var addReceiveMessage=function(data,content,platformStr){var userId=data.extras.friendid;console.debug(userId);var title=data.extras.title,imgcontent="",noticeId="";if(toolsService.isEmpty(data.extras.imgcontent)||(content="",imgcontent=JSON.parse(data.extras.imgcontent)),"1"==data.extras.type){var pushMessage=[],friendId=data.extras.memberid,friendName="",friendHead="",friendMessage="",friendurl='common.chat/{"friendId":"'+friendId+'"}';noticeId=data.extras.phone;var message=localStorage.getItem("message");if(!toolsService.isEmpty(message)){pushMessage=JSON.parse(message);for(var i=0;i<pushMessage.length;i++)pushMessage[i].friendid==friendId&&pushMessage[i].memberid==userId&&(friendMessage=pushMessage[i])}var rData=actionManagerService.excuteResource("uoou.chat.pushmessage",{friendid:friendId,memberid:userId},"none","none");if(ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||(friendName=toolsService.isEmpty(data.DATA[0].REMARK_NAME)?data.DATA[0].MEMBERNAME:data.DATA[0].REMARK_NAME,friendHead=data.DATA[0].WXHEADIMG)}),toolsService.isEmpty(friendMessage)){var message={memberid:userId,friendid:friendId,friendname:friendName,friendremark:friendName,friendhead:friendHead,messagenum:"1",pushtime:myDate,message:[{memberid:friendId,content:content,imgcontent:imgcontent,createtime:myDate}]};pushMessage.push(message)}else for(var message={memberid:friendId,content:content,imgcontent:imgcontent,createtime:myDate},i=0;i<pushMessage.length;i++)pushMessage[i].friendid==friendId&&pushMessage[i].memberid==userId&&(pushMessage[i].message.push(message),pushMessage[i].messagenum=parseInt(pushMessage[i].messagenum)+1,pushMessage[i].pushtime=myDate);localStorage.setItem("message",JSON.stringify(pushMessage));var dnd=localStorage.getItem("no_disturb");("false"==dnd||toolsService.isEmpty(dnd))&&(toolsService.isEmpty(content)&&(content="[图片]"),console.info("安卓通知"),$rootScope.$emit("to-parent","parent"),navigator.notification.vibrate(1e3),window.plugins.jPushPlugin.addLocalNotification(0,content,title,noticeId,0,{url:""+friendurl})),$rootScope.$broadcast("FromSelf",{divName:"app.js",description:"向子传播数据"})}else if("2"==data.extras.type){var pushMessage=[],groupId=data.extras.groupid,memberId=data.extras.memberid,memberName="",memberHead="",groupMessage="",groupName="",groupurl='common.groupchat/{"groupId":"'+groupId+'"}';noticeId=data.extras.groupno;var message=localStorage.getItem("group_message");if(!toolsService.isEmpty(message)){pushMessage=JSON.parse(message);for(var i=0;i<pushMessage.length;i++)pushMessage[i].groupid==groupId&&(groupMessage=pushMessage[i])}var rData=actionManagerService.excuteResource("uoou.groupchat.memberinfo",{id:memberId},"none","none");ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||(memberName=data.DATA[0].MEMBERNAME,memberHead=data.DATA[0].WXHEADIMG)});var rData=actionManagerService.excuteResource("uoou.chat.groupchat",{memberid:groupId},"none","none");if(ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||(groupName=data.DATA[0].GROUP_NAME)}),toolsService.isEmpty(groupMessage)){var message={groupid:groupId,groupname:groupName,messagenum:"1",pushtime:myDate,message:[{memberid:memberId,membername:memberName,memberhead:memberHead,content:content,imgcontent:imgcontent,createtime:myDate}]};pushMessage.push(message)}else for(var message={memberid:memberId,membername:memberName,memberhead:memberHead,content:content,imgcontent:imgcontent,createtime:myDate},i=0;i<pushMessage.length;i++)pushMessage[i].groupid==groupId&&(pushMessage[i].message.push(message),pushMessage[i].messagenum=parseInt(pushMessage[i].messagenum)+1,pushMessage[i].pushtime=myDate);
localStorage.setItem("group_message",JSON.stringify(pushMessage)),$rootScope.$broadcast("GroupFromSelf",{divName:"app.js",description:"向子传播数据"});var dnd=localStorage.getItem("no_disturb");("false"==dnd||toolsService.isEmpty(dnd))&&(toolsService.isEmpty(content)&&(content="[图片]"),console.info("安卓通知"),$rootScope.$emit("to-parent","parent"),navigator.notification.vibrate(1e3),window.plugins.jPushPlugin.addLocalNotification(0,content,groupName,noticeId,0,{url:""+groupurl}))}},addReceiveIosMessage=function(data,content,platformStr){console.debug(platformStr);var userId=data.jsonExtra.friendid;console.debug(userId);var title=data.jsonExtra.title,imgcontent="",noticeId="";if(toolsService.isEmpty(data.jsonExtra.imgcontent)||(content="",imgcontent=JSON.parse(data.jsonExtra.imgcontent)),"1"==data.jsonExtra.type){var pushMessage=[],friendId=data.jsonExtra.memberid,friendName="",friendHead="",friendMessage="",friendurl='common.chat/{"friendId":"'+friendId+'"}';noticeId=data.jsonExtra.phone;var message=localStorage.getItem("message");if(!toolsService.isEmpty(message)){pushMessage=JSON.parse(message);for(var i=0;i<pushMessage.length;i++)pushMessage[i].friendid==friendId&&pushMessage[i].memberid==userId&&(friendMessage=pushMessage[i])}var rData=actionManagerService.excuteResource("uoou.chat.pushmessage",{friendid:friendId,memberid:userId},"none","none");if(ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||(friendName=toolsService.isEmpty(data.DATA[0].REMARK_NAME)?data.DATA[0].MEMBERNAME:data.DATA[0].REMARK_NAME,friendHead=data.DATA[0].WXHEADIMG)}),toolsService.isEmpty(friendMessage)){var message={memberid:userId,friendid:friendId,friendname:friendName,friendremark:friendName,friendhead:friendHead,messagenum:"1",pushtime:myDate,message:[{memberid:friendId,content:content,imgcontent:imgcontent,createtime:myDate}]};pushMessage.push(message)}else for(var message={memberid:friendId,content:content,imgcontent:imgcontent,createtime:myDate},i=0;i<pushMessage.length;i++)pushMessage[i].friendid==friendId&&pushMessage[i].memberid==userId&&(pushMessage[i].message.push(message),pushMessage[i].messagenum=parseInt(pushMessage[i].messagenum)+1);localStorage.setItem("message",JSON.stringify(pushMessage));var dnd=localStorage.getItem("no_disturb");("false"==dnd||toolsService.isEmpty(dnd))&&(toolsService.isEmpty(content)&&(content="[图片]"),console.info("IOS通知"),$rootScope.$emit("to-parent","parent"),navigator.notification.vibrate(1e3),window.plugins.jPushPlugin.addLocalNotification(0,content,title,noticeId,0,{url:""+friendurl})),$rootScope.$broadcast("FromSelf",{divName:"app.js",description:"向子传播数据"})}else if("2"==data.jsonExtra.type){var pushMessage=[];console.info("群id:"+data.jsonExtra.groupid);var groupId=data.jsonExtra.groupid,memberId=data.jsonExtra.memberid,memberName="",memberHead="",groupMessage="",groupName="",groupurl='common.groupchat/{"groupId":"'+groupId+'"}';noticeId=data.jsonExtra.groupno;var message=localStorage.getItem("group_message");if(!toolsService.isEmpty(message)){pushMessage=JSON.parse(message);for(var i=0;i<pushMessage.length;i++)pushMessage[i].groupid==groupId&&(groupMessage=pushMessage[i])}var rData=actionManagerService.excuteResource("uoou.groupchat.memberinfo",{id:memberId},"none","none");ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||(memberName=data.DATA[0].MEMBERNAME,memberHead=data.DATA[0].WXHEADIMG)});var rData=actionManagerService.excuteResource("uoou.chat.groupchat",{memberid:groupId},"none","none");if(ajaxManager.ajaxTosyc(rData,function(data){toolsService.isEmpty(data.DATA)||(groupName=data.DATA[0].GROUP_NAME)}),toolsService.isEmpty(groupMessage)){var message={groupid:groupId,groupname:groupName,messagenum:"1",pushtime:myDate,message:[{memberid:memberId,membername:memberName,memberhead:memberHead,content:content,imgcontent:imgcontent,createtime:myDate}]};pushMessage.push(message)}else for(var message={memberid:memberId,membername:memberName,memberhead:memberHead,content:content,imgcontent:imgcontent,createtime:myDate},i=0;i<pushMessage.length;i++)pushMessage[i].groupid==groupId&&(pushMessage[i].message.push(message),pushMessage[i].messagenum=parseInt(pushMessage[i].messagenum)+1);localStorage.setItem("group_message",JSON.stringify(pushMessage)),$rootScope.$broadcast("GroupFromSelf",{divName:"app.js",description:"向子传播数据"});var dnd=localStorage.getItem("no_disturb");("false"==dnd||toolsService.isEmpty(dnd))&&(toolsService.isEmpty(content)&&(content="[图片]"),console.info("设备:"+ionic.Platform.isAndroid()),ionic.Platform.isAndroid()?(console.info("安卓通知"),$rootScope.$emit("to-parent","parent"),navigator.notification.vibrate(1e3),window.plugins.jPushPlugin.addLocalNotification(0,content,groupName,noticeId,0,{url:""+groupurl})):(console.info("苹果通知"),$rootScope.$emit("to-parent","parent"),navigator.notification.vibrate(1e3)))}};return{addReceiveMessage:addReceiveMessage,addReceiveIosMessage:addReceiveIosMessage}}]),angular.module("mallMobileApp.services").service("ShareService",["toolsService","$state","$rootScope","appConfig","actionManagerService","ajaxManager","$ionicActionSheet",function(toolsService,$state,$rootScopem,appConfig,actionManagerService,ajaxManager,$ionicActionSheet){var shareQQ=function(params){console.debug("ShareService.js+shareQQ+params:"+params.img);var _url=location.href,_showcount=0,_desc="",_summary="",_title="",_site="",_pic="",_width=600,_height=500,_shareUrl="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";_shareUrl+="url="+encodeURIComponent(_url||document.location),_shareUrl+="&showcount="+_showcount||0,_shareUrl+="&desc="+encodeURIComponent(_desc||"分享的描述"),_shareUrl+="&summary="+encodeURIComponent(_summary||"分享摘要"),_shareUrl+="&title="+encodeURIComponent(_title||document.title),_shareUrl+="&site="+encodeURIComponent(_site||""),_shareUrl+="&pics="+encodeURIComponent(_pic||params.img),window.open(_shareUrl,"_blank","width="+_width+",height="+_height+",top="+(screen.height-_height)/2+",left="+(screen.width-_width)/2+",toolbar=no,menubar=no,scrollbars=no,resizable=1,location=no,status=0")},shareSina=function(params){console.debug("ShareService.js+shareSina+params:"+params.img);var _url=location.href,_title="",_source="",_sourceUrl="",_pic="",_width=600,_height=500,_shareUrl="http://v.t.sina.com.cn/share/share.php?";_shareUrl+="&url="+encodeURIComponent(_url||document.location),_shareUrl+="&title="+encodeURIComponent(_title||document.title),_shareUrl+="&source="+encodeURIComponent(_source||""),_shareUrl+="&sourceUrl="+encodeURIComponent(_sourceUrl||""),_shareUrl+="&content=utf-8",_shareUrl+="&pic="+encodeURIComponent(_pic||params.img),window.open(_shareUrl,"_blank","toolbar=no,menubar=no,scrollbars=no,resizable=1,location=no,status=0,width="+_width+",height="+_height+",top="+(screen.height-_height)/2+",left="+(screen.width-_width)/2)},mpWeiChartShare=function(params){WeixinJSBridge.invoke("shareTimeline",{img_url:"http://yuebin616.iask.in/img/app_icon.png",link:"http://yuebin616.iask.in/wap/",desc:"微信",title:"呼旅网，微信分享"})};return{shareQQ:shareQQ,shareSina:shareSina,mpWeiChartShare:mpWeiChartShare}}]),angular.module("mallMobileApp.services").service("GetTonken",["toolsService","$state","$rootScope","appConfig","actionManagerService","ajaxManager","md5","PlatformManagerService","$cordovaDevice","$ionicPlatform",function(toolsService,$state,$rootScopem,appConfig,actionManagerService,ajaxManager,md5,PlatformManagerService,$cordovaDevice,$ionicPlatform){return{}}]);